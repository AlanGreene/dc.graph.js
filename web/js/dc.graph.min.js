/*!
 *  dc.graph 0.1.0
 *  http://dc-js.github.io/dc.graph.js/
 *  Copyright 2015 Gordon Woodhull
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

!function(){function a(a,b,c){"use strict";function d(a,b){return function(){return a(b.apply(null,arguments))}}function e(a,b,c,d){var e=Math.tan(Math.atan2(d,c));e*=e;var f={x:a*b/Math.sqrt(b*b+a*a*e),y:a*b/Math.sqrt(a*a+b*b/e)};return 0>c&&(f.x=-f.x),0>d&&(f.y=-f.y),f}function f(a,b){for(var c=["M",a[0],",",a[1]],d=b,e=!1,f=2;f<a.length;f+=2)(isNaN(a[f])||isNaN(a[f+1]))&&(e=!0),c.push(d===b?j[b]:" ",a[f],",",a[f+1]),0===--d&&(d=b);return d!=b&&console.log("warning: pts.length didn't match bezness",a,b),c.join("")}var g={version:"0.1.0"},h=function(a){var b=a,c=null,d=function(a){return arguments.length?(b=a,c&&c(a),this):b};return d.react=function(a){return arguments.length?(c=a,this):c},d},i=function(a){return a};g.functor_wrap=function(a,b){return"function"==typeof a?b?function(c){return a(b(c))}:a:function(){return a}};var j={1:"L",2:"Q",3:"C"};return g.diagram=function(j,k){function l(a){return g.functor_wrap(a,function(a){return a.orig})}function m(){switch(E=cola.d3adaptor().avoidOverlaps(!0).size([z.width(),z.height()]),z.lengthStrategy()){case"symmetric":E.symmetricDiffLinkLengths(z.baseLength());break;case"jaccard":E.jaccardLinkLengths(z.baseLength());break;case"individual":E.linkDistance(function(a){var b=a.orig?l(z.edgeDistanceAccessor())(a):a.internal&&a.internal.distance;return b||z.baseLength()});break;case"none":}z.modLayout()&&z.modLayout()(E)}function n(a){return"edge-"+l(z.edgeKeyAccessor())(a).replace(/[^\w-_]/g,"-")}function o(a){return!!a.source&&!!a.target}function p(a,b,c,d,g){var h,i,j,k,m,n,o=d-b,p=g-c,q=a.source.dcg_ry+l(z.nodeStrokeWidthAccessor())(a.source)/2,r=a.target.dcg_ry+l(z.nodeStrokeWidthAccessor())(a.target)/2;if(a.parallel){var s=!!(a.parallel%2)==d>b?-1:1,t=Math.floor((a.parallel+1)/2)*s,u=Math.atan2(p,o),v=u+t*z.parallelEdgeOffset()/q,w=u-Math.PI-t*z.parallelEdgeOffset()/r,x=Math.cos(v),y=Math.sin(v),A=Math.cos(w),B=Math.sin(w),C=Math.hypot(d-b,g-c);m=e(a.source.dcg_rx,a.source.dcg_ry,x,y),n=e(a.target.dcg_rx,a.target.dcg_ry,A,B);var D=Math.hypot(m.x,m.y),E=Math.hypot(n.x,n.y),F=Math.max(D+q/4,Math.min(2*D,C/2)),G=Math.min(E+r/4,Math.min(2*E,C/2));h=b+m.x,i=c+m.y;var H=b+F*x,I=c+F*y,J=d+G*A,K=g+G*B;return j=d+n.x,k=g+n.y,a.length=Math.hypot(j-h,k-i),f([h,i,H,I,J,K,j,k],3)}return m=e(a.source.dcg_rx,a.source.dcg_ry,o,p),n=e(a.target.dcg_rx,a.target.dcg_ry,-o,-p),h=b+m.x,i=c+m.y,j=d+n.x,k=g+n.y,a.length=Math.hypot(j-h,k-i),f([h,i,j,k],1)}function q(a){return p(a,a.source.prevX||a.source.x,a.source.prevY||a.source.y,a.target.prevX||a.target.x,a.target.prevY||a.target.y)}function r(a){return p(a,a.source.x,a.source.y,a.target.x,a.target.y)}function s(a,b){a.every(function(a){return 0===a.size()})&&b();var c=0;a.forEach(function(a){a.each(function(){++c}).each("end.all",function(){--c||b.apply(this,arguments)})})}function t(a,b,c,d,e,f,g){console.assert(H),console.assert(c.data().every(o)),b.attr("transform",function(a){return"translate("+a.x+","+a.y+")"});var h=a.transition().duration(z.transitionDuration()).attr("opacity","1").attr("transform",function(a){return"translate("+a.x+","+a.y+")"});h.each("end.record",function(a){a.prevX=a.x,a.prevY=a.y}),d.attr("d",q);var i=c.transition().duration(z.transitionDuration()).attr("opacity",l(z.edgeOpacityAccessor())).attr("d",r);z.showLayoutSteps()||s([h,i],function(){F.end()}),e.attr("d",r),g.transition().duration(z.transitionDuration()).attr("transform",function(a){if(a.target.x<a.source.x){var b=this.getBBox(),c=b.x+b.width/2,d=b.y+b.height/2;return"rotate(180 "+c+" "+d+")"}return"rotate(0)"}).attr("dy",function(a){return a.target.x<a.source.x?11:-2})}function u(){B.attr("transform","translate("+a.event.translate+") scale("+a.event.scale+")")}function v(){A&&A.attr("width",z.width()).attr("height",z.height())}function w(){return A=z.root().append("svg"),v(),z.defineArrow("vee",12,12,10,0,function(a){a.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),z.defineArrow("dot",7,7,0,0,function(a){a.append("svg:circle").attr("r",5).attr("cx",5).attr("cy",0).attr("stroke-width","0px")}),z.mouseZoomable()&&A.call(a.behavior.zoom().on("zoom",u)),A}var x,y,z={},A=null,B=null,C=null,D=null,E=null,F=a.dispatch("end"),G={},H=!1;z.width=h(200).react(v),z.height=h(200).react(v),z.root=h(null).react(function(a){a.empty()&&console.log("Warning: parent selector "+j+" doesn't seem to exist")}),z.mouseZoomable=h(!0),z.nodeDimension=h(),z.nodeGroup=h(),z.edgeDimension=h(),z.edgeGroup=h(),z.nodeKeyAccessor=h(function(a){return a.key}),z.edgeKeyAccessor=h(function(a){return a.key}),z.sourceAccessor=h(function(a){return a.value.sourcename}),z.targetAccessor=h(function(a){return a.value.targetname}),z.nodeRadiusAccessor=h(function(){return 25}),z.nodeStrokeWidthAccessor=h(function(){return"1"}),z.nodeStrokeAccessor=h(function(){return"black"}),z.nodeFillScale=h(i),z.nodeFillAccessor=h(function(){return"white"}),z.nodePadding=h(6),z.nodeLabelAccessor=h(function(a){return a.value.label||a.value.name}),z.nodeLabelFillAccessor=h(null),z.nodeFitLabelAccessor=h(!0),z.nodeTitleAccessor=h(function(a){return z.nodeKeyAccessor()(a)}),z.nodeOrdering=h(null),z.nodeFixedAccessor=h(null),z.edgeStrokeAccessor=h(function(){return"black"}),z.edgeStrokeWidthAccessor=h(function(){return"1"}),z.edgeOpacityAccessor=h(function(){return"1"}),z.edgeLabelAccessor=h(function(a){return z.edgeKeyAccessor()(a)}),z.edgeArrowheadAccessor=h(function(){return"vee"}),z.edgeArrowtailAccessor=h(function(){return null}),z.edgeIsLayoutAccessor=h(function(a){return!a.value.notLayout}),z.lengthStrategy=h("symmetric"),z.edgeDistanceAccessor=h(function(a){return a.value.distance}),z.baseLength=h(30),z.highlightNeighbors=h(!1),z.transitionDuration=h(500),z.timeLimit=h(0),z.constrain=h(function(){return[]}),z.parallelEdgeOffset=h(5),z.edgeOrdering=h(null),z.initLayoutOnRedraw=h(!1),z.layoutUnchanged=h(!1),z.relayout=function(){return x=y=null,this},z.induceNodes=h(!1),z.modLayout=h(function(){}),z.showLayoutSteps=h(!1),z.legend=h(null).react(function(a){a.parent(z)});var I={},J={};z._buildNode=function(a,b){z.nodeTitleAccessor()&&b.append("title"),b.append("ellipse"),b.append("text").attr("class","node-label").attr("fill",l(z.nodeLabelFillAccessor())),a.select("title").text(l(z.nodeTitleAccessor())),a.select("text.node-label").text(l(z.nodeLabelAccessor())).each(function(a){var b,c=l(z.nodeRadiusAccessor())(a),d=2*c+z.nodePadding();l(z.nodeFitLabelAccessor())(a)&&(b=this.getBBox());var e=0;if(b&&b.width&&b.height){var f=b.height/2/c,g=b.width/2/Math.sqrt(1-f*f);e=2*g+z.nodePadding(),a.dcg_rx=Math.max(g,c),a.dcg_ry=c}else a.dcg_rx=a.dcg_ry=c;a.width=Math.max(e,d),a.height=d}),a.select("ellipse").attr("rx",function(a){return a.dcg_rx}).attr("ry",function(a){return a.dcg_ry}).attr("stroke",l(z.nodeStrokeAccessor())).attr("stroke-width",l(z.nodeStrokeWidthAccessor())).attr("fill",d(z.nodeFillScale(),l(z.nodeFillAccessor())))},z.isRunning=function(){return H};var K=!1;return z.redraw=function(){H?K=!0:window.setTimeout(function(){z.startLayout()},10)},z.startLayout=function(){function c(a){var b=z.nodeKeyAccessor()(a);I[b]||(I[b]={});var c=I[b];c.orig=a;var d;return z.nodeFixedAccessor()&&(d=z.nodeFixedAccessor()(a)),d?(c.x=a.x,c.y=a.y,c.fixed=!0):c.fixed=!1,i[b]=!0,c}function d(a){var b=z.edgeKeyAccessor()(a);J[b]||(J[b]={});var c=J[b];return c.orig=a,c.source=I[z.sourceAccessor()(a)],c.target=I[z.targetAccessor()(a)],j[b]=!0,c}function e(a){return a.orig}var f=z.nodeGroup().all(),h=z.edgeGroup().all();if(H)throw new Error("dc_graph.diagram.redraw already running!");H=!0,E&&E.stop(),z.initLayoutOnRedraw()&&m(),z.nodeOrdering()&&(f=b.quicksort.by(z.nodeOrdering())(f.slice(0),0,f.length)),z.edgeOrdering()&&(h=b.quicksort.by(z.edgeOrdering())(h.slice(0),0,h.length));var i={},j={},k=f.map(c);for(var p in I)i[p]||delete I[p];var q=h.map(d);for(var r in J)j[r]||delete J[r];if(q=q.filter(o),q=q.filter(function(a){return a.source!==a.target}),z.induceNodes()){var s={};q.forEach(function(a){s[l(z.sourceAccessor())(a)]=!0,s[l(z.targetAccessor())(a)]=!0}),k=k.filter(function(a){return s[l(z.nodeKeyAccessor())(a)]})}k.forEach(function(a,b){a.index=b}),G={nnodes:k.length,nedges:q.length};var u=!1;if(!z.layoutUnchanged()){var v=JSON.stringify(k.map(e)),w=JSON.stringify(q.map(e));v===x&&w===y&&(u=!0),x=v,y=w}if(z.parallelEdgeOffset()){for(var A=new Array(k.length),B=0;B<A.length;++B){A[B]=new Array(A.length);for(var L=0;L<A.length;++L)A[B][L]=0}q.forEach(function(a){var b=Math.min(a.source.index,a.target.index),c=Math.max(a.source.index,a.target.index);a.parallel=A[b][c]++})}var M=D.selectAll(".edge").data(q,l(z.edgeKeyAccessor())),N=M.enter().append("svg:path").attr({"class":"edge",id:n,opacity:0});M.attr("stroke",l(z.edgeStrokeAccessor())).attr("stroke-width",l(z.edgeStrokeWidthAccessor())).attr("marker-end",function(a){var b=l(z.edgeArrowheadAccessor())(a);return b?"url(#"+b+")":null}).attr("marker-start",function(a){var b=l(z.edgeArrowtailAccessor())(a);return b?"url(#"+b+")":null}),M.exit().transition().duration(z.transitionDuration()).attr("opacity",0).remove();var O=D.selectAll(".edge-hover").data(q,l(z.edgeKeyAccessor())),P=O.enter().append("svg:path").attr("class","edge-hover").attr("opacity",0).attr("stroke","green").attr("stroke-width",10).on("mouseover",function(b){a.select("#"+n(b)+"-label").attr("visibility","visible")}).on("mouseout",function(b){a.select("#"+n(b)+"-label").attr("visibility","hidden")});O.exit().remove();var Q=D.selectAll(".edge-label").data(q,l(z.edgeKeyAccessor())),R=Q.enter().append("text").attr("id",function(a){return n(a)+"-label"}).attr("visibility","hidden").attr({"class":"edge-label","text-anchor":"middle",dy:-2}).append("textPath").attr("startOffset","50%").attr("xlink:href",function(a){return"#"+n(a)}).text(function(a){return l(z.edgeLabelAccessor())(a)});Q.exit().transition().duration(z.transitionDuration()).attr("opacity",0).remove();var S=C.selectAll(".node").data(k,l(z.nodeKeyAccessor())),T=S.enter().append("g").attr("class","node").attr("opacity","0").call(E.drag);z.highlightNeighbors()&&T.on("mouseover",function(a){M.attr("stroke-width",function(b){return(b.source===a||b.target===a?2:1)*l(z.edgeStrokeWidthAccessor())(b)})}).on("mouseout",function(){M.attr("stroke-width",l(z.edgeStrokeWidthAccessor()))}),z._buildNode(S,T),S.exit().transition().duration(z.transitionDuration()).attr("opacity",0).remove();var U=z.constrain()(k,q);U.forEach(function(a){if(a.type)switch(a.type){case"alignment":a.offsets.forEach(function(a){a.node=I[a.node].index});break;case"circle":a.nodes.forEach(function(a){a.node=I[a.node].index})}else a.axis&&(a.left=I[a.left].index,a.right=I[a.right].index)}),E.on("tick",function(){var a=Date.now()-Y;z.showLayoutSteps()&&t(S,T,M,N,O,P,Q,R),(K||z.timeLimit()&&a>z.timeLimit())&&(console.log("cancelled"),E.stop())});var V=q.filter(l(z.edgeIsLayoutAccessor())),W=(q.filter(function(a){return!l(z.edgeIsLayoutAccessor())(a)}),U.filter(function(a){return"circle"===a.type}));U=U.filter(function(a){return"circle"!==a.type}),W.forEach(function(a){var b=(a.distance||4*z.baseLength())/(2*Math.sin(Math.PI/a.nodes.length)),c=a.nodes.map(function(a){return a.node}),d=function(a){return l(z.nodeKeyAccessor())(k[a])},e=g.wheel_edges(d,c,b).map(function(a){var b={internal:a};return b.source=I[a.sourcename],b.target=I[a.targetname],b});V=V.concat(e)});var X=U.filter(function(a){return"ordering"===a.type});if(U=U.filter(function(a){return"ordering"!==a.type}),X.forEach(function(a){var c,d=b.quicksort.by(l(a.ordering))(a.nodes.map(function(a){return I[a]}),0,a.nodes.length);d.forEach(function(b,d){0===d?c=b:U.push({left:c.index,right:(c=b).index,axis:a.axis,gap:a.gap})})}),u)return H=!1,F.end(),this;var Y=Date.now();return E.nodes(k).links(V).constraints(U).start(10,20,20).on("end",function(){z.showLayoutSteps()?F.end():t(S,T,M,N,O,P,Q,R),H=!1,K&&(K=!1,window.setTimeout(function(){z.startLayout()},0))}),this},z.render=function(){return z.initLayoutOnRedraw()||m(),z.resetSvg(),B=A.append("g").attr("class","dc-graph"),D=B.append("g"),C=B.append("g"),z.legend()&&z.legend().render(),z.redraw()},z.on=function(a,b){return F.on(a,b),this},z.getStats=function(){return G},z.select=function(a){return z.root().select(a)},z.selectAll=function(a){return z.root()?z.root().selectAll(a):null},z.svg=function(a){return arguments.length?(A=a,z):A},z.resetSvg=function(){return z.select("svg").remove(),w()},z.redrawGroup=function(){c.redrawAll(k)},z.renderGroup=function(){c.renderAll(k)},z.defineArrow=function(a,b,c,d,e,f){A.append("svg:defs").append("svg:marker").attr("id",a).attr("viewBox","0 -5 10 10").attr("refX",d).attr("refY",e).attr("markerUnits","userSpaceOnUse").attr("markerWidth",b).attr("markerHeight",c).attr("orient","auto").call(f)},z.root(a.select(j)),c.registerChart(z,k),z},g.legend=function(){var a={},b=null;return a.x=h(0),a.y=h(0),a.gap=h(5),a.nodeWidth=h(40),a.nodeHeight=h(40),a.exemplars=h({}),a.parent=h(null),a.render=function(){var c=a.parent().svg().selectAll("g.dc-graph-legend").data([0]).enter();b=c.append("g").attr("class","dc-graph-legend").attr("transform","translate("+a.x()+","+a.y()+")");var d,e=a.exemplars();if(e instanceof Array)d=e.map(function(a){return{name:a.name,orig:{key:a.key,value:a.value}}});else{d=[];for(var f in e)d.push({name:f,orig:{key:f,value:e[f]}})}var g=b.selectAll(".node").data(d,function(a){return a.name}),h=g.enter().append("g").attr("class","node").attr("transform",function(b,c){return"translate("+a.nodeWidth()/2+","+(a.nodeHeight()+a.gap())*(c+.5)+")"});h.append("text").attr("class","legend-label").attr("transform","translate("+(a.nodeWidth()/2+a.gap())+",0)").text(function(a){return a.name}),a.parent()._buildNode(g,h)},a},g.load_graph=function(b,c){var d=b.replace(/\?.*/,"");/\.json$/.test(d)?a.json(b,c):/\.gv|\.dot$/.test(d)&&a.text(b,function(a,b){if(a)return void c(a,null);var d=graphlibDot.parse(b),e=d.nodes(),f=new Array(e.length);e.forEach(function(a,b){var c=f[b]=d._nodes[e[b]];c.id=b,c.name=a});var g=d.edges(),h=[];g.forEach(function(a){var b=d._edges[a];h.push({source:d._nodes[b.u].id,target:d._nodes[b.v].id,sourcename:b.u,targetname:b.v})});var i={nodes:f,links:h};c(null,i)})},g.node_name=function(a){if(26>a)return String.fromCharCode(97+a);if(52>a)return String.fromCharCode(65+a-26);if(2704>a)return g.node_name(Math.floor(a/52))+g.node_name(a%52);throw new Error("no, that's too large")},g.node_object=function(a,b){return b=b||{},_.extend({id:a,name:g.node_name(a)},b)},g.edge_object=function(a,b,c,d){return d=d||{},_.extend({source:b,target:c,sourcename:a(b),targetname:a(c)},d)},g.generate=function(a,b,c,d){var e,f,h,i,j=c.nodePrefix||"",k=function(a){return e[a].name},l=b[0],m=c.linkLength||30;switch(a){case"clique":case"cliquestf":for(e=new Array(l),f=[],h=0;l>h;++h)for(e[h]=g.node_object(h,{circle:"A",name:j+g.node_name(h)}),i=0;h>i;++i)f.push(g.edge_object(k,h,i,{notLayout:!0,undirected:!0}));if("cliquestf"===a)for(h=0;l>h;++h)e[h+l]=g.node_object(h+l),e[h+2*l]=g.node_object(h+2*l),f.push(g.edge_object(k,h,h+l,{undirected:!0})),f.push(g.edge_object(k,h,h+2*l,{undirected:!0}));break;case"wheel":for(e=new Array(l),h=0;l>h;++h)e[h]=g.node_object(h,{name:j+g.node_name(h)});f=g.wheel_edges(k,_.range(l),l*m/2);var n=f[0].distance;for(h=0;h<b[1];++h)for(i=0;l>i;++i)f.push(g.edge_object(k,i,(i+1)%l,{distance:n,par:h+2}));break;default:throw new Error("unknown generation type "+a)}var o={nodes:e,links:f};d(null,o)},g.wheel_edges=function(a,b,c){for(var d=b.length,e=[],f=Math.floor(d/2),h=2*c*Math.sin(Math.PI/d),i=2*c*Math.sin(f*Math.PI/d),j=0;d>j;++j)e.push(g.edge_object(a,b[j],b[(j+1)%d],{distance:h}));for(j=0;d/2>j;++j)e.push(g.edge_object(a,b[j],b[(j+f)%d],{distance:i})),d%2&&j!=Math.floor(d/2)&&e.push(g.edge_object(a,b[j],b[(j+d-f)%d],{distance:i}));return e},g.d3=a,g.crossfilter=b,g.dc=c,g}if("function"==typeof define&&define.amd)define(["d3","crossfilter","dc"],a);else if("object"==typeof module&&module.exports){var b=require("d3"),c=require("crossfilter");"function"!=typeof c&&(c=c.crossfilter);var d=require("dc");module.exports=a(b,c,d)}else this.dc_graph=a(d3,crossfilter,dc)}();
//# sourceMappingURL=dc.graph.min.js.map