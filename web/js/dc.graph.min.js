/*!
 *  dc.graph 0.6.0
 *  http://dc-js.github.io/dc.graph.js/
 *  Copyright 2015-2016 AT&T Intellectual Property & the dc.graph.js Developers
 *  https://github.com/dc-js/dc.graph.js/blob/master/AUTHORS
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 */

!function(){function a(a,b,c){"use strict";function d(a){return a.orig}function e(a){return a}function f(){var a={},b=function(b,c){return 1===arguments.length?a[b]:a[b]===c?this:(a[b]&&a[b].parent(null),a[b]=c,c&&c.parent(this),this)};return b.enum=function(){return Object.keys(a)},b}function g(a,b){var c=O(b),d=function(){return arguments.length?(console.warn(a),c.apply(O,arguments),this):c()};return["cascade","_eval","eval","react"].forEach(function(a){d[a]=c[a]}),d}function h(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}function i(a,b){function c(a,b){return function(c,d){return a(c)?b(c):d()}}var d={};for(var e in b)d[e]=c(a,m(b[e]));return d}function j(a,b,c){var d={},e={},f=[];for(var g in c)/^node/.test(g)?d[g]=c[g]:/^edge/.test(g)?e[g]=c[g]:f.push(g);f.length&&console.error('only know how to deal with properties that start with "node" or "edge"',f);var h=a?i(a,d):{};return b&&Object.assign(h,i(b,e)),h}function k(a){return function(b,c,d){for(var e in d){if(!a[e])throw new Error("unknown attribute "+e);a[e].cascade(b,c?d[e]:null)}return a}}function l(a,b){return function(){return a(b.apply(null,arguments))}}function m(a){return N.functor_wrap(a,d)}function n(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function o(a,b,c){for(var d=["M",a[0].x,",",a[0].y],e=b,f=!1,g=1;g<a.length;++g)(isNaN(a[g].x)||isNaN(a[g].y))&&(f=!0),d.push(e===b?P[b]:" ",a[g].x,",",a[g].y),0===--e&&(e=b);return e!=b&&console.log("warning: pts.length didn't match bezian degree",a,b),c&&d.push("Z"),d.join("")}function p(a){return Promise.resolve(a)}function q(a,b,c,d,e,f,g){function h(b){var c=d(b);a[c]||f(c,a[c]={},b);var g=a[c];return e(g,b),i[c]=!0,g}f||(f=function(a,b){}),g||(g=function(a){});var i={},j=b.map(h);c&&c.forEach(function(b){a[b]||f(b,a[b]={},null),i[b]||(j.push(a[b]),i[b]=!0)});for(var k in a)i[k]||(g(k,a[k]),delete a[k]);return j}function r(a,b,c,d){var e=Math.tan(Math.atan2(d,c));e*=e;var f={x:a*b/Math.sqrt(b*b+a*a*e),y:a*b/Math.sqrt(a*a+b*b/e)};return c<0&&(f.x=-f.x),d<0&&(f.y=-f.y),f}function s(a,b,c){return a-S<=b&&b<=c+S}function t(a,b,c,d,e,f,g,h){var i=((a*d-b*c)*(e-g)-(a-c)*(e*h-f*g))/((a-c)*(f-h)-(b-d)*(e-g)),j=((a*d-b*c)*(f-h)-(b-d)*(e*h-f*g))/((a-c)*(f-h)-(b-d)*(e-g));if(isNaN(i)||isNaN(j))return!1;if(a>=c){if(!s(c,i,a))return!1}else if(!s(a,i,c))return!1;if(b>=d){if(!s(d,j,b))return!1}else if(!s(b,j,d))return!1;if(e>=g){if(!s(g,i,e))return!1}else if(!s(e,i,g))return!1;if(f>=h){if(!s(h,j,f))return!1}else if(!s(f,j,h))return!1;return{x:i,y:j}}function u(a,b,c,d,e){for(var f=0;f<a.length;++f){var g=f===a.length-1?0:f+1,h=t(a[f].x,a[f].y,a[g].x,a[g].y,b,c,d,e);if(h)return h}return null}function v(a,b){var c=b.shape;if("random"===b.shape){var d=N.available_shapes();c=d[Math.floor(Math.random()*d.length)]}else if(a.shape.enum().indexOf(b.shape)!==-1)return a.shape(b.shape).elaborate(b);if(!T[c])throw new Error("unknown shape "+c);return T[c](b)}function w(a){return function(b){var c=a.nodeShape.eval(b)||U;b.dcg_shape=v(a,c),b.dcg_shape.abstract=c}}function x(a){return function(b){var c=a.nodeShape.eval(b)||U,d=b.dcg_shape.abstract;return c.shape!==d.shape||"polygon"===c.shape&&(c.shape.sides!==d.sides||c.shape.skew!==d.skew||c.shape.distortion!==d.distortion||c.shape.rotation!==d.rotation)}}function y(a,b){return function(c){c.each(function(c){var d;if(b.nodeFitLabel.eval(c)){d=this.getBBox();var e,f=b.nodeContent.eval(c);if(f&&b.content(f).padding)e=b.content(f).padding(c);else{var g=b.nodeLabelPadding.eval(c);e={x:2*g.x,y:2*g.y}}d.width+=e.x,d.height+=e.y}var h=0;if(d&&d.width&&d.height){var i=b.nodeRadius.eval(c),j=a.calc_radii(c,i,d);c.dcg_rx=j.rx,c.dcg_ry=j.ry,h=2*j.rx+b.nodePadding.eval(c)+b.nodeStrokeWidth.eval(c)}else c.dcg_rx=c.dcg_ry=b.nodeRadius.eval(c);var k=2*c.dcg_ry+b.nodePadding.eval(c)+b.nodeStrokeWidth.eval(c);c.cola.width=Math.max(h,k),c.cola.height=k})}}function z(a){return{rx:function(a){return a.dcg_rx},ry:function(a){return a.dcg_ry}}}function A(b,c){return{d:function(b){var c=b.dcg_shape,d=c.sides||4,e=c.skew||0,f=c.distortion||0,g=c.rotation||0,h=d%2?0:.5,i=[];g=g/360+.25;for(var j=0;j<d;++j){var k=-((j+h)/d+g)*Math.PI*2;i.push({x:Math.cos(k),y:Math.sin(k)})}var l=a.extent(i,function(a){return a.y}),m=b.dcg_rx,n=b.dcg_ry/Math.min(-l[0],l[1]);return b.dcg_points=i.map(function(a){var c=m*a.x,d=n*a.y;return c*=1+f*((b.dcg_ry-d)/b.dcg_ry-1),c-=e*d/2,{x:c,y:d}}),o(b.dcg_points,1,!0)}}}function B(a,b,c){var d=100;if(a(b).val>=0)throw new Error("f(a) must be less than 0");if(a(c).val<=0)throw new Error("f(b) must be greater than 0");for(;;){if(!--d)throw new Error("patience ran out");var e=(b+c)/2,f=a(e),g=f.val;if(Math.abs(g)<.5)return f;g>0?c=e:b=e}}function C(a,b,c,d,e,f,g,h,i,j,k){var l,m,n,o;if(g){var p,q,r=function(b,c){return a.shape(b.dcg_shape.shape).intersect_vec(b,1e3*Math.cos(c),1e3*Math.sin(c))},s=function(a,b,c){return function(d){var e=r(a,d);return e?{port:e,val:Math.hypot(e.x-b.x,e.y-b.y)-c,ang:d}:{port:{x:0,y:0},val:0,ang:d}}},t=Math.atan2(g.sourcePort.y,g.sourcePort.x),u=Math.atan2(g.targetPort.y,g.targetPort.x);try{p=B(s(b.source,g.sourcePort,i),t,t+2*h*i/j)}catch(a){p={ang:t,port:g.sourcePort}}try{q=B(s(b.target,g.targetPort,i),u,u-2*h*i/j)}catch(a){q={ang:u,port:g.targetPort}}l=p.port,m=q.port;var v=Math.hypot(l.x,l.y),w=Math.hypot(m.x,m.y),x=v+j/2,y=w+k/2,z=c+x*Math.cos(p.ang),A=d+x*Math.sin(p.ang),C=e+y*Math.cos(q.ang),D=f+y*Math.sin(q.ang);n=[{x:c+l.x,y:d+l.y},{x:z,y:A},{x:C,y:D},{x:e+m.x,y:f+m.y}],o=3}else l=b.sourcePort.pos,m=b.targetPort.pos,console.assert(l),console.assert(m),n=[{x:c+l.x,y:d+l.y},{x:e+m.x,y:f+m.y}],o=1;return{sourcePort:l,targetPort:m,points:n,bezDegree:o}}function D(a,b){for(var c=[],d=1;d<a.length;d++){var e=a[d-1],f=a[d];c.push({x:e.x+(f.x-e.x)*b,y:e.y+(f.y-e.y)*b})}return c}function E(a,b){for(var c=[a],d=1;d<a.length;d++)c.push(D(c[c.length-1],b));return c}function F(a,b){var c=E(a,b);return c[c.length-1][0]}function G(a){if(!V[a]){var b=V[a]={worker:new Worker(Q()+"dc.graph."+a+".worker.js"),layouts:{}};b.worker.onmessage=function(a){var c=a.data.layoutId;if(!b.layouts[c])throw new Error('layoutId "'+c+'" unknown!');b.layouts[c].dispatch()[a.data.response].apply(null,a.data.args)}}return V[a]}function H(a,b,c){return(a?"node/"+a:"edge/"+b)+"/"+c}function I(a){var b=a.split("/");return"node"===b[0]?{nodeKey:b[1],name:b[2]}:{edgeKey:b[1],name:b[2]}}function J(a){var b=function(){return{type:"alignment",axis:a}};return b.listname="offsets",b.wrap=function(a){return{node:a,offset:0}},b}function K(a,b,c){if(b)return void a(b,null);var d=graphlibDot.parse(c),e=d.nodes(),f=new Array(e.length);e.forEach(function(a,b){var c=f[b]=d._nodes[e[b]];c.id=b,c.name=a});var g=d.edges(),h=[];g.forEach(function(a){var b=d._edges[a];h.push({source:d._nodes[b.u].id,target:d._nodes[b.v].id,sourcename:b.u,targetname:b.v})});var i={nodes:f,links:h};a(null,i)}function L(b,c,d){if(c)return void b(c,null);var e=Object.keys(d[0]),f=e[0],g=e[1],h=a.set(d.map(function(a){return a[f]}));d.forEach(function(a){h.add(a[g])}),h=h.values().map(function(a){return{name:a}}),b(null,{nodes:h,links:d.map(function(a,b){return{key:b,sourcename:a[f],targetname:a[g]}})})}function M(a){return(a.nodes||a.vertices)&&(a.edges||a.links)}var N={version:"0.6.0",constants:{CHART_CLASS:"dc-graph"}},O=function(a,b){void 0===b?b=d:b===!1&&(b=e);var c=a,f=null,g=[],h=function(a){return arguments.length?(f&&f(a),c=a,this):c};return h.cascade=function(a,b){for(var c=0;c<g.length;++c){if(g[c].n===a)return b?g[c].f=b:delete g[c],h;if(g[c].n>a)return g.splice(c,0,{n:a,f:b}),h}return g.push({n:a,f:b}),h},h._eval=function(a,c){if(0!==c&&g.length){var d=g[c-1];return d.f(a,function(){return h._eval(a,c-1)})}return N.functor_wrap(h(),b)(a)},h.eval=function(a){return h._eval(a,g.length)},h.react=function(a){return arguments.length?(f=a,this):f},h};N.functor_wrap=function(a,b){return"function"==typeof a?b?function(c){return a(b(c))}:a:function(){return a}};var P={1:"L",2:"Q",3:"C"};Math.hypot=Math.hypot||function(){for(var a=0,b=arguments.length,c=0;c<b;c++){if(arguments[c]===1/0||arguments[c]===-(1/0))return 1/0;a+=arguments[c]*arguments[c]}return Math.sqrt(a)};var Q=function(){var a;return function(){if(void 0===a){a=null;var b="dc.graph.js",c=document.getElementsByTagName("script");if(c&&c.length>0)for(var d in c)if(c[d].src&&c[d].src.match(new RegExp(b+"$"))){a=c[d].src.replace(new RegExp("(.*)"+b+"$"),"$1");break}}return a}}();N.event_coords=function(b){var c=b.root().node().getBoundingClientRect();return b.invertCoord([a.event.clientX-c.left,a.event.clientY-c.top])};var R=navigator.platform.toUpperCase().indexOf("MAC")!==-1;N.depth_first_traversal=function(a){return function(b,c){function d(b,c){var e=a.nodeid(b);return j[e]?void(a.skip&&a.skip(b,f[e])):(i[c]||(i[c]=[]),a.place&&a.place(b,c,i[c]),i[c].push(b),j[e]=!0,g[e]&&g[e].forEach(function(b,f){var i=h[a.targetid(b)];f&&a.sib&&a.sib(!1,h[a.targetid(g[e][f-1])],i),a.push&&a.push(),d(i,c+1)}),void(a.pop&&a.pop(b)))}a.init&&a.init(),a.tree&&(c=c.filter(function(b){return a.tree(b)}));var e,f={},g=c.reduce(function(b,c){var d=a.sourceid(c),e=a.targetid(c);return b[d]||(b[d]=[]),b[d].push(c),f[e]=(f[e]||0)+1,b},{}),h=b.reduce(function(b,c){var d=a.nodeid(c);return b[d]=c,b},{}),i=[],j={};a.root?e=b.filter(function(b){return a.root(b)}):(e=b.filter(function(b){return!f[a.nodeid(b)]}),b.length&&!e.length&&(e=[b[0]])),e.forEach(function(b,c){c&&a.sib&&a.sib(!0,e[c-1],b),a.push&&a.push(),d(b,a.row&&a.row(b)||0)}),a.finish(i)}},N.undirected_dfs=function(a){return function(b,c){function d(b){var c=a.nodeid(b);a.node(h,b),g[c]=!0,e[c]&&e[c].forEach(function(a){g[a]||d(f[a])})}var e=c.reduce(function(b,c){var d=a.sourceid(c),e=a.targetid(c);return b[d]||(b[d]=[]),b[e]||(b[e]=[]),b[d].push(e),b[e].push(d),b},{}),f=b.reduce(function(b,c){var d=a.nodeid(c);return b[d]=c,b},{}),g={},h=0;b.forEach(function(b){g[a.nodeid(b)]||(a.comp&&a.comp(h),d(b),++h)})}};var S=1e-7,T={ellipse:function(){return{shape:"ellipse"}},egg:function(){return{shape:"polygon",sides:100,distortion:-.25}},triangle:function(){return{shape:"polygon",sides:3}},rectangle:function(){return{shape:"polygon",sides:4}},diamond:function(){return{shape:"polygon",sides:4,rotation:45}},trapezium:function(){return{shape:"polygon",sides:4,distortion:-.5}},parallelogram:function(){return{shape:"polygon",sides:4,skew:.5}},pentagon:function(){return{shape:"polygon",sides:5}},hexagon:function(){return{shape:"polygon",sides:6}},septagon:function(){return{shape:"polygon",sides:7}},octagon:function(){return{shape:"polygon",sides:8}},invtriangle:function(){return{shape:"polygon",sides:3,rotation:180}},invtrapezium:function(){return{shape:"polygon",sides:4,distortion:.5}},square:function(){return{shape:"polygon",sides:4}},polygon:function(a){return{shape:"polygon",sides:a.sides,skew:a.skew,distortion:a.distortion,rotation:a.rotation}}};N.available_shapes=function(){var a=Object.keys(T);return a.slice(0,a.length-1)};var U={shape:"ellipse"};N.ellipse_shape=function(){var a={parent:O(null),elaborate:function(a){return T.ellipse(a)},intersect_vec:function(a,b,c){return r(a.dcg_rx,a.dcg_ry,b,c)},calc_radii:function(a,b,c){b=Math.max(b,c.height/2+5);var d=c.width/2,e=c.height/2/b;return d/=Math.sqrt(1-e*e),d=Math.max(d,b),{rx:d,ry:b}},create:function(a){a.append("ellipse").attr("class","node-shape")},replace:function(a){a.select("ellipse.node-shape").remove(),a.insert("ellipse",":first-child").attr("class","node-shape")},update:function(b){b.select("ellipse.node-shape").attr(z(a.parent()))}};return a},N.polygon_shape=function(){var a={parent:O(null),elaborate:function(a){return T.polygon(a)},intersect_vec:function(a,b,c){return u(a.dcg_points,0,0,b,c)},calc_radii:function(a,b,c){b=Math.max(b,c.height/2+5);var d=c.width/2;return d=d*Math.sqrt(2)/Math.cos(Math.PI/(a.dcg_shape.sides||4)),{rx:d,ry:b}},create:function(a){a.append("path").attr("class","node-shape")},replace:function(a){a.select("path.node-shape").remove(),a.insert("path",":first-child").attr("class","node-shape")},update:function(b){b.select("path.node-shape").attr(A(a.parent()))}};return a},N.rounded_rectangle_shape=function(){var a=(N.polygon_shape(),{parent:O(null),elaborate:function(a){return{shape:a.shape,rx:a.rx||10,ry:a.ry||10}},intersect_vec:function(a,b,c){var d=[{x:a.dcg_rx,y:a.dcg_ry},{x:a.dcg_rx,y:-a.dcg_ry},{x:-a.dcg_rx,y:-a.dcg_ry},{x:-a.dcg_rx,y:a.dcg_ry}];return u(d,0,0,b,c)},calc_radii:function(a,b,c){return{rx:c.width/2,ry:Math.max(b,c.height/2+5)}},create:function(a){a.append("rect").attr("class","node-shape")},replace:function(a){a.select("rect.node-shape").remove(),a.insert("rect",":first-child").attr("class","node-shape")},update:function(a){a.select("rect.node-shape").attr({x:function(a){return-a.dcg_rx},y:function(a){return-a.dcg_ry},width:function(a){return 2*a.dcg_rx},height:function(a){return 2*a.dcg_ry},rx:function(a){return a.dcg_shape.rx+"px"},ry:function(a){return a.dcg_shape.ry+"px"}})}});return a},N.text_contents=function(){var a={parent:O(null),update:function(b){var c=b.selectAll("text.node-label").data(function(a){return[a]});c.enter().append("text").attr("class","node-label");var d=c.selectAll("tspan").data(function(b){var c=a.parent().nodeLabel.eval(b);if(!c)return[];"string"==typeof c&&(c=[c]);var d=c.length%2?.3-(c.length-1)/2:1-c.length/2;return c.map(function(a,b){return{line:a,ofs:(0==b?d:1)+"em"}})});d.enter().append("tspan").attr("x",0).attr("dy",function(a){return a.ofs}),d.text(function(a){return a.line}),d.exit().remove(),c.attr("fill",a.parent().nodeLabelFill.eval)},textbox:function(a){return this.select(a).node().getBBox()},select:function(a){return a.select("text.node-label")}};return a},N.with_icon_contents=function(b,c,d){var e={parent:O(null).react(function(a){b.parent(a)}),padding:function(a){var b=e.parent().nodeLabelPadding.eval(a);return{x:3*b.x,y:3*b.y}},update:function(f){var g=f.selectAll("g.with-icon").data(function(a){return[a]}),h=g.enter();h.append("g").attr("class","with-icon").append("image").attr({class:"icon",width:c+"px",height:d+"px"}),g.call(b.update),b.select(g).attr("transform","translate("+c/2+")"),g.selectAll("image.icon").attr({href:e.parent().nodeIcon.eval,x:function(d){var f=c+b.textbox(a.select(this.parentNode)).width;return-f/2-e.parent().nodeLabelPadding.eval(d).x},y:-d/2})},textbox:function(a){var d=b.textbox(a);return d.x+=c/2,d},select:function(a){return a.select("g.with-icon")}};return e},N.diagram=function(h,i){function j(a){return function(b){ea.layoutEngine()||ea.layoutAlgorithm("cola",!0);var c=ea.layoutEngine();return c.getEngine&&(c=c.getEngine()),c[a]?(console.warn('Warning: dc_graph.diagram."'+a+'"is deprecated. Call the corresponding method on the layout engine instead.'),c[a](b)):console.warn('Warning: dc_graph.diagram."'+a+'"is deprecated, and it is not supported for the "'+c.layoutAlgorithm()+'" layout algorithm: ignored.'),this}}function n(){ea.layoutEngine()||ea.layoutAlgorithm("cola",!0),ea.layoutEngine().init({width:ea.width(),height:ea.height()})}function p(a){return!!a.source&&!!a.target}function r(b,c){c.attr("stroke",ea.edgeStroke.eval).attr("stroke-width",ea.edgeStrokeWidth.eval).attr("stroke-dasharray",ea.edgeStrokeDashArray.eval).attr("marker-end",function(a){var b=ea.edgeArrowhead.eval(a),c=S(a,"head",b);return c?"url(#"+c+")":null}).attr("marker-start",function(a){var b=ea.edgeArrowtail.eval(a),c=S(a,"tail",b);return b?"url(#"+c+")":null}).each(function(b){a.selectAll("#"+ea.arrowId(b,"head")+",#"+ea.arrowId(b,"tail")).attr("fill",ea.edgeStroke.eval(b))}),ea._updateNode(b)}function s(a){ra.end(a),xa=!1,Ga&&(Ga=!1,window.setTimeout(function(){ea.isRunning()||ea.redraw()},0))}function t(a,b){var c=a[0],d=a[a.length-1],e=F(a,"tail"===b?.25:.75);return("head"===b?Math.atan2(d.y-e.y,d.x-e.x):Math.atan2(e.y-c.y,e.x-c.x))+"rad"}function u(a,b,c,d,e,f){if(a.cola.points)a.pos.new=a.pos.old={path:{points:a.cola.points,bezDegree:3},orienthead:t(a.cola.points,"head"),orienttail:t(a.cola.points,"tail")};else if(!a.pos[b]){var g=a.parallel,h=a.source,i=a.target;if(g.edges.length>1&&a.source.index>a.target.index){var j;j=i,i=h,h=j,j=e,e=c,c=j,j=f,f=d,d=j}for(var k=h.dcg_ry+ea.nodeStrokeWidth.eval(h)/2,l=i.dcg_ry+ea.nodeStrokeWidth.eval(i)/2,m=0;m<g.edges.length;++m){var n=!!(m%2)==c<e?-1:1,o=Math.floor((m+1)/2),p=o>0?g.edges[m>2?m-2:0].pos[b].path:null,q=C(ea,a,c,d,e,f,p,n,ea.parallelEdgeOffset(),k,l);g.rev[m]&&q.points.reverse(),g.edges[m].pos[b]={path:q,orienthead:t(q.points,"head"),orienttail:t(q.points,"tail")}}}return a.pos[b].path}function v(a){u(a,"old",a.source.prevX||a.source.cola.x,a.source.prevY||a.source.cola.y,a.target.prevX||a.target.cola.x,a.target.prevY||a.target.cola.y)}function z(a){var b=u(a,"new",a.source.cola.x,a.source.cola.y,a.target.cola.x,a.target.cola.y),c=b.points[0],d=b.points[b.points.length-1];a.length=Math.hypot(d.x-c.x,d.y-c.y)}function A(a){return function(b){var c=b.pos[a].path;return o(c.points,c.bezDegree)}}function B(a){return function(b){var c=b.pos[a].path,d=c.points[c.points.length-1].x<c.points[0].x?c.points.slice(0).reverse():c.points;return o(d,c.bezDegree)}}function D(a,b){a.every(function(a){return 0===a.size()})&&b();var c=0;a.forEach(function(a){a.each(function(){++c}).each("end.all",function(){--c||b()})})}function E(a){return{left:a.cola.x-a.dcg_rx,top:a.cola.y-a.dcg_ry,right:a.cola.x+a.dcg_rx,bottom:a.cola.y+a.dcg_ry}}function G(a,b){return{left:Math.min(a.left,b.left),top:Math.min(a.top,b.top),right:Math.max(a.right,b.right),bottom:Math.max(a.bottom,b.bottom)}}function J(a){return{left:a.x,top:a.y,right:a.x,bottom:a.y}}function K(a){var b=a.pos.new.path.points;return b.map(J).reduce(G)}function L(a){var b=oa.selectAll("rect.bounds").data([0]);b.enter().insert("rect",":first-child").attr({class:"bounds",fill:"rgba(128,255,128,0.1)",stroke:"#000"}),b.attr({x:a.left,y:a.top,width:a.right-a.left,height:a.bottom-a.top})}function M(a,b){(ea.fitStrategy()||ea.restrictPan())&&a.size()&&(Ha=a.data().map(E).reduce(G),Ha=b.data().map(K).reduce(G,Ha))}function P(){if(ea.fitStrategy()){if(!Ha)return;var a,b=Ha.right-Ha.left,c=Ha.bottom-Ha.top,d=ea.width(),e=ea.height();ea.DEBUG_BOUNDS&&L(Ha);var f,g,h=ea.fitStrategy(),i=[0,0],j=1;if(["default","vertical","horizontal"].indexOf(h)>=0){var k=e/d,l=c/b,m=l<k;"default"===h?(g=!m,f=null):(g="vertical"===h,f="xMidYMid "+(m^g?"meet":"slice")),i=[ea.margins().left,ea.margins().top],j=g?(e-ea.margins().top-ea.margins().bottom)/e:(d-ea.margins().left-ea.margins().right)/d}else if("string"==typeof h&&h.match(/^align_/)){var n=h.split("_")[1].toLowerCase().split("");if(n.length>2)throw new Error("align_ expecting 0-2 sides, not "+n.length);var o=V();i=ha.translate(),j=ha.scale(),n.forEach(function(a){switch(a){case"l":i[0]=W(i,o.left);break;case"t":i[1]=X(i,o.top);break;case"r":i[0]=Y(i,o.right);break;case"b":i[1]=Z(i,o.bottom);break;default:throw new Error("align_ expecting l t r or b, not '"+a+"'")}})}else if("function"==typeof h){var p=h(b,c,d,e);f=p.pAR,i=p.translate,j=p.scale,a=p.viewBox}else{if("zoom"===h)return void $(ha.translate(),ha.scale());if("string"!=typeof h)throw new Error("unknown fitStrategy type "+typeof h);f=ea.fitStrategy()}void 0!==f&&(a||(a=[Ha.left,Ha.top,b,c].join(" ")),ma.attr({viewBox:a,preserveAspectRatio:f})),ha.translate(i).scale(j).event(ma),ra.zoomed(i,j)}}function Q(b,c,d,e,f,g,h,i,j,k,l){console.assert(d.data().every(p));var m={};c.each(function(a){m[ea.nodeKey.eval(a)]=!0}).attr("transform",function(a){return"translate("+a.cola.x+","+a.cola.y+")"});var n=b.transition().duration(ea.stagedDuration()).delay(function(a){return ea.stagedDelay(m[ea.nodeKey.eval(a)])}).attr("opacity",ea.nodeOpacity.eval);l&&n.attr("transform",function(a){return"translate("+a.cola.x+","+a.cola.y+")"}).each("end.record",function(a){a.prevX=a.cola.x,a.prevY=a.cola.y}),d.each(function(a){a.pos.new=null,a.pos.old=null});var o={};e.each(function(a){o[ea.edgeKey.eval(a)]=!0}).each(function(b){var c;"modins"===ea.stageTransitions()?(z(b),c="new"):(v(b),c="old"),ea.edgeArrowhead.eval(b)&&a.select("#"+ea.arrowId(b,"head")).attr("orient",function(){return b.pos[c].orienthead}),ea.edgeArrowtail.eval(b)&&a.select("#"+ea.arrowId(b,"tail")).attr("orient",function(){return b.pos[c].orienttail})}).attr("d",A("modins"===ea.stageTransitions()?"new":"old"));var q=d.each(z).each(function(b){ea.edgeArrowhead.eval(b)&&a.select("#"+ea.arrowId(b,"head")).transition().duration(ea.stagedDuration()).delay(ea.stagedDelay(!1)).attr("orient",function(){return b.pos.new.orienthead}),ea.edgeArrowtail.eval(b)&&a.select("#"+ea.arrowId(b,"tail")).transition().duration(ea.stagedDuration()).delay(ea.stagedDelay(!1)).attr("orient",function(){return b.pos.new.orienttail})}).transition().duration(ea.stagedDuration()).delay(function(a){return ea.stagedDelay(o[ea.edgeKey.eval(a)])}).attr("opacity",ea.edgeOpacity.eval);l&&q.attr("d",function(a){var b="insmod"===ea.stageTransitions()&&o[ea.edgeKey.eval(a)]?"old":"new";return A(b)(a)}),h.selectAll("textPath").text(function(a){return ea.edgeLabel.eval(a)}),k.attr("d",B("modins"===ea.stageTransitions()?"new":"old"));var r=j.transition().duration(ea.stagedDuration()).delay(function(a){return ea.stagedDelay(o[ea.edgeKey.eval(a)])}).attr("opacity",ea.edgeOpacity.eval);l&&r.attr("d",function(a){var b="insmod"===ea.stageTransitions()&&o[ea.edgeKey.eval(a)]?"old":"new";return B(b)(a)}),"insmod"===ea.stageTransitions()&&l&&(ea.stagedDuration()>=50?(q=q.transition().duration(ea.stagedDuration()).attr("d",A("new")),r=r.transition().duration(ea.stagedDuration()).attr("d",B("new"))):(q.attr("d",A("new")),r.attr("d",A("new")))),ea.showLayoutSteps()||D([n,q,r],function(){s(!0)}),l&&f.attr("d",A("new"))}function R(a,b){ea.portStyle.enum().forEach(function(c){var d={};for(var e in a)d[e]=a[e].filter(function(a){return ea.portStyleName.eval(a)===c});ea.portStyle(c).drawPorts(d,b)})}function S(a,b,c){var d=ea.arrowId(a,b),e=ea.addOrRemoveDef(d,!!c,"svg:marker");return c&&e.attr("viewBox","0 -5 10 10").attr("refX",wa[c].refX).attr("refY",wa[c].refY).attr("markerUnits","userSpaceOnUse").attr("markerWidth",wa[c].width*ea.edgeArrowSize.eval(a)).attr("markerHeight",wa[c].height*ea.edgeArrowSize.eval(a)).attr("stroke",ea.edgeStroke.eval(a)).attr("fill",ea.edgeStroke.eval(a)).call(wa[c].drawFunction),c?d:null}function T(a,b){ya=a,za=b,oa.attr("transform","translate("+a+") scale("+b+")")}function V(){var a=Ha||{left:0,top:0,right:0,bottom:0};return{left:a.left-ea.margins().left,top:a.top-ea.margins().top,right:a.right+ea.margins().right,bottom:a.bottom+ea.margins().bottom}}function W(a,b){return a[0]-ea.x()(b)+ea.x().range()[0]}function X(a,b){return a[1]-ea.y()(b)+ea.y().range()[0]}function Y(a,b){return a[0]-ea.x()(b)+ea.x().range()[1]}function Z(a,b){return a[1]-ea.y()(b)+ea.y().range()[1]}function $(a,b){if(ea.restrictPan()){var c,d=ea.x().domain(),e=ea.y().domain(),f=V(),g=f.left<d[0],h=f.right<d[1],i=f.right-f.left<d[1]-d[0],j=0;switch(g&&h?c=i?"left":"right":g||h||(c=i?"right":"left"),c){case"left":a[0]=W(a,f.left);break;case"right":a[0]=Y(a,f.right);break;default:++j}switch(g=f.top<e[0],h=f.bottom<e[1],i=f.bottom-f.top<e[1]-e[0],g&&h?c=i?"top":"bottom":g||h||(c=i?"bottom":"top"),c){case"top":a[1]=X(a,f.top);break;case"bottom":a[1]=Z(a,f.bottom);break;default:++j}j<2&&ha.translate(a)}T(a,b)}function _(){$(a.event.translate,a.event.scale)}function aa(a,b){ma&&ma.attr("width",a||ea.width()).attr("height",b||ea.height())}function ba(){ma.call(ha),ma.on("dblclick.zoom",null)}function ca(){ma.on(".zoom",null)}function da(){return ma=ea.root().append("svg"),aa(),na=ma.append("svg:defs"),ea.x()||ea.x(a.scale.linear().domain([0,ea.width()]).range([0,ea.width()])),ea.y()||ea.y(a.scale.linear().domain([0,ea.height()]).range([0,ea.height()])),ha=a.behavior.zoom().on("zoom",_).x(ea.x()).y(ea.y()),ea.mouseZoomable()&&(ea.altKeyZoom()?a.select(document).on("keydown",function(){"Alt"===a.event.key&&ba()}).on("keyup",function(){"Alt"===a.event.key&&ca()}):ba()),ma}var ea=c.marginMixin({});ea.__dcFlag__=c.utils.uniqueId();var fa,ga,ha,ia,ja,ka,la,ma=null,na=null,oa=null,pa=null,qa=null,ra=a.dispatch("data","end","start","drawn","transitionsStarted","zoomed"),sa={},ta={},ua={},va={},wa={},xa=!1,ya=[0,0],za=1,Aa=200,Ba=function(a){var b=a&&a.getBoundingClientRect&&a.getBoundingClientRect().width;return b&&b>Aa?b:Aa},Ca=Ba,Da=200,Ea=function(a){var b=a&&a.getBoundingClientRect&&a.getBoundingClientRect().height;return b&&b>Da?b:Da},Fa=Ea;ea.height=function(b){return arguments.length?(Fa=a.functor(b||Ea),la=void 0,ea):(c.utils.isNumber(la)||(la=Fa(ea.root().node())),la)},ea.width=function(b){return arguments.length?(Ca=a.functor(b||Ba),ka=void 0,ea):(c.utils.isNumber(ka)||(ka=Ca(ea.root().node())),ka)},ea.root=O(null).react(function(a){a.empty()&&console.log("Warning: parent selector "+h+" doesn't seem to exist")}),ea.mouseZoomable=O(!0),ea.altKeyZoom=O(!1),ea.fitStrategy=O("default"),ea.restrictPan=O(!1),ea.autoZoom=O(null),ea.zoomToFit=function(){if(pa&&qa){var a=ea.selectAllNodes(),b=ea.selectAllEdges();P(a,b)}},ea.nodeDimension=O(),ea.nodeGroup=O(),ea.edgeDimension=O(),ea.edgeGroup=O(),ea.nodeKey=ea.nodeKeyAccessor=O(function(a){return a.key}),ea.edgeKey=ea.edgeKeyAccessor=O(function(a){return a.key}),ea.edgeSource=ea.sourceAccessor=O(function(a){return a.value.sourcename}),ea.edgeTarget=ea.targetAccessor=O(function(a){return a.value.targetname}),ea.portDimension=O(null),ea.portGroup=O(null),ea.portNodeKey=O(null),ea.portEdgeKey=O(null),ea.portName=O(null),ea.portStyleName=O(null),ea.portStyle=f(),ea.portBounds=O(null),ea.edgeSourcePortName=O(null),ea.edgeTargetPortName=O(null),ea.nodeRadius=ea.nodeRadiusAccessor=O(25),ea.nodeStrokeWidth=ea.nodeStrokeWidthAccessor=O(1),ea.nodeStroke=ea.nodeStrokeAccessor=O("black"),ea.nodeStrokeDashArray=O(null),ea.nodeFillScale=O(null),ea.nodeFill=ea.nodeFillAccessor=O("white"),ea.nodeOpacity=O(1),ea.nodePadding=O(6),ea.nodeLabelPadding=O({x:0,y:0}),ea.nodeLabel=ea.nodeLabelAccessor=O(function(a){return a.value.label||a.value.name}),ea.nodeLabelFill=ea.nodeLabelFillAccessor=O(null),ea.nodeFitLabel=ea.nodeFitLabelAccessor=O(!0),ea.nodeShape=O(U),ea.shape=f(),ea.shape("ellipse",N.ellipse_shape()),ea.shape("polygon",N.polygon_shape()),ea.shape("rounded-rect",N.rounded_rectangle_shape()),ea.nodeContent=O("text"),ea.content=f(),ea.content("text",N.text_contents()),ea.nodeIcon=O(null),ea.nodeTitle=ea.nodeTitleAccessor=O(function(a){return ea.nodeKeyAccessor()(a)}),ea.nodeOrdering=O(null),ea.nodeFixed=ea.nodeFixedAccessor=O(null),ea.edgeStroke=ea.edgeStrokeAccessor=O("black"),ea.edgeStrokeWidth=ea.edgeStrokeWidthAccessor=O(1),ea.edgeStrokeDashArray=O(null),ea.edgeOpacity=ea.edgeOpacityAccessor=O(1),ea.edgeLabel=ea.edgeLabelAccessor=O(function(a){return ea.edgeKey()(a)}),ea.edgeArrowhead=ea.edgeArrowheadAccessor=O("vee"),ea.edgeArrowtail=ea.edgeArrowtailAccessor=O(null),ea.edgeArrowSize=O(1),ea.edgeIsLayout=ea.edgeIsLayoutAccessor=O(function(a){return!a.value.notLayout}),ea.edgeIsShown=O(!0),ea.lengthStrategy=j("lengthStrategy"),ea.edgeLength=ea.edgeDistanceAccessor=O(function(a){return a.value.distance}),ea.flowLayout=j("flowLayout"),ea.rankdir=j("rankdir"),ea.baseLength=j("baseLength"),ea.transitionDuration=O(500),ea.stageTransitions=O("none"),ea.deleteDelay=O(0),ea.groupConnected=O(!1),ea.timeLimit=O(0),ea.constrain=O(function(a,b){return[]}),ea.parallelEdgeOffset=O(10),ea.edgeOrdering=O(null),ea.cascade=k(ea),ea.initLayoutOnRedraw=O(!1),ea.layoutUnchanged=O(!1),ea.relayout=function(){return fa=ga=null,this},ea.initialLayout=g("initialLayout is deprecated - use layout algorithms instead",null),ea.initialOnly=g("initialOnly is deprecated - see the initialLayout deprecation notice in the documentation",!1),ea.induceNodes=O(!1),ea.showLayoutSteps=O(!1),ea.legend=O(null).react(function(a){a.parent(ea)}),ea.mode=ea.child=f(),ea.layoutAlgorithm=function(a,b){if(!arguments.length)return ea.layoutEngine()?ea.layoutEngine().layoutAlgorithm():"cola";b||console.warn("dc.graph.diagram.layoutAlgorithm is depecrated - pass the layout engine object to dc_graph.diagram.layoutEngine instead");var c;switch(a){case"cola":c=N.cola_layout();break;case"dagre":c=N.dagre_layout()}return c=N.webworker_layout(c),ea.layoutEngine(c),this},ea.layoutEngine=O(null).react(function(a){a&&a.parent&&a.parent(ea)}),ea.tickSize=j("tickSize"),ea.uniqueId=function(){return ea.anchorName().replace(/[ .#=\[\]"]/g,"-")},ea.edgeId=function(a){return"edge-"+ea.edgeKey.eval(a).replace(/[^\w-_]/g,"-")},ea.arrowId=function(a,b){return"arrow-"+b+"-"+ea.uniqueId()+"-"+ea.edgeId(a)},ea.textpathId=function(a){return"textpath-"+ea.uniqueId()+"-"+ea.edgeId(a)},ea.getNode=function(a){return sa[a]?sa[a].orig:null},ea.getWholeNode=function(a){return sa[a]?sa[a]:null},ea.getEdge=function(a){return ta[a]?ta[a].orig:null},ea.getPort=function(a,b,c){return ua[H(a,b,c)]},ea.handleDisconnected=j("handleDisconnected"),ea.forEachChild=function(a,b,c,d){b.enum().forEach(function(e){d(b(e),a.filter(function(a){return c(a)===e}))})},ea.forEachShape=function(a,b){ea.forEachChild(a,ea.shape,function(a){return a.dcg_shape.shape},b)},ea.forEachContent=function(a,b){ea.forEachChild(a,ea.content,ea.nodeContent.eval,b)},ea.renderNode=ea._enterNode=function(a){return ea.nodeTitle()&&a.append("title"),a.each(w(ea)),ea.forEachShape(a,function(a,b){b.call(a.create)}),ea},ea.redrawNode=ea._updateNode=function(a){var b=a.filter(x(ea));return b.each(w(ea)),ea.forEachShape(b,function(a,b){b.call(a.replace)}),a.select("title").text(ea.nodeTitle.eval),ea.forEachContent(a,function(a,b){b.call(a.update),ea.forEachShape(a.select(b),function(a,b){b.call(y(a,ea))})}),ea.forEachShape(a,function(a,b){b.call(a.update)}),a.select(".node-shape").attr({stroke:ea.nodeStroke.eval,"stroke-width":ea.nodeStrokeWidth.eval,"stroke-dasharray":ea.nodeStrokeDashArray.eval,fill:l(ea.nodeFillScale()||e,ea.nodeFill.eval)}),ea},ea.stagedDuration=function(){return"none"!==ea.stageTransitions()?ea.transitionDuration()/2:ea.transitionDuration()},ea.stagedDelay=function(a){return"none"===ea.stageTransitions()||"modins"===ea.stageTransitions()==!a?0:ea.transitionDuration()/2},ea.selectAllNodes=function(a){return a=a||".node",pa.selectAll(a).filter(function(a){return!a.deleted})},ea.selectAllEdges=function(a){return a=a||".edge",qa.selectAll(a).filter(function(a){return!a.deleted})},ea.selectAllDefs=function(a){return na.selectAll(a).filter(function(a){return!a.deleted})},ea.isRunning=function(){return xa};var Ga=!1;ea.redraw=function(){return xa?(Ga=!0,this):ea.startLayout()},ea.startLayout=function(){function c(a,b){a.forEach(function(a){var b=sa[a.dcg_nodeKey];return b?(b.cola.x=a.x,void(b.cola.y=a.y)):void console.warn('received node "'+a.dcg_nodeKey+'" that we did not send')}),b.forEach(function(a){var b=ta[a.dcg_edgeKey];return b?void(a.points&&(b.cola.points=a.points)):void console.warn('received edge "'+a.dcg_edgeKey+'" that we did not send')})}var e=ea.nodeGroup().all(),f=ea.edgeGroup().all(),g=ea.portGroup()?ea.portGroup().all():[];if(xa)throw new Error("dc_graph.diagram.redraw already running!");xa=!0,ea.layoutEngine().stop(),ea.initLayoutOnRedraw()&&n(),ea.nodeOrdering()&&(e=b.quicksort.by(ea.nodeOrdering())(e.slice(0),0,e.length)),ea.edgeOrdering()&&(f=b.quicksort.by(ea.edgeOrdering())(f.slice(0),0,f.length));var h=q(sa,e,null,function(a){return ea.nodeKey()(a)},function(a,b){a.orig=b,a.cola=a.cola||{},a.cola.dcg_nodeKey=ea.nodeKey.eval(a),ea.layoutEngine().populateLayoutNode(a.cola,a)}),i=q(ta,f,null,function(a){return ea.edgeKey()(a)},function(a,b){a.orig=b,a.cola=a.cola||{},a.cola.dcg_edgeKey=ea.edgeKey.eval(a),a.cola.dcg_edgeSource=ea.edgeSource.eval(a),a.cola.dcg_edgeTarget=ea.edgeTarget.eval(a),a.source=sa[a.cola.dcg_edgeSource],a.target=sa[a.cola.dcg_edgeTarget],a.cola.dcg_edgeLength=ea.edgeLength.eval(a),a.sourcePort=a.sourcePort||{},a.targetPort=a.targetPort||{},ea.layoutEngine().populateLayoutEdge(a.cola,a)});i=i.filter(p),i=i.filter(function(a){
return a.source!==a.target}),i=i.filter(ea.edgeIsShown.eval);var j=i.map(function(a){return ea.edgeSourcePortName.eval(a)?H(ea.edgeSource.eval(a),null,ea.edgeSourcePortName.eval(a)):H(null,ea.edgeKey.eval(a),"source")});j=j.concat(i.map(function(a){return ea.edgeTargetPortName.eval(a)?H(ea.edgeTarget.eval(a),null,ea.edgeTargetPortName.eval(a)):H(null,ea.edgeKey.eval(a),"target")}));var k=q(ua,g,j,function(a){return H(ea.portNodeKey()(a),ea.portEdgeKey()&&ea.portEdgeKey(a),ea.portName()(a))},function(a,b){a.orig=b,a.named&&(a.edges=[])},function(a,b){var c=I(a);if(c.nodeKey)b.node=sa[c.nodeKey],b.named=!0;else{var d=ta[c.edgeKey];b.node=d[c.name],b.edges=[d],b.named=!1}b.name=c.name});if(i.forEach(function(a){var b=ea.edgeSourcePortName.eval(a);b&&ua[H(ea.nodeKey.eval(a.source),null,b)].edges.push(a),b=ea.edgeTargetPortName.eval(a),b&&ua[H(ea.nodeKey.eval(a.target),null,b)].edges.push(a)}),ea.induceNodes()){var l={};i.forEach(function(a){l[a.cola.dcg_edgeSource]=!0,l[a.cola.dcg_edgeTarget]=!0}),h=h.filter(function(a){return l[a.cola.dcg_nodeKey]});for(var o in sa)l[o]||delete sa[o]}if(h.forEach(function(a,b){a.index=b}),ra.data(ea,sa,h,ta,i,ua,k),va={nnodes:h.length,nedges:i.length},h.forEach(function(a){ea.nodeFixed()&&(a.cola.dcg_nodeFixed=ea.nodeFixed.eval(a))}),ea.parallelEdgeOffset()){for(var t=new Array(h.length),u=0;u<h.length;++u){t[u]=new Array(h.length);for(var v=0;v<h.length;++v)t[u][v]={rev:[],edges:[]}}i.forEach(function(a){a.pos=a.pos||{};var b=Math.min(a.source.index,a.target.index),c=Math.max(a.source.index,a.target.index);a.parallel=t[b][c],a.parallel.edges.push(a),a.parallel.rev.push(b!==a.source.index)})}var w=qa.selectAll(".edge").data(i,ea.edgeKey.eval),x=w.enter().append("svg:path").attr({class:"edge",id:ea.edgeId,opacity:0});w.exit().each(function(a){a.deleted=!0}).transition().duration(ea.stagedDuration()).delay(ea.deleteDelay()).attr("opacity",0).each(function(a){S(a,"head",null),S(a,"head",null)}).remove();var y=qa.selectAll(".edge-hover").data(i,ea.edgeKey.eval),z=y.enter().append("svg:path").attr("class","edge-hover").attr("opacity",0).attr("stroke","green").attr("stroke-width",10).on("mouseover",function(b){a.select("#"+ea.edgeId(b)+"-label").attr("visibility","visible")}).on("mouseout",function(b){a.select("#"+ea.edgeId(b)+"-label").attr("visibility","hidden")});y.exit().remove();var A=qa.selectAll(".edge-label").data(i,ea.edgeKey.eval),B=A.enter().append("text").attr("id",function(a){return ea.edgeId(a)+"-label"}).attr("visibility","hidden").attr({class:"edge-label","text-anchor":"middle",dy:-2}).append("textPath").attr("startOffset","50%").attr("xlink:href",function(a){var b=ea.textpathId(a);return"#"+b}),C=na.selectAll("path.edge-label-path").data(i,ea.textpathId),D=C.enter().append("svg:path").attr({class:"edge-label-path",id:ea.textpathId});A.exit().transition().duration(ea.stagedDuration()).delay(ea.deleteDelay()).attr("opacity",0).remove();var E=pa.selectAll(".node").data(h,ea.nodeKey.eval),F=E.enter().append("g").attr("class","node").attr("opacity","0");ea._enterNode(F),E.exit().each(function(a){a.deleted=!0}).transition().duration(ea.stagedDuration()).delay(ea.deleteDelay()).attr("opacity",0).remove(),ra.drawn(E,w,y),r(E,w),ea.initialLayout()&&ea.initialLayout()(ea,h,i);var G=!1;if(!ea.layoutUnchanged()){var J=JSON.stringify(h.map(function(a){return{orig:d(a),cola:{dcg_nodeFixed:a.cola.dcg_nodeFixed}}})),K=JSON.stringify(i.map(function(a){return{orig:d(a),cola:a.cola}}));J===fa&&K===ga&&(G=!0),fa=J,ga=K}var L=ea.constrain()(ea,h,i);L.forEach(function(a){if(a.type)switch(a.type){case"alignment":a.offsets.forEach(function(a){a.node=sa[a.node].index});break;case"circle":a.nodes.forEach(function(a){a.node=sa[a.node].index})}else a.axis&&(a.left=sa[a.left].index,a.right=sa[a.right].index)});var O=i.filter(ea.edgeIsLayout.eval),T=(i.filter(function(a){return!ea.edgeIsLayout.eval(a)}),L.filter(function(a){return"circle"===a.type}));L=L.filter(function(a){return"circle"!==a.type}),T.forEach(function(a){var b=(a.distance||4*ea.baseLength())/(2*Math.sin(Math.PI/a.nodes.length)),c=a.nodes.map(function(a){return a.node}),d=function(a){return ea.nodeKey.eval(h[a])},e=N.wheel_edges(d,c,b).map(function(a){var b={internal:a};return b.source=sa[a.sourcename],b.target=sa[a.targetname],b});O=O.concat(e)});var U=L.filter(function(a){return"ordering"===a.type});if(L=L.filter(function(a){return"ordering"!==a.type}),U.forEach(function(a){var c=a.nodes.map(function(a){return sa[a]});if(a.ordering){var d=b.quicksort.by(m(a.ordering));c=d(c,0,c.length)}var e;c.forEach(function(b,c){0===c?e=b:L.push({left:e.index,right:(e=b).index,axis:a.axis,gap:a.gap})})}),ea.legend()&&ea.legend().redraw(),G)return xa=!1,ra.end(!1),this;var V=Date.now();return ea.layoutEngine().on("tick",function(a,b){var d=Date.now()-V;if(ea.initialOnly()||c(a,b),ea.showLayoutSteps()){var e;ea.layoutEngine().needsStage&&ea.layoutEngine().needsStage("ports")&&(e=N.place_ports(ea,sa,h,ta,i,ua,k)),Q(E,F,w,x,y,z,A,B,C,D,!0),e&&R(e,E),ra.transitionsStarted(E,w,y)}(Ga||ea.timeLimit()&&d>ea.timeLimit())&&(console.log("cancelled"),ea.layoutEngine().stop())}).on("end",function(a,b){if(ea.showLayoutSteps())s(!0);else{var d;ea.initialOnly()||c(a,b),ea.layoutEngine().needsStage&&ea.layoutEngine().needsStage("ports")&&(d=N.place_ports(ea,sa,h,ta,i,ua,k)),Q(E,F,w,x,y,z,A,B,C,D,!0),d&&R(d,E),ra.transitionsStarted(E,w,y)}var e;switch(ea.autoZoom()){case"always":e=!0;break;case"once":e=!0,ea.autoZoom(null);break;default:e=!1}M(E,w),e&&P()}).on("start",function(){console.log("algo "+ea.layoutEngine().layoutAlgorithm()+" started."),ra.start()}),ea.initialOnly()?ea.layoutEngine().dispatch().end(h,i):(ra.start(),ea.layoutEngine().data(h.map(function(a){return a.cola}),O.map(function(a){return a.cola}),L,{groupConnected:ea.groupConnected()}),ea.layoutEngine().start({initialUnconstrainedIterations:10,initialUserConstraintIterations:20,initialAllConstraintsIterations:20})),this},ea.refresh=function(b,c,d,e,f){b=b||ea.selectAllNodes(),c=c||ea.selectAllEdges(),r(b,c),d=d||ea.selectAllEdges(".edge-hover"),e=e||ea.selectAllEdges(".edge-label"),f=f||ea.selectAllDefs("path.edge-label-path");var g=a.select(null);return Q(b,g,c,g,d,g,e,g,f,g,!1),this},ea.reposition=function(b,c){return b.attr("transform",function(a){return"translate("+a.cola.x+","+a.cola.y+")"}),c.each(function(b){b.pos.new=null,b.pos.old=null,z(b),ea.edgeArrowhead.eval(b)&&a.select("#"+ea.arrowId(b,"head")).attr("orient",function(){return b.pos.new.orienthead}),ea.edgeArrowtail.eval(b)&&a.select("#"+ea.arrowId(b,"tail")).attr("orient",function(){return b.pos.new.orienttail})}).attr("d",A("new")),this};var Ha;return ea.render=function(){return ea.initLayoutOnRedraw()||n(),ea.resetSvg(),oa=ma.append("g").attr("class","draw"),qa=oa.append("g").attr("class","edge-layer"),pa=oa.append("g").attr("class","node-layer"),ea.legend()&&ea.legend().render(),ea.redraw()},ea.on=function(a,b){return ra.on(a,b),this},ea.getStats=function(){return va},ea.select=function(a){return ea.root().select(a)},ea.selectAll=function(a){return ea.root()?ea.root().selectAll(a):null},ea.x=O(null),ea.y=O(null),ea.svg=function(a){return arguments.length?(ma=a,ea):ma},ea.g=function(a){return arguments.length?(oa=a,ea):oa},ea.resetSvg=function(){return ea.select("svg").remove(),da()},ea.redrawGroup=function(){c.redrawAll(i)},ea.renderGroup=function(){c.renderAll(i)},ea.defineArrow=function(a,b,c,d,e,f){return wa[a]={name:a,width:b,height:c,refX:d,refY:e,drawFunction:f},ea},ea.addOrRemoveDef=function(a,b,c){var d=b?[0]:[],e=na.selectAll("#"+a).data(d),f=e.enter().append(c).attr("id",a);return e.exit().remove(),f},ea.invertCoord=function(a){return[ea.x().invert(a[0]),ea.y().invert(a[1])]},ea.defineArrow("vee",12,12,10,0,function(a){a.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),ea.defineArrow("crow",12,12,0,0,function(a){a.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),ea.defineArrow("dot",7,7,0,0,function(a){a.append("svg:circle").attr("r",5).attr("cx",5).attr("cy",0).attr("stroke-width","0px")}),ea.anchor=function(b,d){if(!arguments.length)return ia;if(!b)throw new c.errors.BadArgumentException("parent must be defined");return ia=b.select&&b.classed?b.node():b,ea.root(a.select(ia)),ea.root().classed(N.constants.CHART_CLASS,!0),c.registerChart(ea,d),ja=d,ea},ea.chartID=function(){return ea.__dcFlag__},ea.anchorName=function(){var a=ea.anchor();return a&&a.id?a.id:a&&a.replace?a.replace("#",""):"dc-graph"+ea.chartID()},ea.anchor(h,i)},N.spawn_engine=function(a,b,c){var d,e;switch(a){case"dagre":d=N.dagre_layout(),e=["rankdir"];break;case"tree":d=N.tree_layout(),e=[];break;case"circo":case"dot":case"neato":case"osage":case"twopi":d=N.graphviz_layout(null,a,b.server),e=[];break;case"cola":default:d=N.cola_layout(),e=["lengthStrategy"]}return e.forEach(function(a){b[a]&&d[a](b[a])}),d.supportsWebworker()&&c&&(d=N.webworker_layout(d)),d};var V={};N.webworker_layout=function(b){var c=a.dispatch("init","start","tick","end"),d=G(b.layoutAlgorithm()),e={};d.layouts[b.layoutId()]=e,e.parent=function(a){b.parent&&b.parent(a)},e.init=function(a){return a=b.optionNames().reduce(function(a,c){return a[c]=b[c](),a},a),d.worker.postMessage({command:"init",args:{layoutId:b.layoutId(),options:a}}),this},e.data=function(a,c,e,f){d.worker.postMessage({command:"data",args:{layoutId:b.layoutId(),nodes:a,edges:c,constraints:e,options:f}})},e.start=function(a){d.worker.postMessage({command:"start",args:{layoutId:b.layoutId(),options:a}})},e.stop=function(){return d.worker.postMessage({command:"stop",args:{layoutId:b.layoutId()}}),this},e.getEngine=function(){return b};var f=["layoutAlgorithm","needsStage","populateLayoutNode","populateLayoutEdge","rankdir","ranksep"];return f.concat(b.optionNames()).forEach(function(a){e[a]=function(){var c=b[a].apply(b,arguments);return arguments.length?this:c}}),e.on=function(a,b){return c.on(a,b),this},e.dispatch=function(){return c},e},N.graphviz_attrs=function(){return{rankdir:O("TB"),nodesep:O(40),ranksep:O(40)}},N.cola_layout=function(b){function c(a){switch(j=cola.d3adaptor().avoidOverlaps(!0).size([a.width,a.height]).handleDisconnected(a.handleDisconnected),j.tickSize&&j.tickSize(a.tickSize),a.lengthStrategy){case"symmetric":j.symmetricDiffLinkLengths(a.baseLength);break;case"jaccard":j.jaccardLinkLengths(a.baseLength);break;case"individual":j.linkDistance(function(b){return b.dcg_edgeLength||a.baseLength});break;case"none":}a.flowLayout&&j.flowLayout(a.flowLayout.axis,a.flowLayout.minSeparation)}function d(a,b,c,d){function e(a){k[a](f,g.map(function(a){return{dcg_edgeKey:a.dcg_edgeKey}}))}var f=q(l,a,null,function(a){return a.dcg_nodeKey},function(a,b){a.dcg_nodeKey=b.dcg_nodeKey,a.width=b.width,a.height=b.height,a.fixed=!!b.dcg_nodeFixed,a.fixed&&"object"==typeof b.dcg_nodeFixed?(a.x=b.dcg_nodeFixed.x,a.y=b.dcg_nodeFixed.y):(void 0!==b.x&&(a.x=b.x),void 0!==b.y&&(a.y=b.y))}),g=q(m,b,null,function(a){return a.dcg_edgeKey},function(a,b){a.dcg_edgeKey=b.dcg_edgeKey,a.source=l[b.dcg_edgeSource],a.target=l[b.dcg_edgeTarget],a.dcg_edgeLength=b.dcg_edgeLength});f.forEach(function(a,b){a.index=b});var h=null;if(d.groupConnected){var i=cola.separateGraphs(f,g);h=i.map(function(a){return{leaves:a.array.map(function(a){return a.index})}})}j.on("tick",function(){e("tick")}).on("start",function(){k.start()}).on("end",function(){e("end")}),j.nodes(f).links(g).constraints(c).groups(h)}function e(a){j.start(a.initialUnconstrainedIterations,a.initialUserConstraintIterations,a.initialAllConstraintsIterations,a.gridSnapIterations)}function f(){j.stop()}var g,i=b||h(),j=null,k=a.dispatch("tick","start","end"),l={},m={},n=N.graphviz_attrs(),o=Object.keys(n);n.rankdir(null);var p=Object.assign(n,{layoutAlgorithm:function(){return"cola"},layoutId:function(){return i},supportsWebworker:function(){return!0},needsStage:function(a){return"ports"===a||"edgepos"===a},parent:O(null),on:function(a,b){return k.on(a,b),this},init:function(a){return this.optionNames().forEach(function(b){a[b]=a[b]||this[b]()}.bind(this)),c(a),this},data:function(a,b,c,e){d(a,b,c,e)},start:function(a){e(a)},stop:function(){f()},optionNames:function(){return["handleDisconnected","lengthStrategy","baseLength","flowLayout","tickSize"].concat(o)},populateLayoutNode:function(){},populateLayoutEdge:function(){},handleDisconnected:O(!0),lengthStrategy:O("symmetric"),baseLength:O(30),flowLayout:function(a){if(!arguments.length){if(g)return g;var b=p.rankdir();switch(b){case"LR":return{axis:"x",minSeparation:p.ranksep()+2*p.parent().nodeRadius()};case"TB":return{axis:"y",minSeparation:p.ranksep()+2*p.parent().nodeRadius()};default:return null}}return g=a,this},tickSize:O(1)});return p},N.cola_layout.scripts=["d3.js","cola.js"],N.dagre_layout=function(b){function c(a){k=new dagre.graphlib.Graph({multigraph:!0}),k.setGraph({rankdir:a.rankdir,nodesep:a.nodesep,ranksep:a.ranksep}),k.setDefaultEdgeLabel(function(){return{}})}function d(a,b,c,d){function e(a){l[a](f,h.map(function(a){return{dcg_edgeKey:a.dcg_edgeKey}}))}var f=q(m,a,null,function(a){return a.dcg_nodeKey},function(a,b){a.dcg_nodeKey=b.dcg_nodeKey,a.width=b.width,a.height=b.height},function(a,b){k.setNode(a,b)},function(a){k.removeNode(a)}),h=q(n,b,null,function(a){return a.dcg_edgeKey},function(a,b){a.dcg_edgeKey=b.dcg_edgeKey,a.dcg_edgeSource=b.dcg_edgeSource,a.dcg_edgeTarget=b.dcg_edgeTarget},function(a,b,c){k.setEdge(c.dcg_edgeSource,c.dcg_edgeTarget,b)},function(a,b){k.removeEdge(b.dcg_edgeSource,b.dcg_edgeTarget,b.dcg_edgeKey)});g=function(){e("tick")},i=function(){e("end")}}function e(a){l.start(),dagre.layout(k),i()}function f(){}var g,i,j=b||h(),k=null,l=a.dispatch("tick","start","end"),m={},n={},o=N.graphviz_attrs(),p=Object.keys(o);return Object.assign(o,{layoutAlgorithm:function(){return"dagre"},layoutId:function(){return j},supportsWebworker:function(){return!0},needsStage:function(a){return"ports"===a||"edgepos"===a},on:function(a,b){return l.on(a,b),this},init:function(a){return this.optionNames().forEach(function(b){a[b]=a[b]||this[b]()}.bind(this)),c(a),this},data:function(a,b,c,e){d(a,b,c,e)},start:function(a){e(a)},stop:function(){f()},optionNames:function(){return p},populateLayoutNode:function(){},populateLayoutEdge:function(){}})},N.dagre_layout.scripts=["d3.js","dagre.js"],N.tree_layout=function(b){function c(b){function c(a,b){return(e(a)+e(b))/2}var d,e=a.functor(b.nodeWidth);g=N.depth_first_traversal({nodeid:function(a){return a.dcg_nodeKey},sourceid:function(a){return a.dcg_edgeSource},targetid:function(a){return a.dcg_edgeTarget},init:function(){d=b.offsetX},row:function(a){return a.dcg_rank},place:function(a,c,f){if(f.length){var g=f[f.length-1],h=(e(g)+e(a))/2;d=Math.max(d,g.left_x+h)}a.left_x=d,a.hit_ins=1,a.y=c*b.gapY+b.offsetY},sib:function(a,b,e){var f=c(b,e);a&&(f*=1.5),d+=f},pop:function(a){a.x=(a.left_x+d)/2},skip:function(a,b){a.x=(a.hit_ins*a.x+d)/++a.hit_ins,a.hit_ins===b&&delete a.hit_ins},finish:function(a){a.forEach(function(a){for(var b,d=a.sort(function(a,b){return a.x-b.x}),e=null,f=null,g=0;g<d.length-1;++g){var h=d[g],i=d[g+1];if(e){if(b+=c(h,i),g<d.length-2&&i.x<f+b)continue;e>0&&--e;var j,k;if(g<d.length-2){var l=i.x-(f+b);j=d[e].x+l/2,k=g+1}else j=Math.max(d[e].x,f-c(d[e],d[e+1])-(b-i.x+f)/2),k=d.length;for(var m=e+1;m<k;++m)j+=c(d[m-1],d[m]),d[m].x=j;e=f=b=null}else i.x-h.x<c(h,i)&&(e=g,f=h.x,b=c(h,i))}})}})}function d(a,b,c,d){i=a,j=b}function e(a){g(i,j),l.end(i,j)}function f(){}var g,i,j,k=b||h(),l=a.dispatch("tick","start","end"),m={layoutAlgorithm:function(){return"tree"},layoutId:function(){return k},supportsWebworker:function(){return!1},on:function(a,b){return l.on(a,b),this},init:function(a){return this.optionNames().forEach(function(b){a[b]=a[b]||this[b]()}.bind(this)),c(a),this},data:function(a,b,c,e){d(a,b,c,e)},start:function(a){e(a)},stop:function(){f()},optionNames:function(){return["nodeWidth","offsetX","offsetY","rowFunction","gapY"]},populateLayoutNode:function(a,b){this.rowFunction()&&(a.dcg_rank=this.rowFunction.eval(b))},populateLayoutEdge:function(){},nodeWidth:O(function(a){return a.width}),offsetX:O(30),offsetY:O(30),rowFunction:O(null),gapY:O(100)};return m},N.tree_layout.scripts=[],N.graphviz_layout=function(b,c,d){function e(a){}function f(a){return a.replace(/^%/,"&#37;")}function g(a){return a.replace(/^&#37;/,"%")}function i(a,b){return[a,'"'+b+'"'].join("=")}function j(a){return"["+a.join(", ")+"]"}function k(a,b,d,e){var g=[],h="neato"!==c;g.push((h?"digraph":"graph")+" g {"),g.push("graph "+j([i("nodesep",r.nodesep()/72),i("ranksep",r.ranksep()/72),i("rankdir",r.rankdir())])),g=g.concat(a.map(function(a){var b=[i("width",a.width/72),i("height",a.height/72),i("fixedsize","true")];return a.dcg_nodeFixed&&b.push(i("pos",[a.dcg_nodeFixed.x,1e3-a.dcg_nodeFixed.y].join(","))),'  "'+f(a.dcg_nodeKey)+'" '+j(b)})),g=g.concat(b.map(function(a){return'  "'+f(a.dcg_edgeSource)+(h?'" -> "':'" -- "')+f(a.dcg_edgeTarget)+'" '+j([i("id",f(a.dcg_edgeKey)),i("arrowhead","none"),i("arrowtail","none")])})),g.push("}"),g.push(""),o=g.join("\n")}function l(a,b){q.start();var c=b.bb.split(",").map(function(a){return+a}),d=(b.objects||[]).map(function(a){var b=a.pos.split(",");return{dcg_nodeKey:g(a.name),x:+b[0],y:c[3]-b[1]}}),e=(b.edges||[]).map(function(a){var b={dcg_edgeKey:g(a.id)};if(a._draw_){var d=a._draw_.find(function(a){return a.op&&a.points});b.points=d.points.map(function(a){return{x:a[0],y:c[3]-a[1]}})}return b});q.end(d,e)}function m(b){if(d)a.json(d).header("Content-type","application/x-www-form-urlencoded").post("layouttool="+c+"&"+encodeURIComponent(o),l);else{var e=Viz(o,{format:"json",engine:c});e=JSON.parse(e),l(null,e)}}function n(){}var o,p=b||h(),q=a.dispatch("tick","start","end"),r=N.graphviz_attrs(),s=Object.keys(r);return Object.assign(r,{layoutAlgorithm:function(){return c},layoutId:function(){return p},supportsWebworker:function(){return!1},on:function(a,b){return q.on(a,b),this},init:function(a){return this.optionNames().forEach(function(b){a[b]=a[b]||this[b]()}.bind(this)),e(a),this},data:function(a,b,c,d){k(a,b,c,d)},start:function(a){m(a)},stop:function(){n()},optionNames:function(){return s},populateLayoutNode:function(){},populateLayoutEdge:function(){}})},N.place_ports=function(b,c,d,e,f,g,h){function i(a){var b=Math.hypot(a[0],a[1]);return[a[0]/b,a[1]/b]}function j(a,b){var c=b.target.cola.y-b.source.cola.y,d=b.target.cola.x-b.source.cola.x;return b.source!==a&&(c=-c,d=-d),i([d,c])}function k(a,b){return a[0]*b[1]-a[1]*b[0]>0}function l(a,b){return k(b[0],a)&&k(a,b[1])}function m(a,b){return k(a,b[0])?b[0]:k(b[1],a)?b[1]:a}function n(a){return[Math.cos(a),Math.sin(a)]}function o(a){return Math.atan2(a[1],a[0])}var p={};h.forEach(function(a){var c=b.nodeKey.eval(a.node),d=p[c]=p[c]||[];d.push(a)});for(var q in p){var r=c[q],s=p[q];s.forEach(function(c){if(c.edges.length){var d=c.edges.map(j.bind(null,r));c.vec=[a.sum(d,function(a){return a[0]})/d.length,a.sum(d,function(a){return a[1]})/d.length]}else c.vec=c.vec||void 0;if(c.orig){var e=b.portBounds.eval(c);Array.isArray(e[0])?c.bounds=e:c.bounds=e.map(n)}});var t=[],u=[],v=[];s.forEach(function(a){a.vec?a.bounds&&!l(a.vec,a.bounds)?u.push(a):t.push(a):v.push(a)}),u.forEach(function(a){a.vec=m(a.vec,a.bounds),t.push(a)}),v.forEach(function(a){var b=a.bounds.map(o);b[0]>b[1]&&(b[1]+=2*Math.PI),a.vec=n(b[0]+Math.random()*(b[1]-b[0]))}),s.forEach(function(a){a.pos=b.shape(r.dcg_shape.shape).intersect_vec(r,1e3*a.vec[0],1e3*a.vec[1])})}return f.forEach(function(a){var c=b.edgeSourcePortName.eval(a);a.sourcePort.pos=c?g[H(b.nodeKey.eval(a.source),null,c)].pos:g[H(null,b.edgeKey.eval(a),"source")].pos,c=b.edgeTargetPortName.eval(a),a.targetPort.pos=c?g[H(b.nodeKey.eval(a.target),null,c)].pos:g[H(null,b.edgeKey.eval(a),"target")].pos}),p},N.legend=function(){var a,b={};return b.x=O(0),b.y=O(0),b.gap=O(5),b.nodeWidth=O(40),b.nodeHeight=O(40),b.exemplars=O({}),b.parent=O(null),b.redraw=function(){var c=b.parent().svg().selectAll("g.dc-graph-legend").data([0]);c.enter().append("g").attr("class","dc-graph-legend").attr("transform","translate("+b.x()+","+b.y()+")");var d=c.selectAll(".node").data(a,function(a){return a.name}),e=d.enter().append("g").attr("class","node");e.append("text").attr("dy","0.3em").attr("class","legend-label"),d.attr("transform",function(a,c){return"translate("+b.nodeWidth()/2+","+(b.nodeHeight()+b.gap())*(c+.5)+")"}),d.select("text.legend-label").attr("transform","translate("+(b.nodeWidth()/2+b.gap())+",0)").text(function(a){return a.name}),b.parent()._enterNode(e)._updateNode(d)},b.render=function(){var c=b.exemplars();if(c instanceof Array)a=c.map(function(a){return{name:a.name,orig:{key:a.key,value:a.value},cola:{}}});else{a=[];for(var d in c)a.push({name:d,orig:{key:d,value:c[d]},cola:{}})}b.redraw()},b},N.constraint_pattern=function(a){var b={},c=[];return a.nodes.forEach(function(a){var c=a.id,d=b[c]||(b[c]={});if(a.partition){var e=a.partition,f=a.value||a.id;a.all||a.typename?(d.match=a.extract?function(b){return a.extract(b.value[e])}:function(a){return a.value[e]},d.typename=a.typename||function(a){return e+"="+a.value[e]}):d.match=function(a){return a.value[e]===f}}else{if(!a.match)throw new Error("couldn't determine matcher for type "+JSON.stringify(a));d.match=a.match}}),a.edges.forEach(function(a){if(!a.disable){var b={source:a.source,target:a.target};b.produce="function"==typeof a.produce?a.produce:function(){return n(a.produce)},["listname","wrap","reverse"].forEach(function(c){void 0!==a[c]&&(b[c]=a[c])}),c.push(b)}}),function(a,d,e){var f=[],g={};d.forEach(function(c){var d=a.nodeKey.eval(c);for(var e in b){var f=b[e],h=f.match(c.orig);if(h){var i=f.typename?f.typename(e,h):e;g[i]||(g[i]={nodes:[],whether:{}}),g[i].nodes.push(d),g[i].whether[d]=!0}}});var h=c.filter(function(a){return a.source!==a.target}),i=c.filter(function(a){return a.source===a.target});return e.forEach(function(b){var c=a.edgeSource.eval(b),i=a.edgeTarget.eval(b);h.forEach(function(a){if(g[a.source]&&g[a.source].whether[c]&&g[a.target]&&g[a.target].whether[i]){var b=a.produce(g,d,e);a.reverse?(b.left=i,b.right=c):(b.left=c,b.right=i),f.push(b)}})}),i.forEach(function(a){if(g[a.source]){var b=a.produce(),c=a.listname||a.produce.listname||"nodes",d=a.wrap||a.produce.wrap||function(a){return a};b[c]=g[a.source].nodes.map(d),f.push(b)}}),f}},N.gap_y=function(a,b){return{axis:"y",gap:a,equality:!!b}},N.gap_x=function(a,b){return{axis:"x",gap:a,equality:!!b}},N.align_y=function(){return J("y")},N.align_x=function(){return J("x")},N.order_x=function(a,b){return{type:"ordering",axis:"x",gap:60,ordering:b}},N.order_y=function(a,b){return{type:"ordering",axis:"y",gap:60,ordering:b}},N.tree_positions=function(b,c,d,e,f,g,h){function i(a,b){return(g(a)+g(b))/2}console.warn("dc_graph.tree_positions is deprecated; use the layout engine tree_layout instead"),(b||d)&&console.warn("dc_graph.tree_positions: rootf and treef are ignored");var j;g=a.functor(g);var k=N.depth_first_traversal({nodeid:function(a){return a.cola.dcg_nodeKey},sourceid:function(a){return a.cola.dcg_edgeSource},targetid:function(a){return a.cola.dcg_edgeTarget},init:function(){j=e},row:function(a){return c(a.orig)},place:function(a,b,c){if(c.length){var d=c[c.length-1],e=(g(d)+g(a))/2;j=Math.max(j,d.left_x+e)}a.left_x=j,a.hit_ins=1,a.cola.y=b*h+f},sib:function(a,b,c){var d=i(b,c);a&&(d*=1.5),j+=d},pop:function(a){a.cola.x=(a.left_x+j)/2},skip:function(a,b){a.cola.x=(a.hit_ins*a.cola.x+j)/++a.hit_ins,a.hit_ins===b&&delete a.hit_ins},finish:function(a){a.forEach(function(a){for(var b,c=a.sort(function(a,b){return a.cola.x-b.cola.x}),d=null,e=null,f=0;f<c.length-1;++f){var g=c[f],h=c[f+1];if(d){if(b+=i(g,h),f<c.length-2&&h.cola.x<e+b)continue;d>0&&--d;var j,k;if(f<c.length-2){var l=h.cola.x-(e+b);j=c[d].cola.x+l/2,k=f+1}else j=Math.max(c[d].cola.x,e-i(c[d],c[d+1])-(b-h.cola.x+e)/2),k=c.length;for(var m=d+1;m<k;++m)j+=i(c[m-1],c[m]),c[m].cola.x=j;d=e=b=null}else h.cola.x-g.cola.x<i(g,h)&&(d=f,e=g.cola.x,b=i(g,h))}})}});return function(a,b,c){return k(b,c)}},N.tree_constraints=function(a,b,c,d){return console.warn("dc_graph.tree_constraints is deprecated - it never worked right and may not be a good idea"),function(d,e,f){var g=[],h=0,i=N.depth_first_traversal({root:a,tree:b,place:function(a,b,c){if(c.length){var e=c[c.length-1];g.push({left:d.nodeKey.eval(e),right:d.nodeKey.eval(a),axis:"x",gap:h-e.foo_x,equality:!0})}a.foo_x=h},sib:function(){h+=c}});return i(d,e,f),g}},N.behavior=function(a,b){var c={},d=b.laterDraw?"transitionsStarted":"drawn";return c.parent=O(null).react(function(e){var f;if(e){var g=!0;f=e,e.on(d+"."+a,function(a,c,d){b.add_behavior(f,a,c,d),g&&b.first?(b.first(f,a,c,d),g=!1):b.rest&&b.rest(f,a,c,d)})}else c.parent()&&(f=c.parent(),f.on(d+"."+a,function(c,e,g){b.remove_behavior(f,c,e,g),f.on(d+"."+a,null)}));b.parent&&b.parent(e)}),c},N.tip=function(b){function c(b){j||(j=a.tip().attr("class","d3-tip").html(function(a){return"<span>"+a+"</span>"}).direction(k.direction()),k.offset()&&j.offset(k.offset()),b.svg().call(j))}function d(b){return function(c){var d=this,e=function(){k[b]()(c,function(b){j.show.call(d,b,d),k.linkCallback()&&a.select("div.d3-tip").selectAll("a.tip-link").on("click",function(){a.event.preventDefault(),k.linkCallback()(this.id)})})};i&&window.clearTimeout(i),k.delay()?(window.clearTimeout(h),h=window.setTimeout(e,k.delay())):e()}}function e(){a.event.relatedTarget&&(this.contains(a.event.relatedTarget)||k.clickable()&&a.event.relatedTarget.classList.contains("d3-tip"))||(h&&(window.clearTimeout(h),h=null),k.clickable()?i=window.setTimeout(function(){j.hide()},k.hideDelay()):j.hide())}function f(f,g,h,j){c(f),k.selection().select(f,g,h,j).on("mouseover."+b.namespace,d("content")).on("mouseout."+b.namespace,e),k.clickable()&&a.select("div.d3-tip").on("mouseover."+b.namespace,function(){i&&window.clearTimeout(i)}).on("mouseout."+b.namespace,e)}function g(a,c,d,e){k.selection().select(a,c,d,e).on("mouseover."+b.namespace,null).on("mouseout."+b.namespace,null)}b=b||{};var h,i,j=(b.namespace||"tip",null),k=N.behavior(b.namespace,{add_behavior:f,remove_behavior:g,laterDraw:!0});return k.direction=O("n"),k.content=O(function(a,b){b(k.parent()?k.parent().nodeTitle.eval(a):"")}),k.selection=O(N.tip.select_node_and_edge()),k.showDelay=k.delay=O(0),k.hideDelay=O(200),k.offset=O(null),k.clickable=O(!1),k.linkCallback=O(null),k},N.tip.table=function(){var b=function(c,d){c=c.orig.value;var e=Object.keys(c).filter(a.functor(b.filter())).filter(function(a){return c[a]}),f=a.select(document.createElement("table")),g=f.selectAll("tr").data(e),h=g.enter().append("tr");h.append("td").text(function(a){return a}),h.append("td").text(function(a){return c[a]}),d(f.node().outerHTML)};return b.filter=O(!0),b},N.tip.select_node_and_edge=function(){return{select:function(a,b,c,d){var e=a.selectAll(".foo-this-does-not-exist");return e[0]=b[0].concat(d[0]),e}}},N.tip.select_port=function(){return{select:function(a,b,c,d){return b.selectAll("g.port")}}},N.keyboard=function(){function b(){g.keydown()}function c(){g.keyup()}function d(a){f=a.svg().selectAll("a#dcgraph-keyboard").data([1]),f.enter().append("a").attr({id:"dcgraph-keyboard",href:"#"}),f.on("keydown.keyboard",b),f.on("keyup.keyboard",c),a.svg().on("mouseup.keyboard",function(){h.focus()})}function e(a){f.remove()}var f,g=a.dispatch("keydown","keyup"),h=N.behavior("brush",{add_behavior:d,remove_behavior:e});return h.on=function(a,b){return g.on(a,b),this},h.focus=function(){f.node().focus()},h},N.edit_text=function(b,c){function d(){var a;switch(c.align){case"left":a=[c.box.x,c.box.y];break;default:case"center":a=[c.box.x+(c.box.width-i.node().offsetWidth)/2,c.box.y+(c.box.height-i.node().offsetHeight)/2]}h.attr("transform","translate("+a.join(" ")+")")}function e(){a.event.stopPropagation()}function f(){c.accept&&c.accept(i.text()),i.on("blur.edittext",null),h.remove(),c.finally&&c.finally()}function g(){c.cancel&&c.cancel(),i.on("blur.edittext",null),h.remove(),c.finally&&c.finally()}var h=b.append("foreignObject").attr({height:"100%",width:"100%"}),i=h.append("xhtml:div"),j=c.text||"type on me";i.text(j).attr({contenteditable:!0,width:"auto"}).style({display:"inline-block","background-color":"white",padding:"2px"}),h.on("mousedown",e).on("mousemove",e).on("mouseup",e).on("dblclick",e),i.on("keydown.edittext",function(){13===a.event.keyCode&&a.event.preventDefault()}).on("keyup.edittext",function(){13===a.event.keyCode?f():27===a.event.keyCode&&g(),d()}).on("blur.edittext",g),d(),i.node().focus();var k=document.createRange();c.selectText?k.selectNodeContents(i.node()):(k.setStart(i.node(),1),k.setEnd(i.node(),1));var l=window.getSelection();l.removeAllRanges(),l.addRange(k)},N.brush=function(){function b(){i.brushstart()}function c(){var a=h.extent();i.brushmove(a)}function d(){i.brushend(),g.call(h.clear())}function e(e){h||(h=a.svg.brush().x(e.x()).y(e.y()).on("brushstart",b).on("brush",c).on("brushend",d)),g||(g=e.svg().insert("g",":first-child").attr("class","brush").call(h))}function f(){g&&(g.remove(),g=null)}var g,h=null,i=a.dispatch("brushstart","brushmove","brushend"),j=N.behavior("brush",{add_behavior:function(){},remove_behavior:f});return j.on=function(a,b){return i.on(a,b),this},j.activate=function(){return e(j.parent()),this},j.deactivate=function(){return f(),this},j.isActive=function(){return!!g},j},N.select_things=function(b,c,d){function e(a,b){return!!q.find(r(b))}function f(a){return a.shiftKey}function g(a){return R?a.metaKey:a.ctrlKey}function h(a,b){return e(a,b)?a:a.concat([b])}function i(a,b){return e(a,b)?a.filter(function(a){return a!=b}):a.concat([b])}function j(a){return function(b,c){void 0===c&&(c=!0),q=b,c&&a.refresh()}}function k(d,e){s!==e&&(d.svg().on("click."+c,e?function(c){a.event.target===this&&b.set_changed([])}:null),s=e)}function l(){f(a.event.sourceEvent)||g(a.event.sourceEvent)?p=q.slice():(p=[],b.set_changed([]))}function m(c){var e,j=d.intersectRect(c);e=f(a.event.sourceEvent)?j.reduce(h,p):g(a.event.sourceEvent)?j.reduce(i,p):j,b.set_changed(e)}function n(j,l,m){var n=t.noneIsAll()?function(a){return!q.length||e(q,d.key(a))}:function(a){return e(q,d.key(a))};if(d.applyStyles(n),d.clickables(j,l,m).on("click."+c,function(c){var e,j=d.key(c);t.multipleSelect()&&(f(a.event)?e=h(q,j):g(a.event)&&(e=i(q,j))),e||(e=[j]),b.set_changed(e)}),t.multipleSelect()){var o=j.child("brush");o.activate()}else k(j,t.clickBackgroundClears());if(t.autoCropSelection()){var p=d.clickables(j,l,m).data().map(d.key),r=q.filter(function(a){return e(p,a)});q.length!==r.length&&b.set_changed(r,!1)}}function o(a,b,e){d.clickables(a,b,e).on("click."+c,null),a.svg().on("click."+c,null),d.removeStyles()}var p,q=[],r=d.keysEqual?function(a){return function(b){return d.keysEqual(a,b)}}:function(a){return function(b){return a===b}},s=!1,t=N.behavior(c,{add_behavior:n,remove_behavior:o,parent:function(a){if(b.on("set_changed."+c,a?j(a):null),a){var d=a.child("brush");d||(d=N.brush(),a.child("brush",d)),d.on("brushstart."+c,l).on("brushmove."+c,m)}}});return t.multipleSelect=O(!0),t.clickBackgroundClears=O(!0,!1).react(function(a){!t.multipleSelect()&&t.parent()&&k(t.parent(),a)}),t.noneIsAll=O(!1),t.autoCropSelection=O(!0),t.thinginess=function(){return d},t},N.select_things_group=function(b,c){return window.chart_registry.create_type(c,function(){return a.dispatch("set_changed")}),window.chart_registry.create_group(c,b)},N.select_nodes=function(a){var b=N.select_things_group("select-nodes-group","select-nodes"),c={intersectRect:function(a){return d.parent().selectAllNodes().data().filter(function(b){return b&&a[0][0]<b.cola.x&&b.cola.x<a[1][0]&&a[0][1]<b.cola.y&&b.cola.y<a[1][1]}).map(this.key)},clickables:function(a,b,c){return b},key:function(a){return d.parent().nodeKey.eval(a)},applyStyles:function(b){d.parent().cascade(50,!0,j(b,null,a))},removeStyles:function(){d.parent().cascade(50,!1,a)}},d=N.select_things(b,"select-nodes",c);
return d},N.select_edges=function(a){var b=N.select_things_group("select-edges-group","select-edges"),c={intersectRect:function(a){return this.clickables().data().filter(function(b){var c={x:b.source.cola.x+b.sourcePort.pos.x,y:b.source.cola.y+b.sourcePort.pos.y},d={x:b.target.cola.x+b.targetPort.pos.x,y:b.target.cola.y+b.targetPort.pos.y};return[c,d].some(function(b){return a[0][0]<b.x&&b.x<a[1][0]&&a[0][1]<b.y&&b.y<a[1][1]})}).map(this.key)},clickables:function(){return d.parent().selectAllEdges(".edge-hover")},key:function(a){return d.parent().edgeKey.eval(a)},applyStyles:function(b){d.parent().cascade(50,!0,j(null,b,a))},removeStyles:function(){d.parent().cascade(50,!1,a)}},d=N.select_things(b,"select-edges",c);return d},N.select_ports=function(a){var b=N.select_things_group("select-ports-group","select-ports"),c={intersectRect:null,clickables:function(){return d.parent().selectAllNodes("g.port")},key:function(a){return a.named?{node:d.parent().nodeKey.eval(a.node),name:a.name}:{edge:d.parent().edgeKey.eval(a.edges[0]),name:a.name}},applyStyles:function(b){d.parent().portStyle("symbols").cascade(50,!0,i(b,a))},removeStyles:function(){d.parent().portStyle("symbols").cascade(50,!1,a)},keysEqual:function(a,b){return a.name===b.name&&(a.node?a.node===b.node:a.edge===b.edge)}},d=N.select_things(b,"select-ports",c);return d},N.move_nodes=function(b){function c(a){return function(a,b){void 0===b&&(b=!0),n=a}}function d(a){n.forEach(function(b){var c=p.parent().getWholeNode(b);a(c,b)})}function e(b,c,e){function f(){if(o){var a=N.event_coords(b),f=a[0]-o[0],i=a[1]-o[1];!h&&Math.hypot(f,i)>p.dragSize()&&(h=!0,g&&g.style("pointer-events","none")),h&&(d(function(a){a.cola.x=a.original_position[0]+f,a.cola.y=a.original_position[1]+i}),b.reposition(c,e))}}function k(){if(o){if(h){h=!1,g&&(g.style("pointer-events",null),g=null);var a=[];d(function(b,c){a.push({id:c,pos:{x:b.cola.x,y:b.cola.y}})}),m.request_fixes(a)}o=null}}c.on("mousedown.move-nodes",function(c){if(!(j&&j.usePorts()&&j.usePorts().eventPort())){o=N.event_coords(b),g=a.select(this);var e=b.nodeKey.eval(c);n.indexOf(e)<0&&l.set_changed([e]),d(function(a){a.original_position=[a.cola.x,a.cola.y]}),i&&i.deactivate()}}),c.on("mousemove.move-nodes",f).on("mouseup.move-nodes",k),b.svg().on("mousemove.move-nodes",f).on("mouseup.move-nodes",k)}function f(a,b,c){b.on("mousedown.move-nodes",null),b.on("mousemove.move-nodes",null),b.on("mouseup.move-nodes",null)}b=b||{};var g,h,i,j,k,l=N.select_things_group("select-nodes-group","select-nodes"),m=N.fix_nodes_group("fix-nodes-group"),n=[],o=null,p=N.behavior("move-nodes",{add_behavior:e,remove_behavior:f,parent:function(a){l.on("set_changed.move-nodes",a?c(a):null),i=a.child("brush"),j=a.child("draw-graphs"),k=a.child("select-nodes")}});return p.dragSize=O(5),p},N.fix_nodes=function(a){function b(a){s.strategy().request_fixes(r,a),g(e()).then(function(){s.parent().redraw()})}function c(a,b,c){s.strategy().new_node(r,a,b,c)}function d(a,b,c){var d=k[b],e=k[c];s.strategy().new_edge(r,a,d,e)}function e(){var a=[];return l.forEach(function(b){var c=s.parent().nodeKey.eval(b),d=q[c],e=b.orig.value[p],f=!1;e?d&&d.x===e.x&&d.y===e.y||(f=!0):f=d,f&&a.push({n:b,fixed:d?{x:d.x,y:d.y}:null})}),a}function f(a,b){b?r.fix_node(a.orig.value,b):r.unfix_node(a.orig.value)}function g(a){var b=s.fixNode()||function(a,b){return Promise.resolve(b)},c=a.map(function(a){var c=s.parent().nodeKey.eval(a.n);return b(c,a.fixed).then(function(b){f(a.n,b)})});return Promise.all(c)}function h(a){a.forEach(function(a){f(a.n,a.fixed)})}function i(a){var b=s.fixNode()||function(a,b){return Promise.resolve(b)},c=a.map(function(a){var c=s.parent().nodeKey.eval(a.n);return b(c,a.fixed)});return Promise.all(c)}function j(a,b,c,d,f,g,j){if(k=b,l=c,m=d,n=f,s.strategy().on_data){s.strategy().on_data(r,b,c,d,f,g,j);var o=e();h(o),s.reportOverridesAsynchronously()&&i(e())}}a=a||{};var k,l,m,n,o=N.fix_nodes_group("fix-nodes-group"),p=a.fixedPosTag||"fixedPos",q=[],r={nodeid:function(a){return s.parent().nodeKey.eval(a)},sourceid:function(a){return s.parent().edgeSource.eval(a)},targetid:function(a){return s.parent().edgeTarget.eval(a)},fix_node:function(a,b){a[p]=b},unfix_node:function(a){a[p]=null},clear_fixes:function(){q={}},register_fix:function(a,b){q[a]=b}},s={parent:O(null).react(function(a){o.on("request_fixes.fix-nodes",a?b:null).on("new_node.fix_nodes",a?c:null).on("new_edge.fix_nodes",a?d:null),a?a.on("data.fix-nodes",j):s.parent()&&s.parent().on("data.fix-nodes",null)}),fixNode:O(null),strategy:O(N.fix_nodes.strategy.fix_last()),reportOverridesAsynchronously:O(!0)};return s},N.fix_nodes.strategy={},N.fix_nodes.strategy.fix_last=function(){return{request_fixes:function(a,b){a.clear_fixes(),b.forEach(function(b){a.register_fix(b.id,b.pos)})},new_node:function(a,b,c,d){a.fix_node(c,d)},new_edge:function(a,b,c,d){a.unfix_node(c.orig.value),a.unfix_node(d.orig.value)}}},N.fix_nodes.strategy.last_N_per_component=function(a){var b=0,c={};return{request_fixes:function(a,d){++b,d.forEach(function(a){c[a.id]={id:a.id,age:b,pos:a.pos}})},new_node:function(a,d,e,f){++b,c[d]={id:d,age:b,pos:f},a.fix_node(e,f)},new_edge:function(){},on_data:function(d,e,f,g,h,i,j){++b;var k=[],l=N.undirected_dfs({nodeid:d.nodeid,sourceid:d.sourceid,targetid:d.targetid,comp:function(){k.push([])},node:function(a,b){k[a].push(b)}});l(f,h),d.clear_fixes(),k.forEach(function(b,e){var f=b.reduce(function(a,b){if(b.last_component){var e=a[b.last_component]=a[b.last_component]||{total:0,fixed:0};e.total++,c[d.nodeid(b)]&&e.fixed++}return a},{}),g=Object.keys(f).reduce(function(a,b){return f[b].fixed&&a.push({compid:+b,total:f[b].total,fixed:f[b].fixed}),a},[]).sort(function(a,b){return b.total-a.total}),h=g.length&&g[0].compid,i=b.filter(function(a){return!a.last_component||a.last_component===h}).map(function(a){return c[d.nodeid(a)]}).filter(function(a){return a});i.length>a&&(i.sort(function(a,b){return b.age-a.age}),i=i.slice(0,a)),i.forEach(function(a){d.register_fix(a.id,a.pos)});var j=i.reduce(function(a,b){return a[b.id]=!0,a},{});b.forEach(function(a){var b=d.nodeid(a);j[b]||(c[b]=null),a.last_component=e+1})})}}},N.fix_nodes_group=function(b){return window.chart_registry.create_type("fix-nodes",function(){return a.dispatch("request_fixes","new_node","new_edge")}),window.chart_registry.create_group("fix-nodes",b)},N.filter_selection=function(b,c){function d(b){return function(c){if(c.length){var d=a.set(c);f.dimensionAccessor()(b).filterFunction(function(a){return d.has(a)})}else f.dimensionAccessor()(b).filter(null);b.redrawGroup()}}c=c||"select-nodes";var e=N.select_things_group(b||"select-nodes-group",c),f={parent:O(null).react(function(a){e.on("set_changed.filter-selection-"+c,a?d(a):null)})};return f.dimensionAccessor=O(function(a){return a.nodeDimension()}),f},N.delete_things=function(b,c,d){function e(a){l=a}function f(a){return a[d]}function g(){if(!m.crossfilterAccessor())throw new Error("need crossfilterAccessor");if(!m.dimensionAccessor())throw new Error("need dimensionAccessor");if(0===l.length)return Promise.resolve([]);var a=m.preDelete()?m.preDelete()(l):Promise.resolve(l);return m.onDelete()&&(a=a.then(m.onDelete())),a.then(function(a){if(a&&a.length){var b=m.crossfilterAccessor()(m.parent()),c=m.dimensionAccessor()(m.parent()),d=b.all().slice();d.length;c.filter(null),b.remove();var e=d.filter(function(b){return a.indexOf(f(b))===-1});d.length!==e.length+a.length&&console.warn("size after deletion is not previous size minus selection size",e.map(f),d.map(f),a),b.add(e),m.parent().redrawGroup()}})}function h(b){j.on("keyup."+c,function(){a.event.code===k&&g()})}function i(a){}d=d||"id";var j,k=R?"Backspace":"Delete",l=[],m=N.behavior(c,{add_behavior:h,remove_behavior:i,parent:function(a){b.on("set_changed."+c,e),a&&(j=a.child("keyboard"),j||a.child("keyboard",j=N.keyboard()))}});return m.preDelete=O(null),m.onDelete=O(null),m.crossfilterAccessor=O(null),m.dimensionAccessor=O(null),m.deleteSelection=g,m},N.delete_nodes=function(a){var b=N.select_things_group("select-nodes-group","select-nodes"),c=N.select_things_group("select-edges-group","select-edges"),d=N.delete_things(b,"delete-nodes",a);return d.preDelete(function(a){var b=d.parent(),e=b.child("delete-edges");return e?Promise.resolve(void 0).then(function(){var d=b.edgeGroup().all().filter(function(c){return a.indexOf(b.edgeSource()(c))!==-1||a.indexOf(b.edgeTarget()(c))!==-1}).map(b.edgeKey());return c.set_changed(d),e.deleteSelection().then(function(){return a})}):null}),d},N.label_things=function(b){function c(a){return function(a){m=a}}function d(){i.focus()}function e(a){return function(c,e){var f=b.thing_box(c);N.edit_text(a.g(),{text:e.text||b.thing_label(c)||b.default_label,align:b.align,box:f,selectText:e.selectText,accept:function(a){return b.accept(c,a)},finally:d})}}function f(a,c,d){var e=b.find_thing(m[0],a,c);return e.empty()?void console.error("couldn't find thing '"+m[0]+"'!"):e.size()>1?void console.error("found too many things for '"+m[0]+"' ("+e.size()+")!"):void l.edit_label(e,d)}function g(c,d,e){i.on("keyup."+b.label_type,function(){if(m.length){if(1!==a.event.key.length)return;f(d,e,{text:a.event.key,selectText:!1})}}),j&&j.thinginess().clickables(c,d,e).on("dblclick."+b.label_type,function(){f(d,e,{selectText:!0})})}function h(a,b,c){}b=b||{};var i,j,k=N.select_things_group(b.select_group,b.select_type),l=N.label_things_group(b.label_group,b.label_type),m=[],n=N.behavior(b.label_type,{add_behavior:g,remove_behavior:h,parent:function(a){k.on("set_changed."+b.label_type,a?c(a):null),l.on("edit_label."+b.label_type,a?e(a):null),a&&(i=a.child("keyboard"),i||a.child("keyboard",i=N.keyboard()),j=a.child(b.select_type))}});return n.editSelection=function(a){f(n.parent().selectAllNodes(),n.parent().selectAllEdges(),a)},n},N.label_things_group=function(b,c){return window.chart_registry.create_type(c,function(){return a.dispatch("edit_label")}),window.chart_registry.create_group(c,b)},N.label_nodes=function(a){a=a||{};var b=a.labelTag||"label";a.select_group=a.select_group||"select-nodes-group",a.select_type=a.select_type||"select-nodes",a.label_group=a.label_group||"label-nodes-group",a.label_type=a.label_type||"label-nodes",a.default_label="node name",a.find_thing=function(a,b,d){return b.filter(function(b){return c.parent().nodeKey.eval(b)===a})},a.thing_box=function(a,b){var d=c.parent().content(c.parent().nodeContent.eval(a.datum())),e=d.textbox(a);return e.x+=a.datum().cola.x,e.y+=a.datum().cola.y,e},a.thing_label=function(a){return c.parent().nodeLabel.eval(a.datum())},a.accept=function(a,d){var e=c.changeNodeLabel()?c.changeNodeLabel()(c.parent().nodeKey.eval(a.datum()),d):Promise.resolve(d);return e.then(function(d){var e=a.datum();e.orig.value[b]=d,c.parent().redrawGroup()})};var c=N.label_things(a);return c.changeNodeLabel=O(null),c},N.label_edges=function(a){a=a||{};var b=a.labelTag||"label";a.select_group=a.select_group||"select-edges-group",a.select_type=a.select_type||"select-edges",a.label_group=a.label_group||"label-edges-group",a.label_type=a.label_type||"label-edges",a.default_label="edge name",a.find_thing=function(a,b,d){return d.filter(function(b){return c.parent().edgeKey.eval(b)===a})},a.thing_box=function(a,b){var c=a.datum().pos.new.path.points,d=(c[0].x+c[1].x)/2,e=(c[0].y+c[1].y)/2;return{x:d,y:e-10,width:0,height:20}},a.thing_label=function(a){return c.parent().edgeLabel.eval(a.datum())},a.accept=function(a,d){var e=c.changeEdgeLabel()?c.changeEdgeLabel()(c.parent().edgeKey.eval(a.datum()),d):Promise.resolve(d);return e.then(function(d){var e=a.datum();e.orig.value[b]=d,c.parent().redrawGroup()})};var c=N.label_things(a);return c.changeEdgeLabel=O(null),c},N.highlight_neighbors=function(a){function b(a){a.each(function(a){a.dcg_highlighted=!1})}function c(c,d,e){c.cascade(100,!0,j(null,function(a){return a.dcg_highlighted},a)),d.on("mouseover.highlight-neighbors",function(a){e.each(function(b){b.dcg_highlighted=b.source===a||b.target===a}),c.refresh(d,e)}).on("mouseout.highlight-neighbors",function(a){b(e),c.refresh(d,e)})}function d(c,d,e){d.on("mouseover.highlight-neighbors",null).on("mouseout.highlight-neighbors",null),b(e),c.cascade(100,!1,a)}return N.behavior("highlight-neighbors",{add_behavior:c,remove_behavior:function(a,b,c){d(a,b,c)}})},N.register_highlight_paths_group=function(b){return window.chart_registry.create_type("highlight-paths",function(){return a.dispatch("paths_changed","hover_changed","select_changed")}),window.chart_registry.create_group("highlight-paths",b)},N.highlight_paths=function(a,b,c,d){function e(){w.doRedraw()?w.parent().relayout().redraw():w.parent().refresh()}function f(a,b){u=v=null,0===Object.keys(s).length&&0===Object.keys(a).length&&0===Object.keys(t).length&&0===Object.keys(b).length||(s=a,t=b,e())}function g(a){a!==v&&(v=a,e())}function h(a){a!==u&&(u=a,e())}function i(){s={},t={}}function k(a){return function(b){return a.indexOf(b)>=0}}function l(a){var b=k(a);return function(a){return!b(a)}}function m(a,b){return!(!a||!b)&&a.some(k(b))}function n(a,b){return a?b?b.every(k(a))?a.filter(l(b)):a.concat(b.filter(l(a))):a:b}function o(d,e,f,g){d.cascade(200,!0,j(function(a){return!!s[d.nodeKey.eval(a)]},function(a){return!!t[d.edgeKey.eval(a)]},a)).cascade(300,!0,j(function(a){return m(s[d.nodeKey.eval(a)],u)},function(a){return m(t[d.edgeKey.eval(a)],u)},c)).cascade(400,!0,j(function(a){return m(s[d.nodeKey.eval(a)],v)},function(a){return m(t[d.edgeKey.eval(a)],v)},b)),e.on("mouseover.highlight-paths",function(a){q.hover_changed(s[d.nodeKey.eval(a)]||null)}).on("mouseout.highlight-paths",function(a){q.hover_changed(null)}).on("click.highlight-paths",function(a){q.select_changed(n(u,s[d.nodeKey.eval(a)]))}),g.on("mouseover.highlight-paths",function(a){q.hover_changed(t[d.edgeKey.eval(a)]||null)}).on("mouseout.highlight-paths",function(a){q.hover_changed(null)}).on("click.highlight-paths",function(a){q.select_changed(n(u,t[d.nodeKey.eval(a)]))})}function p(d,e,f,g){e.on("mouseover.highlight-paths",null).on("mouseout.highlight-paths",null).on("click.highlight-paths",null),g.on("mouseover.highlight-paths",null).on("mouseout.highlight-paths",null).on("click.highlight-paths",null),i(),d.cascade(200,!1,a).cascade(300,!1,c).cascade(400,!1,b)}var q=N.register_highlight_paths_group(d||"highlight-paths-group");a=a||{},b=b||{},c=c||{};var r,s={},t={},u=null,v=null,w=N.behavior("highlight-paths",{add_behavior:o,remove_behavior:function(a,b,c,d){return p(a,b,c,d),this},parent:function(a){a&&(r=a.anchorName()),q.on("paths_changed."+r,a?f:null),q.on("hover_changed."+r,a?g:null),q.on("select_changed."+r,a?h:null)}});return w.doRedraw=O(!1),w},N.expand_collapse=function(b,c,d,e){function f(a){var b=a.addOrRemoveDef("spike-gradient",!0,"linearGradient");b.attr({x1:"0%",y1:"0%",x2:"100%",y2:"0%",spreadMethod:"pad"}),b.selectAll("stop").data([[0,"black",1],[100,"black","0"]]).enter().append("stop").attr({offset:function(a){return a[0]+"%"},"stop-color":function(a){return a[1]},"stop-opacity":function(a){return a[2]}})}function g(a,b,c,d){var e;switch(c){case"out":e=function(b){return a.edgeSource.eval(b)===d};break;case"in":e=function(b){return a.edgeTarget.eval(b)===d};break;case"both":e=function(b){return a.edgeSource.eval(b)===d||a.edgeTarget.eval(b)===d}}return b.filter(e).size()}function h(a,b,c){if("both"===b)return function(a){return Math.PI*(2*a/c-.5)};var d,e=(c-1)*Math.PI/c;switch(a){case"LR":d=0;break;case"TB":d=Math.PI/2;break;case"RL":d=Math.PI;break;case"BT":d=-Math.PI/2}return"in"===b&&(d+=Math.PI),function(a){return d+e*(-.5+(c>1?a/(c-1):0))}}function i(a,b,c){var d=b.selectAll("g.spikes").data(function(a){return!a.dcg_expand_selected||a.dcg_expanded&&a.dcg_expanded[a.dcg_expand_selected.dir]?[]:[a]});d.exit().remove(),d.enter().insert("g",":first-child").classed("spikes",!0);var e=d.selectAll("rect.spike").data(function(b){for(var c=(a.nodeKey.eval(b),b.dcg_expand_selected.dir),d=b.dcg_expand_selected.n,e=h(a.layoutEngine().rankdir(),c,d),f=Array(d),g=0;g<d;++g){var i=e(g);f[g]={a:180*i/Math.PI,x:Math.cos(i)*b.dcg_rx*.9,y:Math.sin(i)*b.dcg_ry*.9}}return f});e.enter().append("rect").classed("spike",!0).attr({width:25,height:3,fill:"url(#spike-gradient)",rx:1,ry:1,x:0,y:0}),e.attr("transform",function(a){return"translate("+a.x+","+a.y+") rotate("+a.a+")"}),e.exit().remove()}function j(a,b,c){b.each(function(a){a.dcg_expand_selected=null}),i(a,b,c)}function k(a,b,c,d){return 1===g(a,b,d,c)}function l(a,b,c,d){if(1===c.length)return c[0];var e=a.root().node().getBoundingClientRect(),f=a.invertCoord([b.clientX-e.left,b.clientY-e.top]),g=f[0],h=f[1];switch(a.layoutEngine().rankdir()){case"TB":return h>d.cola.y?"out":"in";case"BT":return h<d.cola.y?"out":"in";case"LR":return g>d.cola.x?"out":"in";case"RL":return g<d.cola.x?"out":"in"}throw new Error("unknown rankdir "+a.layoutEngine().rankdir())}function m(f,h,m){function n(c){var d=l(f,a.event,e,c),j=f.nodeKey.eval(c);Promise.resolve(b(j,d)).then(function(a){var b={dir:d,n:Math.max(0,a-g(f,m,d,j))};h.each(function(a){a.dcg_expand_selected=a===c?b:null}),i(f,h,m)})}function o(b){function g(){var a=l(f,j,e,b);b.dcg_expanded=b.dcg_expanded||{},b.dcg_expanded[a]?(d(f.nodeKey.eval(b),k.bind(null,f,m,a),a),b.dcg_expanded[a]=!1):(c(f.nodeKey.eval(b),a,"dblclick"===j.type),b.dcg_expanded[a]=!0),i(f,h,m),b.dcg_dblclk_timeout=null}var j=a.event;return console.log(j.type),g()}h.on("mouseover.expand-collapse",n).on("mousemove.expand-collapse",n).on("mouseout.expand-collapse",function(a){j(f,h,m)}).on("click",o).on("dblclick",o)}function n(a,b,c){b.on("mouseover.expand-collapse",null).on("mouseout.expand-collapse",null),j(a,b)}if(e=e||["both"],e.length>2)throw new Error("there are only two directions to expand in");return N.behavior("expand-collapse",{add_behavior:m,first:f,remove_behavior:n})},N.draw_graphs=function(b){function c(){var a=w.filter(function(a){return a.source&&a.target}),b=v.selectAll("line.hint-edge").data(a);b.exit().remove(),b.enter().append("line").attr("class","hint-edge").style({fill:"none",stroke:"black","pointer-events":"none"}),b.attr({x1:function(a){return a.source.x},y1:function(a){return a.source.y},x2:function(a){return a.target.x},y2:function(a){return a.target.y}})}function d(){w=[],t=u=null,c()}function e(a,b,c){if(!x.nodeCrossfilter())throw new Error("need nodeCrossfilter");var d,e=x.addNode()||p;c?d=c:(d={},d[m]=h(),d[r]=""),b&&l.new_node(d[m],d,{x:b[0],y:b[1]}),e(d).then(function(b){b&&(x.nodeCrossfilter().add([b]),a.redrawGroup(),j.set_changed([b[m]]))})}function f(a,b,c){if(!x.edgeCrossfilter())throw new Error("need edgeCrossfilter");var d={},e=x.addEdge()||p;d[n]=h(),d[o]=b.node.orig.key,d[q]=c.node.orig.key,d[s]="",e(d,b.port,c.port).then(function(b){b&&(l.new_edge(d[n],b[o],b[q]),x.edgeCrossfilter().add([b]),j.set_changed([],!1),k.set_changed([b[n]],!1),a.redrawGroup())})}function g(b,g,h,i){var j=b.child("select-nodes");j&&x.clickCreatesNodes()&&j.clickBackgroundClears(!1),g.on("mousedown.draw-graphs",function(b){if(a.event.stopPropagation(),x.dragCreatesEdges()){if(x.usePorts()){var c=x.usePorts().eventPort();if(!c)return;t={node:b,port:c},w=[{source:{x:b.cola.x+c.pos.x,y:b.cola.y+c.pos.y}}]}else t={node:b},w=[{source:{x:t.node.cola.x,y:t.node.cola.y}}];x.conduct().startDragEdge&&(x.conduct().startDragEdge(t)||d())}}).on("mousemove.draw-graphs",function(d){if(a.event.stopPropagation(),t){var e=u;if(d===t.node)u=null,w[0].target=null;else if(x.usePorts()){var f=x.usePorts().eventPort();u=f?{node:d,port:f}:null}else u&&d===u.node||(u={node:d});if(x.conduct().changeDragTarget){var g;if(x.usePorts()){var h=e&&e.port,i=u&&u.port;g=h!==i}else{var j=e&&e.node,k=u&&u.node;g=j!==k}g&&!x.conduct().changeDragTarget(t,u)&&(u=null)}if(u)u.port?w[0].target={x:d.cola.x+f.pos.x,y:d.cola.y+f.pos.y}:w[0].target={x:d.cola.x,y:d.cola.y};else{var l=N.event_coords(b);w[0].target={x:l[0],y:l[1]}}c()}}).on("mouseup.draw-graphs",function(a){if(t&&u){if(x.conduct().finishDragEdge&&!x.conduct().finishDragEdge(t,u))return;f(b,t,u)}else t&&x.conduct().cancelDragEdge&&x.conduct().cancelDragEdge(t);d()}),b.svg().on("mousedown.draw-graphs",function(){t=null}).on("mousemove.draw-graphs",function(){if(t){x.conduct().changeDragTarget&&u&&x.conduct().changeDragTarget(t,null);var a=N.event_coords(b);u=null,w[0].target={x:a[0],y:a[1]},c()}}).on("mouseup.draw-graphs",function(){t?(x.conduct().cancelDragEdge&&x.conduct().cancelDragEdge(t),d()):a.event.target===this&&x.clickCreatesNodes()&&e(b,N.event_coords(b))}),v||(v=b.g().append("g").attr("class","draw-graphs"))}function i(a,b,c,d){b.on("mousedown.draw-graphs",null).on("mousemove.draw-graphs",null).on("mouseup.draw-graphs",null),a.svg().on("mousedown.draw-graphs",null).on("mousemove.draw-graphs",null).on("mouseup.draw-graphs",null)}var j=N.select_things_group("select-nodes-group","select-nodes"),k=N.select_things_group("select-edges-group","select-edges"),l=(N.label_things_group("label-nodes-group","label-nodes"),N.label_things_group("label-edges-group","label-edges"),N.fix_nodes_group("fix-nodes-group")),m=b.idTag||"id",n=b.edgeIdTag||m,o=b.sourceTag||"source",q=b.targetTag||"target",r=b.labelTag||"label",s=b.edgeLabelTag||r,t=null,u=null,v=null,w=[],x=N.behavior("highlight-paths",{add_behavior:g,remove_behavior:i});return x.nodeCrossfilter=O(b.nodeCrossfilter),x.edgeCrossfilter=O(b.edgeCrossfilter),x.usePorts=O(null),x.clickCreatesNodes=O(!0),x.dragCreatesEdges=O(!0),x.conduct=O({}),x.addNode=O(null),x.addEdge=O(null),x.createNode=function(a,b){e(x.parent(),a,b)},x},N.match_ports=function(a,b){function c(b,c){return b.map(function(b){return b.state=c,a.portNodeKey.eval(b)})}function d(d){var e=c(g,"small");d.port.state="small",e.push(a.portNodeKey.eval(d.port)),b.animateNodes(e)}var e,f,g;a.on("data",function(a,b,c,d,g,h,i){e=h,f=i});var h={isValid:O(function(a,b){return b!==a&&b.name===a.name}),startDragEdge:function(d){g=f.filter(h.isValid().bind(null,d.port));var e=c(g,"shimmer");return g.length&&(b.enableHover(!1),d.port.state="large",e.push(a.portNodeKey.eval(d.port)),b.animateNodes(e)),console.log("valid targets",e),0!==g.length},changeDragTarget:function(a,d){var e,f,i=d&&h.isValid()(a.port,d.port);return i?(e=c(g,"small"),d.port.state="large"):(e=c(g,"small"),f=b.animateNodes(e),e=c(g,"shimmer")),b.animateNodes(e,f),i},finishDragEdge:function(a,c){return b.enableHover(!0),d(a),h.isValid()(a.port,c.port)},cancelDragEdge:function(a){return b.enableHover(!0),d(a),!0}};return h},N.symbol_port_style=function(){function b(a){return a.named?a.name:m.parent().edgeKey.eval(a.edges[0])}function c(a){return m.colorScale()(m.portColor.eval(a))}function d(a){var b=Math.hypot(a.pos.x,a.pos.y),c={x:a.pos.x/b,y:a.pos.y/b},d=m.portDisplacement.eval(a),e={x:a.pos.x+d*c.x,y:a.pos.y+d*c.y};return"translate("+e.x+","+e.y+")"}function f(b,c){return a.svg.symbol().type(m.symbolScale()(m.portSymbol.eval(b))).size(c*c)()}function g(a){return a.vec[0]<0}function h(a){switch(a.state){case"large":return m.portHoverPortRadius.eval(a);case"medium":return m.portHoverNodeRadius.eval(a);case"small":default:return m.portRadius.eval(a)}}function i(a){var b,c;return m.portBackgroundFill.eval(a)?(b=m.portBackgroundScale()||e,c=m.portBackgroundFill.eval(a)):(b=m.parent().nodeFillScale()||e,c=m.parent().nodeFill.eval(a.node)),b(c)}var j,l,m={},n=a.tip().attr("class","d3-tip").html(function(a){return"<span>"+a+"</span>"}).direction("w");return m.symbolScale=O(a.shuffle(a.scale.ordinal().range(a.svg.symbolTypes))),m.colorScale=O(a.scale.ordinal().range(a.shuffle(["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]))),m.portSymbol=O(b,!1),m.portColor=O(b,!1),m.portRadius=O(7),m.portHoverNodeRadius=O(10),m.portHoverPortRadius=O(14),m.portDisplacement=O(2),m.portBackground=O(!0),m.portBackgroundScale=O(null),m.portBackgroundFill=O(null),m.portBackgroundStroke=O("black"),m.portBackgroundStrokeWidth=O(1),m.portPadding=O(2),m.portLabel=m.portText=O(function(a){return a.name}),m.portLabelPadding=O({x:5,y:5}),m.cascade=k(m),m.animateNodes=function(b,c){function d(){var a=n.transition().duration(1e3).ease("bounce");a.selectAll("circle.port").attr("r",function(a){return m.portHoverPortRadius.eval(a)+m.portPadding.eval(a)}),a.selectAll("path.port").attr({d:function(a){return f(a,m.portHoverPortRadius.eval(a))}});var b=a.transition().duration(1e3).ease("sin");b.selectAll("circle.port").attr("r",function(a){return m.portRadius.eval(a)+m.portPadding.eval(a)}),b.selectAll("path.port").attr({d:function(a){return f(a,m.portRadius.eval(a))}}),b.each("end",d)}function e(a){return"large"===a.state||"medium"===a.state}var g=a.set(b),i=l.filter(function(a){return g.has(m.parent().nodeKey.eval(a))}),k=i.selectAll("g.port"),n=k.filter(function(a){return"shimmer"===a.state}),o=k.filter(function(a){return"shimmer"!==a.state});n.size()&&(c?c.each("end",d):d());var p=o.transition().duration(250);return p.selectAll("circle.port").attr({r:function(a){return h(a)+m.portPadding.eval(a)}}),p.selectAll("path.port").attr({d:function(a){return f(a,h(a))}}),p.selectAll("text.port").attr({opacity:function(a){return e(a)?1:0},"pointer-events":function(a){return e(a)?"auto":"none"}}),p.selectAll("rect.port").attr("opacity",function(a){return e(a)?1:0}),l.filter(function(a){return j[m.parent().nodeKey.eval(a)].some(e)}).each(function(){this.parentNode.appendChild(this)}),p},m.eventPort=function(){var b=a.select(a.event.target.parentNode);return"g"===a.event.target.parentNode.tagName&&b.classed("port")?b.datum():null},m.drawPorts=function(a,e){j=a,l=e;var h=e.selectAll("g.port").data(function(b){return a[m.parent().nodeKey.eval(b)]||[]},b);h.exit().remove();var k=h.enter().append("g").attr({class:"port",transform:d});h.transition("port-position").duration(m.parent().stagedDuration()).delay(m.parent().stagedDelay(!1)).attr({transform:d});var n=h.selectAll("circle.port").data(function(a){return m.portBackground.eval(a)?[a]:[]});n.exit().remove(),n.enter().append("circle").attr({class:"port",r:function(a){return m.portRadius.eval(a)+m.portPadding.eval(a)},fill:i,"stroke-width":m.portBackgroundStrokeWidth.eval,stroke:m.portBackgroundStroke.eval}),n.transition().duration(m.parent().stagedDuration()).delay(m.parent().stagedDelay(!1)).attr({r:function(a){return m.portRadius.eval(a)+m.portPadding.eval(a)},fill:i,"stroke-width":m.portBackgroundStrokeWidth.eval,stroke:m.portBackgroundStroke.eval});var o=(k.append("path").attr({class:"port",fill:c,d:function(a){return f(a,m.portRadius.eval(a))}}),h.select("path.port"));o.transition().duration(m.parent().stagedDuration()).delay(m.parent().stagedDelay(!1)).attr({fill:c,d:function(a){return f(a,m.portRadius.eval(a))}});var p=h.selectAll("text.port").data(function(a){return m.portText.eval(a)?[a]:[]});p.exit().remove();var q=p.enter();return q.append("rect").attr({class:"port","pointer-events":"none"}),q.append("text").attr({class:"port","alignment-baseline":"middle","pointer-events":"none",cursor:"default",opacity:0}),p.each(function(a){a.offset=(g(a)?-1:1)*(m.portHoverPortRadius.eval(a)+m.portPadding.eval(a))}).attr({"text-anchor":function(a){return g(a)?"end":"start"},transform:function(a){return"translate("+a.offset+",0)"}}).text(m.portText.eval).each(function(a){a.bbox=this.getBBox()}),h.selectAll("rect.port").attr({x:function(a){return(a.offset<0?a.offset-a.bbox.width:a.offset)-m.portLabelPadding.eval(a).x},y:function(a){return-a.bbox.height/2-m.portLabelPadding.eval(a).y},width:function(a){return a.bbox.width+2*m.portLabelPadding.eval(a).x},height:function(a){return a.bbox.height+2*m.portLabelPadding.eval(a).y},fill:"white",opacity:0}),m.enableHover(!0),m},m.enableHover=function(a){return a?(l.on("mouseover.grow-ports",function(a){var b=m.parent().nodeKey.eval(a),c=m.eventPort();j[b].forEach(function(a){a.state=a===c?"large":c?"small":"medium"}),m.animateNodes([b])}),l.on("mouseout.grow-ports",function(a){var b=m.parent().nodeKey.eval(a);j[b].forEach(function(a){a.state="small"}),m.animateNodes([b])})):(l.on("mouseover.grow-ports",null),l.on("mouseout.grow-ports",null)),m},m.showTip=function(a){return l.filter(function(b){return a.node===b}).call(n.show),m},m.parent=O(null),m},N.load_graph=function(){function b(a){return a?a.replace(/\?.*/,""):null}var c,d,e;if(c=arguments[0],3===arguments.length)d=arguments[1],e=arguments[2];else{if(2!==arguments.length)throw new Error("need two or three arguments");e=arguments[1]}d?queue().defer(a.json,c).defer(a.json,d).await(function(a,b,c){a?e(a,null):e(null,{nodes:b.results,edges:c.results})}):/\.json$/.test(b(c))?a.json(c,e):/\.gv|\.dot$/.test(b(c))?a.text(c,K.bind(null,e)):/\.psv$/.test(b(c))?a.dsv("|","text/plain")(c,L.bind(null,e)):/\.csv$/.test(b(c))&&a.csv(c,L.bind(null,e))},N.munge_graph=function(a,b,c,d){function e(a,b){return b.filter(function(b){return!!a[b]})}var f,g,h=b||"name",i=c||"sourcename",j=d||"targetname";if(!M(a)){var k=["database","response"],l=k.findIndex(function(b){return a[b]&&M(a[b])});if(l<0)throw new Error("couldn't find the data!");a=a[k[l]]}g=a.edges||a.links,f=a.nodes||a.vertices;var m=g[0];if(void 0===m[i]){var n=c?[c]:["source_ecomp_uid","node1","source","tail"],o=d?[d]:["target_ecomp_uid","node2","target","head"],p=["edge"];if(m.node0&&m.node1)i="node0",j="node1";else{var q=e(m,n);if(!q.length){if(l=p.findIndex(function(a){return m[a]&&e(m[a],n).length}),l<0)throw c?new Error("sourceattr "+i+" didn't work"):new Error("didn't find any source attr");g=g.map(function(a){return a[p[l]]}),m=g[0],q=e(m,n)}if(q.length>1&&console.warn("found more than one possible source attr",q),i=q[0],q=e(m,o),!q.length)throw d&&!m[d]?new Error("targetattr "+j+" didn't work"):new Error("didn't find any target attr");q.length>1&&console.warn("found more than one possible target attr",q),j=q[0]}}var r=f[0];if(void 0===r[h]){var s=b?[b]:["ecomp_uid","id","_id"],t=["vertex"];if(q=e(r,s),!q.length){if(l=t.findIndex(function(a){return r[a]&&e(r[a],s).length}),l<0)throw b?new Error("nodekeyattr "+h+" didn't work"):new Error("couldn't find the node data");f=f.map(function(a){return a[t[l]]}),r=f[0],q=e(r,s)}q.length>1&&console.warn("found more than one possible node key attr",q),h=q[0]}return{nodes:f,edges:g,nodekeyattr:h,sourceattr:i,targetattr:j}},N.flat_group=function(){function a(a){return{all:function(){return a.all().filter(function(a){return null!==a.value})}}}function c(b,c){var e=b.dimension(c);return{crossfilter:b,dimension:e,group:a(e.group().reduce(d.add,d.remove,d.init))}}var d={add:function(a,b){return b},remove:function(){return null},init:function(){return null}};return{make:function(a,d){var e=b(a);return c(e,d)},another:function(a,b){return c(a,b)}}}();var W=function(a,b,d,e,f,g){if(f=f||0,b.length>(d.valuesByAttr?1:0)){var i=b.shift(),j=[],k=[],l=a.map(function(a){var c=a[d.nestKey],l=d.nestKeysUnique?c:h();if(l){var m;if(d.ancestorKeys?(g=g||{},i&&(g[i]=c),m=Object.assign({},g)):m={},m[d.nodeKey]=l,d.label&&d.labelFun&&(m[d.label]=d.labelFun(c,i,a)),d.level&&(m[d.level]=f+1),j.push(m),e){var n={};n[d.edgeSource]=e,n[d.edgeTarget]=l,k.push(n)}}var o=d.valuesByAttr?a[b[0]]:a.values,p=W(o,b.slice(0),d,l,f+1,Object.assign({},g));return p});return{nodes:Array.prototype.concat.apply(j,l.map(c.pluck("nodes"))),edges:Array.prototype.concat.apply(k,l.map(c.pluck("edges")))}}return{nodes:a.map(function(a){return a=Object.assign({},a),d.level&&(a[d.level]=f+1),a}),edges:a.map(function(a){var b={};return b[d.edgeSource]=e,b[d.edgeTarget]=a[d.nodeKey],b})}};return N.convert_tree=function(a,b,c){return c=Object.assign({nodeKey:"key",edgeKey:"key",edgeSource:"sourcename",edgeTarget:"targetname",nestKey:"key"},c),Array.isArray(a)?W(a,b,c,c.root,0,c.inherit):(b=[""].concat(b),W([a],b,c,c.root,0,c.inherit))},N.convert_nest=function(a,b,c,d,e,f,g){return N.convert_tree(a,b,{nodeKey:c,edgeSource:d,edgeTarget:e,root:f,inherit:g,ancestorKeys:!0,label:"name",labelFun:function(a,b,c){return b+":"+a},level:"_level"})},N.convert_adjacency_list=function(a,b,c){
var d=Array.prototype.concat.apply([],a.map(function(a){return a[b.adjacencies].map(function(d){var e={};return c.edgeKey&&(e[c.edgeKey]=h()),e[c.edgeSource]=a[b.nodeKey],e[c.edgeTarget]=b.targetKey?d[b.targetKey]:d,c.adjacency&&(e[c.adjacency]=d),e})}));return{nodes:a,edges:d}},N.path_reader=function(a){function b(a,b,c){h.elementList.eval(a).forEach(function(d){var e,f;switch(h.elementType.eval(d)){case"node":e=h.nodeKey.eval(d),f=b[e]=b[e]||[];break;case"edge":e=h.edgeSource.eval(d)+"-"+h.edgeTarget.eval(d),f=c[e]=c[e]||[]}f.push(a)})}var c,d,f,g=N.register_highlight_paths_group(a||"highlight-paths-group"),h={pathList:O(e,!1),timeRange:O(null,!1),elementList:O(e,!1),elementType:O(null,!1),nodeKey:O(null,!1),edgeSource:O(null,!1),edgeTarget:O(null,!1),clear:function(){g.paths_changed({},{},[])},data:function(a){var e,i={},j={},k=[];h.pathList.eval(a).forEach(function(a){if(a._range=h.timeRange.eval(a)){if(e===!1)throw new Error("can't have a mix of ranged and non-ranged paths");e=!0}else{if(e===!0)throw new Error("can't have a mix of ranged and non-ranged paths");e=!1,b(a,i,j)}k.push(a)}),e?(c=k.map(function(a){var b=[a._range[0].getTime(),a._range[1].getTime()];return b.path=a,b}),d=lysenkoIntervalTree(c),f&&this.setTime(f)):(c=null,d=null,g.paths_changed(i,j,k))},getIntervals:function(){return c},setTime:function(a){if(a&&d){var c=[],e={},h={};d.queryPoint(a.getTime(),function(a){c.push(a.path),b(a.path,e,h)}),g.paths_changed(e,h,c)}f=a}};return h},N.path_selector=function(b,d,e,f){function g(a){return function(b){return!!a&&a.indexOf(b)>=0}}function h(a){var b=g(a);return function(a){return!b(a)}}function i(a,b){return a?b?b.every(g(a))?a.filter(h(b)):a.concat(b.filter(h(a))):a:b}function j(a){var b=n.selectAll("span.path-selector").data(a);b.enter().append("span").attr("class","path-selector").style({"border-width":"1px","border-style":"solid","border-color":"grey","border-radius":"4px",display:"inline-block",padding:"4px",cursor:"pointer",margin:"5px"}),b.exit().transition(1e3).attr("opacity",0).remove(),b.text(function(a,b){return"path "+(b+1)+" ("+d.elementList.eval(a).length+")"}).on("mouseover",function(a){m.hover_changed([a])}).on("mouseout",function(a){m.hover_changed(null)}).on("click",function(a){m.select_changed(i(q,[a]))});var c=n.selectAll("span.no-paths").data(0===a.length?[0]:[]);c.exit().remove(),c.enter().append("span").attr("class","no-paths"),c.classed("error",!!r.error_text()).text(r.error_text()||(r.queried()?r.zero_text():r.default_text()))}function k(){var a=g(p);n.selectAll("span.path-selector").style({"border-color":function(b,c){return a(b)?"#e41a1c":"grey"},"border-width":function(b,c){return(a(b)?2:1)+"px"},padding:function(b,c){return(a(b)?3:4)+"px"}})}function l(){var a=g(q);n.selectAll("span.path-selector").style({"background-color":function(b,c){return a(b)?"#1c1ae6":"white"},color:function(b,c){return a(b)?"white":"black"}})}var m=N.register_highlight_paths_group(e||"highlight-paths-group"),n=a.select(b),o=[],p=null,q=null;m.on("paths_changed.selector",function(a,b,c){p=q=null,o=c,r.redraw()}).on("hover_changed.selector",function(a){p=a,k()}).on("select_changed.selector",function(a){q=a,l()});var r={default_text:O("Nothing here"),zero_text:O("No paths"),error_text:O(null),queried:O(!1),redraw:function(){j(o),k(),l()},render:function(){return this.redraw(),this}};return c.registerChart(r,f),r},N.node_name=function(a){if(a<26)return String.fromCharCode(97+a);if(a<52)return String.fromCharCode(65+a-26);if(a<2704)return N.node_name(Math.floor(a/52))+N.node_name(a%52);throw new Error("no, that's too large")},N.node_object=function(a,b){return b=b||{},_.extend({id:a,name:N.node_name(a)},b)},N.edge_object=function(a,b,c,d){return d=d||{},_.extend({source:b,target:c,sourcename:a(b),targetname:a(c)},d)},N.generate=function(a,b,c,d){var e,f,g,h,i=c.nodePrefix||"",j=function(a){return e[a].name},k=b[0],l=c.linkLength||30;switch(a){case"clique":case"cliquestf":for(e=new Array(k),f=[],g=0;g<k;++g)for(e[g]=N.node_object(g,{circle:"A",name:i+N.node_name(g)}),h=0;h<g;++h)f.push(N.edge_object(j,g,h,{notLayout:!0,undirected:!0}));if("cliquestf"===a)for(g=0;g<k;++g)e[g+k]=N.node_object(g+k),e[g+2*k]=N.node_object(g+2*k),f.push(N.edge_object(j,g,g+k,{undirected:!0})),f.push(N.edge_object(j,g,g+2*k,{undirected:!0}));break;case"wheel":for(e=new Array(k),g=0;g<k;++g)e[g]=N.node_object(g,{name:i+N.node_name(g)});f=N.wheel_edges(j,_.range(k),k*l/2);var m=f[0].distance;for(g=0;g<b[1];++g)for(h=0;h<k;++h){var n,o=h,p=(h+1)%k;g%2===1&&(n=o,o=p,p=n),f.push(N.edge_object(j,o,p,{distance:m,par:g+2}))}break;default:throw new Error("unknown generation type "+a)}var q={nodes:e,links:f};d(null,q)},N.wheel_edges=function(a,b,c){for(var d=b.length,e=[],f=Math.floor(d/2),g=2*c*Math.sin(Math.PI/d),h=2*c*Math.sin(f*Math.PI/d),i=0;i<d;++i)e.push(N.edge_object(a,b[i],b[(i+1)%d],{distance:g}));for(i=0;i<d/2;++i)e.push(N.edge_object(a,b[i],b[(i+f)%d],{distance:h})),d%2&&i!=Math.floor(d/2)&&e.push(N.edge_object(a,b[i],b[(i+d-f)%d],{distance:h}));return e},N.random_graph=function(a){function b(){var b={};return b[a.nodeKey]=a.nodeKeyGen(d.length),b[a.colorTag]=Math.floor(Math.random()*a.ncolors),d.push(b),b}function c(){return d[Math.floor(Math.random()*d.length)]}a=Object.assign({ncolors:5,ndashes:4,nodeKey:"key",edgeKey:"key",sourceKey:"sourcename",targetKey:"targetname",colorTag:"color",dashTag:"dash",nodeKeyGen:function(a){return"n"+a},edgeKeyGen:function(a){return"e"+a},newComponentProb:.1,newNodeProb:.9,log:!1},a),isNaN(a.newNodeProb)&&(a.newNodeProb=.9),a.newNodProb<=0&&(a.newNodeProb=.1);var d=[],e=[];return{nodes:function(){return d},edges:function(){return e},generate:function(f){for(;f-- >0;){var g,h,i=Math.random();if(g=!d.length||i<a.newComponentProb?b():c(),h=i<a.newNodeProb?b():c(),g&&h){var j={};j[a.edgeKey]=a.edgeKeyGen(e.length),j[a.sourceKey]=g[a.nodeKey],j[a.targetKey]=h[a.nodeKey],j[a.dashTag]=Math.floor(Math.random()*a.ndashes),a.log&&console.log(g[a.nodeKey]+" -> "+h[a.nodeKey]),e.push(j)}}}}},N.line_breaks=function(a,b){var c=new RegExp(a,"g");return function(a){var d,e,f=a.key,g="",h=[],i=0;do d=c.exec(f),e=d?f.slice(i,c.lastIndex):f.slice(i),g.length+e.length>b&&g.length>0&&(h.push(g),g=""),g+=e,i=c.lastIndex;while(null!==d);return h.push(g),h}},N.build_type_graph=function(a,b,c,d,e,f){var g={},h={},i={};return a.forEach(function(a){g[c(a)]=a;var b=d(a);h[b]||(h[b]={type:b})}),b.forEach(function(a){var b,c,h=e(a),j=f(a);if(!(b=g[h]))throw new Error("source key "+h+" not found!");if(!(c=g[j]))throw new Error("target key "+j+" not found!");var k=d(b)+"/"+d(c);i[k]||(i[k]={type:k,source:d(b),target:d(c)})}),{nodes:Object.keys(h).map(function(a){return h[a]}),edges:Object.keys(i).map(function(a){return i[a]})}},N.d3=a,N.crossfilter=b,N.dc=c,N}if("function"==typeof define&&define.amd)define(["d3","crossfilter","dc"],a);else if("object"==typeof module&&module.exports){var b=require("d3"),c=require("crossfilter");"function"!=typeof c&&(c=c.crossfilter);var d=require("dc");module.exports=a(b,c,d)}else this.dc_graph=a(d3,crossfilter,dc)}();
//# sourceMappingURL=dc.graph.min.js.map