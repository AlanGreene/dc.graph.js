# dc.graph.js API
  * [Diagram](#diagram)
  * [Legend](#legend)

## Diagram

The dc_graph.diagram is a dc.js-compatible network visualization component. It registers in
the dc.js chart registry and its nodes and edges are generated from crossfilter groups. It
logically derives from
[the dc.js Base Mixin](https://github.com/dc-js/dc.js/blob/master/web/docs/api-latest.md#base-mixin),
but it does not physically derive from it since so much is different about network visualization
versus conventional diagraming.

#### .width([value])
Set or get the width attribute of the diagram. See `.height` below. Default: 200

#### .height([value])
Set or get the height attribute of the diagram. The width and height are applied to the SVG
element generated by the diagram when rendered. If a value is given, then the diagram is returned
for method chaining. If no value is given, then the current value of the height attribute will
be returned. Default: 200

#### .root([rootElement])
Get or set the root element, which is usually the parent div. Normally the root is set when the
diagram is constructed; setting it later may have unexpected consequences.

#### .mouseZoomable([boolean])
Get or set whether mouse wheel rotation or touchpad gestures will zoom the diagram, and whether dragging
on the background pans the diagram.

#### .nodeDimension([value])
Set or get the crossfilter dimension which represents the nodes (vertices) in the diagram. Typically there will
be a crossfilter instance for the nodes, and another for the edges.

*The node dimension currently does nothing, but once selection is supported, it will be used for
filtering other charts on the same crossfilter instance based on the nodes selected.*

#### .nodeGroup([value]) - **mandatory**
Set or get the crossfilter group which is the data source for the nodes in the diagram. The diagram will
use the group's `.all()` method to get an array of `{key, value}` pairs, where the key is a unique
identifier, and the value is usually an object containing the node's attributes. All accessors work
with these key/value pairs.

If the group is changed or returns different values, the next call to `.redraw()` will reflect the changes
incrementally.

It is possible to pass another object with the same `.all()` interface instead of a crossfilter group.

#### .edgeDimension([value])
Set or get the crossfilter dimension which represents the edges in the diagram. Typically there will
be a crossfilter instance for the nodes, and another for the edges.

*The edge dimension currently does nothing, but once selection is supported, it will be used for filtering
other charts on the same crossfilter instance based on the edges selected.*

#### .edgeGroup([value]) - **mandatory**
Set or get the crossfilter group which is the data source for the edges in the diagram. See `.nodeGroup`
above for the way data is loaded from a crossfilter group.

The values in the key/value pairs returned by `diagram.edgeGroup().all()` need to support, at a minimum,
the `sourceAccessor` and `targetAccessor`, which should return the same keys as the `nodeKeyAccessor`

#### .nodeKeyAccessor([function])
Set or get the function which will be used to retrieve the unique key for each node. By default, this
accesses the `key` field of the object passed to it. The keys should match the keys returned by the
`.sourceAccessor` and `.targetAccessor` of the edges.

#### .edgeKeyAccessor([function])
Set or get the function which will be used to retrieve the unique key for each edge. By default, this
accesses the `key` field of the object passed to it.

#### .sourceAccessor([function]) - **mandatory**
Set or get the function which will be used to retrieve the source (origin/tail) key of the edge objects.
The key must equal the key returned by the `.nodeKeyAccessor` for one of the nodes; if it does not, or
if the node is currently filtered out, the edge will not be displayed.

#### .targetAccessor([function]) - **mandatory**
Set or get the function which will be used to retrieve the target (destination/head) key of the edge objects.
The key must equal the key returned by the `.nodeKeyAccessor` for one of the nodes; if it does not, or
if the node is currently filtered out, the edge will not be displayed.

#### .nodeRadiusAccessor([function])
Set or get the function which will be used to retrieve the radius, in pixels, for each node. Nodes are
currently all displayed as circles. Default: 25

#### .nodeStrokeWidthAccessor([function])
Set or get the function which will be used to retrieve the stroke width, in pixels, for drawing the outline of each
node. According to the SVG specification, the outline will be drawn half on top of the fill, and half
outside. Default: 1

#### .nodeStrokeAccessor([function])
Set or get the function which will be used to retrieve the stroke color for the outline of each
node. Default: black

#### .nodeFillScale([d3.scale])
If set, the value returned from `nodeFillAccessor` will be processed through this d3.scale
to return the fill color. Default: identity function (no scale)

#### .nodeFillAccessor([function])
Set or get the function which will be used to retrieve the fill color for the body of each
node. Default: white

#### .nodePadding([number])
Set or get the padding or minimum distance, in pixels, between nodes in the diagram. Default: 6

#### .nodeLabelAccessor([function])
Set or get the function which will be used to retrieve the label text to display in each node. By
default, looks for a field `label` or `name` inside the `value` field.

#### .nodeTitleAccessor([function])
Set or get the function which will be used to retrieve the node title, usually rendered as a tooltip.
By default, uses the key of the node.

#### .edgeStrokeAccessor([function])
Set or get the function which will be used to retrieve the stroke color for the edges. Default: black

#### .edgeStrokeWidthAccessor([function])
Set or get the function which will be used to retrieve the stroke width for the edges. Default: 1

#### .edgeOpacityAccessor([function])
Set or get the function which will be used to retrieve the edge opacity, a number from 0 to 1. Default: 1

#### .edgeLabelAccessor([function])
Set or get the function which will be used to retrieve the edge label text. The label is displayed when
an edge is hovered over. By default, uses the `edgeKeyAccessor`.

#### .edgeArrowheadAccessor([function])
Set or get the function which will be used to retrieve the name of the arrowhead to use for the target/
head/destination of the edge. Arrow symbols can be specified with `.defineArrow()`. Return null to
display no arrowhead. Default: 'vee'

#### .edgeArrowtailAccessor([function])
Set or get the function which will be used to retrieve the name of the arrow tail to use for the source/
tail/source of the edge. Arrow symbols can be specified with `.defineArrow()`. Return null to
display no arrowhead. Default: null

#### .edgeIsLayoutAccessor([function])
To draw an edge but not have it affect the layout, specify a function which returns false for that edge.
By default, will return false if the `notLayout` field of the edge is truthy, true otherwise.

#### .lengthStrategy([string])
Currently, three strategies are supported for specifying the lengths of edges:
* 'individual' - uses the `edgeDistanceAccessor` for each edge. If it returns falsy, uses the `baseLength`
* 'symmetric', 'jaccard' - compute the edge length based on the graph structure around the edge. See [the
cola.js wiki](https://github.com/tgdwyer/WebCola/wiki/link-lengths) for more details.
* 'none' - no edge lengths will be specified

#### .edgeDistanceAccessor([function])
When the `.lengthStrategy` is 'individual', this accessor will be used to read the length of each edge.
By default, reads the `distance` field of the edge. If the distance is falsy, uses the `baseLength`.

#### .baseLength([number])
Gets or sets the default edge length (in pixels) when the `.lengthStrategy` is 'individual', and the base
value to be multiplied for 'symmetric' and 'jaccard' edge lengths.

#### .constrain([function])
This function will be called with the current nodes and edges on each redraw in order to derive new
layout constraints. By default, no constraints will be added beyond those for edge lengths, but this
can be used to generate alignment (rank) or axis constraints. See
[the cola.js wiki](https://github.com/tgdwyer/WebCola/wiki/Constraints) for more details. The constraints
are built from scratch on each redraw.

#### .parallelEdgeOffset([number])
If there are multiple edges between the same two nodes, start them this many pixels away from the original
so they don't overlap.
Default: true

#### .initLayoutOnRedraw([boolean])
Currently there are some bugs when the same instance of cola.js is used multiple times. (In particular,
overlaps between nodes may not be eliminated [if cola is not reinitialized]
(https://github.com/tgdwyer/WebCola/issues/118)). This flag can be set true to construct a new cola
layout object on each redraw. However, layout seems to be more stable if this is set false, so hopefully
this will be fixed soon.

#### .induceNodes([boolean])
By default, all nodes are included, and edges are only included if both end-nodes are visible.
If `.induceNodes` is set, then only nodes which have at least one edge will be shown.

#### .modLayout([function])
If it is desired to modify the cola layout object after it is created, this function can be called to add
a modifier function which takes the layout object.

#### .showLayoutSteps([boolean])
If this flag is true, the positions of nodes and will be updated while layout is iterating. If false,
the positions will only be updated once layout has stabilized. Default: true

#### .redraw()
Computes a new layout based on the nodes and edges in the edge groups, and displays the diagram.
To the extent possible, the diagram will minimize changes in positions from the previous layout.
`.render()` must be called the first time, and `.redraw()` can be called after that.

`.redraw()` will be triggered by changes to the filters in any other charts in the same dc.js
chart group.

#### .render()
Erases any existing SVG elements and draws the diagram from scratch. `.render()` must be called
the first time, and `.redraw()` can be called after that.

#### .on()
Attaches an event handler to the diagram. Currently the only diagram event is `end`, signalling
that diagram layout has completed.

#### .getStats()
Returns an object with current statistics on graph layout.
* `nnodes` - number of nodes displayed
* `nedges` - number of edges displayed

#### .select(selector)
Execute a d3 single selection in the diagram's scope using the given selector and return the d3
selection. Roughly the same as

```js
d3.select('#diagram-id').select(selector)
```

Since this function returns a d3 selection, it is not chainable. (However, d3 selection calls can
be chained after it.)

#### .selectAll(selector)
Selects all elements that match the d3 single selector in the diagram's scope, and return the d3
selection. Roughly the same as

```js
d3.select('#diagram-id').selectAll(selector)
```

Since this function returns a d3 selection, it is not chainable. (However, d3 selection calls can
be chained after it.)

#### .svg([svgElement])
Returns the top svg element for this specific chart. You can also pass in a new svg element, but
setting the svg element on a diagram may have unexpected consequences.

#### .resetSvg()
Remove the diagram's SVG elements from the dom and recreate the container SVG element.

#### .defineArrow(name, width, height, refX, refY, drawf)
Creates an svg marker definition for drawing edge arrow tails or heads.
 * **name** - the `id` to give the marker. When this identifier is returned by `.edgeArrowheadAccessor`
 or `.edgeArrowtailAccessor`, that edge will be drawn with the specified marker for its source or target.
 * **width** - the width, in pixels, to draw the marker
 * **height** - the height, in pixels, to draw the marker
 * **refX**, **refY** - the reference position, in marker coordinates, which will be aligned to the
 endpoint of the edge
 * **drawf** - a function to draw the marker using d3 SVG primitives, which takes the marker object as
 its parameter. The `viewBox` of the marker is `0 -5 10 10`, so the arrow should be drawn from (0, -5)
 to (10, 5) and it will be moved and sized based on the other parameter, and rotated based on the
 orientation of the edge.

 For example, the built-in `vee` arrow is defined so:
 ```js
 _chart.defineArrow('vee', 12, 12, 10, 0, function(marker) {
     marker.append('svg:path')
         .attr('d', 'M0,-5 L10,0 L0,5 L3,0')
         .attr('stroke-width', '0px');
 });
 (If further customization is required, it is possible to append other `svg:defs` to `chart.svg()`
 and use refer to them by `id`.)
 ```

## Legend

The dc_graph.legend will show labeled examples of nodes (and someday edges), within the frame of a dc_graph.diagram.

#### .x([value])
Set or get x coordinate for legend widget. Default: 0.

#### .y([value])
Set or get y coordinate for legend widget. Default: 0.

#### .gap([value])
Set or get gap between legend items. Default: 5.

#### .nodeWidth([value])
Set or get legend node width. Default: 30.

#### .nodeHeight([value])
Set or get legend node height. Default: 30.

#### .exemplars([object])
Specifies an object where the keys are the names of items to add to the legend, and the values are
objects which will be passed to the accessors of the attached diagram in order to determine the
drawing attributes.