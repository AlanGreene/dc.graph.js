/*!
 *  dc.graph 0.1.0
 *  http://dc-js.github.io/dc.graph.js/
 *  Copyright 2015 Gordon Woodhull
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

!function(){function b(b,c,d){"use strict";function e(a,b){return function(){return a(b.apply(null,arguments))}}function f(a,b,c,d){var e=Math.tan(Math.atan2(d,c));e*=e;var f={x:a*b/Math.sqrt(b*b+a*a*e),y:a*b/Math.sqrt(a*a+b*b/e)};return 0>c&&(f.x=-f.x),0>d&&(f.y=-f.y),f}function g(a,b){for(var c=["M",a[0],",",a[1]],d=b,e=!1,f=2;f<a.length;f+=2)(isNaN(a[f])||isNaN(a[f+1]))&&(e=!0),c.push(d===b?k[b]:" ",a[f],",",a[f+1]),0===--d&&(d=b);return d!=b&&console.log("warning: pts.length didn't match bezness",a,b),c.join("")}var h={version:"0.1.0"},i=function(a){var b=a,c=null,d=function(a){return arguments.length?(b=a,c&&c(a),this):b};return d.react=function(a){return arguments.length?(c=a,this):c},d},j=function(a){return a};h.functor_wrap=function(a,b){return"function"==typeof a?b?function(c){return a(b(c))}:a:function(){return a}};var k={1:"L",2:"Q",3:"C"};return h.diagram=function(k,l){function m(a){return h.functor_wrap(a,function(a){return a.orig})}function n(){switch(B=cola.d3adaptor().avoidOverlaps(!0).size([w.width(),w.height()]),w.lengthStrategy()){case"symmetric":B.symmetricDiffLinkLengths(w.baseLength());break;case"jaccard":B.symmetricDiffLinkLengths(w.baseLength());break;case"individual":B.linkDistance(function(a){var b=a.orig?m(w.edgeDistanceAccessor())(a):a.internal&&a.internal.distance;return b||w.baseLength()});break;case"none":}w.modLayout()&&w.modLayout()(B)}function o(a){return"edge-"+m(w.edgeKeyAccessor())(a).replace(/[^\w-_]/g,"-")}function p(a){var b,c,d,e,h,i,j=a.target.x-a.source.x,k=a.target.y-a.source.y,l=a.source.dcg_ry+m(w.nodeStrokeWidthAccessor())(a.source)/2,n=a.target.dcg_ry+m(w.nodeStrokeWidthAccessor())(a.target)/2;if(a.parallel){var o=!!(a.parallel%2)==a.source.x<a.target.x?-1:1,p=Math.floor((a.parallel+1)/2)*o,q=Math.atan2(k,j),r=q+p*w.parallelEdgeOffset()/l,s=q-Math.PI-p*w.parallelEdgeOffset()/n,t=Math.cos(r),u=Math.sin(r),v=Math.cos(s),x=Math.sin(s),y=Math.hypot(a.target.x-a.source.x,a.target.y-a.source.y);h=f(a.source.dcg_rx,a.source.dcg_ry,t,u),i=f(a.target.dcg_rx,a.target.dcg_ry,v,x);var z=Math.hypot(h.x,h.y),A=Math.hypot(i.x,i.y),B=Math.max(z+l/4,Math.min(2*z,y/2)),C=Math.min(A+n/4,Math.min(2*A,y/2));b=a.source.x+h.x,c=a.source.y+h.y;var D=a.source.x+B*t,E=a.source.y+B*u,F=a.target.x+C*v,G=a.target.y+C*x;return d=a.target.x+i.x,e=a.target.y+i.y,a.length=Math.hypot(d-b,e-c),g([b,c,D,E,F,G,d,e],3)}return h=f(a.source.dcg_rx,a.source.dcg_ry,j,k),i=f(a.target.dcg_rx,a.target.dcg_ry,-j,-k),b=a.source.x+h.x,c=a.source.y+h.y,d=a.target.x+i.x,e=a.target.y+i.y,a.length=Math.hypot(d-b,e-c),g([b,c,d,e],1)}function q(a,b,c,d){a.attr("visibility","visible").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),b.attr("d",p),c.attr("d",p),d.attr("transform",function(a){if(a.target.x<a.source.x){var b=this.getBBox(),c=b.x+b.width/2,d=b.y+b.height/2;return"rotate(180 "+c+" "+d+")"}return"rotate(0)"}).attr("dy",function(a){return a.target.x<a.source.x?11:-2})}function r(){y.attr("transform","translate("+b.event.translate+") scale("+b.event.scale+")")}function s(){x&&x.attr("width",w.width()).attr("height",w.height())}function t(){return x=w.root().append("svg"),s(),w.defineArrow("vee",12,12,10,0,function(a){a.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),w.defineArrow("dot",7,7,0,0,function(a){a.append("svg:circle").attr("r",5).attr("cx",5).attr("cy",0).attr("stroke-width","0px")}),w.mouseZoomable()&&x.call(b.behavior.zoom().on("zoom",r)),x}var u,v,w={},x=null,y=null,z=null,A=null,B=null,C=b.dispatch("end"),D={};w.width=i(200).react(s),w.height=i(200).react(s),w.root=i(null).react(function(a){a.empty()&&console.log("Warning: parent selector "+k+" doesn't seem to exist")}),w.mouseZoomable=i(!0),w.nodeDimension=i(),w.nodeGroup=i(),w.edgeDimension=i(),w.edgeGroup=i(),w.nodeKeyAccessor=i(function(a){return a.key}),w.edgeKeyAccessor=i(function(a){return a.key}),w.sourceAccessor=i(),w.targetAccessor=i(),w.nodeRadiusAccessor=i(function(){return 25}),w.nodeStrokeWidthAccessor=i(function(){return"1"}),w.nodeStrokeAccessor=i(function(){return"black"}),w.nodeFillScale=i(j),w.nodeFillAccessor=i(function(){return"white"}),w.nodePadding=i(6),w.nodeLabelAccessor=i(function(a){return a.value.label||a.value.name}),w.nodeFitLabelAccessor=i(!0),w.nodeTitleAccessor=i(function(a){return w.nodeKeyAccessor()(a)}),w.nodeOrdering=i(null),w.edgeStrokeAccessor=i(function(){return"black"}),w.edgeStrokeWidthAccessor=i(function(){return"1"}),w.edgeOpacityAccessor=i(function(){return"1"}),w.edgeLabelAccessor=i(function(a){return w.edgeKeyAccessor()(a)}),w.edgeArrowheadAccessor=i(function(){return"vee"}),w.edgeArrowtailAccessor=i(function(){return null}),w.edgeIsLayoutAccessor=i(function(a){return!a.value.notLayout}),w.lengthStrategy=i("symmetric"),w.edgeDistanceAccessor=i(function(a){return a.value.distance}),w.baseLength=i(30),w.transitionDuration=i(500),w.timeLimit=i(0),w.constrain=i(function(){return[]}),w.parallelEdgeOffset=i(5),w.edgeOrdering=i(null),w.initLayoutOnRedraw=i(!1),w.layoutUnchanged=i(!1),w.relayout=function(){return u=v=null,this},w.induceNodes=i(!1),w.modLayout=i(function(){}),w.showLayoutSteps=i(!0),w.legend=i(null).react(function(a){a.parent(w)});var E={},F={};return w._buildNode=function(a,b){b.append("title"),b.append("ellipse"),b.append("text").attr("class","node-label"),a.select("title").text(m(w.nodeTitleAccessor())),a.select("text.node-label").text(m(w.nodeLabelAccessor())).each(function(a){var b,c=m(w.nodeRadiusAccessor())(a),d=2*c+w.nodePadding();m(w.nodeFitLabelAccessor())(a)&&(b=this.getBBox());var e=0;if(b&&b.width&&b.height){var f=b.height/2/c,g=b.width/2/Math.sqrt(1-f*f);e=2*g+w.nodePadding(),a.dcg_rx=Math.max(g,c),a.dcg_ry=c}else a.dcg_rx=a.dcg_ry=c;a.width=Math.max(e,d),a.height=d}),a.select("ellipse").attr("rx",function(a){return a.dcg_rx}).attr("ry",function(a){return a.dcg_ry}).attr("stroke",m(w.nodeStrokeAccessor())).attr("stroke-width",m(w.nodeStrokeWidthAccessor())).attr("fill",e(w.nodeFillScale(),m(w.nodeFillAccessor())))},w.redraw=function(){function d(a,b){var c=w.nodeKeyAccessor()(a);E[c]||(E[c]={});var d=E[c];return d.orig=a,d.id=b,k[c]=!0,d}function e(a){var b=w.edgeKeyAccessor()(a);F[b]||(F[b]={});var c=F[b];return c.orig=a,c.source=E[w.sourceAccessor()(a)],c.target=E[w.targetAccessor()(a)],l[b]=!0,c}function f(a){return a.orig}var g=w.nodeGroup().all(),i=w.edgeGroup().all();if(B&&B.stop(),w.initLayoutOnRedraw()&&n(),w.induceNodes()){var j={};a,i.forEach(function(a){j[w.sourceAccessor()(a)]=!0,j[w.targetAccessor()(a)]=!0}),g=g.filter(function(a){return j[w.nodeKeyAccessor()(a)]})}w.nodeOrdering()&&(g=c.quicksort.by(w.nodeOrdering())(g.slice(0),0,g.length)),w.edgeOrdering()&&(i=c.quicksort.by(w.edgeOrdering())(i.slice(0),0,i.length));var k={},l={},p=g.map(d);for(var r in E)k[r]||delete E[r];for(var s in F)l[s]||delete F[s];var t=i.map(e).filter(function(a){return void 0!==a.source&&void 0!==a.target});D={nnodes:p.length,nedges:t.length};var x=!1;if(!w.layoutUnchanged()){var y=JSON.stringify(p.map(f)),G=JSON.stringify(t.map(f));y===u&&G===v&&(x=!0),u=y,v=G}if(w.parallelEdgeOffset()){for(var H=new Array(p.length),I=0;I<H.length;++I){H[I]=new Array(H.length);for(var J=0;J<H.length;++J)H[I][J]=0}t.forEach(function(a){var b=Math.min(a.source.id,a.target.id),c=Math.max(a.source.id,a.target.id);a.parallel=H[b][c]++})}{var K=A.selectAll(".edge").data(t,m(w.edgeKeyAccessor()));K.enter().append("svg:path").attr("class","edge").attr("id",o)}K.attr("stroke",m(w.edgeStrokeAccessor())).attr("stroke-width",m(w.edgeStrokeWidthAccessor())).attr("opacity",m(w.edgeOpacityAccessor())).attr("marker-end",function(a){var b=m(w.edgeArrowheadAccessor())(a);return b?"url(#"+b+")":null}).attr("marker-start",function(a){var b=m(w.edgeArrowtailAccessor())(a);return b?"url(#"+b+")":null});var L=K.exit();L.remove();var M=A.selectAll(".edge-hover").data(t,m(w.edgeKeyAccessor()));M.enter().append("svg:path").attr("class","edge-hover").attr("opacity",0).attr("stroke","green").attr("stroke-width",10).on("mouseover",function(a){b.select("#"+o(a)+"-label").attr("visibility","visible")}).on("mouseout",function(a){b.select("#"+o(a)+"-label").attr("visibility","hidden")}),M.exit().remove();{var N=A.selectAll(".edge-label").data(t,m(w.edgeKeyAccessor()));N.enter().append("text").attr("id",function(a){return o(a)+"-label"}).attr("visibility","hidden").attr({"class":"edge-label","text-anchor":"middle",dy:-2}).append("textPath").attr("startOffset","50%").attr("xlink:href",function(a){return"#"+o(a)}).text(function(a){return m(w.edgeLabelAccessor())(a)})}N.exit().remove();var O=z.selectAll(".node").data(p,m(w.nodeKeyAccessor())),P=O.enter().append("g").attr("class","node").attr("visibility","hidden").call(B.drag);w._buildNode(O,P);var Q=O.exit(),R=w.constrain()(p,t);Q.remove(),B.on("tick",function(){var a=Date.now()-V;w.showLayoutSteps()&&q(O,K,M,N),w.timeLimit()&&a>w.timeLimit()&&(console.log("cancelled"),B.stop(),C.end())});var S=t.filter(m(w.edgeIsLayoutAccessor())),T=(t.filter(function(a){return!m(w.edgeIsLayoutAccessor())(a)}),R.filter(function(a){return"circle"===a.type})),U=R.filter(function(a){return"circle"!==a.type});if(T.forEach(function(a){var b=(a.distance||4*w.baseLength())/(2*Math.sin(Math.PI/a.nodes.length)),c=a.nodes.map(function(a){return a.node}),d=function(a){return m(w.nodeKeyAccessor())(p[a])},e=h.wheel_edges(d,c,b).map(function(a){var b={internal:a};return b.source=E[a.sourcename],b.target=E[a.targetname],b});S=S.concat(e)}),x)return C.end(),this;var V=Date.now();return B.nodes(p).links(S).constraints(U).start(10,20,20).on("end",function(){w.showLayoutSteps()||q(O,K,M,N),C.end()}),this},w.render=function(){return w.initLayoutOnRedraw()||n(),w.resetSvg(),y=x.append("g").attr("class","dc-graph"),A=y.append("g"),z=y.append("g"),w.legend()&&w.legend().render(),w.redraw()},w.on=function(a,b){return C.on(a,b),this},w.getStats=function(){return D},w.select=function(a){return w.root().select(a)},w.selectAll=function(a){return w.root()?w.root().selectAll(a):null},w.svg=function(a){return arguments.length?(x=a,w):x},w.resetSvg=function(){return w.select("svg").remove(),t()},w.defineArrow=function(a,b,c,d,e,f){x.append("svg:defs").append("svg:marker").attr("id",a).attr("viewBox","0 -5 10 10").attr("refX",d).attr("refY",e).attr("markerUnits","userSpaceOnUse").attr("markerWidth",b).attr("markerHeight",c).attr("orient","auto").call(f)},w.root(b.select(k)),d.registerChart(w,l),w},h.legend=function(){var a={},b=null;return a.x=i(0),a.y=i(0),a.gap=i(5),a.nodeWidth=i(40),a.nodeHeight=i(40),a.exemplars=i({}),a.parent=i(null),a.render=function(){var c=a.parent().svg().selectAll("g.dc-graph-legend").data([0]).enter();b=c.append("g").attr("class","dc-graph-legend").attr("transform","translate("+a.x()+","+a.y()+")");var d=[],e=a.exemplars();for(var f in e)d.push({orig:{key:f,value:e[f]}});var g=b.selectAll(".node").data(d,function(a){return a.orig.key}),h=g.enter().append("g").attr("class","node").attr("transform",function(b,c){return"translate("+a.nodeWidth()/2+","+(a.nodeHeight()+a.gap())*(c+.5)+")"});h.append("text").attr("class","legend-label").attr("transform","translate("+(a.nodeWidth()/2+a.gap())+",0)").text(function(a){return a.orig.key}),a.parent()._buildNode(g,h)},a},h.load_graph=function(a,c){/\.json$/.test(a)?b.json(a,c):/\.gv|\.dot$/.test(a)&&b.text(a,function(a,b){if(a)return void c(a,null);var d=graphlibDot.parse(b),e=d.nodes(),f=new Array(e.length);e.forEach(function(a,b){var c=f[b]=d._nodes[e[b]];c.id=b,c.name=a});var g=d.edges(),h=[];g.forEach(function(a){var b=d._edges[a];h.push({source:d._nodes[b.u].id,target:d._nodes[b.v].id,sourcename:b.u,targetname:b.v})});var i={nodes:f,links:h};c(null,i)})},h.node_name=function(a){if(26>a)return String.fromCharCode(97+a);if(52>a)return String.fromCharCode(65+a-26);if(2704>a)return h.node_name(Math.floor(a/52))+h.node_name(a%52);throw new Error("no, that's too large")},h.node_object=function(a,b){return b=b||{},_.extend({id:a,name:h.node_name(a)},b)},h.edge_object=function(a,b,c,d){return d=d||{},_.extend({source:b,target:c,sourcename:a(b),targetname:a(c)},d)},h.generate=function(a,b,c,d){var e,f,g,i,j=c.nodePrefix||"",k=function(a){return e[a].name},l=b[0],m=c.linkLength||30;switch(a){case"clique":case"cliquestf":for(e=new Array(l),f=[],g=0;l>g;++g)for(e[g]=h.node_object(g,{circle:"A",name:j+h.node_name(g)}),i=0;g>i;++i)f.push(h.edge_object(k,g,i,{notLayout:!0,undirected:!0}));if("cliquestf"===a)for(g=0;l>g;++g)e[g+l]=h.node_object(g+l),e[g+2*l]=h.node_object(g+2*l),f.push(h.edge_object(k,g,g+l,{undirected:!0})),f.push(h.edge_object(k,g,g+2*l,{undirected:!0}));break;case"wheel":for(e=new Array(l),g=0;l>g;++g)e[g]=h.node_object(g,{name:j+h.node_name(g)});f=h.wheel_edges(k,_.range(l),l*m/2);var n=f[0].distance;for(g=0;g<b[1];++g)for(i=0;l>i;++i)f.push(h.edge_object(k,i,(i+1)%l,{distance:n,par:g+2}));break;default:throw new Error("unknown generation type "+a)}var o={nodes:e,links:f};d(null,o)},h.wheel_edges=function(a,b,c){for(var d=b.length,e=[],f=Math.floor(d/2),g=2*c*Math.sin(Math.PI/d),i=2*c*Math.sin(f*Math.PI/d),j=0;d>j;++j)e.push(h.edge_object(a,b[j],b[(j+1)%d],{distance:g}));for(j=0;d/2>j;++j)e.push(h.edge_object(a,b[j],b[(j+f)%d],{distance:i})),d%2&&j!=Math.floor(d/2)&&e.push(h.edge_object(a,b[j],b[(j+d-f)%d],{distance:i}));return e},h.d3=b,h.crossfilter=c,h.dc=d,h}if("function"==typeof define&&define.amd)define(["d3","crossfilter","dc"],b);else if("object"==typeof module&&module.exports){var c=require("d3"),d=require("crossfilter");"function"!=typeof d&&(d=d.crossfilter);var e=require("dc");module.exports=b(c,d,e)}else this.dc_graph=b(d3,crossfilter,dc)}();
//# sourceMappingURL=dc.graph.min.js.map