/*!
 *  dc.graph 0.6.0-beta.3
 *  http://dc-js.github.io/dc.graph.js/
 *  Copyright 2015-2016 AT&T Intellectual Property & the dc.graph.js Developers
 *  https://github.com/dc-js/dc.graph.js/blob/master/AUTHORS
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 */

!function(){function e(e,t,n){"use strict";var r={version:"0.6.0-beta.3",constants:{CHART_CLASS:"dc-graph"}};function o(e){return e.orig}function a(e){return e}var i=function(e,t){void 0===t?t=o:!1===t&&(t=a);var n=e,i=null,u=[],c=function(e){return arguments.length?(i&&i(e),n=e,this):n};return c.cascade=function(e,t){for(var n=0;n<u.length;++n){if(u[n].n===e)return t?u[n].f=t:delete u[n],c;if(u[n].n>e)return u.splice(n,0,{n:e,f:t}),c}return u.push({n:e,f:t}),c},c._eval=function(e,n){return 0!==n&&u.length?u[n-1].f(e,function(){return c._eval(e,n-1)}):r.functor_wrap(c(),t)(e)},c.eval=function(e){return c._eval(e,u.length)},c.react=function(e){return arguments.length?(i=e,this):i},c};function u(){var e={},t=function(t,n){return 1===arguments.length?e[t]:e[t]===n?this:(e[t]&&e[t].parent(null),e[t]=n,n&&n.parent(this),this)};return t.enum=function(){return Object.keys(e)},t.nameOf=function(t){var n=Object.entries(e).find(function(e){return e[1]==t});return n?n[0]:null},t}function c(e,t){var n=i(t),r=function(){return arguments.length?(console.warn(e),n.apply(i,arguments),this):n()};return["cascade","_eval","eval","react"].forEach(function(e){r[e]=n[e]}),r}function l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function s(e){try{return e.getBBox()}catch(e){return{x:0,y:0,width:0,height:0}}}function d(e,t){return function(n,r){return e(n)?t(n):r()}}function f(t,n){return function(r,o){return e.interpolate(o(r),n(r))(t(r))}}function g(e,t,n){var r={};for(var o in t)r[o]=n(e,y(t[o]));return r}function h(e,t){return g(e,t,d)}function p(e,t,n){var r={},o={},a=[];for(var i in n)/^node/.test(i)?r[i]=n[i]:/^edge/.test(i)?o[i]=n[i]:a.push(i);a.length&&console.error('only know how to deal with properties that start with "node" or "edge"',a);var u=e?h(e,r):{};return t&&Object.assign(u,h(t,o)),u}function v(e){return function(t,n,r){for(var o in r){if(!e[o])throw new Error("unknown attribute "+o);e[o].cascade(t,n?r[o]:null)}return e}}function y(e){return r.functor_wrap(e,o)}"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a])}return n},writable:!0,configurable:!0}),r.functor_wrap=function(e,t){return"function"==typeof e?t?function(n){return e(t(n))}:e:function(){return e}};var m={1:"L",2:"Q",3:"C"};function x(e,t,n){for(var r=["M",e[0].x,",",e[0].y],o=t,a=1;a<e.length;++a)(isNaN(e[a].x)||isNaN(e[a].y))&&!0,r.push(o===t?m[t]:" ",e[a].x,",",e[a].y),0==--o&&(o=t);return o!=t&&console.log("warning: pts.length didn't match bezian degree",e,t),n&&r.push("Z"),r.join("")}Math.hypot=Math.hypot||function(){for(var e=0,t=arguments.length,n=0;n<t;n++){if(arguments[n]===1/0||arguments[n]===-1/0)return 1/0;e+=arguments[n]*arguments[n]}return Math.sqrt(e)},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],o=0;o<n;){var a=t[o];if(e.call(r,a,o,t))return a;o++}}});var b,w=function(){if(void 0===b){b=null;var e="dc.graph.js",t=document.getElementsByTagName("script");if(t&&t.length>0)for(var n in t)if(t[n].src&&t[n].src.match(new RegExp(e+"$"))){b=t[n].src.replace(new RegExp("(.*)"+e+"$"),"$1");break}}return b};function k(e){return Promise.resolve(e)}r.event_coords=function(t){var n=t.root().node().getBoundingClientRect();return t.invertCoord([e.event.clientX-n.left,e.event.clientY-n.top])};var E=-1!==navigator.platform.toUpperCase().indexOf("MAC");function K(t,n){return!!e.select(t).classed(n)||t.parentElement&&K(t.parentElement,n)}function S(e,t,n,r,o,a,i){a||(a=function(e,t){}),i||(i=function(e){});var u={};var c=t.map(function(t){var n=r(t);e[n]||a(n,e[n]={},t);var i=e[n];return o(i,t),u[n]=!0,i});for(var l in n&&n.forEach(function(t){e[t]||(a(t,e[t]={},null),o(e[t],null)),u[t]||(c.push(e[t]),u[t]=!0)}),e)u[l]||(i(l,e[l]),delete e[l]);return c}r.depth_first_traversal=function(e){return function(t,n){e.init&&e.init(),e.tree&&(n=n.filter(function(t){return e.tree(t)}));var r,o={},a=n.reduce(function(t,n){var r=e.sourceid(n),a=e.targetid(n);return t[r]||(t[r]=[]),t[r].push(n),o[a]=(o[a]||0)+1,t},{}),i=t.reduce(function(t,n){return t[e.nodeid(n)]=n,t},{}),u=[],c={};e.root?r=t.filter(function(t){return e.root(t)}):(r=t.filter(function(t){return!o[e.nodeid(t)]}),t.length&&!r.length&&(r=[t[0]])),r.forEach(function(t,n){n&&e.sib&&e.sib(!0,r[n-1],t),e.push&&e.push(),function t(n,r){var l=e.nodeid(n);c[l]?e.skip&&e.skip(n,o[l]):(u[r]||(u[r]=[]),e.place&&e.place(n,r,u[r]),u[r].push(n),c[l]=!0,a[l]&&a[l].forEach(function(n,o){var u=i[e.targetid(n)];o&&e.sib&&e.sib(!1,i[e.targetid(a[l][o-1])],u),e.push&&e.push(),t(u,r+1)}),e.pop&&e.pop(n))}(t,e.row&&e.row(t)||0)}),e.finish(u)}},r.undirected_dfs=function(e){return function(t,n){var r=n.reduce(function(t,n){var r=e.sourceid(n),o=e.targetid(n);return t[r]||(t[r]=[]),t[o]||(t[o]=[]),t[r].push(o),t[o].push(r),t},{}),o=t.reduce(function(t,n){return t[e.nodeid(n)]=n,t},{}),a={};var i=0;t.forEach(function(t){a[e.nodeid(t)]||(e.comp&&e.comp(i),function t(n){var u=e.nodeid(n);e.node(i,n),a[u]=!0,r[u]&&r[u].forEach(function(e){a[e]||t(o[e])})}(t),++i)})}};var P=1e-7;function A(e,t,n){return e-P<=t&&t<=n+P}function N(e,t,n,r,o,a,i,u){var c=((e*r-t*n)*(o-i)-(e-n)*(o*u-a*i))/((e-n)*(a-u)-(t-r)*(o-i)),l=((e*r-t*n)*(a-u)-(t-r)*(o*u-a*i))/((e-n)*(a-u)-(t-r)*(o-i));if(isNaN(c)||isNaN(l))return!1;if(e>=n){if(!A(n,c,e))return!1}else if(!A(e,c,n))return!1;if(t>=r){if(!A(r,l,t))return!1}else if(!A(t,l,r))return!1;if(o>=i){if(!A(i,c,o))return!1}else if(!A(o,c,i))return!1;if(a>=u){if(!A(u,l,a))return!1}else if(!A(a,l,u))return!1;return{x:c,y:l}}function L(e,t,n,r,o){for(var a=0;a<e.length;++a){var i=a===e.length-1?0:a+1,u=N(e[a].x,e[a].y,e[i].x,e[i].y,t,n,r,o);if(u)return u}return null}r.shape_presets={egg:{generator:"polygon",preset:function(){return{sides:100,distortion:-.25}}},triangle:{generator:"polygon",preset:function(){return{sides:3}}},rectangle:{generator:"polygon",preset:function(){return{sides:4}}},diamond:{generator:"polygon",preset:function(){return{sides:4,rotation:45}}},trapezium:{generator:"polygon",preset:function(){return{sides:4,distortion:-.5}}},parallelogram:{generator:"polygon",preset:function(){return{sides:4,skew:.5}}},pentagon:{generator:"polygon",preset:function(){return{sides:5}}},hexagon:{generator:"polygon",preset:function(){return{sides:6}}},septagon:{generator:"polygon",preset:function(){return{sides:7}}},octagon:{generator:"polygon",preset:function(){return{sides:8}}},invtriangle:{generator:"polygon",preset:function(){return{sides:3,rotation:180}}},invtrapezium:{generator:"polygon",preset:function(){return{sides:4,distortion:.5}}},square:{generator:"polygon",preset:function(){return{sides:4,regular:!0}}},plain:{generator:"rounded-rect",preset:function(){return{noshape:!0}}}},r.available_shapes=function(){var e=Object.keys(r.shape_presets);return e.slice(0,e.length-1)};var T={shape:"ellipse"};function D(e){return function(t){var n=e.nodeShape.eval(t)||T;t.dcg_shape=function(e,t){"string"==typeof t&&(t={shape:t});var n=t.shape,o=Object.assign({},t);if(delete o.shape,"random"===n){var a=r.available_shapes();n=a[Math.floor(Math.random()*a.length)]}else if(-1!==e.shape.enum().indexOf(n))return e.shape(n).elaborate({shape:n},o);if(!r.shape_presets[n])return console.warn("unknown shape ",n),T;var i=r.shape_presets[n].preset(o);return i.shape=r.shape_presets[n].generator,e.shape(i.shape).elaborate(i,o)}(e,n),t.dcg_shape.abstract=n}}function M(e,t,n){var r=100;if(e(t).val>=0)throw new Error("f(a) must be less than 0");if(e(n).val<=0)throw new Error("f(b) must be greater than 0");for(;;){if(!--r)throw new Error("patience ran out");var o=(t+n)/2,a=e(o),i=a.val;if(Math.abs(i)<.5)return a;i>0?n=o:t=o}}function O(e,t,n,r,o,a,i,u,c,l,s){var d,f,g,h;if(i){var p,v,y=function(t,n,r){return function(o){var a,i,u=(a=t,i=o,e.shape(a.dcg_shape.shape).intersect_vec(a,1e3*Math.cos(i),1e3*Math.sin(i)));return u?{port:u,val:Math.hypot(u.x-n.x,u.y-n.y)-r,ang:o}:{port:{x:0,y:0},val:0,ang:o}}},m=Math.atan2(i.sourcePort.y,i.sourcePort.x),x=Math.atan2(i.targetPort.y,i.targetPort.x);try{p=M(y(t.source,i.sourcePort,c),m,m+2*u*c/l)}catch(e){p={ang:m,port:i.sourcePort}}try{v=M(y(t.target,i.targetPort,c),x,x-2*u*c/l)}catch(e){v={ang:x,port:i.targetPort}}d=p.port,f=v.port;var _=Math.hypot(d.x,d.y)+l/2,b=Math.hypot(f.x,f.y)+s/2,w=n+_*Math.cos(p.ang),k=r+_*Math.sin(p.ang),E=o+b*Math.cos(v.ang),K=a+b*Math.sin(v.ang);g=[{x:n+d.x,y:r+d.y},{x:w,y:k},{x:E,y:K},{x:o+f.x,y:a+f.y}],h=3}else(d=t.sourcePort.pos)||(d={x:0,y:0}),(f=t.targetPort.pos)||(f={x:0,y:0}),g=[{x:n+d.x,y:r+d.y},{x:o+f.x,y:a+f.y}],h=1;return{sourcePort:d,targetPort:f,points:g,bezDegree:h}}function j(e){return 1===e.bezDegree&&2===e.points.length||3===e.bezDegree&&4===e.points.length}function C(e){var t=e.points;if(3===e.bezDegree)return t;if(1===e.bezDegree)return[{x:t[0].x,y:t[0].y},{x:t[0].x+(t[1].x-t[0].x)/3,y:t[0].y+(t[1].y-t[0].y)/3},{x:t[0].x+2*(t[1].x-t[0].x)/3,y:t[0].y+2*(t[1].y-t[0].y)/3},{x:t[1].x,y:t[1].y}];throw new Error("unknown bezDegree "+e.bezDegree)}function I(e,t){for(var n=[],r=1;r<e.length;r++){var o=e[r-1],a=e[r];n.push({x:o.x+(a.x-o.x)*t,y:o.y+(a.y-o.y)*t})}return n}function z(e,t){var n=function(e,t){for(var n=[e],r=1;r<e.length;r++)n.push(I(n[n.length-1],t));return n}(e,t);return n[n.length-1][0]}function R(e,t){for(var n,r,o,a,i,u,c,l,s,d,f,g,h,p,v,y,m,x,_,b,w,k,E=[];t>1;){var K=(r=1/t,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,o=(n=e)[0].x,a=n[0].y,i=n[1].x,u=n[1].y,c=n[2].x,l=n[2].y,s=n[3].x,d=n[3].y,[[{x:o,y:a},{x:f=(i-o)*r+o,y:g=(u-a)*r+a},{x:m=((h=(c-i)*r+i)-f)*r+f,y:x=((p=(l-u)*r+u)-g)*r+g},{x:w=((_=((v=(s-c)*r+c)-h)*r+h)-m)*r+m,y:k=((b=((y=(d-l)*r+l)-p)*r+p)-x)*r+x}],[{x:w,y:k},{x:_,y:b},{x:v,y:y},{x:s,y:d}]]);E.push(K[0][0],K[0][1],K[0][2]),e=K[1],--t}return E.push.apply(E,e),E}r.no_shape=function(){return{parent:i(null),elaborate:function(e,t){return Object.assign(e,t)},useTextSize:function(){return!1},useRadius:function(){return!1},usePaddingAndStroke:function(){return!1},intersect_vec:function(e,t,n){return{x:0,y:0}},calc_radii:function(e,t,n){return{rx:0,ry:0}},create:function(e){},replace:function(e){},update:function(e){}}},r.ellipse_shape=function(){var e={parent:i(null),elaborate:function(e,t){return Object.assign(e,t)},intersect_vec:function(e,t,n){return function(e,t,n,r){var o=Math.tan(Math.atan2(r,n));o*=o;var a={x:e*t/Math.sqrt(t*t+e*e*o),y:e*t/Math.sqrt(e*e+t*t/o)};return n<0&&(a.x=-a.x),r<0&&(a.y=-a.y),a}(e.dcg_rx,e.dcg_ry,t,n)},calc_radii:function(e,t,n){t=Math.max(t,n.height/2+5);var r=n.width/2,o=n.height/2/t;return r/=Math.sqrt(1-o*o),{rx:r=Math.max(r,t),ry:t}},create:function(e){e.insert("ellipse",":first-child").attr("class","node-shape")},update:function(t){t.select("ellipse.node-shape").attr((e.parent(),{rx:function(e){return e.dcg_rx},ry:function(e){return e.dcg_ry}}))}};return e},r.polygon_shape=function(){var t={parent:i(null),elaborate:function(e,t){return Object.assign(e,t)},intersect_vec:function(e,t,n){return L(e.dcg_points,0,0,t,n)},calc_radii:function(e,t,n){t=Math.max(t,n.height/2+5);var r=n.width/2;return{rx:r=r*Math.sqrt(2)/Math.cos(Math.PI/(e.dcg_shape.sides||4)),ry:t}},create:function(e){e.insert("path",":first-child").attr("class","node-shape")},update:function(n){n.select("path.node-shape").attr((t.parent(),{d:function(t){var n=t.dcg_rx,r=t.dcg_ry,o=t.dcg_shape,a=o.sides||4,i=o.skew||0,u=o.distortion||0,c=o.rotation||0,l=a%2?0:.5,s=[];c=c/360+.25;for(var d=0;d<a;++d){var f=-((d+l)/a+c)*Math.PI*2;s.push({x:Math.cos(f),y:Math.sin(f)})}var g=e.extent(s,function(e){return e.y});return o.regular?n=r=Math.max(n,r):n<r&&!o.squeeze?n=r:r/=Math.min(-g[0],g[1]),t.dcg_points=s.map(function(e){var t=n*e.x,o=r*e.y;return t*=1+u*((r-o)/r-1),{x:t-=i*o/2,y:o}}),x(t.dcg_points,1,!0)}}))}};return t},r.rounded_rectangle_shape=function(){return{parent:i(null),elaborate:function(e,t){return e=Object.assign({rx:10,ry:10},e),Object.assign(e,t)},intersect_vec:function(e,t,n){return L([{x:e.dcg_rx,y:e.dcg_ry},{x:e.dcg_rx,y:-e.dcg_ry},{x:-e.dcg_rx,y:-e.dcg_ry},{x:-e.dcg_rx,y:e.dcg_ry}],0,0,t,n)},useRadius:function(e){return!e.noshape},calc_radii:function(e,t,n){var r=n.height/2;return e.dcg_shape.noshape||(r+=5),{rx:n.width/2,ry:Math.max(t,r)}},create:function(e){e.filter(function(e){return!e.dcg_shape.noshape}).insert("rect",":first-child").attr("class","node-shape")},update:function(e){e.select("rect.node-shape").attr({x:function(e){return-e.dcg_rx},y:function(e){return-e.dcg_ry},width:function(e){return 2*e.dcg_rx},height:function(e){return 2*e.dcg_ry},rx:function(e){return e.dcg_shape.rx+"px"},ry:function(e){return e.dcg_shape.ry+"px"}})}}},r.text_contents=function(){var e={parent:i(null),update:function(t){var n=t.selectAll("text.node-label").data(function(e){return[e]});n.enter().append("text").attr("class","node-label");var r=n.selectAll("tspan").data(function(t){var n=e.parent().nodeLabel.eval(t);if(!n)return[];"string"==typeof n&&(n=[n]);var r=n.length%2?.5-(n.length-1)/2:1-n.length/2;return n.map(function(e,n){return{node:t,line:e,yofs:(0==n?r:1)+"em"}})});r.enter().append("tspan"),r.attr({"text-anchor":"start",x:0}).text(function(e){return e.line}),n.each(function(e){e.xofs=0}).filter(function(t){return"center"!==e.parent().nodeLabelAlignment.eval(t)}).each(function(t){var n=s(this);switch(t.bbox={x:n.x,y:n.y,width:n.width,height:n.height},e.parent().nodeLabelAlignment.eval(t)){case"left":t.xofs=-t.bbox.width/2;break;case"right":t.xofs=t.bbox.width/2}}).selectAll("tspan"),r.attr({"text-anchor":function(t){switch(e.parent().nodeLabelAlignment.eval(t.node)){case"left":return"start";case"center":return"middle";case"right":return"end"}return null},x:function(e){return e.node.xofs},dy:function(e){return e.yofs}}),r.exit().remove(),n.attr("fill",e.parent().nodeLabelFill.eval)},textbox:function(e){var t=s(this.selectContent(e).node());return{x:t.x,y:t.y,width:t.width,height:t.height}},selectContent:function(e){return e.select("text.node-label")}};return e},r.with_icon_contents=function(t,n,r){var o={parent:i(null).react(function(e){t.parent(e)}),padding:function(e){var t=o.parent().nodeLabelPadding.eval(e);return{x:3*t.x,y:3*t.y}},update:function(a){var i=a.selectAll("g.with-icon").data(function(e){return[e]});i.enter().append("g").attr("class","with-icon").append("image").attr({class:"icon",width:n+"px",height:r+"px"}),i.call(t.update),t.selectContent(i).attr("transform","translate("+n/2+")"),i.selectAll("image.icon").attr({href:o.parent().nodeIcon.eval,x:function(r){return-(n+t.textbox(e.select(this.parentNode)).width)/2-o.parent().nodeLabelPadding.eval(r).x},y:-r/2})},textbox:function(e){var r=t.textbox(e);return r.x+=n/2,r},selectContent:function(e){return e.select("g.with-icon")}};return o},r.diagram=function(l,d){var f=n.marginMixin({});f.__dcFlag__=n.utils.uniqueId(),f.margins({left:10,top:10,right:10,bottom:10});var g,h,p,m,_,b,w,k,E,K=null,P=null,A=null,N=null,L=null,M=e.dispatch("preDraw","data","end","start","drawn","receivedLayout","transitionsStarted","zoomed"),I={},F={},B={},G={},H={},Y=!1,X=200,Z=function(e){var t=e&&e.getBoundingClientRect&&e.getBoundingClientRect().width;return t&&t>X?t:X},U=Z,$=200,J=function(e){var t=e&&e.getBoundingClientRect&&e.getBoundingClientRect().height;return t&&t>$?t:$},V=J;function Q(e){return function(t){f.layoutEngine()||f.layoutAlgorithm("cola",!0);var n=f.layoutEngine();if(n.getEngine&&(n=n.getEngine()),n[e]){if(console.warn("property is deprecated, call on layout engine instead: dc_graph.diagram.%c"+e,"font-weight: bold"),!arguments.length)return n[e]();n[e](t)}else if(console.warn("property is deprecated, and is not supported for Warning: dc_graph.diagram.<b>"+e+'</b> is deprecated, and it is not supported for the "'+n.layoutAlgorithm()+'" layout algorithm: ignored.'),!arguments.length)return null;return this}}function ee(e){f.layoutEngine()||f.layoutAlgorithm("cola",!0),(e||f.layoutEngine()).init({width:f.width(),height:f.height()})}function te(e){return!!e.source&&!!e.target}f.height=function(t){return arguments.length?(V=e.functor(t||J),E=void 0,f):(n.utils.isNumber(E)||(E=V(f.root().node())),E)},f.minHeight=function(e){return arguments.length?($=e,f):$},f.width=function(t){return arguments.length?(U=e.functor(t||Z),k=void 0,f):(n.utils.isNumber(k)||(k=U(f.root().node())),k)},f.minWidth=function(e){return arguments.length?(X=e,f):X},f.root=i(null).react(function(e){e.empty()&&console.log("Warning: parent selector "+l+" doesn't seem to exist")}),f.mouseZoomable=i(!0),f.zoomExtent=i([.1,2]),f.modKeyZoom=f.altKeyZoom=i(!1),f.fitStrategy=i("default"),f.restrictPan=i(!1),f.autoZoom=i(null),f.zoomToFit=function(e){if(N&&L){var t=f.selectAllNodes();f.selectAllEdges();me(t)}},f.zoomDuration=i(500),f.nodeDimension=i(),f.nodeGroup=i(),f.edgeDimension=i(),f.edgeGroup=i(),f.edgesInFront=i(!1),f.nodeKey=f.nodeKeyAccessor=i(function(e){return e.key}),f.edgeKey=f.edgeKeyAccessor=i(function(e){return e.key}),f.edgeSource=f.sourceAccessor=i(function(e){return e.value.sourcename}),f.edgeTarget=f.targetAccessor=i(function(e){return e.value.targetname}),f.portDimension=i(null),f.portGroup=i(null),f.portNodeKey=i(null),f.portEdgeKey=i(null),f.portName=i(null),f.portStyleName=i(null),f.portElastic=i(!0),f.portStyle=u(),f.portBounds=i(null),f.edgeSourcePortName=i(null),f.edgeTargetPortName=i(null),f.nodeRadius=f.nodeRadiusAccessor=i(25),f.nodeStrokeWidth=f.nodeStrokeWidthAccessor=i(1),f.nodeStroke=f.nodeStrokeAccessor=i("black"),f.nodeStrokeDashArray=i(null),f.nodeFillScale=i(null),f.nodeFill=f.nodeFillAccessor=i("white"),f.nodeOpacity=i(1),f.nodePadding=i(6),f.nodeLabelPadding=i({x:0,y:0}),f.nodeLabel=f.nodeLabelAccessor=i(function(e){return e.value.label||e.value.name}),f.nodeLabelAlignment=i("center"),f.nodeLabelFill=f.nodeLabelFillAccessor=i(null),f.nodeFitLabel=f.nodeFitLabelAccessor=i(!0),f.nodeShape=i(T),f.shape=u(),f.shape("nothing",r.no_shape()),f.shape("ellipse",r.ellipse_shape()),f.shape("polygon",r.polygon_shape()),f.shape("rounded-rect",r.rounded_rectangle_shape()),f.nodeContent=i("text"),f.content=u(),f.content("text",r.text_contents()),f.nodeIcon=i(null),f.nodeTitle=f.nodeTitleAccessor=i(function(e){return f.nodeKey()(e)}),f.nodeOrdering=i(null),f.nodeFixed=f.nodeFixedAccessor=i(null),f.edgeStroke=f.edgeStrokeAccessor=i("black"),f.edgeStrokeWidth=f.edgeStrokeWidthAccessor=i(1),f.edgeStrokeDashArray=i(null),f.edgeOpacity=f.edgeOpacityAccessor=i(1),f.edgeLabel=f.edgeLabelAccessor=i(function(e){return f.edgeKey()(e)}),f.edgeArrowhead=f.edgeArrowheadAccessor=i("vee"),f.edgeArrowtail=f.edgeArrowtailAccessor=i(null),f.edgeArrowSize=i(1),f.edgeIsLayout=f.edgeIsLayoutAccessor=i(function(e){return!e.value.notLayout}),f.edgeIsShown=i(!0),f.lengthStrategy=Q("lengthStrategy"),f.edgeLength=f.edgeDistanceAccessor=i(function(e){return e.value.distance}),f.flowLayout=Q("flowLayout"),f.rankdir=Q("rankdir"),f.baseLength=Q("baseLength"),f.transitionDuration=i(500),f.stageTransitions=i("none"),f.deleteDelay=i(0),f.groupConnected=Q("groupConnected"),f.timeLimit=i(0),f.constrain=i(function(e,t){return[]}),f.parallelEdgeOffset=i(10),f.edgeOrdering=i(null),f.cascade=v(f),f.initLayoutOnRedraw=i(!1),f.layoutUnchanged=i(!1),f.relayout=function(){return h=p=null,this},f.initialLayout=c("initialLayout is deprecated - use layout algorithms instead",null),f.initialOnly=c("initialOnly is deprecated - see the initialLayout deprecation notice in the documentation",!1),f.induceNodes=i(!1),f.showLayoutSteps=i(!1),f.legend=i(null).react(function(e){e.parent(f)}),f.mode=f.child=u(),f.layoutAlgorithm=function(e,t){if(!arguments.length)return f.layoutEngine()?f.layoutEngine().layoutAlgorithm():"cola";var n;switch(t||console.warn("dc.graph.diagram.layoutAlgorithm is depecrated - pass the layout engine object to dc_graph.diagram.layoutEngine instead"),e){case"cola":n=r.cola_layout();break;case"dagre":n=r.dagre_layout()}return n=r.webworker_layout(n),f.layoutEngine(n),this},f.layoutEngine=i(null).react(function(e){e&&e.parent&&e.parent(f),A&&(Object.keys(F).forEach(function(e){F[e].cola.points=null}),ee(e))}),f.enforceEdgeDirection=i(null),f.tickSize=Q("tickSize"),f.uniqueId=function(){return f.anchorName().replace(/[ .#=\[\]"]/g,"-")},f.edgeId=function(e){return"edge-"+f.edgeKey.eval(e).replace(/[^\w-_]/g,"-")},f.arrowId=function(e,t){return"arrow-"+t+"-"+f.uniqueId()+"-"+f.edgeId(e)},f.textpathId=function(e){return"textpath-"+f.uniqueId()+"-"+f.edgeId(e)},f.getNode=function(e){return I[e]?I[e].orig:null},f.getWholeNode=function(e){return I[e]?I[e]:null},f.getEdge=function(e){return F[e]?F[e].orig:null},f.getWholeEdge=function(e){return F[e]?F[e]:null},f.getPort=function(e,t,n){return B[W(e,t,n)]},f.nodePorts=function(){return g},f.handleDisconnected=Q("handleDisconnected"),f.forEachChild=function(e,t,n,r){t.enum().forEach(function(o){r(t(o),e.filter(function(e){return n(e)===o}))})},f.forEachShape=function(e,t){f.forEachChild(e,f.shape,function(e){return e.dcg_shape.shape},t)},f.forEachContent=function(e,t){f.forEachChild(e,f.content,f.nodeContent.eval,t)},f.renderNode=f._enterNode=function(e){return f.nodeTitle()&&e.append("title"),e.each(D(f)),f.forEachShape(e,function(e,t){t.call(e.create)}),f},f.redrawNode=f._updateNode=function(e){var t,n,r,o=e.filter((t=f,function(e){var n=t.nodeShape.eval(e)||T,r=e.dcg_shape.abstract;return n.shape!==r.shape||"polygon"===n.shape&&(n.shape.sides!==r.sides||n.shape.skew!==r.skew||n.shape.distortion!==r.distortion||n.shape.rotation!==r.rotation)}));return o.selectAll(".node-shape").remove(),o.each(D(f)),f.forEachShape(o,function(e,t){t.call(e.create)}),e.select("title").text(f.nodeTitle.eval),f.forEachContent(e,function(e,t){t.call(e.update),f.forEachShape(e.selectContent(t),function(e,t){var n,r;t.call((n=e,r=f,function(e){e.each(function(e){var t=null;if((!n.useTextSize||n.useTextSize(e.dcg_shape))&&r.nodeFitLabel.eval(e)){var o;t={x:(t=s(this)).x,y:t.y,width:t.width,height:t.height};var a=r.nodeContent.eval(e);if(a&&r.content(a).padding)o=r.content(a).padding(e);else{var i=r.nodeLabelPadding.eval(e);o={x:2*i.x,y:2*i.y}}t.width+=o.x,t.height+=o.y,e.bbox=t}var u,c=0;n.useRadius&&!n.useRadius(e.dcg_shape)||(c=r.nodeRadius.eval(e)),u=t&&t.width&&t.height||n.useTextSize&&!n.useTextSize(e.dcg_shape)?n.calc_radii(e,c,t):{rx:c,ry:c},e.dcg_rx=u.rx,e.dcg_ry=u.ry;var l=2*u.rx,d=2*u.ry;if(l<d&&(l=d),!n.usePaddingAndStroke||n.usePaddingAndStroke(e.dcg_shape)){var f=r.nodePadding.eval(e)+r.nodeStrokeWidth.eval(e);l+=f,d+=f}e.cola.width=l,e.cola.height=d})}))})}),f.forEachShape(e,function(e,t){t.call(e.update)}),e.select(".node-shape").attr({stroke:f.nodeStroke.eval,"stroke-width":f.nodeStrokeWidth.eval,"stroke-dasharray":f.nodeStrokeDashArray.eval,fill:(n=f.nodeFillScale()||a,r=f.nodeFill.eval,function(){return n(r.apply(null,arguments))})}),f},f.stagedDuration=function(){return"none"!==f.stageTransitions()?f.transitionDuration()/2:f.transitionDuration()},f.stagedDelay=function(e){return"none"===f.stageTransitions()||"modins"===f.stageTransitions()==!e?0:f.transitionDuration()/2},f.selectAllNodes=function(e){return e=e||".node",N.selectAll(e).filter(function(e){return!e.deleted})},f.selectAllEdges=function(e){return e=e||".edge",L.selectAll(e).filter(function(e){return!e.deleted})},f.selectAllDefs=function(e){return P.selectAll(e).filter(function(e){return!e.deleted})},f.isRunning=function(){return Y};var ne,re=!1;function oe(e,t){var n,r,o=t.target.cola.y-t.source.cola.y,a=t.target.cola.x-t.source.cola.x;return t.source!==e&&(o=-o,a=-a),t.parallel&&t.parallel.edges.length>1&&t.source.index>t.target.index&&(o=-o,a=-a),n=[a,o],r=Math.hypot(n[0],n[1]),[n[0]/r,n[1]/r]}function ae(t,n){for(var r in g={},n.forEach(function(e){var t=f.nodeKey.eval(e.node);(g[t]=g[t]||[]).push(e)}),g){var o=t[r];g[r].forEach(function(t){if(f.portElastic.eval(t)&&t.edges.length){var n=t.edges.map(oe.bind(null,o));t.vec=[e.sum(n,function(e){return e[0]})/n.length,e.sum(n,function(e){return e[1]})/n.length]}else t.vec=t.vec||void 0;t.pos=null})}}function ie(e,t,n){for(var r in g){var o=e[r];g[r].forEach(function(e){e.pos||q(f,o,e)})}t.forEach(function(e){var t=f.edgeSourcePortName.eval(e);e.sourcePort.pos=t?n[W(f.nodeKey.eval(e.source),null,t)].pos:n[W(null,f.edgeKey.eval(e),"source")].pos,t=f.edgeTargetPortName.eval(e),e.targetPort.pos=t?n[W(f.nodeKey.eval(e.target),null,t)].pos:n[W(null,f.edgeKey.eval(e),"target")].pos,console.assert(e.sourcePort.pos&&e.targetPort.pos)})}function ue(t,n){n.attr("stroke",f.edgeStroke.eval).attr("stroke-width",f.edgeStrokeWidth.eval).attr("stroke-dasharray",f.edgeStrokeDashArray.eval).attr("marker-end",function(e){var t=be(e,"head",f.edgeArrowhead.eval(e));return t?"url(#"+t+")":null}).attr("marker-start",function(e){var t=f.edgeArrowtail.eval(e),n=be(e,"tail",t);return t?"url(#"+n+")":null}).each(function(t){e.selectAll("#"+f.arrowId(t,"head")+",#"+f.arrowId(t,"tail")).attr("fill",f.edgeStroke.eval(t))}),f._updateNode(t),_e(t)}function ce(e){M.end(e),Y=!1,re&&(re=!1,window.setTimeout(function(){f.isRunning()||f.redraw()},0))}function le(e,t){var n=e[0],r=e[e.length-1],o=z(e,"tail"===t?.25:.75);return("head"===t?Math.atan2(r.y-o.y,r.x-o.x):Math.atan2(n.y-o.y,n.x-o.x))+"rad"}function se(e,t,n){var r=e.points,o=r[0],a=r[r.length-1];switch(f.enforceEdgeDirection()){case"LR":if(t.x>=n.x){var i=o.x-a.x;return{points:[o,{x:o.x+i,y:o.y-i/2},{x:a.x-i,y:a.y-i/2},a],bezDegree:3,sourcePort:e.sourcePort,targetPort:e.targetPort}}break;case"TB":if(t.y>=n.y){var u=o.y-a.y;return{points:[o,{x:o.x+u/2,y:o.y+u},{x:a.x+u/2,y:a.y-u},a],bezDegree:3,sourcePort:e.sourcePort,targetPort:e.targetPort}}}return e}function de(e,t,n,r,o,a){var i,u=e.parallel,c=e.source,l=e.target;u.edges.length>1&&e.source.index>e.target.index&&(i=l,l=c,c=i,i=o,o=n,n=i,i=a,a=r,r=i);for(var s=c.dcg_ry+f.nodeStrokeWidth.eval(c)/2,d=l.dcg_ry+f.nodeStrokeWidth.eval(l)/2,g=0;g<u.edges.length;++g){var h=!!(g%2)==n<o?-1:1,p=Math.floor((g+1)/2)>0?u.edges[g>2?g-2:0].pos[t].path:null,v=O(f,e,n,r,o,a,p,h,f.parallelEdgeOffset(),s,d);u.edges.length>1&&u.rev[g]&&v.points.reverse(),f.enforceEdgeDirection()&&(v=se(v,c.cola,l.cola)),u.edges[g].pos[t]={path:v,orienthead:le(v.points,"head"),orienttail:le(v.points,"tail")}}}function fe(e){return function(t){var n=t.pos[e].path;return x(n.points,n.bezDegree)}}function ge(e){return function(t){var n=t.pos[e].path;return x(n.points[n.points.length-1].x<n.points[0].x?n.points.slice(0).reverse():n.points,n.bezDegree)}}function he(e){return{left:e.cola.x-e.dcg_rx,top:e.cola.y-e.dcg_ry,right:e.cola.x+e.dcg_rx,bottom:e.cola.y+e.dcg_ry}}function pe(e,t){return{left:Math.min(e.left,t.left),top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom)}}function ve(e){return{left:e.x,top:e.y,right:e.x,bottom:e.y}}function ye(e){return e.pos.new.path.points.map(ve).reduce(pe)}function me(e){if(f.fitStrategy()){if(!ne)return;var t=ne.right-ne.left,n=ne.bottom-ne.top,r=f.width()-f.margins().left-f.margins().right,o=f.height()-f.margins().top-f.margins().bottom;f.DEBUG_BOUNDS&&(s=ne,(d=A.selectAll("rect.bounds").data([0])).enter().insert("rect",":first-child").attr({class:"bounds",fill:"rgba(128,255,128,0.1)",stroke:"#000"}),d.attr({x:s.left,y:s.top,width:s.right-s.left,height:s.bottom-s.top}));var a=f.fitStrategy(),i=[0,0],u=1;if(["default","vertical","horizontal"].indexOf(a)>=0)u=("default"===a?!(n/t<o/r):"vertical"===a)?o/n:r/t,u=Math.max(f.zoomExtent()[0],Math.min(f.zoomExtent()[1],u)),i=[f.margins().left-ne.left*u+(r-t*u)/2,f.margins().top-ne.top*u+(o-n*u)/2];else if("string"==typeof a&&a.match(/^align_/)){var c=a.split("_")[1].toLowerCase().split("");if(c.length>2)throw new Error("align_ expecting 0-2 sides, not "+c.length);var l=we();i=m.translate(),u=m.scale(),c.forEach(function(e){switch(e){case"l":i[0]=ke(i,l.left);break;case"t":i[1]=Ee(i,l.top);break;case"r":i[0]=Ke(i,l.right);break;case"b":i[1]=Se(i,l.bottom);break;default:throw new Error("align_ expecting l t r or b, not '"+e+"'")}})}else{if("zoom"!==a)throw new Error("unknown fitStrategy type "+typeof a);i=Pe(m.translate())}_=e,m.translate(i).scale(u).event(K),_=!1}var s,d}function xe(t,n,r,o,a,i,u,c,l,s,d){console.assert(r.data().every(te));var g={};n.each(function(e){g[f.nodeKey.eval(e)]=!0}).attr("transform",function(e){return"translate("+e.cola.x+","+e.cola.y+")"});var h=t.transition().duration(f.stagedDuration()).delay(function(e){return f.stagedDelay(g[f.nodeKey.eval(e)])}).attr("opacity",f.nodeOpacity.eval);d&&h.attr("transform",function(e){return"translate("+e.cola.x+","+e.cola.y+")"}).each("end.record",function(e){e.prevX=e.cola.x,e.prevY=e.cola.y}),r.each(function(e){e.pos.new=null}),r.each(function(e){e.cola.points?e.pos.new={path:{points:e.cola.points,bezDegree:3},orienthead:le(e.cola.points,"head"),orienttail:le(e.cola.points,"tail")}:(e.pos.old||de(e,"old",e.source.prevX||e.source.cola.x,e.source.prevY||e.source.cola.y,e.target.prevX||e.target.cola.x,e.target.prevY||e.target.cola.y),e.pos.new||de(e,"new",e.source.cola.x,e.source.cola.y,e.target.cola.x,e.target.cola.y)),e.pos.old?e.pos.old.path.bezDegree===e.pos.new.path.bezDegree&&e.pos.old.path.points.length===e.pos.new.path.points.length||(console.log("old",e.pos.old.path.points.length,"new",e.pos.new.path.points.length),j(e.pos.old.path)?(e.pos.new.path.points=C(e.pos.new.path),e.pos.old.path.points=R(C(e.pos.old.path),(e.pos.new.path.points.length-1)/3),e.pos.old.path.bezDegree=e.pos.new.bezDegree=3):j(e.pos.new.path)?(e.pos.old.path.points=C(e.pos.old.path),e.pos.new.path.points=R(C(e.pos.new.path),(e.pos.old.path.points.length-1)/3),e.pos.old.path.bezDegree=e.pos.new.bezDegree=3):console.warn("don't know how to interpolate two multi-segments")):e.pos.old=e.pos.new});var p={};o.each(function(e){p[f.edgeKey.eval(e)]=!0}).each(function(t){var n="modins"===f.stageTransitions()?"new":"old";f.edgeArrowhead.eval(t)&&e.select("#"+f.arrowId(t,"head")).attr("orient",function(){return t.pos[n].orienthead}),f.edgeArrowtail.eval(t)&&e.select("#"+f.arrowId(t,"tail")).attr("orient",function(){return t.pos[n].orienttail})}).attr("d",fe("modins"===f.stageTransitions()?"new":"old"));var v=r.each(function(t){f.edgeArrowhead.eval(t)&&e.select("#"+f.arrowId(t,"head")).transition().duration(f.stagedDuration()).delay(f.stagedDelay(!1)).attr("orient",function(){return t.pos.new.orienthead}),f.edgeArrowtail.eval(t)&&e.select("#"+f.arrowId(t,"tail")).transition().duration(f.stagedDuration()).delay(f.stagedDelay(!1)).attr("orient",function(){return t.pos.new.orienttail})}).transition().duration(f.stagedDuration()).delay(function(e){return f.stagedDelay(p[f.edgeKey.eval(e)])}).attr("opacity",f.edgeOpacity.eval);d&&v.attr("d",function(e){return fe("insmod"===f.stageTransitions()&&p[f.edgeKey.eval(e)]?"old":"new")(e)}),u.selectAll("textPath").text(function(e){return f.edgeLabel.eval(e)}),s.attr("d",ge("modins"===f.stageTransitions()?"new":"old"));var y=l.transition().duration(f.stagedDuration()).delay(function(e){return f.stagedDelay(p[f.edgeKey.eval(e)])}).attr("opacity",f.edgeOpacity.eval);d&&y.attr("d",function(e){return ge("insmod"===f.stageTransitions()&&p[f.edgeKey.eval(e)]?"old":"new")(e)}),"insmod"===f.stageTransitions()&&d&&(f.stagedDuration()>=50?(v=v.transition().duration(f.stagedDuration()).attr("d",fe("new")),y=y.transition().duration(f.stagedDuration()).attr("d",ge("new"))):(v.attr("d",fe("new")),y.attr("d",fe("new")))),f.showLayoutSteps()||function(e,t){e.every(function(e){return 0===e.size()})&&t();var n=0;e.forEach(function(e){e.each(function(){++n}).each("end.all",function(){--n||t()})})}([h,v,y],function(){ce(!0)}),d&&a.attr("d",fe("new")),r.each(function(e){e.pos.old=e.pos.new})}function _e(e){g&&f.portStyle.enum().forEach(function(t){var n={};for(var r in g)n[r]=g[r].filter(function(e){return f.portStyleName.eval(e)===t});var o=f.selectNodePortsOfStyle(e,t);f.portStyle(t).drawPorts(o,n,e)})}function be(e,t,n){var r=f.arrowId(e,t),o=f.addOrRemoveDef(r,!!n,"svg:marker");return n&&o.attr("viewBox","0 -5 10 10").attr("refX",H[n].refX).attr("refY",H[n].refY).attr("markerUnits","userSpaceOnUse").attr("markerWidth",H[n].width*f.edgeArrowSize.eval(e)).attr("markerHeight",H[n].height*f.edgeArrowSize.eval(e)).attr("stroke",f.edgeStroke.eval(e)).attr("fill",f.edgeStroke.eval(e)).call(H[n].drawFunction),n?r:null}function we(){var e=ne||{left:0,top:0,right:0,bottom:0},t=m?m.scale():1;return{left:e.left-f.margins().left/t,top:e.top-f.margins().top/t,right:e.right+f.margins().right/t,bottom:e.bottom+f.margins().bottom/t}}function ke(e,t){return e[0]-f.x()(t)+f.x().range()[0]}function Ee(e,t){return e[1]-f.y()(t)+f.y().range()[0]}function Ke(e,t){return e[0]-f.x()(t)+f.x().range()[1]}function Se(e,t){return e[1]-f.y()(t)+f.y().range()[1]}function Pe(e){var t,n=f.x().domain(),r=f.y().domain(),o=we(),a=o.left<n[0],i=o.right<n[1],u=o.right-o.left<n[1]-n[0];switch(a&&i?t=u?"left":"right":a||i||(t=u?"right":"left"),t){case"left":e[0]=ke(e,o.left);break;case"right":e[0]=Ke(e,o.right);break;default:0}switch(a=o.top<r[0],i=o.bottom<r[1],u=o.bottom-o.top<r[1]-r[0],a&&i?t=u?"top":"bottom":a||i||(t=u?"bottom":"top"),t){case"top":e[1]=Ee(e,o.top);break;case"bottom":e[1]=Se(e,o.bottom);break;default:0}return e}function Ae(){var t,n=e.event.scale;f.restrictPan()?m.translate(t=Pe(e.event.translate)):t=e.event.translate,function(e,t,n){e,t;var r=A;n&&(r=A.transition().duration(f.zoomDuration())),r.attr("transform","translate("+e+") scale("+t+")")}(t,n,_),M.zoomed(t,n)}function Ne(){K.call(m),K.on("dblclick.zoom",null)}function Le(){K.on(".zoom",null)}return f.redraw=function(){return Y?(re=!0,this):f.startLayout()},f.startLayout=function(){var n=f.nodeGroup().all(),a=f.edgeGroup().all(),i=f.portGroup()?f.portGroup().all():[];if(Y)throw new Error("dc_graph.diagram.redraw already running!");Y=!0,f.resizeSvg(),f.initLayoutOnRedraw()&&ee(),f.layoutEngine().stop(),M.preDraw(),f.nodeOrdering()&&(n=t.quicksort.by(f.nodeOrdering())(n.slice(0),0,n.length)),f.edgeOrdering()&&(a=t.quicksort.by(f.edgeOrdering())(a.slice(0),0,a.length));var u=S(I,n,null,function(e){return f.nodeKey()(e)},function(e,t){e.orig=t,e.cola=e.cola||{},e.cola.dcg_nodeKey=f.nodeKey.eval(e),f.layoutEngine().populateLayoutNode(e.cola,e)}),c=S(F,a,null,function(e){return f.edgeKey()(e)},function(e,t){e.orig=t,e.cola=e.cola||{},e.cola.dcg_edgeKey=f.edgeKey.eval(e),e.cola.dcg_edgeSource=f.edgeSource.eval(e),e.cola.dcg_edgeTarget=f.edgeTarget.eval(e),e.source=I[e.cola.dcg_edgeSource],e.target=I[e.cola.dcg_edgeTarget],e.cola.dcg_edgeLength=f.edgeLength.eval(e),e.sourcePort=e.sourcePort||{},e.targetPort=e.targetPort||{},f.layoutEngine().populateLayoutEdge(e.cola,e)}),l=(c=(c=(c=c.filter(te)).filter(function(e){return e.source!==e.target})).filter(f.edgeIsShown.eval)).map(function(e){return f.edgeSourcePortName.eval(e)?W(f.edgeSource.eval(e),null,f.edgeSourcePortName.eval(e)):W(null,f.edgeKey.eval(e),"source")});l=l.concat(c.map(function(e){return f.edgeTargetPortName.eval(e)?W(f.edgeTarget.eval(e),null,f.edgeTargetPortName.eval(e)):W(null,f.edgeKey.eval(e),"target")})),i=i.filter(function(e){return f.portNodeKey()&&f.portNodeKey()(e)||f.portEdgeKey()&&f.portEdgeKey()(e)});var s=S(B,i,l,function(e){return W(f.portNodeKey()&&f.portNodeKey()(e),f.portEdgeKey()&&f.portEdgeKey()(e),f.portName()(e))},function(e,t){e.orig=t,e.named&&(e.edges=[])},function(e,t){console.assert(e,"should have screened out invalid ports");var n,r=(n=e.split("/"),console.assert(3===n.length),"node"===(n=n.map(function(e){return e.replace(/%2F/g,"/")}))[0]?{nodeKey:n[1],name:n[2]}:{edgeKey:n[1],name:n[2]});if(r.nodeKey)t.node=I[r.nodeKey],t.named=!0;else{var o=F[r.edgeKey];t.node=o[r.name],t.edges=[o],t.named=!1}t.name=r.name});if(s=s.filter(function(e){return e.node}),c.forEach(function(e){var t=f.edgeSourcePortName.eval(e);t&&B[W(f.nodeKey.eval(e.source),null,t)].edges.push(e),(t=f.edgeTargetPortName.eval(e))&&B[W(f.nodeKey.eval(e.target),null,t)].edges.push(e)}),f.induceNodes()){var d={};for(var g in c.forEach(function(e){d[e.cola.dcg_edgeSource]=!0,d[e.cola.dcg_edgeTarget]=!0}),u=u.filter(function(e){return d[e.cola.dcg_nodeKey]}),I)d[g]||delete I[g]}if(u.forEach(function(e,t){e.index=t}),M.data(f,I,u,F,c,B,s),G={nnodes:u.length,nedges:c.length},u.forEach(function(e){f.nodeFixed()&&(e.cola.dcg_nodeFixed=f.nodeFixed.eval(e))}),f.parallelEdgeOffset()){for(var v=new Array(u.length),m=0;m<u.length;++m)v[m]=new Array(m);c.forEach(function(e){var t,n,r,o;e.pos=e.pos||{},e.source.index<e.target.index?(t=e.source.index,n=e.target.index,r="edgeSourcePortName",o="edgeTargetPortName"):(n=e.source.index,t=e.target.index,o="edgeSourcePortName",r="edgeTargetPortName");var a=f[r].eval(e)||"no port",i=f[o].eval(e)||"no port";v[n][t]=v[n][t]||{},v[n][t][i]=v[n][t][i]||{},e.parallel=v[n][t][i][a]=v[n][t][i][a]||{rev:[],edges:[]},e.parallel.edges.push(e),e.parallel.rev.push(t!==e.source.index)})}var x=L.selectAll(".edge").data(c,f.edgeKey.eval),_=x.enter().append("svg:path").attr({class:"edge",id:f.edgeId,opacity:0});x.exit().each(function(e){e.deleted=!0}).transition().duration(f.stagedDuration()).delay(f.deleteDelay()).attr("opacity",0).each(function(e){be(e,"head",null),be(e,"head",null)}).remove();var b=L.selectAll(".edge-hover").data(c,f.edgeKey.eval),w=b.enter().append("svg:path").attr("class","edge-hover").attr("opacity",0).attr("fill","none").attr("stroke","green").attr("stroke-width",10).on("mouseover",function(t){e.select("#"+f.edgeId(t)+"-label").attr("visibility","visible")}).on("mouseout",function(t){e.select("#"+f.edgeId(t)+"-label").attr("visibility","hidden")});b.exit().remove();var k=L.selectAll(".edge-label").data(c,f.edgeKey.eval),E=k.enter().append("text").attr("id",function(e){return f.edgeId(e)+"-label"}).attr("visibility","hidden").attr({class:"edge-label","text-anchor":"middle",dy:-2}).append("textPath").attr("startOffset","50%").attr("xlink:href",function(e){var t=f.textpathId(e);return window.location.href.split("#")[0]+"#"+t}),K=P.selectAll("path.edge-label-path").data(c,f.textpathId),A=K.enter().append("svg:path").attr({class:"edge-label-path",id:f.textpathId});k.exit().transition().duration(f.stagedDuration()).delay(f.deleteDelay()).attr("opacity",0).remove();var T=N.selectAll(".node").data(u,f.nodeKey.eval),D=T.enter().append("g").attr("class","node").attr("opacity","0");f._enterNode(D),T.exit().each(function(e){e.deleted=!0}).transition().duration(f.stagedDuration()).delay(f.deleteDelay()).attr("opacity",0).remove(),M.drawn(T,x,b),ue(T,x),f.initialLayout()&&f.initialLayout()(f,u,c);var O=!1;if(!f.layoutUnchanged()){var j=JSON.stringify(u.map(function(e){return{orig:o(e),cola:{dcg_nodeFixed:e.cola.dcg_nodeFixed}}})),C=JSON.stringify(c.map(function(e){return{orig:o(e),cola:e.cola}}));j===h&&C===p&&(O=!0),h=j,p=C}var z=f.constrain()(f,u,c);z.forEach(function(e){if(e.type)switch(e.type){case"alignment":e.offsets.forEach(function(e){e.node=I[e.node].index});break;case"circle":e.nodes.forEach(function(e){e.node=I[e.node].index})}else e.axis&&(e.left=I[e.left].index,e.right=I[e.right].index)});var R=c.filter(f.edgeIsLayout.eval),q=(c.filter(function(e){return!f.edgeIsLayout.eval(e)}),z.filter(function(e){return"circle"===e.type}));z=z.filter(function(e){return"circle"!==e.type}),q.forEach(function(e){var t=(e.distance||4*f.baseLength())/(2*Math.sin(Math.PI/e.nodes.length)),n=e.nodes.map(function(e){return e.node}),o=r.wheel_edges(function(e){return f.nodeKey.eval(u[e])},n,t).map(function(e){var t={internal:e};return t.source=I[e.sourcename],t.target=I[e.targetname],t});R=R.concat(o)});var H=z.filter(function(e){return"ordering"===e.type});if(z=z.filter(function(e){return"ordering"!==e.type}),H.forEach(function(e){var n,r=e.nodes.map(function(e){return I[e]});e.ordering&&(r=t.quicksort.by(y(e.ordering))(r,0,r.length));r.forEach(function(t,r){0===r?n=t:z.push({left:n.index,right:(n=t).index,axis:e.axis,gap:e.gap})})}),f.legend()&&f.legend().redraw(),O)return Y=!1,M.end(!1),this;var X=Date.now();function Z(e,t){e.forEach(function(e){var t=I[e.dcg_nodeKey];t?(t.cola.x=e.x,t.cola.y=e.y):console.warn('received node "'+e.dcg_nodeKey+'" that we did not send')}),t.forEach(function(e){var t=F[e.dcg_edgeKey];t?e.points&&(t.cola.points=e.points):console.warn('received edge "'+e.dcg_edgeKey+'" that we did not send')})}return f.layoutEngine().on("tick",function(e,t){var n=Date.now()-X;f.initialOnly()||Z(e,t),f.showLayoutSteps()&&(ae(I,s),M.receivedLayout(f,I,u,F,c,B,s),ie(I,c,B),xe(T,D,x,_,b,w,k,E,K,A,!0),_e(T),M.transitionsStarted(T,x,b)),(re||f.timeLimit()&&n>f.timeLimit())&&(console.log("cancelled"),f.layoutEngine().stop())}).on("end",function(e,t){f.showLayoutSteps()?ce(!0):(f.initialOnly()||Z(e,t),ae(I,s),M.receivedLayout(f,I,u,F,c,B,s),ie(I,c,B),xe(T,D,x,_,b,w,k,E,K,A,!0),_e(T),M.transitionsStarted(T,x,b));var n,r,o,a=!0;switch(f.autoZoom()){case"always-skipanimonce":a=!1,f.autoZoom("always");case"always":n=!0;break;case"once-noanim":a=!1;case"once":n=!0,f.autoZoom(null);break;default:n=!1}r=T,o=x,(f.fitStrategy()||f.restrictPan())&&r.size()&&(ne=r.data().map(he).reduce(pe),ne=o.data().map(ye).reduce(pe,ne)),n&&me(a)}).on("start",function(){console.log("algo "+f.layoutEngine().layoutAlgorithm()+" started."),M.start()}),f.initialOnly()?f.layoutEngine().dispatch().end(u,c):(M.start(),f.layoutEngine().data({width:f.width(),height:f.height()},u.map(function(e){return e.cola}),R.map(function(e){return e.cola}),z),f.layoutEngine().start()),this},f.refresh=function(t,n,r,o,a){ue(t=t||f.selectAllNodes(),n=n||f.selectAllEdges()),r=r||f.selectAllEdges(".edge-hover"),o=o||f.selectAllEdges(".edge-label"),a=a||f.selectAllDefs("path.edge-label-path");var i=e.select(null);return xe(t,i,n,i,r,i,o,i,a,i,!1),this},f.reposition=function(t,n){return t.attr("transform",function(e){return"translate("+e.cola.x+","+e.cola.y+")"}),n.each(function(t){t.pos.new=null,t.pos.old=null,de(t,"new",t.source.cola.x,t.source.cola.y,t.target.cola.x,t.target.cola.y),f.edgeArrowhead.eval(t)&&e.select("#"+f.arrowId(t,"head")).attr("orient",function(){return t.pos.new.orienthead}),f.edgeArrowtail.eval(t)&&e.select("#"+f.arrowId(t,"tail")).attr("orient",function(){return t.pos.new.orienttail})}).attr("d",fe("new")),this},f.selectNodePortsOfStyle=function(e,t){return e.selectAll("g.port").filter(function(e){return f.portStyleName.eval(e)===t})},f.render=function(){f.initLayoutOnRedraw()||ee(),f.resetSvg(),A=K.append("g").attr("class","draw");var e=["edge-layer","node-layer"];return f.edgesInFront()&&e.reverse(),A.selectAll("g").data(e).enter().append("g").attr("class",function(e){return e}),L=A.selectAll("g.edge-layer"),N=A.selectAll("g.node-layer"),f.legend()&&f.legend().render(),f.redraw()},f.on=function(e,t){return 1===arguments.length?M.on(e):(M.on(e,t),this)},f.getStats=function(){return G},f.select=function(e){return f.root().select(e)},f.selectAll=function(e){return f.root()?f.root().selectAll(e):null},f.x=i(null),f.y=i(null),f.svg=function(e){return arguments.length?(K=e,f):K},f.g=function(e){return arguments.length?(A=e,f):A},f.resetSvg=function(){return f.select("svg").remove(),function(){K=f.root().append("svg"),f.resizeSvg(),P=K.append("svg:defs"),f.x()||f.x(e.scale.linear().domain([0,f.width()]).range([0,f.width()]));f.y()||f.y(e.scale.linear().domain([0,f.height()]).range([0,f.height()]));if(m=e.behavior.zoom().on("zoom",Ae).x(f.x()).y(f.y()).scaleExtent(f.zoomExtent()),f.mouseZoomable()){var t,n,r=f.child("brush");if(t=f.modKeyZoom()){n=Array.isArray(t)?t.slice():"string"==typeof t?[t]:["Alt"];var o=!1,a=!1,i=!1;K.on("mousedown.modkey-zoom",function(){o=!0}).on("mouseup.modkey-zoom",function(){(o=!1)||a||!i||(i=!1,Le(),r&&r.activate())}),e.select(document).on("keydown.modkey-zoom",function(){n.indexOf(e.event.key)>-1&&(a=!0,o||(i=!0,Ne(),r&&r.deactivate()))}).on("keyup.modkey-zoom",function(){n.indexOf(e.event.key)>-1&&(a=!1,o||(i=!1,Le(),r&&r.activate()))})}else Ne()}return K}()},f.redrawGroup=function(){n.redrawAll(w)},f.renderGroup=function(){n.renderAll(w)},f.defineArrow=function(e,t,n,r,o,a){return H[e]={name:e,width:t,height:n,refX:r,refY:o,drawFunction:a},f},f.addOrRemoveDef=function(e,t,n){var r=t?[0]:[],o=P.selectAll("#"+e).data(r),a=o.enter().append(n).attr("id",e);return o.exit().remove(),a},f.resizeSvg=function(e,t){return K&&K.attr("width",e||f.width()).attr("height",t||f.height()),f},f.invertCoord=function(e){return[f.x().invert(e[0]),f.y().invert(e[1])]},f.defineArrow("vee",12,12,10,0,function(e){e.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),f.defineArrow("crow",12,12,0,0,function(e){e.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),f.defineArrow("dot",7,7,0,0,function(e){e.append("svg:circle").attr("r",5).attr("cx",5).attr("cy",0).attr("stroke-width","0px")}),f.anchor=function(t,o){if(!arguments.length)return b;if(!t)throw new n.errors.BadArgumentException("parent must be defined");return b=t.select&&t.classed?t.node():t,f.root(e.select(b)),f.root().classed(r.constants.CHART_CLASS,!0),n.registerChart(f,o),w=o,f},f.chartID=function(){return f.__dcFlag__},f.anchorName=function(){var e=f.anchor();return e&&e.id?e.id:e&&e.replace?e.replace("#",""):"dc-graph"+f.chartID()},f.anchor(l,d)},r.spawn_engine=function(e,t,n){return t=t||{},r.engines.instantiate(e,t,n)||r.engines.instantiate(r._default_engine,t,n)},r._engines=[{name:"dagre",params:["rankdir"],instantiate:function(){return r.dagre_layout()}},{name:"d3force",instantiate:function(){return r.d3_force_layout()}},{name:"d3v4force",instantiate:function(){return r.d3v4_force_layout()}},{name:"tree",instantiate:function(){return r.tree_layout()}},{names:["circo","dot","neato","osage","twopi","fdp"],instantiate:function(e,t){return r.graphviz_layout(null,e,t.server)}},{name:"cola",params:["lengthStrategy"],instantiate:function(){return r.cola_layout()}}],r._default_engine="cola",r.engines={entry_pred:function(e){return function(t){return t.name===e||t.names&&t.names.includes(e)}},get:function(e){return r._engines.find(this.entry_pred(e))},instantiate:function(e,t,n){var o=this.get(e);if(!o)return null;var a=o.instantiate(e,t);return(o.params||[]).forEach(function(e){t[e]&&a[e](t[e])}),a.supportsWebworker&&a.supportsWebworker()&&n&&(a=r.webworker_layout(a)),a},available:function(){return r._engines.reduce(function(e,t){return e.concat(t.name?[t.name]:t.names)},[])},unregister:function(e){var t=r._engines.findIndex(this.entry_pred(e)),n=!1;if(t<0)return!1;var o=r._engines[t];if(o.name===e)n=!0;else{var a=o.names.indexOf(e);a>=0?o.names.splice(a,1):console.warn("search for engine failed",e),0===o.names.length&&(n=!0)}return n&&r._engines.splice(t,1),!0},register:function(e){var t=this;if(!e.instantiate)return console.error("engine definition needs instantiate: function(layout, args) { ... }"),this;if(e.name)this.unregister(e.name);else{if(!e.names)return console.error("engine definition needs name or names[]"),this;this.names.forEach(function(e){t.unregister(e)})}return r._engines.push(e),this}};var F={};function W(e,t,n){return e||t?(e&&(e=e.replace(/\//g,"%2F")),t&&(t=t.replace(/\//g,"%2F")),(e?"node/"+e:"edge/"+t)+"/"+n):null}function q(e,t,n){if(!n.vec)throw console.assert(!n.edges.length),new Error("port has not been placed, maybe install place_ports? "+n.name);n.pos=e.shape(t.dcg_shape.shape).intersect_vec(t,1e3*n.vec[0],1e3*n.vec[1])}function B(e){var t=function(){return{type:"alignment",axis:e}};return t.listname="offsets",t.wrap=function(e){return{node:e,offset:0}},t}function G(t,n,r){if(n)t(n,null);else{var o=Object.keys(r[0]),a=o[0],i=o[1],u=e.set(r.map(function(e){return e[a]}));r.forEach(function(e){u.add(e[i])}),t(null,{nodes:u=u.values().map(function(e){return{name:e}}),links:r.map(function(e,t){return{key:t,sourcename:e[a],targetname:e[i]}})})}}function H(e){return(e.nodes||e.vertices)&&(e.edges||e.links)}r.webworker_layout=function(t){var n=e.dispatch("init","start","tick","end"),r=function(e){if(!F[e]){var t=F[e]={worker:new Worker(w()+"dc.graph."+e+".worker.js"),layouts:{}};t.worker.onmessage=function(e){var n=e.data.layoutId;if(!t.layouts[n])throw new Error('layoutId "'+n+'" unknown!');t.layouts[n].dispatch()[e.data.response].apply(null,e.data.args)}}return F[e]}(t.layoutAlgorithm()),o={};r.layouts[t.layoutId()]=o,o.parent=function(e){t.parent&&t.parent(e)},o.init=function(e){return e=t.optionNames().reduce(function(e,n){return e[n]=t[n](),e},e),r.worker.postMessage({command:"init",args:{layoutId:t.layoutId(),options:e}}),this},o.data=function(e,n,o,a){r.worker.postMessage({command:"data",args:{layoutId:t.layoutId(),graph:e,nodes:n,edges:o,constraints:a}})},o.start=function(){r.worker.postMessage({command:"start",args:{layoutId:t.layoutId()}})},o.stop=function(){return r.worker.postMessage({command:"stop",args:{layoutId:t.layoutId()}}),this},o.getEngine=function(){return t};return["layoutAlgorithm","needsStage","populateLayoutNode","populateLayoutEdge","rankdir","ranksep"].concat(t.optionNames()).forEach(function(e){o[e]=function(){var n=t[e].apply(t,arguments);return arguments.length?this:n}}),o.on=function(e,t){return 1===arguments.length?n.on(e):(n.on(e,t),this)},o.dispatch=function(){return n},o},r.graphviz_attrs=function(){return{rankdir:i("TB"),nodesep:i(40),ranksep:i(40)}},r.cola_layout=function(t){var n,o=t||l(),a=null,u=e.dispatch("tick","start","end"),c={},s={};var d=r.graphviz_attrs(),f=Object.keys(d);d.rankdir(null);var g=Object.assign(d,{layoutAlgorithm:function(){return"cola"},layoutId:function(){return o},supportsWebworker:function(){return!0},needsStage:function(e){return"ports"===e||"edgepos"===e},parent:i(null),on:function(e,t){return 1===arguments.length?u.on(e):(u.on(e,t),this)},init:function(e){return this.optionNames().forEach(function(t){e[t]=e[t]||this[t]()}.bind(this)),function(e){switch((a=cola.d3adaptor().avoidOverlaps(!0).size([e.width,e.height]).handleDisconnected(e.handleDisconnected)).tickSize&&a.tickSize(e.tickSize),e.lengthStrategy){case"symmetric":a.symmetricDiffLinkLengths(e.baseLength);break;case"jaccard":a.jaccardLinkLengths(e.baseLength);break;case"individual":a.linkDistance(function(t){return t.dcg_edgeLength||e.baseLength})}e.flowLayout&&a.flowLayout(e.flowLayout.axis,e.flowLayout.minSeparation)}(e),this},data:function(e,t,n,r){!function(e,t,n){var r=S(c,e,null,function(e){return e.dcg_nodeKey},function(e,t){e.dcg_nodeKey=t.dcg_nodeKey,e.width=t.width,e.height=t.height,e.fixed=!!t.dcg_nodeFixed,e.fixed&&"object"==typeof t.dcg_nodeFixed?(e.x=t.dcg_nodeFixed.x,e.y=t.dcg_nodeFixed.y):(void 0!==t.x&&(e.x=t.x),void 0!==t.y&&(e.y=t.y))}),o=S(s,t,null,function(e){return e.dcg_edgeKey},function(e,t){e.dcg_edgeKey=t.dcg_edgeKey,e.source=c[t.dcg_edgeSource],e.target=c[t.dcg_edgeTarget],e.dcg_edgeLength=t.dcg_edgeLength});r.forEach(function(e,t){e.index=t});var i=null;function l(e){u[e](r,o.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}g.groupConnected()&&(i=cola.separateGraphs(r,o).map(function(e){return{leaves:e.array.map(function(e){return e.index})}})),a.on("tick",function(){l("tick")}).on("start",function(){u.start()}).on("end",function(){l("end")}),a.nodes(r).links(o).constraints(n).groups(i)}(t,n,r)},start:function(){a.start(g.unconstrainedIterations(),g.userConstraintIterations(),g.allConstraintsIterations(),g.gridSnapIterations())},stop:function(){a&&a.stop()},optionNames:function(){return["handleDisconnected","lengthStrategy","baseLength","flowLayout","tickSize","groupConnected"].concat(f)},populateLayoutNode:function(){},populateLayoutEdge:function(){},handleDisconnected:i(!0),lengthStrategy:i("symmetric"),baseLength:i(30),flowLayout:function(e){if(!arguments.length){if(n)return n;switch(g.rankdir()){case"LR":return{axis:"x",minSeparation:g.ranksep()+2*g.parent().nodeRadius()};case"TB":return{axis:"y",minSeparation:g.ranksep()+2*g.parent().nodeRadius()};default:return null}}return n=e,this},unconstrainedIterations:i(10),userConstraintIterations:i(20),allConstraintsIterations:i(20),gridSnapIterations:i(0),tickSize:i(1),groupConnected:i(!1)});return g},r.cola_layout.scripts=["d3.js","cola.js"],r.dagre_layout=function(t){var n,o=t||l(),a=null,i=e.dispatch("tick","start","end"),u={},c={};var s=r.graphviz_attrs(),d=Object.keys(s);return Object.assign(s,{layoutAlgorithm:function(){return"dagre"},layoutId:function(){return o},supportsWebworker:function(){return!0},needsStage:function(e){return"ports"===e||"edgepos"===e},on:function(e,t){return 1===arguments.length?i.on(e):(i.on(e,t),this)},init:function(e){var t;return this.optionNames().forEach(function(t){e[t]=e[t]||this[t]()}.bind(this)),t=e,(a=new dagre.graphlib.Graph({multigraph:!0})).setGraph({rankdir:t.rankdir,nodesep:t.nodesep,ranksep:t.ranksep}),a.setDefaultEdgeLabel(function(){return{}}),this},data:function(e,t,r){!function(e,t){var r=S(u,e,null,function(e){return e.dcg_nodeKey},function(e,t){e.dcg_nodeKey=t.dcg_nodeKey,e.width=t.width,e.height=t.height},function(e,t){a.setNode(e,t)},function(e){a.removeNode(e)}),o=S(c,t,null,function(e){return e.dcg_edgeKey},function(e,t){e.dcg_edgeKey=t.dcg_edgeKey,e.dcg_edgeSource=t.dcg_edgeSource,e.dcg_edgeTarget=t.dcg_edgeTarget},function(e,t,n){a.setEdge(n.dcg_edgeSource,n.dcg_edgeTarget,t)},function(e,t){a.removeEdge(t.dcg_edgeSource,t.dcg_edgeTarget,t.dcg_edgeKey)});function l(e){i[e](r,o.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}(function(){l("tick")}),n=function(){l("end")}}(t,r)},start:function(){i.start(),dagre.layout(a),n()},stop:function(){},optionNames:function(){return d},populateLayoutNode:function(){},populateLayoutEdge:function(){}})},r.dagre_layout.scripts=["d3.js","dagre.js"],r.tree_layout=function(t){var n,o,a,u=t||l(),c=e.dispatch("tick","start","end");return{layoutAlgorithm:function(){return"tree"},layoutId:function(){return u},supportsWebworker:function(){return!1},on:function(e,t){return 1===arguments.length?c.on(e):(c.on(e,t),this)},init:function(t){return this.optionNames().forEach(function(e){t[e]=t[e]||this[e]()}.bind(this)),function(t){var o,a=e.functor(t.nodeWidth);function i(e,t){return(a(e)+a(t))/2}n=r.depth_first_traversal({nodeid:function(e){return e.dcg_nodeKey},sourceid:function(e){return e.dcg_edgeSource},targetid:function(e){return e.dcg_edgeTarget},init:function(){o=t.offsetX},row:function(e){return e.dcg_rank},place:function(e,n,r){if(r.length){var i=r[r.length-1],u=(a(i)+a(e))/2;o=Math.max(o,i.left_x+u)}e.left_x=o,e.hit_ins=1,e.y=n*t.gapY+t.offsetY},sib:function(e,t,n){var r=i(t,n);e&&(r*=1.5),o+=r},pop:function(e){e.x=(e.left_x+o)/2},skip:function(e,t){e.x=(e.hit_ins*e.x+o)/++e.hit_ins,e.hit_ins===t&&delete e.hit_ins},finish:function(e){e.forEach(function(e){for(var t,n=e.sort(function(e,t){return e.x-t.x}),r=null,o=null,a=0;a<n.length-1;++a){var u=n[a],c=n[a+1];if(r){if(t+=i(u,c),a<n.length-2&&c.x<o+t)continue;var l,s;if(r>0&&--r,a<n.length-2){var d=c.x-(o+t);l=n[r].x+d/2,s=a+1}else l=Math.max(n[r].x,o-i(n[r],n[r+1])-(t-c.x+o)/2),s=n.length;for(var f=r+1;f<s;++f)l+=i(n[f-1],n[f]),n[f].x=l;r=o=t=null}else c.x-u.x<i(u,c)&&(r=a,o=u.x,t=i(u,c))}})}})}(t),this},data:function(e,t,n){o=t,a=n},start:function(){n(o,a),c.end(o,a)},stop:function(){},optionNames:function(){return["nodeWidth","offsetX","offsetY","rowFunction","gapY"]},populateLayoutNode:function(e,t){this.rowFunction()&&(e.dcg_rank=this.rowFunction.eval(t))},populateLayoutEdge:function(){},nodeWidth:i(function(e){return e.width}),offsetX:i(30),offsetY:i(30),rowFunction:i(null),gapY:i(100)}},r.tree_layout.scripts=[],r.graphviz_layout=function(t,n,o){var a,i,u,c=t||l(),s=e.dispatch("tick","start","end");function d(e){return e.replace(/^%/,"&#37;")}function f(e){return e.replace(/^&#37;/,"%")}function g(e,t){return[e,'"'+t+'"'].join("=")}function h(e){return"["+e.join(", ")+"]"}function p(e,t){s.start();var n=t.bb.split(",").map(function(e){return+e}),r=(t.objects||[]).filter(function(e){return e.pos}).map(function(e){var t=e.pos.split(",");return{dcg_nodeKey:f(e.name),x:+t[0],y:n[3]-t[1]}});(u=(t.objects||[]).filter(function(e){return/^cluster/.test(e.name)})).forEach(function(e){e.bbflip=e.bb.split(",").map(function(e){return+e});var t=n[3]-e.bbflip[1];e.bbflip[1]=n[3]-e.bbflip[3],e.bbflip[3]=t});var o=(t.edges||[]).map(function(e){var t={dcg_edgeKey:f(e.id||"n"+e._gvid)};if(e._draw_){var r=e._draw_.find(function(e){return e.op&&e.points});t.points=r.points.map(function(e){return{x:e[0],y:n[3]-e[1]}})}return t});s.end(r,o)}var v=r.graphviz_attrs(),y=Object.keys(v);return Object.assign(v,{layoutAlgorithm:function(){return n},layoutId:function(){return c},supportsWebworker:function(){return!1},on:function(e,t){return 1===arguments.length?s.on(e):(s.on(e,t),this)},init:function(e){return this.optionNames().forEach(function(t){e[t]=e[t]||this[t]()}.bind(this)),this},data:function(e,t,r){!function(e,t){if(a)i=a;else{var r=[],o="neato"!==n;r.push((o?"digraph":"graph")+" g {"),r.push("graph "+h([g("nodesep",v.nodesep()/72),g("ranksep",v.ranksep()/72),g("rankdir",v.rankdir())])),(r=(r=r.concat(e.map(function(e){var t=[g("width",e.width/72),g("height",e.height/72),g("fixedsize","true")];return e.dcg_nodeFixed&&t.push(g("pos",[e.dcg_nodeFixed.x,1e3-e.dcg_nodeFixed.y].join(","))),'  "'+d(e.dcg_nodeKey)+'" '+h(t)}))).concat(t.map(function(e){return'  "'+d(e.dcg_edgeSource)+(o?'" -> "':'" -- "')+d(e.dcg_edgeTarget)+'" '+h([g("id",d(e.dcg_edgeKey)),g("arrowhead","none"),g("arrowtail","none")])}))).push("}"),r.push(""),i=r.join("\n")}}(t,r)},dotInput:function(e){return a=e,this},clusters:function(){return u},start:function(){!function(){if(o)e.json(o).header("Content-type","application/x-www-form-urlencoded").post("layouttool="+n+"&"+encodeURIComponent(i),p);else{var t=Viz(i,{format:"json",engine:n});p(0,t=JSON.parse(t))}}()},stop:function(){},optionNames:function(){return y},populateLayoutNode:function(){},populateLayoutEdge:function(){}})},r.d3_force_layout=function(t){var n=t||l(),o=null,a=e.dispatch("tick","start","end"),u={},c={},s=[],d=[],f=null,g=null;function h(e){a[e](s,d.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}function p(){!function(){if(null===g)o.gravity(f.gravityStrength).charge(f.initialCharge);else{if(f.fixOffPathNodes){var t=e.set();g.forEach(function(e){e.forEach(function(e){t.add(e)})}),Object.keys(u).forEach(function(e){t.has(e)?u[e].fixed=!1:u[e].fixed=!0})}o.charge(f.chargeForce)}}(),function(e){if(!e)return void h("end");o.start();for(var t=0;t<300;++t)o.tick(),g&&v();o.stop()}(f.iterations)}function v(){function e(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function t(t,n){var r,o,a=(o=n,((r=t).x*o.x+r.y*o.y)/(e(t)*e(n)));return a=Math.min(a,1),a=Math.max(a,-1),Math.acos(a)}function n(t){var n=-t.y/t.x,r=e({x:n,y:1});return{x:n/r,y:1/r}}function r(e,t,n,r){e.x+=n.x*(Math.PI-t)*r,e.y+=n.y*(Math.PI-t)*r}g.forEach(function(e){if(!(e.length<3))for(var o=1;o<e.length-1;++o){var a=u[e[o]],i=u[e[o-1]],c=u[e[o+1]],l={x:i.x-a.x,y:i.y-a.y},s={x:c.x-a.x,y:c.y-a.y},d=t(l,s),g=n(l),h=n(s),p=(i.x+c.x)/2,v=(i.y+c.y)/2,y={x:p-i.x,y:v-i.y},m={x:p-c.x,y:v-c.y};g=t(y,g)>=Math.PI/2?g:{x:-g.x,y:-g.x},h=t(m,h)>=Math.PI/2?h:{x:-h.x,y:-h.x},r(i,d,g,f.angleForce),r(c,d,h,f.angleForce)}})}var y=r.graphviz_attrs(),m=Object.keys(y);return Object.assign(y,{layoutAlgorithm:function(){return"d3-force"},layoutId:function(){return n},supportsWebworker:function(){return!0},parent:i(null),on:function(e,t){return 1===arguments.length?a.on(e):(a.on(e,t),this)},init:function(t){var n;return this.optionNames().forEach(function(e){t[e]=t[e]||this[e]()}.bind(this)),f=n=t,(o=e.layout.force().size([n.width,n.height])).on("tick",function(){h("tick")}).on("start",function(){a.start()}).on("end",function(){h("end")}),this},data:function(e,t,n,r){var a,i,l;i=n,l={},(a=t).forEach(function(e,t){l[e.dcg_nodeKey]=t}),s=S(u,a,null,function(e){return e.dcg_nodeKey},function(e,t){e.dcg_nodeKey=t.dcg_nodeKey,e.width=t.width,e.height=t.height,e.id=t.dcg_nodeKey}),d=S(c,i,null,function(e){return e.dcg_edgeKey},function(e,t){e.dcg_edgeKey=t.dcg_edgeKey,e.source=u[t.dcg_edgeSource],e.source.id=l[e.source.dcg_nodeKey],e.target=u[t.dcg_edgeTarget],e.target.id=l[e.target.dcg_nodeKey],e.dcg_edgeLength=t.dcg_edgeLength}),o.nodes(s),o.links(d)},start:function(){p()},stop:function(){o&&o.stop()},paths:function(e){g=e},savePositions:function(){var e={};return Object.keys(u).forEach(function(t){e[t]={x:u[t].x,y:u[t].y}}),e},restorePositions:function(e){Object.keys(e).forEach(function(t){u[t]&&(u[t].fixed=!1,u[t].x=e[t].x,u[t].y=e[t].y)})},optionNames:function(){return["iterations","angleForce","chargeForce","gravityStrength","initialCharge","fixOffPathNodes"].concat(m)},iterations:i(300),angleForce:i(.02),chargeForce:i(-500),gravityStrength:i(1),initialCharge:i(-400),fixOffPathNodes:i(!1),populateLayoutNode:function(){},populateLayoutEdge:function(){}})},r.d3_force_layout.scripts=["d3.js"],r.d3v4_force_layout=function(t){var n=t||l(),o=null,a=e.dispatch("tick","start","end"),u={},c={},s=[],d=[],f=null,g=null;function h(e){a[e](s,d.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}function p(){a.start(),function(t){if(null===t)o.force("charge").strength(f.initialCharge),o.force("angle",null);else{var n;f.fixOffPathNodes&&(n=e.set(),t.forEach(function(e){e.forEach(function(e){n.add(e)})})),Object.keys(u).forEach(function(e){f.fixOffPathNodes&&!n.has(e)?(u[e].fx=u[e].x,u[e].fy=u[e].y):(u[e].fx=null,u[e].fy=null)}),o.force("charge").strength(f.chargeForce),o.force("angle",function(e){!function(e,t,n){function r(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function o(e,t){var n,o,a=(o=t,((n=e).x*o.x+n.y*o.y)/(r(e)*r(t)));return a=Math.min(a,1),a=Math.max(a,-1),Math.acos(a)}function a(e){var t=-e.y/e.x,n=r({x:t,y:1});return{x:t/n,y:1/n}}function i(e,t,n,r){e.x+=n.x*(Math.PI-t)*r,e.y+=n.y*(Math.PI-t)*r}t.forEach(function(e){if(!(e.length<3))for(var t=1;t<e.length-1;++t){var r=u[e[t]],c=u[e[t-1]],l=u[e[t+1]],s={x:c.x-r.x,y:c.y-r.y},d={x:l.x-r.x,y:l.y-r.y},f=o(s,d),g=a(s),h=a(d),p={x:(c.x+l.x)/2,y:(c.y+l.y)/2},v={x:p.x-c.x,y:p.y-c.y},y={x:p.x-l.x,y:p.y-l.y};g=o(v,g)>=Math.PI/2?g:{x:-g.x,y:-g.x},h=o(y,h)>=Math.PI/2?h:{x:-h.x,y:-h.x},i(c,f,g,n),i(l,f,h,n)}})}(0,t,f.angleForce)})}}(g),function(e){o.alpha(1);for(var t=0;t<e;++t)o.tick(),h("tick");h("end")}(f.iterations)}var v=r.graphviz_attrs(),y=Object.keys(v);return Object.assign(v,{layoutAlgorithm:function(){return"d3v4-force"},layoutId:function(){return n},supportsWebworker:function(){return!0},parent:i(null),on:function(e,t){return 1===arguments.length?a.on(e):(a.on(e,t),this)},init:function(e){var t;return this.optionNames().forEach(function(t){e[t]=e[t]||this[t]()}.bind(this)),f=t=e,o=d3v4.forceSimulation().force("link",d3v4.forceLink()).force("center",d3v4.forceCenter(t.width/2,t.height/2)).force("gravityX",d3v4.forceX(t.width/2).strength(f.gravityStrength)).force("gravityY",d3v4.forceY(t.height/2).strength(f.gravityStrength)).force("collision",d3v4.forceCollide(f.collisionRadius)).force("charge",d3v4.forceManyBody()).stop(),this},data:function(e,t,n,r){var a,i,l;i=n,l={},(a=t).forEach(function(e,t){l[e.dcg_nodeKey]=t}),s=S(u,a,null,function(e){return e.dcg_nodeKey},function(e,t){e.dcg_nodeKey=t.dcg_nodeKey,e.width=t.width,e.height=t.height,e.id=t.dcg_nodeKey}),d=S(c,i,null,function(e){return e.dcg_edgeKey},function(e,t){e.dcg_edgeKey=t.dcg_edgeKey,e.source=l[u[t.dcg_edgeSource].dcg_nodeKey],e.target=l[u[t.dcg_edgeTarget].dcg_nodeKey],e.dcg_edgeLength=t.dcg_edgeLength}),o.nodes(s),o.force("link").links(d)},start:function(){p()},stop:function(){},paths:function(e){g=e},savePositions:function(){var e={};return Object.keys(u).forEach(function(t){e[t]={x:u[t].x,y:u[t].y}}),e},restorePositions:function(e){Object.keys(e).forEach(function(t){u[t]&&(u[t].fx=e[t].x,u[t].fy=e[t].y)})},optionNames:function(){return["iterations","angleForce","chargeForce","gravityStrength","collisionRadius","initialCharge","fixOffPathNodes"].concat(y)},iterations:i(300),angleForce:i(.01),chargeForce:i(-600),gravityStrength:i(.3),collisionRadius:i(8),initialCharge:i(-100),fixOffPathNodes:i(!1),populateLayoutNode:function(){},populateLayoutEdge:function(){}})},r.d3v4_force_layout.scripts=["d3.js","d3v4-force.js"],r.flexbox_layout=function(t){var n,r,o,a=t||l(),u=e.dispatch("tick","start","end");function c(e,t){n=e,r={},t.forEach(function(e){!function e(t,n,r,o){if(o.address=t.slice(),o.children=o.children||{},n.length){var a=o.children[n[0]]=o.children[n[0]]||{};t.push(n.shift()),e(t,n,r,a)}else o.node=r}([],h.keyToAddress()(e.dcg_nodeKey),e,r)});(function e(t){var n=h.addressToKey()(t.address);return Array.prototype.concat.apply([n],Object.keys(t.children).map(function(n){return e(t.children[n])}))})(r);o=t}var s=["sort","dcg_nodeKey","x","y"],d=["width","height"];function f(){var t,a,i=function e(t,n){var r={name:h.addressToKey()(n.address),style:{}},o=Object.assign({},t),a=Object.keys(n.children).length;for(var i in n.node&&Object.assign(t,n.node),t)if(!(s.includes(i)||a&&d.includes(i))){var u=t[i];"function"==typeof u&&(u=u(n.node)),r.style[i]=u}return a&&(r.children=Object.values(n.children).sort(t.sort).map(function(e){return e.address[e.address.length-1]}).map(function(t){return e(Object.assign({},o),n.children[t])})),n.flexnode=r,r}({sort:function(t,n){return e.ascending(t.node.dcg_nodeKey,n.node.dcg_nodeKey)}},r);i.style.width=n.width,i.style.height=n.height,h.logStuff()&&console.log(JSON.stringify(i,null,2)),computeLayout(i),function e(t,n){h.logStuff()&&console.log(n.node.dcg_nodeKey+": "+JSON.stringify(n.flexnode.layout)),n.node.x=t.x+n.flexnode.layout.left+n.flexnode.layout.width/2,n.node.y=t.y+n.flexnode.layout.top+n.flexnode.layout.height/2,Object.keys(n.children).map(function(e){return n.children[e]}).forEach(function(r){e({x:t.x+n.flexnode.layout.left,y:t.y+n.flexnode.layout.top},r)})}({x:0,y:0},r),t=o,a=[],u["end"](t,a.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}var g=["width","height","minWidth","minHeight","maxWidth","maxHeight","left","right","top","bottom","margin","marginLeft","marginRight","marginTop","marginBottom","padding","paddingLeft","paddingRight","paddingTop","paddingBottom","borderWidth","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth","flexDirection","justifyContent","alignItems","alignSelf","flex","flexWrap","position"],h={layoutAlgorithm:function(){return"cola"},layoutId:function(){return a},supportsWebworker:function(){return!0},needsStage:function(e){return"ports"===e||"edgepos"===e},parent:i(null),on:function(e,t){return 1===arguments.length?u.on(e):(u.on(e,t),this)},init:function(e){return this.optionNames().forEach(function(t){e[t]=e[t]||this[t]()}.bind(this)),this},data:function(e,t){c(e,t)},start:function(){f()},stop:function(){},optionNames:function(){return[]},populateLayoutNode:function(e,t){["sort","order"].concat(g).forEach(function(n){t.orig.value[n]&&(e[n]=t.orig.value[n])})},populateLayoutEdge:function(){},addressToKey:i(function(e){return e.join(",")}),keyToAddress:i(function(e){return e.split(",")}),logStuff:i(!1)};return h},r.flexbox_layout.scripts=["css-layout.js"],r.manual_layout=function(t){var n,r=t||l(),o=e.dispatch("tick","start","end");function a(){var e,t;e=n,t=[],o["end"](e,t.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}return{layoutAlgorithm:function(){return"cola"},layoutId:function(){return r},supportsWebworker:function(){return!0},needsStage:function(e){return"ports"===e||"edgepos"===e},parent:i(null),on:function(e,t){return 1===arguments.length?o.on(e):(o.on(e,t),this)},init:function(e){return this.optionNames().forEach(function(t){e[t]=e[t]||this[t]()}.bind(this)),this},data:function(e,t,r){n=t},start:function(){a()},stop:function(){},optionNames:function(){return[]},populateLayoutNode:function(e,t){["x","y"].forEach(function(n){void 0!==t.orig.value[n]&&(e[n]=t.orig.value[n])})},populateLayoutEdge:function(){},addressToKey:i(function(e){return e.join(",")}),keyToAddress:i(function(e){return e.split(",")})}},r.manual_layout.scripts=["css-layout.js"],r.place_ports=function(){function t(t,r,o,a,i,u,c){var l,s,d=t.nodePorts();function f(e,t){return e[0]*t[1]-e[1]*t[0]>0}function g(e){return[Math.cos(e),Math.sin(e)]}function h(e){return Math.atan2(e[1],e[0])}function p(e,t){return Math.hypot(t.pos.x-e.pos.x,t.pos.y-e.pos.y)}for(var v in d){var y=r[v],m=d[v];m.forEach(function(e){var n=e.orig&&t.portBounds.eval(e)||[0,2*Math.PI];Array.isArray(n[0])?(e.vbounds=n,e.abounds=n.map(h)):(e.vbounds=n.map(g),e.abounds=n),e.abounds[0]>e.abounds[1]&&(e.abounds[1]+=2*Math.PI),console.assert(e.orig||e.vec,"unplaced unspecified port")});var x=[],_=[],b=[];m.forEach(function(e){var t,n;e.vec?!e.vbounds||(t=e.vec,f((n=e.vbounds)[0],t)&&f(t,n[1]))?x.push(e):_.push(e):b.push(e)}),_.forEach(function(e){var t,n;e.vec=(t=e.vec,n=e.vbounds,f(t,n[0])?n[0]:f(n[1],t)?n[1]:t),x.push(e)});var w={},k={};for(var E in b.forEach(function(e){var t=e.abounds.map(function(e){return e.toFixed(3)}).join(",");w[t]=e.abounds,k[t]=k[t]||[],k[t].push(e)}),k){var K=w[E],S=k[E];if(1===S.length)S[0].vec=g((K[0]+K[1])/2);else{var P=(K[1]-K[0])/(k[E].length-1);k[E].forEach(function(e,t){e.vec=g(K[0]+t*P)})}}x=x.concat(b),b=[],x.forEach(function(e){q(t,y,e)});for(var A=0;A<x.length;++A){var N=x[A];if(!b.includes(N))for(var L=A+1;L<x.length;++L){var T=x[L];if(!b.includes(T)&&!(p(N,T)>n.minDistance())){if(!N.edges.length){b.push(N);continue}b.push(T)}}}x=x.filter(function(e){return!b.includes(e)});for(var D,M=n.patience(),O=0;b.length;){var j=b[0];j.vec=g((l=j.abounds[0],s=j.abounds[1],l+Math.random()*(s-l))),q(t,y,j);var C=e.min(x,function(e){return p(j,e)});C>O&&(O=C,D=j.vec),(!M--||C>n.minDistance())&&(M<0&&(console.warn("ran out of patience placing a port"),j.vec=D,q(t,y,j)),x.push(j),b.shift(),M=n.patience(),O=0)}}}var n={parent:i(null).react(function(e){e?e.on("receivedLayout.place-ports",t):n.parent()&&n.parent().on("receivedLayout.place-ports",null)}),minDistance:i(20),patience:i(20)};return n},r.troubleshoot=function(){var e=null;function t(e,t,n){return{left:e.x-t/2,top:e.y-n/2,right:e.x+t/2,bottom:e.y+n/2}}function n(e,t,n,r){return"M"+e+","+(t+r)+" v"+-r+" h"+n}function o(e){return[n(e.left,e.top,u.boundsWidth(),u.boundsHeight()),n(e.right,e.top,-u.boundsWidth(),u.boundsHeight()),n(e.right,e.bottom,-u.boundsWidth(),-u.boundsHeight()),n(e.left,e.bottom,u.boundsWidth(),-u.boundsHeight())].join(" ")}function a(e,t){e.exit().remove(),e.enter().append("path").attr("class",t),e.attr({d:o,opacity:null!==u.boundsOpacity()?u.boundsOpacity():u.opacity(),stroke:u.boundsColor(),fill:"none"})}var u=r.behavior("highlight-paths",{laterDraw:!0,add_behavior:function(n,r,o,i){e||(e=n.g().append("g").attr({class:"draw-graphs","pointer-events":"none"}));var c=r.data().map(function(e){return{x:e.cola.x,y:e.cola.y}}),l=e.selectAll("path.nodecenter").data(c);function s(e){return{x:e.cola.x,y:e.cola.y}}l.exit().remove(),l.enter().append("path").attr("class","nodecenter"),l.attr({d:function(e){return"M"+(e.x-u.xhairWidth()/2)+","+e.y+" h"+u.xhairWidth()+" M"+e.x+","+(e.y-u.xhairHeight()/2)+" v"+u.xhairHeight()},opacity:null!==u.xhairOpacity()?u.xhairOpacity():u.opacity(),stroke:u.xhairColor()});var d=r.data().map(function(e){return t(s(e),e.cola.width,e.cola.height)});a(e.selectAll("path.colaboundary").data(d),"colaboundary");var f=r.data().map(function(e){return e.bbox?t(s(e),e.bbox.width,e.bbox.height):null}).filter(function(e){return!!e});a(e.selectAll("path.textboundary").data(f),"textboundary");var g=r.data().map(function(e){return"number"===(e.dcg_rx,!1)?null:t(s(e),2*e.dcg_rx,2*e.dcg_ry)}).filter(function(e){return!!e});a(e.selectAll("path.radiiboundary").data(g),"radiiboundary")},remove_behavior:function(t,n,r,o){e&&e.remove()}});return u.opacity=i(.75),u.xhairOpacity=i(null),u.xhairWidth=i(10),u.xhairHeight=i(10),u.xhairColor=i("blue"),u.boundsOpacity=i(null),u.boundsWidth=i(10),u.boundsHeight=i(10),u.boundsColor=i("green"),u},r.validate=function(t){function n(e,t,n,r){var o=e.filter(function(e){return!t(e)});return o.length?[n+" is empty for "+o.length+" of "+e.length+" "+r,o]:null}function o(e,t){return e.reduce(function(e,n){return e[t(n)]=n,e},{})}function a(e,t,n,r,o,a){var i=t.filter(function(t){return!e[n(t)]}).map(function(e){return{key:n(e),value:e}});return i.length?[r+" was not found in "+o,Object.keys(e),"for "+i.length+" of "+t.length+" "+a,i]:null}function u(){var i=c.parent(),u=i.nodeGroup().all(),l=i.edgeGroup().all(),s=i.portGroup()?i.portGroup().all():[],d=[];function f(e){e&&d.push(e)}f(n(u,i.nodeKey(),"nodeKey","nodes")),f(n(l,i.edgeSource(),"edgeSource","edges")),f(n(l,i.edgeTarget(),"edgeTarget","edges"));var g=e.set(i.content.enum()),h=r.functor_wrap(i.nodeContent()),p=u.filter(function(e){return!g.has(h(e))});p.length&&d.push(["there are "+p.length+" nodes with nodeContent not matching any content",p]);var v=o(u,i.nodeKey()),y=o(l,i.edgeKey());f(a(v,l,i.edgeSource(),"edgeSource","nodes","edges")),f(a(v,l,i.edgeTarget(),"edgeTarget","nodes","edges")),f(n(s,function(e){return i.portNodeKey()&&i.portNodeKey()(e)||i.portEdgeKey()&&i.portEdgeKey()(e)},"portNodeKey||portEdgeKey","ports"));var m=!i.portNodeKey()&&[]||s.filter(function(e){return i.portNodeKey()(e)}),x=!i.portEdgeKey()&&[]||s.filter(function(e){return i.portEdgeKey()(e)});if(f(a(v,m,i.portNodeKey(),"portNodeKey","nodes","ports")),f(a(y,x,i.portEdgeKey(),"portEdgeKey","edges","ports")),i.portName()){var _=o(m,function(e){return i.portNodeKey()(e)+" - "+i.portName()(e)});i.edgeSourcePortName()&&f(a(_,l,function(t){return i.edgeSource()(t)+" - "+e.functor(i.edgeSourcePortName())(t)},"edgeSourcePortName","ports","edges")),i.edgeTargetPortName()&&f(a(_,l,function(t){return i.edgeTarget()(t)+" - "+e.functor(i.edgeTargetPortName())(t)},"edgeTargetPortName","ports","edges"))}function b(){return u.length+" nodes, "+l.length+" edges, "+s.length+" ports"}d.length?(console.warn("validation of "+t+" failed with "+b()+":"),d.forEach(function(e){console.warn.apply(null,e)})):console.log("validation of "+t+" succeeded with "+b()+".")}var c={parent:i(null).react(function(e){e?e.on("data.validate",u):c.parent().on("data.validate",null)})};return c},r.legend=function(){var e,t={};return t.x=i(0),t.y=i(0),t.gap=i(5),t.nodeWidth=i(40),t.nodeHeight=i(40),t.exemplars=i({}),t.parent=i(null),t.redraw=function(){var n=t.parent().svg().selectAll("g.dc-graph-legend").data([0]);n.enter().append("g").attr("class","dc-graph-legend").attr("transform","translate("+t.x()+","+t.y()+")");var r=n.selectAll(".node").data(e,function(e){return e.name}),o=r.enter().append("g").attr("class","node");o.append("text").attr("dy","0.3em").attr("class","legend-label"),r.attr("transform",function(e,n){return"translate("+t.nodeWidth()/2+","+(t.nodeHeight()+t.gap())*(n+.5)+")"}),r.select("text.legend-label").attr("transform","translate("+(t.nodeWidth()/2+t.gap())+",0)").text(function(e){return e.name}),t.parent()._enterNode(o)._updateNode(r)},t.render=function(){var n=t.exemplars();if(n instanceof Array)e=n.map(function(e){return{name:e.name,orig:{key:e.key,value:e.value},cola:{}}});else for(var r in e=[],n)e.push({name:r,orig:{key:r,value:n[r]},cola:{}});t.redraw()},t},r.constraint_pattern=function(e){var t={},n=[];return e.nodes.forEach(function(e){var n=e.id,r=t[n]||(t[n]={});if(e.partition){var o=e.partition,a=e.value||e.id;e.all||e.typename?(r.match=e.extract?function(t){return e.extract(t.value[o])}:function(e){return e.value[o]},r.typename=e.typename||function(e){return o+"="+e.value[o]}):r.match=function(e){return e.value[o]===a}}else{if(!e.match)throw new Error("couldn't determine matcher for type "+JSON.stringify(e));r.match=e.match}}),e.edges.forEach(function(e){if(!e.disable){var t={source:e.source,target:e.target};t.produce="function"==typeof e.produce?e.produce:function(){return function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(e.produce)},["listname","wrap","reverse"].forEach(function(n){void 0!==e[n]&&(t[n]=e[n])}),n.push(t)}}),function(e,r,o){var a=[],i={};r.forEach(function(n){var r=e.nodeKey.eval(n);for(var o in t){var a=t[o],u=a.match(n.orig);if(u){var c=a.typename?a.typename(o,u):o;i[c]||(i[c]={nodes:[],whether:{}}),i[c].nodes.push(r),i[c].whether[r]=!0}}});var u=n.filter(function(e){return e.source!==e.target}),c=n.filter(function(e){return e.source===e.target});return o.forEach(function(t){var n=e.edgeSource.eval(t),c=e.edgeTarget.eval(t);u.forEach(function(e){if(i[e.source]&&i[e.source].whether[n]&&i[e.target]&&i[e.target].whether[c]){var t=e.produce(i,r,o);e.reverse?(t.left=c,t.right=n):(t.left=n,t.right=c),a.push(t)}})}),c.forEach(function(e){if(i[e.source]){var t=e.produce(),n=e.listname||e.produce.listname||"nodes",r=e.wrap||e.produce.wrap||function(e){return e};t[n]=i[e.source].nodes.map(r),a.push(t)}}),a}},r.gap_y=function(e,t){return{axis:"y",gap:e,equality:!!t}},r.gap_x=function(e,t){return{axis:"x",gap:e,equality:!!t}},r.align_y=function(){return B("y")},r.align_x=function(){return B("x")},r.order_x=function(e,t){return{type:"ordering",axis:"x",gap:60,ordering:t}},r.order_y=function(e,t){return{type:"ordering",axis:"y",gap:60,ordering:t}},r.tree_positions=function(t,n,o,a,i,u,c){var l;function s(e,t){return(u(e)+u(t))/2}console.warn("dc_graph.tree_positions is deprecated; use the layout engine tree_layout instead"),(t||o)&&console.warn("dc_graph.tree_positions: rootf and treef are ignored"),u=e.functor(u);var d=r.depth_first_traversal({nodeid:function(e){return e.cola.dcg_nodeKey},sourceid:function(e){return e.cola.dcg_edgeSource},targetid:function(e){return e.cola.dcg_edgeTarget},init:function(){l=a},row:function(e){return n(e.orig)},place:function(e,t,n){if(n.length){var r=n[n.length-1],o=(u(r)+u(e))/2;l=Math.max(l,r.left_x+o)}e.left_x=l,e.hit_ins=1,e.cola.y=t*c+i},sib:function(e,t,n){var r=s(t,n);e&&(r*=1.5),l+=r},pop:function(e){e.cola.x=(e.left_x+l)/2},skip:function(e,t){e.cola.x=(e.hit_ins*e.cola.x+l)/++e.hit_ins,e.hit_ins===t&&delete e.hit_ins},finish:function(e){e.forEach(function(e){for(var t,n=e.sort(function(e,t){return e.cola.x-t.cola.x}),r=null,o=null,a=0;a<n.length-1;++a){var i=n[a],u=n[a+1];if(r){if(t+=s(i,u),a<n.length-2&&u.cola.x<o+t)continue;var c,l;if(r>0&&--r,a<n.length-2){var d=u.cola.x-(o+t);c=n[r].cola.x+d/2,l=a+1}else c=Math.max(n[r].cola.x,o-s(n[r],n[r+1])-(t-u.cola.x+o)/2),l=n.length;for(var f=r+1;f<l;++f)c+=s(n[f-1],n[f]),n[f].cola.x=c;r=o=t=null}else u.cola.x-i.cola.x<s(i,u)&&(r=a,o=i.cola.x,t=s(i,u))}})}});return function(e,t,n){return d(t,n)}},r.tree_constraints=function(e,t,n,o){return console.warn("dc_graph.tree_constraints is deprecated - it never worked right and may not be a good idea"),function(o,a,i){var u=[],c=0;return r.depth_first_traversal({root:e,tree:t,place:function(e,t,n){if(n.length){var r=n[n.length-1];u.push({left:o.nodeKey.eval(r),right:o.nodeKey.eval(e),axis:"x",gap:c-r.foo_x,equality:!0})}e.foo_x=c},sib:function(){c+=n}})(o,a,i),u}},r.behavior=function(e,t){var n={},r=t.laterDraw?"transitionsStarted":"drawn";return n.parent=i(null).react(function(o){var a;if(o){var i=!0;a=o,o.on(r+"."+e,function(e,n,r){t.add_behavior(a,e,n,r),i&&t.first?(t.first(a,e,n,r),i=!1):t.rest&&t.rest(a,e,n,r)})}else n.parent()&&(a=n.parent()).on(r+"."+e,function(n,o,i){t.remove_behavior(a,n,o,i),a.on(r+"."+e,null)});t.parent&&t.parent(o)}),n},r.tip=function(t){var n,o,a=(t=t||{}).namespace||"tip",u=null;function c(){(!e.event.relatedTarget||l.selection().exclude&&l.selection().exclude(e.event.target)||!(this.contains(e.event.relatedTarget)||l.clickable()&&e.event.relatedTarget.classList.contains("d3-tip")))&&(n&&(window.clearTimeout(n),n=null),l.clickable()?o=window.setTimeout(function(){u.hide()},l.hideDelay()):u.hide())}var l=r.behavior(a,{add_behavior:function(t,r,i,s){var d,f;d=t,u||(u=e.tip().attr("class","d3-tip").html(function(e){return"<span>"+e+"</span>"}).direction(l.direction()),l.offset()&&u.offset(l.offset()),d.svg().call(u)),l.selection().select(t,r,i,s).on("mouseover."+a,(f="content",function(t){var r=this,a=function(){l[f]()(t,function(t){u.show.call(r,t,r),e.select("div.d3-tip").selectAll("a.tip-link").on("click",function(){e.event.preventDefault(),l.linkCallback()&&l.linkCallback()(this.id)})})};l.selection().exclude&&l.selection().exclude(e.event.target)?c.call(this):(o&&window.clearTimeout(o),l.delay()?(window.clearTimeout(n),n=window.setTimeout(a,l.delay())):a())})).on("mouseout."+a,c),l.clickable()&&e.select("div.d3-tip").on("mouseover."+a,function(){o&&window.clearTimeout(o)}).on("mouseout."+a,c)},remove_behavior:function(e,t,n,r){l.selection().select(e,t,n,r).on("mouseover."+a,null).on("mouseout."+a,null)},laterDraw:!0});return l.direction=i("n"),l.content=i(function(e,t){t(l.parent()?l.parent().nodeTitle.eval(e):"")}),l.selection=i(r.tip.select_node_and_edge()),l.showDelay=l.delay=i(0),l.hideDelay=i(200),l.offset=i(null),l.clickable=i(!1),l.linkCallback=i(null),l},r.tip.table=function(){var t=function(n,r){n=n.orig.value;var o=Object.keys(n).filter(e.functor(t.filter())).filter(function(e){return n[e]}),a=e.select(document.createElement("table")),i=a.selectAll("tr").data(o).enter().append("tr");i.append("td").text(function(e){return e}),i.append("td").text(function(e){return n[e]}),r(a.node().outerHTML)};return t.filter=i(!0),t},r.tip.select_node_and_edge=function(){return{select:function(e,t,n,r){var o=e.selectAll(".foo-this-does-not-exist");return o[0]=t[0].concat(r[0]),o},exclude:function(e){return K(e,"port")}}},r.tip.select_node=function(){return{select:function(e,t,n,r){return t},exclude:function(e){return K(e,"port")}}},r.tip.select_edge=function(){return{select:function(e,t,n,r){return n}}},r.tip.select_port=function(){return{select:function(e,t,n,r){return t.selectAll("g.port")}}},r.keyboard=function(){var t,n=e.dispatch("keydown","keyup");function o(){n.keydown()}function a(){n.keyup()}var u=r.behavior("brush",{add_behavior:function(e){(t=e.svg().selectAll("a#dcgraph-keyboard").data([1])).enter().insert("a",":first-child").attr({id:"dcgraph-keyboard",href:"#"}),t.on("keydown.keyboard",o),t.on("keyup.keyboard",a),e.svg().on("mouseup.keyboard",function(){u.focus()})},remove_behavior:function(e){t.remove()}});return u.on=function(e,t){return 1===arguments.length?n.on(e):(n.on(e,t),this)},u.focus=function(){u.disableFocus()||t.node().focus()},u.disableFocus=i(!1),u},r.edit_text=function(t,n){var r=t.append("foreignObject").attr({height:"100%",width:"100%"});function o(){var e;switch(n.align){case"left":e=[n.box.x,n.box.y];break;default:case"center":e=[n.box.x+(n.box.width-a.node().offsetWidth)/2,n.box.y+(n.box.height-a.node().offsetHeight)/2]}r.attr("transform","translate("+e.join(" ")+")")}var a=r.append("xhtml:div"),i=n.text||"type on me";function u(){e.event.stopPropagation()}function c(){n.cancel&&n.cancel(),a.on("blur.edittext",null),r.remove(),n.finally&&n.finally()}a.text(i).attr({contenteditable:!0,width:"auto"}).style({display:"inline-block","background-color":"white",padding:"2px"}),r.on("mousedown",u).on("mousemove",u).on("mouseup",u).on("dblclick",u),a.on("keydown.edittext",function(){13===e.event.keyCode&&e.event.preventDefault()}).on("keyup.edittext",function(){13===e.event.keyCode?(n.accept&&n.accept(a.text()),a.on("blur.edittext",null),r.remove(),n.finally&&n.finally()):27===e.event.keyCode&&c(),o()}).on("blur.edittext",c),o(),a.node().focus();var l=document.createRange();n.selectText?l.selectNodeContents(a.node()):(l.setStart(a.node(),1),l.setEnd(a.node(),1));var s=window.getSelection();s.removeAllRanges(),s.addRange(l)},r.brush=function(){var t,n=null,o=e.dispatch("brushstart","brushmove","brushend");function a(){o.brushstart()}function i(){var e=n.extent();o.brushmove(e)}function u(){o.brushend(),t.call(n.clear())}function c(){t&&(t.remove(),t=null)}var l=r.behavior("brush",{add_behavior:function(){},remove_behavior:c});return l.on=function(e,t){return 1===arguments.length?o.on(e):(o.on(e,t),this)},l.activate=function(){var r;return r=l.parent(),n||(n=e.svg.brush().x(r.x()).y(r.y()).on("brushstart",a).on("brush",i).on("brushend",u)),t||(t=r.svg().insert("g",":first-child").attr("class","brush").call(n)),this},l.deactivate=function(){return c(),this},l.isActive=function(){return!!t},l},r.select_things=function(t,n,o){var a,u=[],c=null,l=o.keysEqual?function(e){return function(t){return o.keysEqual(e,t)}}:function(e){return function(t){return e===t}};function s(e,t){return!!u.find(l(t))}function d(e){return e.shiftKey}function f(e){return E?e.metaKey:e.ctrlKey}function g(e,t){return s(0,t)?e:e.concat([t])}function h(e,t){return s(0,t)?e.filter(function(e){return e!=t}):e.concat([t])}var p=!1;function v(r,o){p!==o&&(r.svg().on("click."+n,o?function(n){e.event.target===this&&t.set_changed([])}:null),p=o)}function y(){d(e.event.sourceEvent)||f(e.event.sourceEvent)?a=u.slice():(a=[],t.set_changed([]))}function m(n){var r,i=o.intersectRect(n);r=d(e.event.sourceEvent)?i.reduce(g,a):f(e.event.sourceEvent)?i.reduce(h,a):i,t.set_changed(r)}var x=r.behavior(n,{add_behavior:function(r,a,i){var l=x.noneIsAll()?function(e){return!u.length||s(0,o.key(e))}:function(e){return s(0,o.key(e))};if(o.applyStyles(l),o.clickables(r,a,i).on("mousedown."+n,function(e){c=e}),o.clickables(r,a,i).on("mouseup."+n,function(n){if(!(o.excludeClick&&o.excludeClick(e.event.target)||c!==n)){var r,a=o.key(n);x.multipleSelect()&&(d(e.event)?r=g(u,a):f(e.event)&&(r=h(u,a))),r||(r=[a]),t.set_changed(r)}}),x.multipleSelect()?r.child("brush").activate():v(r,x.clickBackgroundClears()),x.autoCropSelection()){o.clickables(r,a,i).data().map(o.key);var p=u.filter(function(e){return s(0,e)});u.length!==p.length&&t.set_changed(p,!1)}},remove_behavior:function(e,t,r){o.clickables(e,t,r).on("click."+n,null),e.svg().on("click."+n,null),o.removeStyles()},parent:function(e){var o;if(t.on("set_changed."+n,e?(o=e,function(e,t){void 0===t&&(t=!0),u=e,t&&o.refresh()}):null),e){var a=e.child("brush");a||(a=r.brush(),e.child("brush",a)),a.on("brushstart."+n,y).on("brushmove."+n,m)}},laterDraw:o.laterDraw||!1});return x.multipleSelect=i(!0),x.clickBackgroundClears=i(!0,!1).react(function(e){!x.multipleSelect()&&x.parent()&&v(x.parent(),e)}),x.noneIsAll=i(!1),x.autoCropSelection=i(!0),x.thinginess=function(){return o},x},r.select_things_group=function(t,n){return window.chart_registry.create_type(n,function(){return e.dispatch("set_changed")}),window.chart_registry.create_group(n,t)},r.select_nodes=function(e,t){t=t||{};var n=r.select_things_group(t.select_nodes_group||"select-nodes-group","select-nodes"),o={intersectRect:function(e){return a.parent().selectAllNodes().data().filter(function(t){return t&&e[0][0]<t.cola.x&&t.cola.x<e[1][0]&&e[0][1]<t.cola.y&&t.cola.y<e[1][1]}).map(this.key)},clickables:function(e,t,n){return t},excludeClick:function(e){return K(e,"port")},key:function(e){return a.parent().nodeKey.eval(e)},applyStyles:function(t){a.parent().cascade(50,!0,p(t,null,e))},removeStyles:function(){a.parent().cascade(50,!1,e)}},a=r.select_things(n,"select-nodes",o);return a},r.select_edges=function(e,t){t=t||{};var n=r.select_things_group(t.select_edges_group||"select-edges-group","select-edges"),o={intersectRect:function(e){return this.clickables().data().filter(function(t){return[{x:t.source.cola.x+t.sourcePort.pos.x,y:t.source.cola.y+t.sourcePort.pos.y},{x:t.target.cola.x+t.targetPort.pos.x,y:t.target.cola.y+t.targetPort.pos.y}].some(function(t){return e[0][0]<t.x&&t.x<e[1][0]&&e[0][1]<t.y&&t.y<e[1][1]})}).map(this.key)},clickables:function(){return a.parent().selectAllEdges(".edge-hover")},key:function(e){return a.parent().edgeKey.eval(e)},applyStyles:function(t){a.parent().cascade(50,!0,p(null,t,e))},removeStyles:function(){a.parent().cascade(50,!1,e)}},a=r.select_things(n,"select-edges",o);return a},r.select_ports=function(e,t){var n=(t=t||{}).portStyle||"symbols",o=r.select_things_group(t.select_ports_group||"select-ports-group","select-ports"),a={laterDraw:!0,intersectRect:null,clickables:function(){return i.parent().selectAllNodes("g.port")},key:function(e){return e.named?{node:i.parent().nodeKey.eval(e.node),name:e.name}:{edge:i.parent().edgeKey.eval(e.edges[0]),name:e.name}},applyStyles:function(t){i.parent().portStyle(n).cascade(50,!0,h(t,e))},removeStyles:function(){i.parent().portStyle(n).cascade(50,!1,e)},keysEqual:function(e,t){return e.name===t.name&&(e.node?e.node===t.node:e.edge===t.edge)}},i=r.select_things(o,"select-ports",a);return i},r.move_nodes=function(t){t=t||{};var n,o,a,u,c=r.select_things_group(t.select_nodes_group||"select-nodes-group","select-nodes"),l=r.fix_nodes_group("fix-nodes-group"),s=[],d=null;function f(e){s.forEach(function(t){var n=g.parent().getWholeNode(t);e(n,t)})}var g=r.behavior("move-nodes",{add_behavior:function(t,i,h){function p(){if(d){var e=r.event_coords(t),a=e[0]-d[0],u=e[1]-d[1];!o&&Math.hypot(a,u)>g.dragSize()&&(o=!0,n&&n.style("pointer-events","none")),o&&(f(function(e){e.cola.x=e.original_position[0]+a,e.cola.y=e.original_position[1]+u}),t.reposition(i,h))}}function v(){if(d){if(o){o=!1,n&&(n.style("pointer-events",null),n=null);var e=[];f(function(t,n){e.push({id:n,pos:{x:t.cola.x,y:t.cola.y}})}),l.request_fixes(e)}a&&a.activate(),d=null}}i.on("mousedown.move-nodes",function(o){if(!(u&&u.usePorts()&&u.usePorts().eventPort())){d=r.event_coords(t),n=e.select(this);var i=t.nodeKey.eval(o);s.indexOf(i)<0&&c.set_changed([i]),f(function(e){e.original_position=[e.cola.x,e.cola.y]}),a&&a.deactivate()}}),i.on("mousemove.move-nodes",p).on("mouseup.move-nodes",v),t.svg().on("mousemove.move-nodes",p).on("mouseup.move-nodes",v)},remove_behavior:function(e,t,n){t.on("mousedown.move-nodes",null),t.on("mousemove.move-nodes",null),t.on("mouseup.move-nodes",null)},parent:function(e){c.on("set_changed.move-nodes",e?function(e,t){void 0===t&&(t=!0),s=e}:null),a=e.child("brush"),u=e.child("draw-graphs"),e.child("select-nodes")}});return g.dragSize=i(5),g},r.fix_nodes=function(e){e=e||{};var t,n,o=r.fix_nodes_group("fix-nodes-group"),a=e.fixedPosTag||"fixedPos",u=[],c={nodeid:function(e){return y.parent().nodeKey.eval(e)},sourceid:function(e){return y.parent().edgeSource.eval(e)},targetid:function(e){return y.parent().edgeTarget.eval(e)},get_fix:function(e){return y.parent().nodeFixed.eval(e)},fix_node:function(e,t){e[a]=t},unfix_node:function(e){e[a]=null},clear_fixes:function(){u={}},register_fix:function(e,t){u[e]=t}};function l(e){y.strategy().request_fixes(c,e),h(f()).then(function(){y.parent().redraw()})}function s(e,t,n){y.strategy().new_node(c,e,t,n)}function d(e,n,r){var o=t[n],a=t[r];y.strategy().new_edge(c,e,o,a)}function f(){var e=[];return n.forEach(function(t){var n=y.parent().nodeKey.eval(t),r=u[n],o=t.orig.value[a],i=!1;o?r&&r.x===o.x&&r.y===o.y||(i=!0):i=r,i&&e.push({n:t,fixed:r?{x:r.x,y:r.y}:null})}),e}function g(e,t){t?c.fix_node(e.orig.value,t):c.unfix_node(e.orig.value)}function h(e){var t=y.fixNode()||function(e,t){return Promise.resolve(t)},n=e.map(function(e){var n=y.parent().nodeKey.eval(e.n);return t(n,e.fixed).then(function(t){g(e.n,t)})});return Promise.all(n)}function p(e){e.forEach(function(e){g(e.n,e.fixed)})}function v(e,r,o,a,i,u,l){if(t=r,n=o,a,i,y.strategy().on_data){y.strategy().on_data(c,r,o,a,i,u,l);var s=f();p(s),y.reportOverridesAsynchronously()&&(d=s,g=y.fixNode()||function(e,t){return Promise.resolve(t)},h=d.map(function(e){var t=y.parent().nodeKey.eval(e.n);return g(t,e.fixed)}),Promise.all(h))}var d,g,h}var y={parent:i(null).react(function(e){o.on("request_fixes.fix-nodes",e?l:null).on("new_node.fix_nodes",e?s:null).on("new_edge.fix_nodes",e?d:null),e?e.on("data.fix-nodes",v):y.parent()&&y.parent().on("data.fix-nodes",null)}),fixNode:i(null),fixAllNodes:function(e){void 0===e&&(e=!0);var t=n.map(function(e){return{n:e,fixed:{x:e.cola.x,y:e.cola.y}}});return e?h(t):(p(t),Promise.resolve(void 0))},clearFixes:function(){y.strategy().clear_all_fixes&&y.strategy().clear_all_fixes(),c.clear_fixes()},strategy:i(r.fix_nodes.strategy.fix_last()),reportOverridesAsynchronously:i(!0)};return y},r.fix_nodes.strategy={},r.fix_nodes.strategy.fix_last=function(){return{request_fixes:function(e,t){e.clear_fixes(),t.forEach(function(t){e.register_fix(t.id,t.pos)})},new_node:function(e,t,n,r){e.fix_node(n,r)},new_edge:function(e,t,n,r){e.unfix_node(n.orig.value),e.unfix_node(r.orig.value)}}},r.fix_nodes.strategy.last_N_per_component=function(e){e=e||1;var t=0,n={};return{clear_all_fixes:function(){n={}},request_fixes:function(e,r){++t,r.forEach(function(e){n[e.id]={id:e.id,age:t,pos:e.pos}})},new_node:function(e,r,o,a){++t,n[r]={id:r,age:t,pos:a},e.fix_node(o,a)},new_edge:function(){},on_data:function(o,a,i,u,c,l,s){++t,i.forEach(function(e){var r=o.nodeid(e),a=o.get_fix(e);a&&!n[r]&&(n[r]={id:r,age:t,pos:a})});var d=[];r.undirected_dfs({nodeid:o.nodeid,sourceid:o.sourceid,targetid:o.targetid,comp:function(){d.push([])},node:function(e,t){d[e].push(t)}})(i,c),o.clear_fixes(),d.forEach(function(t,r){var a=t.reduce(function(e,t){if(t.last_component){var r=e[t.last_component]=e[t.last_component]||{total:0,fixed:0};r.total++,n[o.nodeid(t)]&&r.fixed++}return e},{}),i=Object.keys(a).reduce(function(e,t){return a[t].fixed&&e.push({compid:+t,total:a[t].total,fixed:a[t].fixed}),e},[]).sort(function(e,t){return t.total-e.total}),u=i.length&&i[0].compid,c=t.filter(function(e){return!e.last_component||e.last_component===u}).map(function(e){return n[o.nodeid(e)]}).filter(function(e){return e});c.length>e&&(c.sort(function(e,t){return t.age-e.age}),c=c.slice(0,e)),c.forEach(function(e){o.register_fix(e.id,e.pos)});var l=c.reduce(function(e,t){return e[t.id]=!0,e},{});t.forEach(function(e){var t=o.nodeid(e);l[t]||(n[t]=null),e.last_component=r+1})})}}},r.fix_nodes_group=function(t){return window.chart_registry.create_type("fix-nodes",function(){return e.dispatch("request_fixes","new_node","new_edge")}),window.chart_registry.create_group("fix-nodes",t)},r.filter_selection=function(t,n){n=n||"select-nodes";var o=r.select_things_group(t||"select-nodes-group",n);var a={parent:i(null).react(function(t){var r;o.on("set_changed.filter-selection-"+n,t?(r=t,function(t){if(t.length){var n=e.set(t);a.dimensionAccessor()(r).filterFunction(function(e){return n.has(e)})}else a.dimensionAccessor()(r).filter(null);r.redrawGroup()}):null)})};return a.dimensionAccessor=i(function(e){return e.nodeDimension()}),a},r.delete_things=function(t,n,o){o=o||"id";var a,u=E?"Backspace":"Delete",c=[];function l(e){c=e}function s(e){return e[o]}function d(e){if(!f.crossfilterAccessor())throw new Error("need crossfilterAccessor");if(!f.dimensionAccessor())throw new Error("need dimensionAccessor");if(0===(e=e||c).length)return Promise.resolve([]);var t=f.preDelete()?f.preDelete()(e):Promise.resolve(e);return f.onDelete()&&(t=t.then(f.onDelete())),t.then(function(e){if(e&&e.length){var t=f.crossfilterAccessor()(f.parent()),n=f.dimensionAccessor()(f.parent()),r=t.all().slice();r.length;n.filter(null),t.remove();var o=r.filter(function(t){return-1===e.indexOf(s(t))});r.length!==o.length+e.length&&console.warn("size after deletion is not previous size minus selection size",o.map(s),r.map(s),e),t.add(o),f.parent().redrawGroup()}return!0})}var f=r.behavior(n,{add_behavior:function(t){a.on("keyup."+n,function(){e.event.code===u&&d()})},remove_behavior:function(e){},parent:function(e){t.on("set_changed."+n,l),e&&((a=e.child("keyboard"))||e.child("keyboard",a=r.keyboard()))}});return f.preDelete=i(null),f.onDelete=i(null),f.crossfilterAccessor=i(null),f.dimensionAccessor=i(null),f.deleteSelection=d,f},r.delete_nodes=function(e,t){t=t||{};var n=r.select_things_group(t.select_nodes_group||"select-nodes-group","select-nodes"),o=r.select_things_group(t.select_edges_group||"select-edges-group","select-edges"),a=r.delete_things(n,"delete-nodes",e);return a.preDelete(function(e){var t=a.parent(),n=t.child("delete-edges");return n?Promise.resolve(void 0).then(function(){var r=t.edgeGroup().all().filter(function(n){return-1!==e.indexOf(t.edgeSource()(n))||-1!==e.indexOf(t.edgeTarget()(n))}).map(t.edgeKey());return o.set_changed(r),n.deleteSelection().then(function(){return e})}):null}),a},r.label_things=function(t){t=t||{};var n,o,a=r.select_things_group(t.select_group,t.select_type),i=r.label_things_group(t.label_group,t.label_type),u=[];function c(){n.focus()}function l(e,n,r){var o=t.find_thing(u[0],e,n);o.empty()?console.error("couldn't find thing '"+u[0]+"'!"):o.size()>1?console.error("found too many things for '"+u[0]+"' ("+o.size()+")!"):i.edit_label(o,r)}var s=r.behavior(t.label_type,{add_behavior:function(r,a,i){n.on("keyup."+t.label_type,function(){if(u.length){if(1!==e.event.key.length)return;l(a,i,{text:e.event.key,selectText:!1})}}),o&&o.thinginess().clickables(r,a,i).on("dblclick."+t.label_type,function(){l(a,i,{selectText:!0})})},remove_behavior:function(e,t,n){},parent:function(e){var l;a.on("set_changed."+t.label_type,e?function(e){u=e}:null),i.on("edit_label."+t.label_type,e?(l=e,function(e,n){var o=t.thing_box(e);r.edit_text(l.g(),{text:n.text||t.thing_label(e)||t.default_label,align:t.align,box:o,selectText:n.selectText,accept:function(n){return t.accept(e,n)},finally:c})}):null),e&&((n=e.child("keyboard"))||e.child("keyboard",n=r.keyboard()),o=e.child(t.select_type))}});return s.editSelection=function(e){l(s.parent().selectAllNodes(),s.parent().selectAllEdges(),e)},s},r.label_things_group=function(t,n){return window.chart_registry.create_type(n,function(){return e.dispatch("edit_label")}),window.chart_registry.create_group(n,t)},r.label_nodes=function(e){var t=(e=e||{}).labelTag||"label";e.select_group=e.select_group||"select-nodes-group",e.select_type=e.select_type||"select-nodes",e.label_group=e.label_group||"label-nodes-group",e.label_type=e.label_type||"label-nodes",e.default_label="node name",e.find_thing=function(e,t,r){return t.filter(function(t){return n.parent().nodeKey.eval(t)===e})},e.thing_box=function(e,t){var r=n.parent().content(n.parent().nodeContent.eval(e.datum())).textbox(e);return r.x+=e.datum().cola.x,r.y+=e.datum().cola.y,r},e.thing_label=function(e){return n.parent().nodeLabel.eval(e.datum())},e.accept=function(e,r){return(n.changeNodeLabel()?n.changeNodeLabel()(n.parent().nodeKey.eval(e.datum()),r):Promise.resolve(r)).then(function(r){e.datum().orig.value[t]=r,n.parent().redrawGroup()})};var n=r.label_things(e);return n.changeNodeLabel=i(null),n},r.label_edges=function(e){var t=(e=e||{}).labelTag||"label";e.select_group=e.select_group||"select-edges-group",e.select_type=e.select_type||"select-edges",e.label_group=e.label_group||"label-edges-group",e.label_type=e.label_type||"label-edges",e.default_label="edge name",e.find_thing=function(e,t,r){return r.filter(function(t){return n.parent().edgeKey.eval(t)===e})},e.thing_box=function(e,t){var n=e.datum().pos.new.path.points;return{x:(n[0].x+n[1].x)/2,y:(n[0].y+n[1].y)/2-10,width:0,height:20}},e.thing_label=function(e){return n.parent().edgeLabel.eval(e.datum())},e.accept=function(e,r){return(n.changeEdgeLabel()?n.changeEdgeLabel()(n.parent().edgeKey.eval(e.datum()),r):Promise.resolve(r)).then(function(r){e.datum().orig.value[t]=r,n.parent().redrawGroup()})};var n=r.label_things(e);return n.changeEdgeLabel=i(null),n},r.highlight_neighbors=function(e){function t(e){e.each(function(e){e.dcg_highlighted=!1})}return r.behavior("highlight-neighbors",{add_behavior:function(n,r,o){n.cascade(100,!0,p(null,function(e){return e.dcg_highlighted},e)),r.on("mouseover.highlight-neighbors",function(e){o.each(function(t){t.dcg_highlighted=t.source===e||t.target===e}),n.refresh(r,o)}).on("mouseout.highlight-neighbors",function(e){t(o),n.refresh(r,o)})},remove_behavior:function(n,r,o){var a,i;a=n,i=o,r.on("mouseover.highlight-neighbors",null).on("mouseout.highlight-neighbors",null),t(i),a.cascade(100,!1,e)}})},r.register_highlight_paths_group=function(t){return window.chart_registry.create_type("highlight-paths",function(){return e.dispatch("paths_changed","hover_changed","select_changed")}),window.chart_registry.create_group("highlight-paths",t)},r.highlight_paths=function(e,t,n,o){var a=r.register_highlight_paths_group(o||"highlight-paths-group");e=e||{},t=t||{},n=n||{};var u,c={},l={},s=null,d=null;function f(){w.doRedraw()?w.parent().relayout().redraw():w.parent().refresh()}function g(e,t){s=d=null,0===Object.keys(c).length&&0===Object.keys(e).length&&0===Object.keys(l).length&&0===Object.keys(t).length||(c=e,l=t,f())}function h(e){e!==d&&(d=e,f())}function v(e){e!==s&&(s=e,f())}function y(e){return function(t){return e.indexOf(t)>=0}}function m(e){var t=y(e);return function(e){return!t(e)}}function x(e,t){return!(!e||!t)&&e.some(y(t))}function _(e,t){return e?t?t.every(y(e))?e.filter(m(t)):e.concat(t.filter(m(e))):e:t}function b(r,o,a,i){o.on("mouseover.highlight-paths",null).on("mouseout.highlight-paths",null).on("click.highlight-paths",null),i.on("mouseover.highlight-paths",null).on("mouseout.highlight-paths",null).on("click.highlight-paths",null),c={},l={},r.cascade(200,!1,e).cascade(300,!1,n).cascade(400,!1,t)}var w=r.behavior("highlight-paths",{add_behavior:function(r,o,i,u){r.cascade(200,!0,p(function(e){return!!c[r.nodeKey.eval(e)]},function(e){return!!l[r.edgeKey.eval(e)]},e)).cascade(300,!0,p(function(e){return x(c[r.nodeKey.eval(e)],s)},function(e){return x(l[r.edgeKey.eval(e)],s)},n)).cascade(400,!0,p(function(e){return x(c[r.nodeKey.eval(e)],d)},function(e){return x(l[r.edgeKey.eval(e)],d)},t)),o.on("mouseover.highlight-paths",function(e){a.hover_changed(c[r.nodeKey.eval(e)]||null)}).on("mouseout.highlight-paths",function(e){a.hover_changed(null)}).on("click.highlight-paths",function(e){a.select_changed(_(s,c[r.nodeKey.eval(e)]))}),u.on("mouseover.highlight-paths",function(e){a.hover_changed(l[r.edgeKey.eval(e)]||null)}).on("mouseout.highlight-paths",function(e){a.hover_changed(null)}).on("click.highlight-paths",function(e){a.select_changed(_(s,l[r.nodeKey.eval(e)]))})},remove_behavior:function(e,t,n,r){return b(e,t,0,r),this},parent:function(e){e&&(u=e.anchorName()),a.on("paths_changed.highlight"+u,e?g:null),a.on("hover_changed.highlight"+u,e?h:null),a.on("select_changed.highlight"+u,e?v:null)}});return w.doRedraw=i(!1),w},r.draw_spline_paths=function(t,n,o,a){var i=r.register_highlight_paths_group(a||"highlight-paths-group");n=n||{},o=o||{};var u,c=null,l=null,s=null;function d(e,n,r){l.selectAll(".spline-edge").remove(),l.selectAll(".spline-edge-hover").remove(),c=r;var o=h.parent().layoutEngine(),a=r.filter(f);if(a.length){var i=a.map(function(e){return t.elementList.eval(e).filter(function(e){return"node"===t.elementType.eval(e)}).map(function(e){return t.nodeKey.eval(e)})});o.paths(i)}else o.paths(null),s&&o.restorePositions(s);h.parent().redraw()}function f(e){return t.elementList.eval(e).every(function(e){return"node"!==t.elementType.eval(e)||h.parent().getWholeNode(t.nodeKey.eval(e))})}function g(r,o){o=o||.6;var a,i,u=(a=r,i=[],t.elementList.eval(a).forEach(function(e){var n,r;switch(t.elementType.eval(e)){case"node":n=t.nodeKey.eval(e),null!==(r=h.parent().getWholeNode(n))&&i.push({x:r.cola.x,y:r.cola.y})}}),i);return n.insertDummyNodes&&(u=function(e){for(var t,r,o=[],a=0;a<e.length;a++)if(a-1>=0&&a+1<e.length)if(e[a-1].x===e[a+1].x&&e[a-1].y===e[a+1].y){var i=e[a-1].x,u=e[a-1].y,c=i-(f=e[a].x),l=(h=u-(g=e[a].y))/Math.sqrt(c*c+h*h),s=-c/Math.sqrt(c*c+h*h),d={x:null,y:null};(p={x:null,y:null}).x=(i+f)/2+(v=10)*l,p.y=(u+g)/2+v*s,d.x=(i+f)/2-v*l,d.y=(u+g)/2-v*s,o.push(p),o.push(e[a]),o.push(d)}else if(t=e[a-1],r=e[a+1],Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2))<n.nearNodesDistance){var f,g,h,p,v;i=e[a-1].x,u=e[a-1].y,c=i-(f=e[a].x),l=(h=u-(g=e[a].y))/Math.sqrt(c*c+h*h),s=-c/Math.sqrt(c*c+h*h),(p={x:null,y:null}).x=(i+f)/2+(v=10)*l,p.y=(u+g)/2+v*s,i=e[a].x,u=e[a].y,c=i-(f=e[a+1].x),l=(h=u-(g=e[a+1].y))/Math.sqrt(c*c+h*h),s=-c/Math.sqrt(c*c+h*h),(d={x:null,y:null}).x=(i+f)/2+v*l,d.y=(u+g)/2+v*s,o.push(p),o.push(e[a]),o.push(d)}else o.push(e[a]);else o.push(e[a]);return o}(u)),e.svg.line().interpolate("cardinal").x(function(e){return e.x}).y(function(e){return e.y}).tension(o)(u)}i.on("hover_changed.draw-spline-paths",function(t){!function(t){if(null===t)e.selectAll(".spline-edge").attr("stroke","black");else for(var n=0;n<t.length;n++){var r=c.indexOf(t[n]);e.select("#spline-path-"+r).attr("stroke",o.edgeStroke).each(function(){this.parentNode.appendChild(this)})}}(t)});var h=r.behavior("draw-spline-paths",{laterDraw:!0,add_behavior:function(e,t,r,a){var u,d;null===l&&(l=h.parent().select("g.draw").selectAll("g.spline-layer").data([0])).enter().append("g").attr("class","spline-layer"),d=n,null!==(u=c)?(l.selectAll(".spline-edge").data(u).enter().append("svg:path").attr("class","spline-edge").attr("id",function(e,t){return"spline-path-"+t}).attr("d",function(e){return g(e,d.lineTension)}).attr("stroke",d.edgeStroke||"black").attr("stroke-width",d.edgeStrokeWidth||1).attr("opacity",d.edgeOpacity||1).attr("fill","none"),l.selectAll(".spline-edge-hover").data(u).enter().append("svg:path").attr("class","spline-edge-hover").attr("d",function(e){return g(e)}).attr("opacity",0).attr("stroke","green").attr("stroke-width",o.edgeStrokeWidth||5).attr("fill","none").on("mouseover",function(e,t){i.hover_changed([u[t]])}).on("mouseout",function(e,t){i.hover_changed(null)}).on("click",function(e,t){i.select_changed([u[t]])})):s=h.parent().layoutEngine().savePositions()},remove_behavior:function(e,t,n,r){return this},parent:function(e){e&&(u=e.anchorName()),i.on("paths_changed.spline-"+u,e?d:null)}});return h},r.expand_collapse=function(t,n,o,a){if((a=a||["both"]).length>2)throw new Error("there are only two directions to expand in");function i(e,t,n,r){var o;switch(n){case"out":o=function(t){return e.edgeSource.eval(t)===r};break;case"in":o=function(t){return e.edgeTarget.eval(t)===r};break;case"both":o=function(t){return e.edgeSource.eval(t)===r||e.edgeTarget.eval(t)===r}}return t.filter(o).size()}function u(e,t,n){var r=t.selectAll("g.spikes").data(function(e){return!e.dcg_expand_selected||e.dcg_expanded&&e.dcg_expanded[e.dcg_expand_selected.dir]?[]:[e]});r.exit().remove(),r.enter().insert("g",":first-child").classed("spikes",!0);var o=r.selectAll("rect.spike").data(function(t){e.nodeKey.eval(t);for(var n=t.dcg_expand_selected.dir,r=t.dcg_expand_selected.n,o=function(e,t,n){if("both"===t)return function(e){return Math.PI*(2*e/n-.5)};var r,o=(n-1)*Math.PI/n;switch(e){case"LR":r=0;break;case"TB":r=Math.PI/2;break;case"RL":r=Math.PI;break;case"BT":r=-Math.PI/2}return"in"===t&&(r+=Math.PI),function(e){return r+o*((n>1?e/(n-1):0)-.5)}}(e.layoutEngine().rankdir(),n,r),a=Array(r),i=0;i<r;++i){var u=o(i);a[i]={a:180*u/Math.PI,x:Math.cos(u)*t.dcg_rx*.9,y:Math.sin(u)*t.dcg_ry*.9}}return a});o.enter().append("rect").classed("spike",!0).attr({width:25,height:3,fill:"url(#spike-gradient)",rx:1,ry:1,x:0,y:0}),o.attr("transform",function(e){return"translate("+e.x+","+e.y+") rotate("+e.a+")"}),o.exit().remove()}function c(e,t,n){t.each(function(e){e.dcg_expand_selected=null}),u(e,t)}function l(e,t,n,r){if(1===n.length)return n[0];var o=e.root().node().getBoundingClientRect(),a=e.invertCoord([t.clientX-o.left,t.clientY-o.top]),i=a[0],u=a[1];switch(e.layoutEngine().rankdir()){case"TB":return u>r.cola.y?"out":"in";case"BT":return u<r.cola.y?"out":"in";case"LR":return i>r.cola.x?"out":"in";case"RL":return i<r.cola.x?"out":"in"}throw new Error("unknown rankdir "+e.layoutEngine().rankdir())}return r.behavior("expand-collapse",{add_behavior:function(r,s,d){function f(n){var o=l(r,e.event,a,n),c=r.nodeKey.eval(n);Promise.resolve(t(c,o)).then(function(e){var t={dir:o,n:Math.max(0,e-i(r,d,o,c))};s.each(function(e){e.dcg_expand_selected=e===n?t:null}),u(r,s)})}function g(t){var c=e.event;function f(){var e=l(r,c,a,t);t.dcg_expanded=t.dcg_expanded||{},t.dcg_expanded[e]?(o(r.nodeKey.eval(t),function(e,t,n,r){return 1===i(e,t,r,n)}.bind(null,r,d,e),e),t.dcg_expanded[e]=!1):(n(r.nodeKey.eval(t),e,"dblclick"===c.type),t.dcg_expanded[e]=!0),u(r,s),t.dcg_dblclk_timeout=null}return console.log(c.type),f()}s.on("mouseover.expand-collapse",f).on("mousemove.expand-collapse",f).on("mouseout.expand-collapse",function(e){c(r,s)}).on("click",g).on("dblclick",g)},first:function(e){var t=e.addOrRemoveDef("spike-gradient",!0,"linearGradient");t.attr({x1:"0%",y1:"0%",x2:"100%",y2:"0%",spreadMethod:"pad"}),t.selectAll("stop").data([[0,"black",1],[100,"black","0"]]).enter().append("stop").attr({offset:function(e){return e[0]+"%"},"stop-color":function(e){return e[1]},"stop-opacity":function(e){return e[2]}})},remove_behavior:function(e,t,n){t.on("mouseover.expand-collapse",null).on("mouseout.expand-collapse",null),c(e,t)}})},r.draw_graphs=function(t){var n=r.select_things_group(t.select_nodes_group||"select-nodes-group","select-nodes"),o=r.select_things_group(t.select_edges_group||"select-edges-group","select-edges"),a=(r.label_things_group("label-nodes-group","label-nodes"),r.label_things_group("label-edges-group","label-edges"),r.fix_nodes_group("fix-nodes-group")),u=t.idTag||"id",c=t.edgeIdTag||u,s=t.sourceTag||"source",d=t.targetTag||"target",f=t.labelTag||"label",g=t.edgeLabelTag||f,h=null,p=null,v=null,y=[];function m(){var e=y.filter(function(e){return e.source&&e.target}),t=v.selectAll("line.hint-edge").data(e);t.exit().remove(),t.enter().append("line").attr("class","hint-edge").style({fill:"none",stroke:"black","pointer-events":"none"}),t.attr({x1:function(e){return e.source.x},y1:function(e){return e.source.y},x2:function(e){return e.target.x},y2:function(e){return e.target.y}})}function x(){y=[],h=p=null,m()}function _(e,t,r){if(!b.nodeCrossfilter())throw new Error("need nodeCrossfilter");var o,i=b.addNode()||k;r?o=r:((o={})[u]=l(),o[f]=""),t&&a.new_node(o[u],o,{x:t[0],y:t[1]}),i(o).then(function(t){t&&(b.nodeCrossfilter().add([t]),e.redrawGroup(),n.set_changed([t[u]]))})}var b=r.behavior("highlight-paths",{add_behavior:function(t,i,u,f){var w=t.child("select-nodes");w&&b.clickCreatesNodes()&&w.clickBackgroundClears(!1),i.on("mousedown.draw-graphs",function(n){if(e.event.stopPropagation(),b.dragCreatesEdges()){if(b.usePorts()){var r;if(!(r="object"==typeof b.usePorts()&&b.usePorts().eventPort?b.usePorts().eventPort():t.getPort(t.nodeKey.eval(n),null,"out")||t.getPort(t.nodeKey.eval(n),null,"in")))return;h={node:n,port:r},y=[{source:{x:n.cola.x+r.pos.x,y:n.cola.y+r.pos.y}}]}else y=[{source:{x:(h={node:n}).node.cola.x,y:h.node.cola.y}}];b.conduct().startDragEdge&&(b.conduct().startDragEdge(h)||x())}}).on("mousemove.draw-graphs",function(n){if(e.event.stopPropagation(),h){var o=p;if(n===h.node)p=null,y[0].target=null;else if(b.usePorts()){var a;a="object"==typeof b.usePorts()&&b.usePorts().eventPort?b.usePorts().eventPort():t.getPort(t.nodeKey.eval(n),null,"in")||t.getPort(t.nodeKey.eval(n),null,"out"),p=a?{node:n,port:a}:null}else p&&n===p.node||(p={node:n});if(b.conduct().changeDragTarget)(b.usePorts()?(o&&o.port)!==(p&&p.port):(o&&o.node)!==(p&&p.node))&&!b.conduct().changeDragTarget(h,p)&&(p=null);if(p)p.port?y[0].target={x:n.cola.x+a.pos.x,y:n.cola.y+a.pos.y}:y[0].target={x:n.cola.x,y:n.cola.y};else{var i=r.event_coords(t);y[0].target={x:i[0],y:i[1]}}m()}}).on("mouseup.draw-graphs",function(e){if(h&&p){var r;r=b.conduct().finishDragEdge?b.conduct().finishDragEdge(h,p):Promise.resolve(!0);var i=h,u=p;r.then(function(e){e&&function(e,t,r){if(!b.edgeCrossfilter())throw new Error("need edgeCrossfilter");var i,u={},f=b.addEdge()||k;u[c]=l(),u[g]="",b.conduct().detectReversedEdge&&b.conduct().detectReversedEdge(u,t.port,r.port)?(u[s]=r.node.orig.key,u[d]=t.node.orig.key,i=t,t=r,r=i):(u[s]=t.node.orig.key,u[d]=r.node.orig.key),f(u,t.port,r.port).then(function(t){t&&(a.new_edge(u[c],t[s],t[d]),b.edgeCrossfilter().add([t]),n.set_changed([],!1),o.set_changed([t[c]],!1),e.redrawGroup())})}(t,i,u)})}else h&&b.conduct().cancelDragEdge&&b.conduct().cancelDragEdge(h);x()}),t.svg().on("mousedown.draw-graphs",function(){h=null}).on("mousemove.draw-graphs",function(){if(h){var e=r.event_coords(t);b.conduct().dragCanvas&&b.conduct().dragCanvas(h,e),b.conduct().changeDragTarget&&p&&b.conduct().changeDragTarget(h,null),p=null,y[0].target={x:e[0],y:e[1]},m()}}).on("mouseup.draw-graphs",function(){h?(b.conduct().cancelDragEdge&&b.conduct().cancelDragEdge(h),x()):e.event.target===this&&b.clickCreatesNodes()&&_(t,r.event_coords(t))}),v||(v=t.g().append("g").attr("class","draw-graphs"))},remove_behavior:function(e,t,n,r){t.on("mousedown.draw-graphs",null).on("mousemove.draw-graphs",null).on("mouseup.draw-graphs",null),e.svg().on("mousedown.draw-graphs",null).on("mousemove.draw-graphs",null).on("mouseup.draw-graphs",null)}});return b.nodeCrossfilter=i(t.nodeCrossfilter),b.edgeCrossfilter=i(t.edgeCrossfilter),b.usePorts=i(null),b.clickCreatesNodes=i(!0),b.dragCreatesEdges=i(!0),b.conduct=i({}),b.addNode=i(null),b.addEdge=i(null),b.createNode=function(e,t){_(b.parent(),e,t)},b},r.match_ports=function(e,t){var n,r,o;function a(t,n){return t.map(function(t){return t.state=n,e.portNodeKey.eval(t)})}function u(n){var r=a(o,"small");n.port.state="small",r.push(e.portNodeKey.eval(n.port)),t.animateNodes(r)}function c(e,t){return(l.allowParallel()||!r.some(function(n){return e.edges.indexOf(n)>=0&&t.edges.indexOf(n)>=0}))&&l.isValid()(e,t)}e.on("data.match-ports",function(e,t,o,a,i,u,c){u,n=c,r=i});var l={isValid:i(function(e,t){return t!==e&&t.name===e.name}),allowParallel:i(!1),hoverPort:function(e){if(e){if((o=n.filter(c.bind(null,e))).length)return a(o,"shimmer-medium")}else if(o)return a(o,"small");return null},startDragEdge:function(r){var i=a(o=n.filter(c.bind(null,r.port)),"shimmer");return o.length&&(t.enableHover(!1),r.port.state="large",i.push(e.portNodeKey.eval(r.port)),t.animateNodes(i)),console.log("valid targets",i),0!==o.length},changeDragTarget:function(e,n){var r,i,u=n&&c(e.port,n.port);return u?(r=a(o,"small"),n.port.state="large"):(r=a(o,"small"),i=t.animateNodes(r),r=a(o,"shimmer")),t.animateNodes(r,i),u},finishDragEdge:function(e,n){return t.enableHover(!0),u(e),Promise.resolve(c(e.port,n.port))},cancelDragEdge:function(e){return t.enableHover(!0),u(e),!0}};return l},r.match_opposites=function(t,n,r){var o,a,u;function c(e){return{x:e.node.cola.x+e.pos.x,y:e.node.cola.y+e.pos.y}}function l(e,t){return(d.allowParallel()||!a.some(function(n){return e.edges.indexOf(n)>=0&&t.edges.indexOf(n)>=0}))&&d.isValid()(e,t)}function s(e,t){t.forEach(function(e){e.edges.forEach(function(e){e.deleting=0})}),e&&e.port.edges.forEach(function(e){e.deleting=0})}r=Object.assign({multiplier:2,ease:e.ease("cubic")},r),t.cascade(100,!0,g(function(e){return r.ease(e.deleting||0)},n,f)),t.on("data.match-opposites",function(e,t,n,r,i,u,c){u,o=c,a=i});var d={isValid:i(function(e,n){return"in"===t.portName.eval(e)^"in"===t.portName.eval(n)}),allowParallel:i(!1),hoverPort:function(e){},startDragEdge:function(e){return u=o.filter(l.bind(null,e.port)),console.log("valid targets",u.map(t.portNodeKey.eval)),0!==u.length},dragCanvas:function(e,n){var o=u.map(function(e){var t=c(e);return{distance:Math.hypot(n[0]-t.x,n[1]-t.y),port:e}}).sort(function(e,t){return e.distance-t.distance}),a=c(o[0].port),i=c(e.port);o.forEach(function(e){e.port.edges.forEach(function(t){t.deleting=1-r.multiplier*e.distance/Math.hypot(a.x-i.x,a.y-i.y)})}),e.port.edges.forEach(function(e){e.deleting=1-r.multiplier*o[0].distance/Math.hypot(a.x-i.x,a.y-i.y)}),t.refresh()},changeDragTarget:function(e,n){var r=n&&l(e.port,n.port);return r&&(n.port.edges.forEach(function(e){e.deleting=1}),e.port.edges.forEach(function(e){e.deleting=1}),s(null,u.filter(function(e){return e!==n.port})),t.refresh()),r},finishDragEdge:function(e,n){if(l(e.port,n.port)){if(s(null,u.filter(function(e){return e!==n.port})),r.delete_edges){var o=e.port.edges.map(t.edgeKey.eval).concat(n.port.edges.map(t.edgeKey.eval));return r.delete_edges.deleteSelection(o)}return Promise.resolve(!0)}return s(e,u),Promise.resolve(!1)},cancelDragEdge:function(e){return s(e,u),!0},detectReversedEdge:function(e,n,r){return"in"===t.portName.eval(n)}};return d},r.wildcard_ports=function(e){var t=e.diagram,n=e.get_type||function(e){return e.orig.value.type},r=e.set_type||function(e,t){e.orig.value.type=t.orig.value.type},o=e.get_name||function(e){return e.orig.value.name},a=e.is_wild||function(e){return e.orig.value.wild},i=e.update_ports||function(){},u=e.get_linked||function(){return[]};function c(e,n){if(!t)return[];var r=t.nodeKey.eval(e),a=o(n),i=(u(e)||[]).find(function(e){return e.includes(a)});return i?i.filter(function(e){return e!==a}).map(function(e){return t.getPort(r,null,e)}):[]}function l(e){return e.every(function(e){return 0===e.edges.length})}return{isValid:function(e,t){return null===n(e)^null===n(t)||null!==n(e)&&n(e)===n(t)},copyLinked:function(e,t){c(e,t).forEach(function(e){r(e,t)})},copyType:function(e,t,o){return null===n(t)?(r(t,o),this.copyLinked(t.node,t),i()):null===n(o)&&(r(o,t),this.copyLinked(o.node,o),i()),Promise.resolve(e)},resetTypes:function(e){var n=t;return 2===arguments.length&&(n=arguments[0],e=arguments[1]),e.forEach(function(e){var t=n.getWholeEdge(e),o=n.edgeSourcePortName.eval(t),u=n.edgeTargetPortName.eval(t),s=!1,d=n.getPort(n.nodeKey.eval(t.source),null,o),f=c(t.source,d);a(d)&&1===d.edges.length&&l(f)&&(r(d,null),f.forEach(function(e){r(e,null),s=!0})),d=n.getPort(n.nodeKey.eval(t.target),null,u),f=c(t.target,d),a(d)&&1===d.edges.length&&l(f)&&(r(d,null),f.forEach(function(e){r(e,null),s=!0})),s&&i()}),Promise.resolve(e)}}},r.symbol_port_style=function(){var t,n,o,u={};function c(e){return e.named?e.name:u.parent().edgeKey.eval(e.edges[0])}function l(e){var t=u.color.eval(e);return t?u.colorScale()?u.colorScale()(t):t:"none"}function d(e){var t=Math.hypot(e.pos.x,e.pos.y),n=e.pos.x/t,r=e.pos.y/t,o=u.displacement.eval(e);return"translate("+(e.pos.x+o*n)+","+(e.pos.y+o*r)+")"}function f(t){u.symbolScale()||u.symbolScale(e.scale.ordinal().range(e.shuffle(u.content().enum())));var n=u.symbol.eval(t);return n&&(u.symbolScale()?u.symbolScale()(n):n)}function g(e){return e.vec[0]<0}function h(e){switch(e.state){case"large":return u.largeRadius.eval(e);case"medium":return u.mediumRadius.eval(e);case"small":default:return u.smallRadius.eval(e)}}function p(e){return/-medium$/.test(e.state)?u.mediumRadius.eval(e):u.largeRadius.eval(e)}function y(e){var t,n;return u.outlineFill.eval(e)?(t=u.outlineFillScale()||a,n=u.outlineFill.eval(e)):(t=u.parent().nodeFillScale()||a,n=u.parent().nodeFill.eval(e.node)),"none"===n?"none":t(n)}function m(e){return u.outlineStroke.eval(e)||u.parent().nodeStroke.eval(e.node)}function x(e){var t=u.outlineStrokeWidth.eval(e);return"number"==typeof t?t:u.parent().nodeStrokeWidth.eval(e.node)}return u.symbolScale=i(null),u.colorScale=i(e.scale.ordinal().range(e.shuffle(["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]))),u.symbol=u.portSymbol=i(c,!1),u.color=u.portColor=i(c,!1),u.outline=i(r.symbol_port_style.outline.circle()),u.content=i(r.symbol_port_style.content.d3symbol()),u.smallRadius=u.portRadius=i(7),u.mediumRadius=u.portHoverNodeRadius=i(10),u.largeRadius=u.portHoverPortRadius=i(14),u.displacement=u.portDisplacement=i(2),u.outlineFillScale=u.portBackgroundScale=i(null),u.outlineFill=u.portBackgroundFill=i(null),u.outlineStroke=u.portBackgroundStroke=i(null),u.outlineStrokeWidth=u.portBackgroundStrokeWidth=i(null),u.padding=u.portPadding=i(2),u.label=u.portLabel=u.portText=i(function(e){return e.name}),u.portLabelPadding=i({x:5,y:5}),u.cascade=v(u),u.animateNodes=function(r,o){var a=e.set(r),i=n.filter(function(e){return a.has(u.parent().nodeKey.eval(e))}),c=u.parent().selectNodePortsOfStyle(i,u.parent().portStyle.nameOf(this)),l=c.filter(function(e){return/^shimmer/.test(e.state)}),s=c.filter(function(e){return!/^shimmer/.test(e.state)});function d(){var e=l.transition().duration(1e3).ease("bounce");e.selectAll(".port-outline").call(u.outline().draw(function(e){return p(e)+u.portPadding.eval(e)})),e.selectAll(".port-symbol").call(u.content().draw(f,p));var t=e.transition().duration(1e3).ease("sin");t.selectAll(".port-outline").call(u.outline().draw(function(e){return u.smallRadius.eval(e)+u.portPadding.eval(e)})),t.selectAll(".port-symbol").call(u.content().draw(f,u.smallRadius.eval)),t.each("end",d)}l.size()&&(o?o.each("end",d):d());var g=s.transition().duration(250);function v(e){return"large"===e.state||"medium"===e.state}return g.selectAll(".port-outline").call(u.outline().draw(function(e){return h(e)+u.portPadding.eval(e)})),g.selectAll(".port-symbol").call(u.content().draw(f,h)),g.selectAll("text.port-label").attr({opacity:function(e){return v(e)?1:0},"pointer-events":function(e){return v(e)?"auto":"none"}}),g.selectAll("rect.port-label-background").attr("opacity",function(e){return v(e)?1:0}),n.filter(function(e){var n=t[u.parent().nodeKey.eval(e)];return n&&n.some(v)}).each(function(){this.parentNode.appendChild(this)}),c.filter(function(e){return"small"!==e.state}).each(function(){this.parentNode.appendChild(this)}),g},u.eventPort=function(){var t=e.select(e.event.target.parentNode);return"g"===e.event.target.parentNode.tagName&&t.classed("port")?t.datum():null},u.drawPorts=function(e,r,o){t=r,n=o;var a=e.data(function(e){return r[u.parent().nodeKey.eval(e)]||[]},c);a.exit().remove();var i=a.enter().append("g").attr({class:"port",transform:d});a.transition("port-position").duration(u.parent().stagedDuration()).delay(u.parent().stagedDelay(!1)).attr({transform:d});var h=a.selectAll(".port-outline").data(function(e){return"none"!==y(e)?[e]:[]});h.exit().remove();var p=h.enter().append(u.outline().tag()).attr({class:"port-outline",fill:y,"stroke-width":x,stroke:m});u.outline().init&&p.call(u.outline().init),p.call(u.outline().draw(function(e){return u.smallRadius.eval(e)+u.portPadding.eval(e)})),h.attr({fill:y,"stroke-width":x,stroke:m}),h.transition().duration(u.parent().stagedDuration()).delay(u.parent().stagedDelay(!1)).call(u.outline().draw(function(e){return u.smallRadius.eval(e)+u.portPadding.eval(e)}));i.append(u.content().tag()).attr("class","port-symbol").call(u.content().draw(f,u.smallRadius.eval));var v=a.select(".port-symbol");v.attr("fill",l),v.transition().duration(u.parent().stagedDuration()).delay(u.parent().stagedDelay(!1)).call(u.content().draw(f,u.smallRadius.eval));var _=a.selectAll("text.port-label").data(function(e){return u.portLabel.eval(e)?[e]:[]});_.exit().remove();var b=_.enter();return b.append("rect").attr({class:"port-label-background","pointer-events":"none"}),b.append("text").attr({class:"port-label","dominant-baseline":"middle","pointer-events":"none",cursor:"default",opacity:0}),_.each(function(e){e.offset=(g(e)?-1:1)*(u.largeRadius.eval(e)+u.portPadding.eval(e))}).attr({"text-anchor":function(e){return g(e)?"end":"start"},transform:function(e){return"translate("+e.offset+",0)"}}).text(u.portLabel.eval).each(function(e){e.bbox=s(this)}),a.selectAll("rect.port-label-background").attr({x:function(e){return(e.offset<0?e.offset-e.bbox.width:e.offset)-u.portLabelPadding.eval(e).x},y:function(e){return-e.bbox.height/2-u.portLabelPadding.eval(e).y},width:function(e){return e.bbox.width+2*u.portLabelPadding.eval(e).x},height:function(e){return e.bbox.height+2*u.portLabelPadding.eval(e).y},fill:"white",opacity:0}),u.enableHover(!0),u},u.enableHover=function(e){if(!o&&u.parent()){var r=u.parent().child("draw-graphs");r&&(o=r.conduct())}var a="grow-ports-"+u.parent().portStyle.nameOf(this);return e?(n.on("mouseover."+a,function(e){var n=u.parent().nodeKey.eval(e),r=u.eventPort();t[n]&&t[n].forEach(function(e){e.state=e===r?"large":r?"small":"medium"});var a=o&&o.hoverPort(r)||[];a.push(n),u.animateNodes(a)}),n.on("mouseout."+a,function(e){var n=u.parent().nodeKey.eval(e);t[n]&&t[n].forEach(function(e){e.state="small"});var r=o&&o.hoverPort(null)||[];r.push(n),u.animateNodes(r)})):(n.on("mouseover."+a,null),n.on("mouseout."+a,null)),u},u.parent=i(null),u},r.symbol_port_style.outline={},r.symbol_port_style.outline.circle=function(){return{tag:function(){return"circle"},draw:function(e){return function(t){t.attr("r",function(t){return e(t)})}}}},r.symbol_port_style.outline.square=function(){return{tag:function(){return"rect"},init:function(e){},draw:function(e){return function(t){t.attr({x:function(t){return-e(t)},y:function(t){return-e(t)},width:function(t){return 2*e(t)},height:function(t){return 2*e(t)}})}}}},r.symbol_port_style.outline.arrow=function(){var e=.75-Math.PI/8,t={tag:function(){return"path"},init:function(e){},draw:function(n){return function(r){r.attr("d",function(r){var o=n(r);return!t.outie()||t.outie()(r.orig)?"M"+-e*o+","+-o+" h"+o+" l"+o+","+o+" l"+-o+","+o+" h"+-o+" a"+o+","+o+" 0 1,1 0,"+-2*o:"M"+-(2-e)*o+","+-o+" h"+2*o+" a"+o+","+o+" 0 1,1 0,"+2*o+" h"+-2*o+" l"+o+","+-o+" l"+-o+","+-o})}},outie:i(null)};return t},r.symbol_port_style.content={},r.symbol_port_style.content.d3symbol=function(){return{tag:function(){return"path"},enum:function(){return e.svg.symbolTypes},draw:function(t,n){return function(r){r.attr("d",function(r){var o=t(r),a=n(r);return e.svg.symbol().type(o).size(a*a)()}),r.attr("transform",function(e){switch(t(e)){case"triangle-up":return"translate(0, -1)";case"triangle-down":return"translate(0, 1)";default:return null}})}}}},r.symbol_port_style.content.letter=function(){return{tag:function(){return"text"},enum:function(){return e.range(65,91).map(String.fromCharCode)},draw:function(e,t){return function(n){n.text(e).attr({"dominant-baseline":"middle","text-anchor":"middle"}),n.each(function(e){e.symbol_size||(e.symbol_size=s(this))}),n.attr("transform",function(e){return"scale("+2*t(e)/e.symbol_size.height+") translate("+[0,2].join(",")+")"})}}}},r.load_graph=function(){function t(e){return e?e.replace(/\?.*/,""):null}var n,r,o;if(n=arguments[0],3===arguments.length)r=arguments[1],o=arguments[2];else{if(2!==arguments.length)throw new Error("need two or three arguments");o=arguments[1]}r?queue().defer(e.json,n).defer(e.json,r).await(function(e,t,n){e?o(e,null):o(null,{nodes:t.results,edges:n.results})}):/\.json$/.test(t(n))?e.json(n,o):/\.gv|\.dot$/.test(t(n))?e.text(n,function(e,t,n){if(t)e(t,null);else{var r,o;if(graphlibDot.parse){var a=graphlibDot.parse(n),i=a.nodes();r=new Array(i.length),i.forEach(function(e,t){var n=r[t]=a._nodes[i[t]];n.id=t,n.name=e});var u=a.edges();o=[],u.forEach(function(e){var t=a._edges[e];o.push({source:a._nodes[t.u].id,target:a._nodes[t.v].id,sourcename:t.u,targetname:t.v})})}else a=graphlibDot.read(n),i=a.nodes(),r=new Array(i.length),i.forEach(function(e,t){var n=r[t]=a._nodes[i[t]];n.id=t,n.name=e}),o=[],a.edges().forEach(function(e){o.push({source:a._nodes[e.v].id,target:a._nodes[e.w].id,sourcename:e.v,targetname:e.w})});e(null,{nodes:r,links:o})}}.bind(null,o)):/\.psv$/.test(t(n))?e.dsv("|","text/plain")(n,G.bind(null,o)):/\.csv$/.test(t(n))&&e.csv(n,G.bind(null,o))},r.munge_graph=function(e,t,n,r){var o,a,i=t||"name",u=n||"sourcename",c=r||"targetname";if(!H(e)){var l=["database","response"],s=l.findIndex(function(t){return e[t]&&H(e[t])});if(s<0)throw new Error("couldn't find the data!");e=e[l[s]]}function d(e,t){return t.filter(function(t){return!!e[t]})}a=e.edges||e.links,o=e.nodes||e.vertices;var f=a[0];if(void 0===f[u]){var g=n?[n]:["source_ecomp_uid","node1","source","tail"],h=r?[r]:["target_ecomp_uid","node2","target","head"],p=["edge"];if(f.node0&&f.node1)u="node0",c="node1";else{var v=d(f,g);if(!v.length){if((s=p.findIndex(function(e){return f[e]&&d(f[e],g).length}))<0)throw n?new Error("sourceattr "+u+" didn't work"):new Error("didn't find any source attr");a=a.map(function(e){return e[p[s]]}),v=d(f=a[0],g)}if(v.length>1&&console.warn("found more than one possible source attr",v),u=v[0],!(v=d(f,h)).length)throw r&&!f[r]?new Error("targetattr "+c+" didn't work"):new Error("didn't find any target attr");v.length>1&&console.warn("found more than one possible target attr",v),c=v[0]}}var y=o[0];if(void 0===y[i]){var m=t?[t]:["ecomp_uid","id","_id"],x=["vertex"];if(!(v=d(y,m)).length){if((s=x.findIndex(function(e){return y[e]&&d(y[e],m).length}))<0)throw t?new Error("nodekeyattr "+i+" didn't work"):new Error("couldn't find the node data");o=o.map(function(e){return e[x[s]]}),v=d(y=o[0],m)}v.length>1&&console.warn("found more than one possible node key attr",v),i=v[0]}return{nodes:o,edges:a,nodekeyattr:i,sourceattr:u,targetattr:c}},r.flat_group=function(){var e={add:function(e,t){return t},remove:function(){return null},init:function(){return null}};function n(t,n){var r,o=t.dimension(n);return{crossfilter:t,dimension:o,group:(r=o.group().reduce(e.add,e.remove,e.init),{all:function(){return r.all().filter(function(e){return null!==e.value})}})}}return{make:function(e,r){return n(t(e),r)},another:function(e,t){return n(e,t)}}}();var Y=function(e,t,r,o,a,i){if(a=a||0,t.length>(r.valuesByAttr?1:0)){var u=t.shift(),c=[],s=[],d=e.map(function(e){var n,d=e[r.nestKey],f=r.nestKeysUnique?d:l();if(f&&(r.ancestorKeys?(i=i||{},u&&(i[u]=d),n=Object.assign({},i)):n={},n[r.nodeKey]=f,r.label&&r.labelFun&&(n[r.label]=r.labelFun(d,u,e)),r.level&&(n[r.level]=a+1),c.push(n),o)){var g={};g[r.edgeSource]=o,g[r.edgeTarget]=f,s.push(g)}var h=r.valuesByAttr?e[t[0]]:e.values;return Y(h,t.slice(0),r,f,a+1,Object.assign({},i))});return{nodes:Array.prototype.concat.apply(c,d.map(n.pluck("nodes"))),edges:Array.prototype.concat.apply(s,d.map(n.pluck("edges")))}}return{nodes:e.map(function(e){return e=Object.assign({},e),r.level&&(e[r.level]=a+1),e}),edges:e.map(function(e){var t={};return t[r.edgeSource]=o,t[r.edgeTarget]=e[r.nodeKey],t})}};return r.convert_tree=function(e,t,n){return n=Object.assign({nodeKey:"key",edgeKey:"key",edgeSource:"sourcename",edgeTarget:"targetname",nestKey:"key"},n),Array.isArray(e)?Y(e,t,n,n.root,0,n.inherit):(t=[""].concat(t),Y([e],t,n,n.root,0,n.inherit))},r.convert_nest=function(e,t,n,o,a,i,u){return r.convert_tree(e,t,{nodeKey:n,edgeSource:o,edgeTarget:a,root:i,inherit:u,ancestorKeys:!0,label:"name",labelFun:function(e,t,n){return t+":"+e},level:"_level"})},r.convert_adjacency_list=function(e,t,n){return{nodes:e,edges:Array.prototype.concat.apply([],e.map(function(e){return e[t.adjacencies].map(function(r){var o={};return n.edgeKey&&(o[n.edgeKey]=l()),o[n.edgeSource]=e[t.nodeKey],o[n.edgeTarget]=t.targetKey?r[t.targetKey]:r,n.adjacency&&(o[n.adjacency]=r),o})}))}},r.path_reader=function(e){var t,n,o,u=r.register_highlight_paths_group(e||"highlight-paths-group");function c(e,t,n){l.elementList.eval(e).forEach(function(r){var o,a;switch(l.elementType.eval(r)){case"node":o=l.nodeKey.eval(r),a=t[o]=t[o]||[];break;case"edge":o=l.edgeSource.eval(r)+"-"+l.edgeTarget.eval(r),a=n[o]=n[o]||[]}a.push(e)})}var l={pathList:i(a,!1),timeRange:i(null,!1),elementList:i(a,!1),elementType:i(null,!1),nodeKey:i(null,!1),edgeSource:i(null,!1),edgeTarget:i(null,!1),clear:function(){u.paths_changed({},{},[])},data:function(e){var r,a={},i={},s=[];l.pathList.eval(e).forEach(function(e){if(e._range=l.timeRange.eval(e)){if(!1===r)throw new Error("can't have a mix of ranged and non-ranged paths");r=!0}else{if(!0===r)throw new Error("can't have a mix of ranged and non-ranged paths");r=!1,c(e,a,i)}s.push(e)}),r?(t=s.map(function(e){var t=[e._range[0].getTime(),e._range[1].getTime()];return t.path=e,t}),n=lysenkoIntervalTree(t),o&&this.setTime(o)):(t=null,n=null,u.paths_changed(a,i,s))},getIntervals:function(){return t},setTime:function(e){if(e&&n){var t=[],r={},a={};n.queryPoint(e.getTime(),function(e){t.push(e.path),c(e.path,r,a)}),u.paths_changed(r,a,t)}o=e}};return l},r.path_selector=function(t,o,a,u){var c=r.register_highlight_paths_group(a||"highlight-paths-group"),l=e.select(t),s=[],d=null,f=null;function g(e){return function(t){return!!e&&e.indexOf(t)>=0}}function h(e){var t=g(e);return function(e){return!t(e)}}function p(e){var t=l.selectAll("span.path-selector").data(e);t.enter().append("span").attr("class","path-selector").style({"border-width":"1px","border-style":"solid","border-color":"grey","border-radius":"4px",display:"inline-block",padding:"4px",cursor:"pointer",margin:"5px"}),t.exit().transition(1e3).attr("opacity",0).remove(),t.text(function(e,t){return"path "+(t+1)+" ("+o.elementList.eval(e).length+")"}).on("mouseover",function(e){c.hover_changed([e])}).on("mouseout",function(e){c.hover_changed(null)}).on("click",function(e){var t,n;c.select_changed((n=[e],(t=f)?n?n.every(g(t))?t.filter(h(n)):t.concat(n.filter(h(t))):t:n))});var n=l.selectAll("span.no-paths").data(0===e.length?[0]:[]);n.exit().remove(),n.enter().append("span").attr("class","no-paths"),n.classed("error",!!m.error_text()).text(m.error_text()||(m.queried()?m.zero_text():m.default_text()))}function v(){var e=g(d);l.selectAll("span.path-selector").style({"border-color":function(t,n){return e(t)?"#e41a1c":"grey"},"border-width":function(t,n){return(e(t)?2:1)+"px"},padding:function(t,n){return(e(t)?3:4)+"px"}})}function y(){var e=g(f);l.selectAll("span.path-selector").style({"background-color":function(t,n){return e(t)?"#1c1ae6":"white"},color:function(t,n){return e(t)?"white":"black"}})}c.on("paths_changed.selector",function(e,t,n){d=f=null,s=n,m.redraw()}).on("hover_changed.selector",function(e){d=e,v()}).on("select_changed.selector",function(e){f=e,y()});var m={default_text:i("Nothing here"),zero_text:i("No paths"),error_text:i(null),queried:i(!1),redraw:function(){p(s),v(),y()},render:function(){return this.redraw(),this}};return n.registerChart(m,u),m},r.node_name=function(e){if(e<26)return String.fromCharCode(97+e);if(e<52)return String.fromCharCode(65+e-26);if(e<2704)return r.node_name(Math.floor(e/52))+r.node_name(e%52);throw new Error("no, that's too large")},r.node_object=function(e,t){return t=t||{},_.extend({id:e,name:r.node_name(e)},t)},r.edge_object=function(e,t,n,r){return r=r||{},_.extend({source:t,target:n,sourcename:e(t),targetname:e(n)},r)},r.generate=function(e,t,n,o){var a,i,u,c,l=n.nodePrefix||"",s=function(e){return a[e].name},d=t[0],f=n.linkLength||30;switch(e){case"clique":case"cliquestf":for(a=new Array(d),i=[],u=0;u<d;++u)for(a[u]=r.node_object(u,{circle:"A",name:l+r.node_name(u)}),c=0;c<u;++c)i.push(r.edge_object(s,u,c,{notLayout:!0,undirected:!0}));if("cliquestf"===e)for(u=0;u<d;++u)a[u+d]=r.node_object(u+d),a[u+2*d]=r.node_object(u+2*d),i.push(r.edge_object(s,u,u+d,{undirected:!0})),i.push(r.edge_object(s,u,u+2*d,{undirected:!0}));break;case"wheel":for(a=new Array(d),u=0;u<d;++u)a[u]=r.node_object(u,{name:l+r.node_name(u)});var g=(i=r.wheel_edges(s,_.range(d),d*f/2))[0].distance;for(u=0;u<t[1];++u)for(c=0;c<d;++c){var h,p=c,v=(c+1)%d;u%2==1&&(h=p,p=v,v=h),i.push(r.edge_object(s,p,v,{distance:g,par:u+2}))}break;default:throw new Error("unknown generation type "+e)}o(null,{nodes:a,links:i})},r.wheel_edges=function(e,t,n){for(var o=t.length,a=[],i=Math.floor(o/2),u=2*n*Math.sin(Math.PI/o),c=2*n*Math.sin(i*Math.PI/o),l=0;l<o;++l)a.push(r.edge_object(e,t[l],t[(l+1)%o],{distance:u}));for(l=0;l<o/2;++l)a.push(r.edge_object(e,t[l],t[(l+i)%o],{distance:c})),o%2&&l!=Math.floor(o/2)&&a.push(r.edge_object(e,t[l],t[(l+o-i)%o],{distance:c}));return a},r.random_graph=function(e){e=Object.assign({ncolors:5,ndashes:4,nodeKey:"key",edgeKey:"key",sourceKey:"sourcename",targetKey:"targetname",colorTag:"color",dashTag:"dash",nodeKeyGen:function(e){return"n"+e},edgeKeyGen:function(e){return"e"+e},newComponentProb:.1,newNodeProb:.9,removeEdgeProb:.75,log:!1},e),isNaN(e.newNodeProb)&&(e.newNodeProb=.9),e.newNodProb<=0&&(e.newNodeProb=.1);var t=[],n=[];function r(){var n={};return n[e.nodeKey]=e.nodeKeyGen(t.length),n[e.colorTag]=Math.floor(Math.random()*e.ncolors),t.push(n),n}function o(){return t[Math.floor(Math.random()*t.length)]}return{nodes:function(){return t},edges:function(){return n},generate:function(a){for(;a-- >0;){var i,u,c=Math.random();if(i=!t.length||c<e.newComponentProb?r():o(),u=c<e.newNodeProb?r():o(),i&&u){var l={};l[e.edgeKey]=e.edgeKeyGen(n.length),l[e.sourceKey]=i[e.nodeKey],l[e.targetKey]=u[e.nodeKey],l[e.dashTag]=Math.floor(Math.random()*e.ndashes),e.log&&console.log(i[e.nodeKey]+" -> "+u[e.nodeKey]),n.push(l)}}},remove:function(r){for(;r-- >0;){if(Math.random()<e.removeEdgeProb)n.splice(Math.floor(Math.random()*n.length),1);else{var o=t[Math.floor(Math.random()*t.length)],a=[];n.forEach(function(t,n){t[e.sourceKey]!==o[e.nodeKey]&&t[e.targetKey]!==o[e.nodeKey]||a.push(n)}),a.reverse().forEach(function(e){n.splice(e,1)})}}}}},r.line_breaks=function(e,t){var n=new RegExp(e,"g");return function(e){for(var r,o,a=e.key,i="",u=[],c=0;o=(r=n.exec(a))?a.slice(c,n.lastIndex):a.slice(c),i.length+o.length>t&&i.length>0&&(u.push(i),i=""),i+=o,c=n.lastIndex,null!==r;);return u.push(i),u}},r.build_type_graph=function(e,t,n,r,o,a){var i={},u={},c={};return e.forEach(function(e){i[n(e)]=e;var t=r(e);u[t]||(u[t]={type:t})}),t.forEach(function(e){var t,n,u=o(e),l=a(e);if(!(t=i[u]))throw new Error("source key "+u+" not found!");if(!(n=i[l]))throw new Error("target key "+l+" not found!");var s=r(t)+"/"+r(n);c[s]||(c[s]={type:s,source:r(t),target:r(n)})}),{nodes:Object.keys(u).map(function(e){return u[e]}),edges:Object.keys(c).map(function(e){return c[e]})}},r.d3=e,r.crossfilter=t,r.dc=n,r}if("function"==typeof define&&define.amd)define(["d3","crossfilter","dc"],e);else if("object"==typeof module&&module.exports){var t=require("d3"),n=require("crossfilter");"function"!=typeof n&&(n=n.crossfilter);var r=require("dc");module.exports=e(t,n,r)}else this.dc_graph=e(d3,crossfilter,dc)}();
//# sourceMappingURL=dc.graph.min.js.map