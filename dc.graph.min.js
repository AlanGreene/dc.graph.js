/*!
 *  dc.graph 0.1.1
 *  http://dc-js.github.io/dc.graph.js/
 *  Copyright 2015-2016 AT&T Intellectual Property & the dc.graph.js Developers
 *  https://github.com/dc-js/dc.graph.js/blob/master/AUTHORS
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 */

!function(){function a(a,b,c){"use strict";function d(a,b){function c(a,b){return function(c,d){return a(c)?b(c):d()}}var d={};for(var e in b)d[e]=c(a,g(b[e]));return d}function e(a,b){return function(){return a(b.apply(null,arguments))}}function f(a){return a.orig}function g(a){return D.functor_wrap(a,f)}function h(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function i(a,b,c){for(var d=["M",a[0].x,",",a[0].y],e=b,f=!1,g=1;g<a.length;++g)(isNaN(a[g].x)||isNaN(a[g].y))&&(f=!0),d.push(e===b?G[b]:" ",a[g].x,",",a[g].y),0===--e&&(e=b);return e!=b&&console.log("warning: pts.length didn't match bezian degree",a,b),c&&d.push("Z"),d.join("")}function j(a,b,c,d){function e(b){var e=c(b);a[e]||(a[e]={});var g=a[e];return d(g,b),f[e]=!0,g}var f={},g=b.map(e);for(var h in a)f[h]||delete a[h];return g}function k(a,b,c,d){var e=Math.tan(Math.atan2(d,c));e*=e;var f={x:a*b/Math.sqrt(b*b+a*a*e),y:a*b/Math.sqrt(a*a+b*b/e)};return 0>c&&(f.x=-f.x),0>d&&(f.y=-f.y),f}function l(a,b,c){return b>=a-H&&c+H>=b}function m(a,b,c,d,e,f,g,h){var i=((a*d-b*c)*(e-g)-(a-c)*(e*h-f*g))/((a-c)*(f-h)-(b-d)*(e-g)),j=((a*d-b*c)*(f-h)-(b-d)*(e*h-f*g))/((a-c)*(f-h)-(b-d)*(e-g));if(isNaN(i)||isNaN(j))return!1;if(a>=c){if(!l(c,i,a))return!1}else if(!l(a,i,c))return!1;if(b>=d){if(!l(d,j,b))return!1}else if(!l(b,j,d))return!1;if(e>=g){if(!l(g,i,e))return!1}else if(!l(e,i,g))return!1;if(f>=h){if(!l(h,j,f))return!1}else if(!l(f,j,h))return!1;return{x:i,y:j}}function n(a,b,c,d,e){for(var f=0;f<a.length;++f){var g=f===a.length-1?0:f+1,h=m(a[f].x,a[f].y,a[g].x,a[g].y,b,c,d,e);if(h)return h}return null}function o(a,b,c,d){switch(b.dcg_shape.shape){case"ellipse":return k(b.dcg_rx,b.dcg_ry,c,d);case"polygon":return n(b.dcg_points,0,0,c,d)}}function p(a){var b=a.shape;if("random"===a.shape){var c=Object.keys(I);b=a._shape=c[Math.floor(Math.random()*c.length)]}return(I[b]||function(){throw new Error("unknown shape "+a.shape)})(a)}function q(a){return function(b){var c=a.nodeShape.eval(b)||J;b.dcg_shape=p(c),b.dcg_shape["abstract"]=c}}function r(a){return function(b){var c=a.nodeShape.eval(b)||J,d=b.dcg_shape["abstract"];return c.shape!==d.shape?!0:"polygon"===c.shape?c.shape.sides!==d.sides||c.shape.skew!==d.skew||c.shape.distortion!==d.distortion||c.shape.rotation!==d.rotation:!1}}function s(){return function(a){var b,c=a.dcg_shape.shape;switch(c){case"ellipse":b="ellipse";break;case"polygon":b="path";break;default:throw new Error("unknown shape "+c)}return document.createElementNS("http://www.w3.org/2000/svg",b)}}function t(a){return function(b){var c,d=a.nodeRadius.eval(b),e=2*d+a.nodePadding();a.nodeFitLabel.eval(b)&&(c=this.getBBox());var f=0;if(c&&c.width&&c.height){d=Math.max(d,c.height/2+5);var g=c.height/2/d,h=c.width/2/Math.sqrt(1-g*g);f=2*h+a.nodePadding(),b.dcg_rx=Math.max(h,d),b.dcg_ry=d,"polygon"===b.dcg_shape.shape&&(b.dcg_rx/=Math.cos(Math.PI/(b.dcg_shape.sides||4)))}else b.dcg_rx=b.dcg_ry=d;b.cola.width=Math.max(f,e),b.cola.height=e}}function u(){return{rx:function(a){return a.dcg_rx},ry:function(a){return a.dcg_ry}}}function v(){return{d:function(a){var b=a.dcg_shape,c=b.sides||4,d=b.skew||0,e=b.distortion||0,f=b.rotation||0,g=c%2?0:.5,h=[];f=f/360+.25;for(var j=0;c>j;++j){var k=-((j+g)/c+f)*Math.PI*2,l=a.dcg_rx*Math.cos(k),m=a.dcg_ry*Math.sin(k);l*=1+e*((a.dcg_ry-m)/a.dcg_ry-1),l-=d*m/2,h.push({x:l,y:m})}return a.dcg_points=h,i(h,1,!0)}}}function w(b){return function(c){var d=a.select(this);switch(c.dcg_shape.shape){case"ellipse":d.attr(u(b,c));break;case"polygon":d.attr(v(b,c));break;default:throw new Error("unknown shape "+c.dcg_shape.shape)}}}function x(a,b,c){var d=100;if(a(b).val>=0)throw new Error("f(a) must be less than 0");if(a(c).val<=0)throw new Error("f(b) must be greater than 0");for(;;){if(!--d)throw new Error("patience ran out");var e=(b+c)/2,f=a(e),g=f.val;if(Math.abs(g)<.5)return f;g>0?c=e:b=e}}function y(a,b,c,d,e,f,g,h,i,j,k,l){var m,n,p,q,r,s;if(h){var t=function(b,c){return o(a,b,1e3*Math.cos(c),1e3*Math.sin(c))},u=function(a,b,c){return function(d){var e=t(a,d);return e?{port:e,val:Math.hypot(e.x-b.x,e.y-b.y)-c,ang:d}:{port:{x:0,y:0},val:0,ang:d}}},v=Math.atan2(h.sourcePort.y,h.sourcePort.x),w=Math.atan2(h.targetPort.y,h.targetPort.x),y=x(u(b,h.sourcePort,j),v,v+2*i*j/k),z=x(u(c,h.targetPort,j),w,w-2*i*j/k);p=y.port,q=z.port;var A=Math.hypot(p.x,p.y),B=Math.hypot(q.x,q.y),C=A+k/2,D=B+l/2,E=d+C*Math.cos(y.ang),F=e+C*Math.sin(y.ang),G=f+D*Math.cos(z.ang),H=g+D*Math.sin(z.ang);r=[{x:d+p.x,y:e+p.y},{x:E,y:F},{x:G,y:H},{x:f+q.x,y:g+q.y}],s=3}else m=f-d,n=g-e,p=o(a,b,m,n),q=o(a,c,-m,-n),p||(p={x:0,y:0}),q||(q={x:0,y:0}),r=[{x:d+p.x,y:e+p.y},{x:f+q.x,y:g+q.y}],s=1;return{sourcePort:p,targetPort:q,points:r,bezDegree:s}}function z(a,b){for(var c=[],d=1;d<a.length;d++){var e=a[d-1],f=a[d];c.push({x:e.x+(f.x-e.x)*b,y:e.y+(f.y-e.y)*b})}return c}function A(a,b){for(var c=[a],d=1;d<a.length;d++)c.push(z(c[c.length-1],b));return c}function B(a,b){var c=A(a,b);return c[c.length-1][0]}function C(a){var b=function(){return{type:"alignment",axis:a}};return b.listname="offsets",b.wrap=function(a){return{node:a,offset:0}},b}var D={version:"0.1.1"},E=function(a,b){void 0===b?b=f:b===!1&&(b=F);var c=a,d=null,e=[],g=function(a){return arguments.length?(d&&d(a),c=a,this):c};return g.cascade=function(a,b){for(var c=0;c<e.length;++c){if(e[c].n===a)return b?e[c].f=b:delete e[c],g;if(e[c].n>a)return e.splice(c,0,{n:a,f:b}),g}return e.push({n:a,f:b}),g},g._eval=function(a,c){if(0!==c&&e.length){var d=e[c-1];return d.f(a,function(){return g._eval(a,c-1)})}return D.functor_wrap(g(),b)(a)},g.eval=function(a){return g._eval(a,e.length)},g.react=function(a){return arguments.length?(d=a,this):d},g},F=function(a){return a};D.functor_wrap=function(a,b){return"function"==typeof a?b?function(c){return a(b(c))}:a:function(){return a}};var G={1:"L",2:"Q",3:"C"};Math.hypot=Math.hypot||function(){for(var a=0,b=arguments.length,c=0;b>c;c++){if(arguments[c]===1/0||arguments[c]===-(1/0))return 1/0;a+=arguments[c]*arguments[c]}return Math.sqrt(a)},D.depth_first_traversal=function(a,b,c,d,e,f,g,h,i){return function(j,k,l){function m(a,b){var c=j.nodeKey.eval(a);return r[c]?void(i&&i(a,o[c])):(q[b]||(q[b]=[]),e&&e(a,b,q[b]),q[b].push(a),r[c]=!0,p[c]&&p[c].forEach(function(a,c){c&&f&&f(!1),g&&g(),m(a.target,b+1)}),void(h&&h(a)))}a&&a(),d&&(l=l.filter(function(a){return d(a.orig)}));var n,o={},p=l.reduce(function(a,b){var c=j.edgeSource.eval(b),d=j.edgeTarget.eval(b);return a[c]||(a[c]=[]),a[c].push(b),o[d]=(o[d]||0)+1,a},{}),q=[],r={};n=k.filter(b?function(a){return b(a.orig)}:function(a){return!o[j.nodeKey.eval(a)]}),n.forEach(function(a,b){b&&f&&f(!0),g&&g(),m(a,c?c(a.orig):0)})}};var H=1e-7,I={ellipse:function(){return{shape:"ellipse"}},egg:function(){return{shape:"polygon",sides:100,distortion:-.25}},triangle:function(){return{shape:"polygon",sides:3}},diamond:function(){return{shape:"polygon",sides:4,rotation:45}},trapezium:function(){return{shape:"polygon",sides:4,distortion:-.5}},parallelogram:function(){return{shape:"polygon",sides:4,skew:.5}},pentagon:function(){return{shape:"polygon",sides:5}},hexagon:function(){return{shape:"polygon",sides:6}},septagon:function(){return{shape:"polygon",sides:7}},octagon:function(){return{shape:"polygon",sides:8}},invtriangle:function(){return{shape:"polygon",sides:3,rotation:180}},invtrapezium:function(){return{shape:"polygon",sides:4,distortion:.5}},square:function(){return{shape:"polygon",sides:4}},polygon:function(a){return{shape:"polygon",sides:a.sides,skew:a.skew,distortion:a.distortion,rotation:a.rotation}}},J={shape:"ellipse"};return D.diagram=function(d,h){function k(){S||(S=new Worker("js/dc.graph-worker.js")),S.postMessage({command:"init",args:{width:M.width(),height:M.height(),handleDisconnected:M.handleDisconnected(),lengthStrategy:M.lengthStrategy(),baseLength:M.baseLength(),flowLayout:M.flowLayout()}})}function l(a){return!!a.source&&!!a.target}function m(){return"none"!==M.stageTransitions()?M.transitionDuration()/2:M.transitionDuration()}function n(a){return"none"===M.stageTransitions()||"modins"===M.stageTransitions()==!a?0:M.transitionDuration()/2}function o(a){T.end(a),Z=!1,$&&($=!1,window.setTimeout(function(){M.startLayout()},0))}function p(a,b,c,d,e,f){if(!a.ports[b]){var g=a.source.dcg_ry+M.nodeStrokeWidth.eval(a.source)/2,h=a.target.dcg_ry+M.nodeStrokeWidth.eval(a.target)/2;a.ports[b]=new Array(a.ports.n);for(var i=0;i<a.ports.n;++i){var j=!!(i%2)==e>c?-1:1,k=Math.floor((i+1)/2),l=k?a.ports[b][i>2?i-2:0].path:null,m=y(M,a.source,a.target,c,d,e,f,l,j,M.parallelEdgeOffset(),g,h),n=(m.points[0],m.points[m.points.length-1]),o=B(m.points,.75);a.ports[b][i]={path:m,orient:Math.atan2(n.y-o.y,n.x-o.x)+"rad"}}}return a.ports[b][a.parallel].path}function u(a){p(a,"old",a.source.prevX||a.source.cola.x,a.source.prevY||a.source.cola.y,a.target.prevX||a.target.cola.x,a.target.prevY||a.target.cola.y)}function v(a){var b=p(a,"new",a.source.cola.x,a.source.cola.y,a.target.cola.x,a.target.cola.y),c=b.points[0],d=b.points[b.points.length-1];a.length=Math.hypot(d.x-c.x,d.y-c.y)}function x(a){return function(b){var c=b.ports[a][b.parallel].path;return i(c.points,c.bezDegree)}}function z(a,b){a.every(function(a){return 0===a.size()})&&b();var c=0;a.forEach(function(a){a.each(function(){++c}).each("end.all",function(){--c||b()})})}function A(b,c,d,e,f){console.assert(Z),console.assert(d.data().every(l));var g={};c.each(function(a){g[M.nodeKey.eval(a)]=!0}).attr("transform",function(a){return"translate("+a.cola.x+","+a.cola.y+")"});var h=b.transition().duration(m()).delay(function(a){return n(g[M.nodeKey.eval(a)])}).attr("opacity","1").attr("transform",function(a){return"translate("+a.cola.x+","+a.cola.y+")"}).each("end.record",function(a){a.prevX=a.cola.x,a.prevY=a.cola.y});d.each(function(a){a.ports["new"]=null,a.ports.old=null});var j={};e.each(function(a){j[M.edgeKey.eval(a)]=!0}).each(function(b){var c;"modins"===M.stageTransitions()?(v(b),c="new"):(u(b),c="old"),M.edgeArrowhead.eval(b)&&a.select("#"+M.arrowId(b,"head")).attr("orient",function(){return b.ports[c][b.parallel].orient})}).attr("d",x("modins"===M.stageTransitions()?"new":"old"));var k=d.each(v).each(function(b){M.edgeArrowhead.eval(b)&&a.select("#"+M.arrowId(b,"head")).transition().duration(m()).delay(n(!1)).attr("orient",function(){return b.ports["new"][b.parallel].orient})}).transition().duration(m()).delay(function(a){return n(j[M.edgeKey.eval(a)])}).attr("opacity",M.edgeOpacity.eval).attr("d",function(a){var b="insmod"===M.stageTransitions()&&j[M.edgeKey.eval(a)]?"old":"new";return x(b)(a)});"insmod"===M.stageTransitions()&&(a.timer.flush(),k=k.transition().duration(m()).attr("d",x("new"))),d.each(function(b){var c=M.textpathId(b),d=b.ports["new"][b.parallel].path,e=b.target.cola.x<b.source.cola.x?d.points.slice(0).reverse():d.points;a.select("#"+c).attr("d",function(){return i(e,d.bezDegree)})}),M.showLayoutSteps()||z([h,k],function(){o(!0)}),f.attr("d",x("new"))}function C(a,b,c){var d=M.arrowId(a,b),e=M.addOrRemoveDef(d,!!c,"svg:marker");return c&&e.attr("viewBox","0 -5 10 10").attr("refX",Y[c].refX).attr("refY",Y[c].refY).attr("markerUnits","userSpaceOnUse").attr("markerWidth",Y[c].width*M.edgeArrowSize.eval(a)).attr("markerHeight",Y[c].height*M.edgeArrowSize.eval(a)).attr("stroke",M.edgeStroke.eval(a)).attr("fill",M.edgeStroke.eval(a)).call(Y[c].drawFunction),c?d:null}function G(){P.attr("transform","translate("+a.event.translate+") scale("+a.event.scale+")")}function H(){N&&N.attr("width",M.width()).attr("height",M.height())}function I(){return N=M.root().append("svg"),H(),O=N.append("svg:defs"),M.mouseZoomable()&&N.call(a.behavior.zoom().on("zoom",G)),N}var K,L,M={},N=null,O=null,P=null,Q=null,R=null,S=null,T=a.dispatch("end","start","drawn"),U={},V={},W={},X={},Y={},Z=!1;M.width=E(200).react(H),M.height=E(200).react(H),M.root=E(null).react(function(a){a.empty()&&console.log("Warning: parent selector "+d+" doesn't seem to exist")}),M.mouseZoomable=E(!0),M.nodeDimension=E(),M.nodeGroup=E(),M.edgeDimension=E(),M.edgeGroup=E(),M.nodeKey=M.nodeKeyAccessor=E(function(a){return a.key}),M.edgeKey=M.edgeKeyAccessor=E(function(a){return a.key}),M.edgeSource=M.sourceAccessor=E(function(a){return a.value.sourcename}),M.edgeTarget=M.targetAccessor=E(function(a){return a.value.targetname}),M.nodeRadius=M.nodeRadiusAccessor=E(25),M.nodeStrokeWidth=M.nodeStrokeWidthAccessor=E(1),M.nodeStroke=M.nodeStrokeAccessor=E("black"),M.nodeFillScale=E(null),M.nodeFill=M.nodeFillAccessor=E("white"),M.nodePadding=E(6),M.nodeLabel=M.nodeLabelAccessor=E(function(a){return a.value.label||a.value.name}),M.nodeLabelFill=M.nodeLabelFillAccessor=E(null),M.nodeFitLabel=M.nodeFitLabelAccessor=E(!0),M.nodeShape=E(J),M.nodeTitle=M.nodeTitleAccessor=E(function(a){return M.nodeKeyAccessor()(a)}),M.nodeOrdering=E(null),M.nodeFixed=M.nodeFixedAccessor=E(null),M.edgeStroke=M.edgeStrokeAccessor=E("black"),M.edgeStrokeWidth=M.edgeStrokeWidthAccessor=E(1),M.edgeOpacity=M.edgeOpacityAccessor=E(1),M.edgeLabel=M.edgeLabelAccessor=E(function(a){return M.edgeKey()(a)}),M.edgeArrowhead=M.edgeArrowheadAccessor=E("vee"),M.edgeArrowtail=M.edgeArrowtailAccessor=E(null),M.edgeArrowSize=E(1),M.edgeIsLayout=M.edgeIsLayoutAccessor=E(function(a){return!a.value.notLayout}),M.lengthStrategy=E("symmetric"),M.edgeLength=M.edgeDistanceAccessor=E(function(a){return a.value.distance}),M.flowLayout=E(null),M.baseLength=E(30),M.highlightNeighbors=E(!1),M.transitionDuration=E(500),M.stageTransitions=E("none"),M.deleteDelay=E(0),M.groupConnected=E(!1),M.timeLimit=E(0),M.constrain=E(function(){return[]}),M.parallelEdgeOffset=E(10),M.edgeOrdering=E(null),M.cascade=function(a,b){for(var c in b)M[c].cascade(a,b[c]);return M},M.initLayoutOnRedraw=E(!1),M.layoutUnchanged=E(!1),M.relayout=function(){return K=L=null,this},M.initialLayout=E(null),M.initialOnly=E(!1),M.induceNodes=E(!1),M.showLayoutSteps=E(!1),M.legend=E(null).react(function(a){a.parent(M)}),M.child=function(a,b){return 1===arguments.length?X[a]:X[a]===b?M:(X[a]&&X[a].parent(null),X[a]=b,b&&b.parent(M),M)},M.edgeId=function(a){return"edge-"+M.edgeKey.eval(a).replace(/[^\w-_]/g,"-")},M.arrowId=function(a,b){return"arrow-"+b+"-"+M.edgeId(a)},M.textpathId=function(a){return"textpath-"+M.edgeId(a)},M.getNode=function(a){return U[a]?U[a].orig:null},M.handleDisconnected=E(!0),M._enterNode=function(a){return M.nodeTitle()&&a.append("title"),a.each(q(M)),a.append("text").attr("class","node-label").attr("fill",M.nodeLabelFill.eval),a.append(s(M)).attr("class","node-shape"),M},M._updateNode=function(a){var b=a.filter(r(M));b.select(".node-shape").remove(),b.each(q(M)),b.insert(s(M),":first-child").attr("class","node-shape"),a.select("title").text(M.nodeTitle.eval);var c=a.select("text.node-label"),d=c.selectAll("tspan").data(function(a){var b=M.nodeLabel.eval(a);if(!b)return[];"string"==typeof b&&(b=[b]);var c=b.length%2?.3-(b.length-1)/2:1-b.length/2;return b.map(function(a,b){return{line:a,ofs:(0==b?c:1)+"em"}})});return d.enter().append("tspan").attr("x",0).attr("dy",function(a){return a.ofs}),d.text(function(a){return a.line}),c.each(t(M)),a.select(".node-shape").each(w(M)).attr({stroke:M.nodeStroke.eval,"stroke-width":M.nodeStrokeWidth.eval,fill:e(M.nodeFillScale()||F,M.nodeFill.eval)}),M},M.isRunning=function(){return Z};var $=!1;return M.redraw=function(){return Z?($=!0,this):M.startLayout()},M.startLayout=function(){function c(a,b){a.forEach(function(a){var b=U[a.dcg_nodeKey];b.cola.x=a.x,b.cola.y=a.y}),b.forEach(function(a){V[a.dcg_edgeKey]})}var d=M.nodeGroup().all(),e=M.edgeGroup().all();if(Z)throw new Error("dc_graph.diagram.redraw already running!");Z=!0,S&&S.postMessage({command:"stop"}),M.initLayoutOnRedraw()&&k(),M.nodeOrdering()&&(d=b.quicksort.by(M.nodeOrdering())(d.slice(0),0,d.length)),M.edgeOrdering()&&(e=b.quicksort.by(M.edgeOrdering())(e.slice(0),0,e.length));var h=j(U,d,function(a){return M.nodeKey()(a)},function(a,b){a.orig=b,a.cola=a.cola||{},a.cola.dcg_nodeKey=M.nodeKey.eval(a),M.nodeFixed()&&(a.cola.dcg_nodeFixed=M.nodeFixed.eval(a))}),i=j(V,e,function(a){return M.edgeKey()(a)},function(a,b){a.orig=b,a.cola=a.cola||{},a.cola.dcg_edgeKey=M.edgeKey.eval(a),a.cola.dcg_edgeSource=M.edgeSource.eval(a),a.cola.dcg_edgeTarget=M.edgeTarget.eval(a),a.source=U[a.cola.dcg_edgeSource],a.target=U[a.cola.dcg_edgeTarget],a.cola.dcg_edgeLength=M.edgeLength.eval(a)});if(i=i.filter(l),i=i.filter(function(a){return a.source!==a.target}),M.induceNodes()){var n={};i.forEach(function(a){n[a.cola.dcg_edgeSource]=!0,n[a.cola.dcg_edgeTarget]=!0}),h=h.filter(function(a){return n[a.cola.dcg_nodeKey]});for(var p in U)n[p]||delete U[p]}if(h.forEach(function(a,b){a.index=b}),W={nnodes:h.length,nedges:i.length},M.parallelEdgeOffset()){for(var q=new Array(h.length),r=0;r<q.length;++r){q[r]=new Array(q.length);for(var s=0;s<q.length;++s)q[r][s]={n:0,ports:{}}}for(i.forEach(function(a){var b=Math.min(a.source.index,a.target.index),c=Math.max(a.source.index,a.target.index);a.parallel=q[b][c].n++,a.ports=q[b][c].ports}),r=0;r<q.length;++r)for(s=0;s<q.length;++s)q[r][s].n&&(q[r][s].ports.n=q[r][s].n)}M.initialLayout()&&M.initialLayout()(M,h,i);var t=R.selectAll(".edge").data(i,M.edgeKey.eval),u=t.enter().append("svg:path").attr({"class":"edge",id:M.edgeId,opacity:0});t.exit().transition().duration(m()).delay(M.deleteDelay()).attr("opacity",0).each(function(a){C(a,"head",null),C(a,"head",null)}).remove();var v=R.selectAll(".edge-hover").data(i,M.edgeKey.eval),w=v.enter().append("svg:path").attr("class","edge-hover").attr("opacity",0).attr("stroke","green").attr("stroke-width",10).on("mouseover",function(b){a.select("#"+M.edgeId(b)+"-label").attr("visibility","visible")}).on("mouseout",function(b){a.select("#"+M.edgeId(b)+"-label").attr("visibility","hidden")});v.exit().remove();var x=R.selectAll(".edge-label").data(i,M.edgeKey.eval),y=x.enter().append("text").attr("id",function(a){return M.edgeId(a)+"-label"}).attr("visibility","hidden").attr({"class":"edge-label","text-anchor":"middle",dy:-2}).append("textPath").attr("startOffset","50%").attr("xlink:href",function(a){var b=M.textpathId(a);return M.addOrRemoveDef(b,!0,"svg:path"),"#"+b});x.each(function(a){a.dcg_bbox=null}).selectAll("textPath").text(function(a){return M.edgeLabel.eval(a)}),x.exit().transition().duration(m()).delay(M.deleteDelay()).attr("opacity",0).remove();var z=Q.selectAll(".node").data(h,M.nodeKey.eval),B=z.enter().append("g").attr("class","node").attr("opacity","0");M._enterNode(B),T.drawn(z,t),M.refresh(z,t),z.exit().transition().duration(m()).delay(M.deleteDelay()).attr("opacity",0).remove();var E=!1;if(!M.layoutUnchanged()){var F=JSON.stringify(h.map(f)),G=JSON.stringify(i.map(f));F===K&&G===L&&(E=!0),K=F,L=G}var H=M.constrain()(M,h,i);H.forEach(function(a){if(a.type)switch(a.type){case"alignment":a.offsets.forEach(function(a){a.node=U[a.node].index});break;case"circle":a.nodes.forEach(function(a){a.node=U[a.node].index})}else a.axis&&(a.left=U[a.left].index,a.right=U[a.right].index)});var I=i.filter(M.edgeIsLayout.eval),J=(i.filter(function(a){return!M.edgeIsLayout.eval(a)}),H.filter(function(a){return"circle"===a.type}));H=H.filter(function(a){return"circle"!==a.type}),J.forEach(function(a){var b=(a.distance||4*M.baseLength())/(2*Math.sin(Math.PI/a.nodes.length)),c=a.nodes.map(function(a){return a.node}),d=function(a){return M.nodeKey.eval(h[a])},e=D.wheel_edges(d,c,b).map(function(a){var b={internal:a};return b.source=U[a.sourcename],b.target=U[a.targetname],b});I=I.concat(e)});var N=H.filter(function(a){return"ordering"===a.type});if(H=H.filter(function(a){return"ordering"!==a.type}),N.forEach(function(a){var c=a.nodes.map(function(a){return U[a]});if(a.ordering){var d=b.quicksort.by(g(a.ordering));c=d(c,0,c.length)}var e;c.forEach(function(b,c){0===c?e=b:H.push({left:e.index,right:(e=b).index,axis:a.axis,gap:a.gap})})}),M.legend()&&M.legend().redraw(),E)return Z=!1,T.end(!1),this;var O=Date.now();return S.onmessage=function(a){var b=a.data.args;switch(a.data.response){case"tick":var d=Date.now()-O;c(b.nodes,b.edges),M.showLayoutSteps()&&A(z,B,t,u,v,w,x,y),($||M.timeLimit()&&d>M.timeLimit())&&(console.log("cancelled"),S.postMessage({command:"stop"}));break;case"end":M.showLayoutSteps()?o(!0):A(z,B,t,u,v,w,x,y);break;case"start":console.log("COLA START"),T.start()}},T.start(),S.postMessage({command:"data",args:{nodes:h.map(function(a){return a.cola}),edges:I.map(function(a){return a.cola}),constraints:H,opts:{groupConnected:M.groupConnected()}}}),S.postMessage({command:"start",args:{initialUnconstrainedIterations:10,initialUserConstraintIterations:20,initialAllConstraintsIterations:20,initialOnly:M.initialOnly(),showLayoutSteps:M.showLayoutSteps()}}),this},M.refresh=function(b,c){c.attr("stroke",M.edgeStroke.eval).attr("stroke-width",M.edgeStrokeWidth.eval).attr("marker-end",function(a){var b=M.edgeArrowhead.eval(a),c=C(a,"head",b);return c?"url(#"+c+")":null}).attr("marker-start",function(a){var b=M.edgeArrowtail.eval(a),c=C(a,"tail",b);return b?"url(#"+c+")":null}).each(function(b){a.selectAll("#"+M.arrowId(b,"head")+",#"+M.arrowId(b,"tail")).attr("fill",M.edgeStroke.eval(b))}),M._updateNode(b)},M.render=function(){return M.initLayoutOnRedraw()||k(),M.resetSvg(),P=N.append("g").attr("class","dc-graph"),R=P.append("g"),Q=P.append("g"),M.legend()&&M.legend().render(),M.redraw()},M.on=function(a,b){return T.on(a,b),this},M.getStats=function(){return W},M.select=function(a){return M.root().select(a)},M.selectAll=function(a){return M.root()?M.root().selectAll(a):null},M.svg=function(a){return arguments.length?(N=a,M):N},M.resetSvg=function(){return M.select("svg").remove(),I()},M.redrawGroup=function(){c.redrawAll(h)},M.renderGroup=function(){c.renderAll(h)},M.defineArrow=function(a,b,c,d,e,f){return Y[a]={name:a,width:b,height:c,refX:d,refY:e,drawFunction:f},M},M.addOrRemoveDef=function(a,b,c){var d=b?[0]:[],e=O.selectAll("#"+a).data(d),f=e.enter().append(c).attr("id",a);return e.exit().remove(),f},M.defineArrow("vee",12,12,10,0,function(a){a.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),M.defineArrow("dot",7,7,0,0,function(a){a.append("svg:circle").attr("r",5).attr("cx",5).attr("cy",0).attr("stroke-width","0px")}),M.root(a.select(d)),c.registerChart(M,h),M},D.legend=function(){var a,b={};return b.x=E(0),b.y=E(0),b.gap=E(5),b.nodeWidth=E(40),b.nodeHeight=E(40),b.exemplars=E({}),b.parent=E(null),b.redraw=function(){var c=b.parent().svg().selectAll("g.dc-graph-legend").data([0]);c.enter().append("g").attr("class","dc-graph-legend").attr("transform","translate("+b.x()+","+b.y()+")");var d=c.selectAll(".node").data(a,function(a){return a.name}),e=d.enter().append("g").attr("class","node");e.append("text").attr("dy","0.3em").attr("class","legend-label"),d.attr("transform",function(a,c){return"translate("+b.nodeWidth()/2+","+(b.nodeHeight()+b.gap())*(c+.5)+")"}),d.select("text.legend-label").attr("transform","translate("+(b.nodeWidth()/2+b.gap())+",0)").text(function(a){return a.name}),b.parent()._enterNode(e)._updateNode(d)},b.render=function(){var c=b.exemplars();if(c instanceof Array)a=c.map(function(a){return{name:a.name,orig:{key:a.key,value:a.value},cola:{}}});else{a=[];for(var d in c)a.push({name:d,orig:{key:d,value:c[d]},cola:{}})}b.redraw()},b},D.constraint_pattern=function(a){var b={},c=[];return a.nodes.forEach(function(a){var c=a.id,d=b[c]||(b[c]={});if(a.partition){var e=a.partition,f=a.value||a.id;a.all||a.typename?(d.match=a.extract?function(b){return a.extract(b.value[e])}:function(a){return a.value[e]},d.typename=a.typename||function(a){return e+"="+a.value[e]}):d.match=function(a){return a.value[e]===f}}else{if(!a.match)throw new Error("couldn't determine matcher for type "+JSON.stringify(a));d.match=a.match}}),a.edges.forEach(function(a){if(!a.disable){var b={source:a.source,target:a.target};b.produce="function"==typeof a.produce?a.produce:function(){return h(a.produce)},["listname","wrap","reverse"].forEach(function(c){void 0!==a[c]&&(b[c]=a[c])}),c.push(b)}}),function(a,d,e){var f=[],g={};d.forEach(function(c){var d=a.nodeKey.eval(c);for(var e in b){var f=b[e],h=f.match(c.orig);if(h){var i=f.typename?f.typename(e,h):e;g[i]||(g[i]={nodes:[],whether:{}}),g[i].nodes.push(d),g[i].whether[d]=!0}}});var h=c.filter(function(a){return a.source!==a.target}),i=c.filter(function(a){return a.source===a.target});return e.forEach(function(b){var c=a.edgeSource.eval(b),i=a.edgeTarget.eval(b);h.forEach(function(a){if(g[a.source]&&g[a.source].whether[c]&&g[a.target]&&g[a.target].whether[i]){var b=a.produce(g,d,e);a.reverse?(b.left=i,b.right=c):(b.left=c,b.right=i),f.push(b)}})}),i.forEach(function(a){if(g[a.source]){var b=a.produce(),c=a.listname||a.produce.listname||"nodes",d=a.wrap||a.produce.wrap||function(a){return a};b[c]=g[a.source].nodes.map(d),f.push(b)}}),f}},D.gap_y=function(a,b){return{axis:"y",gap:a,equality:!!b}},D.gap_x=function(a,b){return{axis:"x",gap:a,equality:!!b}},D.align_y=function(){return C("y")},D.align_x=function(){return C("x")},D.order_x=function(a,b){return{type:"ordering",axis:"x",gap:60,ordering:b}},D.order_y=function(a,b){return{type:"ordering",axis:"y",gap:60,ordering:b}},D.tree_constraints=function(a,b,c){return function(d,e,f){var g=[],h=0,i=D.depth_first_traversal(null,a,null,b,function(a,b,c){if(c.length){var e=c[c.length-1];g.push({left:d.nodeKey.eval(e),right:d.nodeKey.eval(a),axis:"x",gap:h-e.foo_x,equality:!0})}a.foo_x=h},function(){h+=c});return i(d,e,f),g}},D.tree_positions=function(a,b,c,d,e,f,g){var h,i=D.depth_first_traversal(function(){h=d},a,b,c,function(a,b){a.left_x=h,a.hit_ins=1,a.cola.y=b*g+e},function(a){h+=a?1.5*f:f},null,function(a){a.cola.x=(a.left_x+h)/2,delete a.left_x},function(a,b){a.cola.x=(a.hit_ins*a.cola.x+h)/++a.hit_ins,a.hit_ins===b&&delete a.hit_ins});return i},D.behavior=function(a,b){var c={};return c.parent=E(null).react(function(d){var e;if(d){var f=!0;e=d,d.on("drawn."+a,function(a,c){b.add_behavior(e,a,c),f&&b.first?(b.first(e,a,c),f=!1):b.rest&&b.rest(e,a,c)})}else c.parent()&&(e=c.parent(),e.on("drawn."+a,function(c,d){b.remove_behavior(e,c,d),e.on("drawn"+a,null)}))}),c},D.tip=function(){function b(b){d||(d=a.tip().attr("class","d3-tip").html(function(a){return"<span>"+a+"</span>"}),c.parent().svg().call(d)),b.on("mouseover.tip",function(b){var e=a.event.target;c.content()(b,function(a){d.show(a,e)})}).on("mouseout.foo",function(){d.hide()})}var c={},d=null;return c.parent=E(null).react(function(a){a?a.on("drawn.tip",function(a){b(a)}):c.parent()&&c.parent().on("drawn.tip",null)}),c.content=E(function(a,b){b(c.parent()?c.parent().nodeTitle.eval(a):"")}),c},D.highlight_neighbors=function(a){function b(a){a.each(function(a){a.dcg_highlighted=!1})}function c(c,e,f){c.cascade(100,d(function(a){return a.dcg_highlighted},a)),e.on("mouseover.highlight-neighbors",function(a){f.each(function(b){b.dcg_highlighted=b.source===a||b.target===a}),c.refresh(e,f)}).on("mouseout.highlight-neighbors",function(){b(f),c.refresh(e,f)})}function e(a,c,d){c.on("mouseover.highlight-neighbors",null).on("mouseout.highlight-neighbors",null),b(d),a.edgeStrokeWidth.cascade(100,null),a.edgeStroke.cascade(100,null)}return D.behavior("highlight-neighbors",{add_behavior:c,remove_behavior:function(a,b,c){e(a,b,c)}})},D.highlight_paths=function(a,b){function c(a){a.each(function(a){a.dcg_paths=null})}function e(c,e,f){c.cascade(200,d(function(a){return!!a.dcg_paths},a)).cascade(300,d(function(a){return g&&a.dcg_paths&&g.some(function(b){return a.dcg_paths.indexOf(b)>=0})},b)),e.each(function(a){a.dcg_paths=h[c.nodeKey.eval(a)]}),f.each(function(a){a.dcg_paths=i[c.edgeKey.eval(a)]}),e.on("mouseover.highlight-paths",function(a){g=h[c.nodeKey.eval(a)],c.refresh(e,f)}).on("mouseout.highlight-paths",function(){g=null,c.refresh(e,f)})}function f(a,b,d){b.on("mouseover.highlight-paths",null).on("mouseout.highlight-paths",null),c(d),a.edgeStrokeWidth.cascade(100,null),a.edgeStroke.cascade(100,null)}var g,h={},i={},j=D.behavior("highlight-paths",{add_behavior:e,remove_behavior:function(a,b,c){return f(a,b,c),this}});return j.pathList=E(F,!1),j.elementList=E(F,!1),j.elementType=E(null,!1),j.nodeKey=E(null,!1),j.edgeSource=E(null,!1),j.edgeTarget=E(null,!1),j.data=function(a){h={},i={},j.pathList.eval(a).forEach(function(a){j.elementList.eval(a).forEach(function(b){var c,d;switch(j.elementType.eval(b)){case"node":c=j.nodeKey.eval(b),d=h[c]=h[c]||[];break;case"edge":c=j.edgeSource.eval(b)+"-"+j.edgeTarget.eval(b),d=i[c]=i[c]||[]}d.push(a)})})},j},D.expand_collapse=function(a,b,c){function d(a){var b=a.addOrRemoveDef("spike-gradient",!0,"linearGradient");b.attr({x1:"0%",y1:"0%",x2:"100%",y2:"0%",spreadMethod:"pad"}),b.selectAll("stop").data([[0,"black",1],[100,"black","0"]]).enter().append("stop").attr({offset:function(a){return a[0]+"%"},"stop-color":function(a){return a[1]},"stop-opacity":function(a){return a[2]}})}function e(a,b,c){return b.filter(function(b){return a.edgeSource.eval(b)===c||a.edgeTarget.eval(b)===c}).size()}function f(b,c,d){var f=c.selectAll("g.spikes").data(function(a){return a.dcg_expand_selected&&!a.dcg_expanded?[a]:[]});f.exit().remove(),f.enter().insert("g",":first-child").classed("spikes",!0).selectAll("rect.spike").data(function(c){for(var f=b.nodeKey.eval(c),g=a(f)-e(b,d,f),h=Array(g),i=0;g>i;++i){var j=Math.PI*(2*i/g-.5);h[i]={a:-90+360*i/g,x:Math.cos(j)*c.dcg_rx*.9,y:Math.sin(j)*c.dcg_ry*.9}}return h}).enter().append("rect").classed("spike",!0).attr({width:25,height:3,fill:"url(#spike-gradient)",rx:1,ry:1,x:0,y:0,transform:function(a){return"translate("+a.x+","+a.y+") rotate("+a.a+")"}})}function g(a,b,c){b.each(function(a){a.dcg_expand_selected=!1}),f(a,b,c)}function h(a,b,c){return 1===e(a,b,c)}function i(a,d,e){d.on("mouseover.expand-collapse",function(b){d.each(function(a){a.dcg_expand_selected=a===b}),f(a,d,e)}).on("mouseout.expand-collapse",function(){g(a,d,e)}).on("click",function(g){(g.dcg_expanded=!g.dcg_expanded)?b(a.nodeKey.eval(g)):c(a.nodeKey.eval(g),h.bind(null,a,e)),f(a,d,e)})}function j(a,b){b.on("mouseover.expand-collapse",null).on("mouseout.expand-collapse",null),g(a,b)}return D.behavior("expand-collapse",{add_behavior:i,first:d,remove_behavior:j})},D.load_graph=function(b,c){var d=b.replace(/\?.*/,"");/\.json$/.test(d)?a.json(b,c):/\.gv|\.dot$/.test(d)&&a.text(b,function(a,b){if(a)return void c(a,null);var d=graphlibDot.parse(b),e=d.nodes(),f=new Array(e.length);e.forEach(function(a,b){var c=f[b]=d._nodes[e[b]];c.id=b,c.name=a});var g=d.edges(),h=[];g.forEach(function(a){var b=d._edges[a];h.push({source:d._nodes[b.u].id,target:d._nodes[b.v].id,sourcename:b.u,targetname:b.v})});var i={nodes:f,links:h};c(null,i)})},D.node_name=function(a){if(26>a)return String.fromCharCode(97+a);if(52>a)return String.fromCharCode(65+a-26);if(2704>a)return D.node_name(Math.floor(a/52))+D.node_name(a%52);throw new Error("no, that's too large")},D.node_object=function(a,b){return b=b||{},_.extend({id:a,name:D.node_name(a)},b)},D.edge_object=function(a,b,c,d){return d=d||{},_.extend({source:b,target:c,sourcename:a(b),targetname:a(c)},d)},D.generate=function(a,b,c,d){var e,f,g,h,i=c.nodePrefix||"",j=function(a){return e[a].name},k=b[0],l=c.linkLength||30;switch(a){case"clique":case"cliquestf":for(e=new Array(k),f=[],g=0;k>g;++g)for(e[g]=D.node_object(g,{circle:"A",name:i+D.node_name(g)}),h=0;g>h;++h)f.push(D.edge_object(j,g,h,{notLayout:!0,undirected:!0}));if("cliquestf"===a)for(g=0;k>g;++g)e[g+k]=D.node_object(g+k),e[g+2*k]=D.node_object(g+2*k),f.push(D.edge_object(j,g,g+k,{undirected:!0})),f.push(D.edge_object(j,g,g+2*k,{undirected:!0}));break;case"wheel":for(e=new Array(k),g=0;k>g;++g)e[g]=D.node_object(g,{name:i+D.node_name(g)});f=D.wheel_edges(j,_.range(k),k*l/2);var m=f[0].distance;for(g=0;g<b[1];++g)for(h=0;k>h;++h)f.push(D.edge_object(j,h,(h+1)%k,{distance:m,par:g+2}));break;default:throw new Error("unknown generation type "+a)}var n={nodes:e,links:f};d(null,n)},D.wheel_edges=function(a,b,c){for(var d=b.length,e=[],f=Math.floor(d/2),g=2*c*Math.sin(Math.PI/d),h=2*c*Math.sin(f*Math.PI/d),i=0;d>i;++i)e.push(D.edge_object(a,b[i],b[(i+1)%d],{
distance:g}));for(i=0;d/2>i;++i)e.push(D.edge_object(a,b[i],b[(i+f)%d],{distance:h})),d%2&&i!=Math.floor(d/2)&&e.push(D.edge_object(a,b[i],b[(i+d-f)%d],{distance:h}));return e},D.build_type_graph=function(a,b,c,d,e,f){var g={},h={},i={};return a.forEach(function(a){g[c(a)]=a;var b=d(a);h[b]||(h[b]={type:b})}),b.forEach(function(a){var b,c,h=e(a),j=f(a);if(!(b=g[h]))throw new Error("source key "+h+" not found!");if(!(c=g[j]))throw new Error("target key "+j+" not found!");var k=d(b)+"/"+d(c);i[k]||(i[k]={type:k,source:d(b),target:d(c)})}),{nodes:Object.keys(h).map(function(a){return h[a]}),edges:Object.keys(i).map(function(a){return i[a]})}},D.d3=a,D.crossfilter=b,D.dc=c,D}if("function"==typeof define&&define.amd)define(["d3","crossfilter","dc"],a);else if("object"==typeof module&&module.exports){var b=require("d3"),c=require("crossfilter");"function"!=typeof c&&(c=c.crossfilter);var d=require("dc");module.exports=a(b,c,d)}else this.dc_graph=a(d3,crossfilter,dc)}();
//# sourceMappingURL=dc.graph.min.js.map