/*!
 *  dc.graph 0.1.0
 *  http://dc-js.github.io/dc.graph.js/
 *  Copyright 2015 Gordon Woodhull
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

!function(){function a(a,b,c){"use strict";function d(a,b){return function(){return a(b.apply(null,arguments))}}var e={version:"0.1.0"},f=function(a){var b=a,c=null,d=function(a){return arguments.length?(b=a,c&&c(a),this):b};return d.react=function(a){return arguments.length?(c=a,this):c},d},g=function(a){return a};return e.functor_wrap=function(a,b){return"function"==typeof a?b?function(c){return a(b(c))}:a:function(){return a}},e.diagram=function(b,h){function i(a){return e.functor_wrap(a,function(a){return a.orig})}function j(){switch(x=cola.d3adaptor().avoidOverlaps(!0).size([s.width(),s.height()]),s.lengthStrategy()){case"symmetric":x.symmetricDiffLinkLengths(s.baseLength());break;case"jaccard":x.symmetricDiffLinkLengths(s.baseLength());break;case"individual":x.linkDistance(function(a){var b=a.orig?i(s.edgeDistanceAccessor())(a):a.internal&&a.internal.distance;return b||s.baseLength()});break;case"none":}s.modLayout()&&s.modLayout()(x)}function k(a){return"edge-"+i(s.edgeKeyAccessor())(a).replace(/[^\w-_]/g,"-")}function l(a){var b,c,d,e,f=a.target.x-a.source.x,g=a.target.y-a.source.y,h=i(s.nodeRadiusAccessor())(a.source)+i(s.nodeStrokeWidthAccessor())(a.source)/2,j=i(s.nodeRadiusAccessor())(a.target)+i(s.nodeStrokeWidthAccessor())(a.target)/2;if(a.parallel){var k=!!(a.parallel%2)==a.source.x<a.target.x?-1:1,l=Math.floor((a.parallel+1)/2)*k,m=Math.atan2(g,f),n=m+l*s.parallelEdgeOffset()/h,o=m-Math.PI-l*s.parallelEdgeOffset()/j,p=Math.cos(n),q=Math.sin(n),r=Math.cos(o),t=Math.sin(o);b=a.source.x+h*p,c=a.source.y+h*q;var u=a.source.x+2*h*p,v=a.source.y+2*h*q,w=a.target.x+2*j*r,x=a.target.y+2*j*t;return d=a.target.x+j*r,e=a.target.y+j*t,a.length=Math.hypot(d-b,e-c),"M"+b+","+c+"C"+u+","+v+" "+w+","+x+" "+d+","+e}var y=Math.hypot(f,g),z=f/y,A=g/y;return b=a.source.x+h*z,c=a.source.y+h*A,d=a.target.x-j*z,e=a.target.y-j*A,a.length=Math.hypot(d-b,e-c),"M"+b+","+c+"L"+d+","+e}function m(a,b,c,d){a.attr("visibility","visible").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),b.attr("d",l),c.attr("d",l),d.attr("transform",function(a){if(a.target.x<a.source.x){var b=this.getBBox(),c=b.x+b.width/2,d=b.y+b.height/2;return"rotate(180 "+c+" "+d+")"}return"rotate(0)"}).attr("dy",function(a){return a.target.x<a.source.x?11:-2})}function n(){u.attr("transform","translate("+a.event.translate+") scale("+a.event.scale+")")}function o(){t&&t.attr("width",s.width()).attr("height",s.height())}function p(){return t=s.root().append("svg"),o(),s.defineArrow("vee",12,12,10,0,function(a){a.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),s.defineArrow("dot",7,7,0,0,function(a){a.append("svg:circle").attr("r",5).attr("cx",5).attr("cy",0).attr("stroke-width","0px")}),s.mouseZoomable()&&t.call(a.behavior.zoom().on("zoom",n)),t}var q,r,s={},t=null,u=null,v=null,w=null,x=null,y=a.dispatch("end"),z={};s.width=f(200).react(o),s.height=f(200).react(o),s.root=f(null),s.mouseZoomable=f(!0),s.nodeDimension=f(),s.nodeGroup=f(),s.edgeDimension=f(),s.edgeGroup=f(),s.nodeKeyAccessor=f(function(a){return a.key}),s.edgeKeyAccessor=f(function(a){return a.key}),s.sourceAccessor=f(),s.targetAccessor=f(),s.nodeRadiusAccessor=f(function(){return 25}),s.nodeStrokeWidthAccessor=f(function(){return"1"}),s.nodeStrokeAccessor=f(function(){return"black"}),s.nodeFillScale=f(g),s.nodeFillAccessor=f(function(){return"white"}),s.nodePadding=f(6),s.nodeLabelAccessor=f(function(a){return a.value.label||a.value.name}),s.nodeTitleAccessor=f(function(a){return s.nodeKeyAccessor()(a)}),s.edgeStrokeAccessor=f(function(){return"black"}),s.edgeStrokeWidthAccessor=f(function(){return"1"}),s.edgeOpacityAccessor=f(function(){return"1"}),s.edgeLabelAccessor=f(function(a){return s.edgeKeyAccessor()(a)}),s.edgeArrowheadAccessor=f(function(){return"vee"}),s.edgeArrowtailAccessor=f(function(){return null}),s.edgeIsLayoutAccessor=f(function(a){return!a.value.notLayout}),s.lengthStrategy=f("symmetric"),s.edgeDistanceAccessor=f(function(a){return a.value.distance}),s.baseLength=f(30),s.transitionDuration=f(500),s.timeLimit=f(0),s.constrain=f(function(){return[]}),s.parallelEdgeOffset=f(5),s.initLayoutOnRedraw=f(!1),s.layoutUnchanged=f(!1),s.induceNodes=f(!1),s.modLayout=f(function(){}),s.showLayoutSteps=f(!0),s.legend=f(null).react(function(a){a.parent(s)});var A={},B={};return s._buildNode=function(a,b){b.append("title").text(i(s.nodeTitleAccessor())),b.append("circle"),b.append("text").attr("class","node-label"),a.select("circle").attr("r",i(s.nodeRadiusAccessor())).attr("stroke",i(s.nodeStrokeAccessor())).attr("stroke-width",i(s.nodeStrokeWidthAccessor())).attr("fill",d(s.nodeFillScale(),i(s.nodeFillAccessor()))),a.select("text.node-label").text(i(s.nodeLabelAccessor()))},s.redraw=function(){function b(a){A[a.key]||(A[s.nodeKeyAccessor()(a)]={});var b=A[s.nodeKeyAccessor()(a)];return b.orig=a,b.width=2*i(s.nodeRadiusAccessor())(a)+s.nodePadding(),b.height=2*i(s.nodeRadiusAccessor())(a)+s.nodePadding(),b}function c(a){B[a.key]||(B[s.edgeKeyAccessor()(a)]={});var b=B[s.edgeKeyAccessor()(a)];return b.orig=a,b.source=h[s.sourceAccessor()(a)],b.target=h[s.targetAccessor()(a)],b}var d=s.nodeGroup().all(),f=s.edgeGroup().all();if(x&&x.stop(),s.initLayoutOnRedraw()&&j(),s.induceNodes()){var g={};f.forEach(function(a){g[s.sourceAccessor()(a)]=!0,g[s.targetAccessor()(a)]=!0}),d=d.filter(function(a){return g[s.nodeKeyAccessor()(a)]})}var h=d.reduce(function(a,b,c){return a[s.nodeKeyAccessor()(b)]=c,a},{}),l=d.map(b),n=f.map(c).filter(function(a){return void 0!==a.source&&void 0!==a.target});if(z={nnodes:l.length,nedges:n.length},!s.layoutUnchanged()){var o=JSON.stringify(l),p=JSON.stringify(n);if(o===q&&p===r)return void y.end();q=o,r=p}if(s.parallelEdgeOffset()){for(var t=new Array(l.length),u=0;u<t.length;++u){t[u]=new Array(t.length);for(var C=0;C<t.length;++C)t[u][C]=0}n.forEach(function(a){var b=Math.min(a.source,a.target),c=Math.max(a.source,a.target);a.parallel=t[b][c]++})}var D=w.selectAll(".edge").data(n,i(s.edgeKeyAccessor())),E=(D.enter().append("svg:path").attr("class","edge").attr("id",k).attr("stroke",i(s.edgeStrokeAccessor())).attr("stroke-width",i(s.edgeStrokeWidthAccessor())).attr("opacity",i(s.edgeOpacityAccessor())).attr("marker-end",function(a){return"url(#"+i(s.edgeArrowheadAccessor())(a)+")"}).attr("marker-start",function(a){return"url(#"+i(s.edgeArrowtailAccessor())(a)+")"}),D.exit());E.remove();var F=w.selectAll(".edge-hover").data(n,i(s.edgeKeyAccessor()));F.enter().append("svg:path").attr("class","edge-hover").attr("opacity",0).attr("stroke","green").attr("stroke-width",10).on("mouseover",function(b){a.select("#"+k(b)+"-label").attr("visibility","visible")}).on("mouseout",function(b){a.select("#"+k(b)+"-label").attr("visibility","hidden")}),F.exit().remove();{var G=w.selectAll(".edge-label").data(n,i(s.edgeKeyAccessor()));G.enter().append("text").attr("id",function(a){return k(a)+"-label"}).attr("visibility","hidden").attr({"class":"edge-label","text-anchor":"middle",dy:-2}).append("textPath").attr("startOffset","50%").attr("xlink:href",function(a){return"#"+k(a)}).text(function(a){return i(s.edgeLabelAccessor())(a)})}G.exit().remove();var H=v.selectAll(".node").data(l,i(s.nodeKeyAccessor())),I=H.enter().append("g").attr("class","node").attr("visibility","hidden").call(x.drag);s._buildNode(H,I);var J=H.exit(),K=s.constrain()(l,n);J.remove(),x.on("tick",function(){var a=Date.now()-P;console.log("tick",a),s.showLayoutSteps()&&m(H,D,F,G),s.timeLimit()&&a>s.timeLimit()&&(console.log("cancelled"),x.stop(),y.end())});var L=n.filter(i(s.edgeIsLayoutAccessor())),M=n.filter(function(a){return!i(s.edgeIsLayoutAccessor())(a)});M.forEach(function(a){a.source=l[a.source],a.target=l[a.target]});var N=K.filter(function(a){return"circle"===a.type}),O=K.filter(function(a){return"circle"!==a.type});N.forEach(function(a){var b=(a.distance||4*s.baseLength())/(2*Math.sin(Math.PI/a.nodes.length)),c=a.nodes.map(function(a){return a.node}),d=function(a){return i(s.nodeKeyAccessor())(l[a])},f=e.wheel_edges(d,c,b).map(function(a){var b={internal:a};return b.source=h[a.sourcename],b.target=h[a.targetname],b});L=L.concat(f)});var P=Date.now();return x.nodes(l).links(L).constraints(O).start(10,20,20).on("end",function(){s.showLayoutSteps()||m(H,D,F,G),y.end()}),this},s.render=function(){return s.initLayoutOnRedraw()||j(),s.resetSvg(),u=t.append("g").attr("class","dc-graph"),w=u.append("g"),v=u.append("g"),s.legend()&&s.legend().render(),s.redraw()},s.on=function(a,b){return y.on(a,b),this},s.getStats=function(){return z},s.select=function(a){return s.root().select(a)},s.selectAll=function(a){return s.root()?s.root().selectAll(a):null},s.svg=function(a){return arguments.length?(t=a,s):t},s.resetSvg=function(){return s.select("svg").remove(),p()},s.defineArrow=function(a,b,c,d,e,f){t.append("svg:defs").append("svg:marker").attr("id",a).attr("viewBox","0 -5 10 10").attr("refX",d).attr("refY",e).attr("markerWidth",b).attr("markerHeight",c).attr("orient","auto").call(f)},s.root(a.select(b)),c.registerChart(s,h),s},e.legend=function(){var a={},b=null;return a.x=f(0),a.y=f(0),a.gap=f(5),a.nodeWidth=f(40),a.nodeHeight=f(40),a.exemplars=f({}),a.parent=f(null),a.render=function(){var c=a.parent().svg().selectAll("g.dc-graph-legend").data([0]).enter();b=c.append("g").attr("class","dc-graph-legend").attr("transform","translate("+a.x()+","+a.y()+")");var d=[],e=a.exemplars();for(var f in e)d.push({orig:{key:f,value:e[f]}});var g=b.selectAll(".node").data(d,function(a){return a.orig.key}),h=g.enter().append("g").attr("class","node").attr("transform",function(b,c){return"translate("+a.nodeWidth()/2+","+(a.nodeHeight()+a.gap())*(c+.5)+")"});h.append("text").attr("class","legend-label").attr("transform","translate("+(a.nodeWidth()/2+a.gap())+",0)").text(function(a){return a.orig.key}),a.parent()._buildNode(g,h)},a},e.load_graph=function(b,c){/\.json$/.test(b)?a.json(b,c):/\.gv|\.dot$/.test(b)&&a.text(b,function(a,b){if(a)return void c(a,null);var d=graphlibDot.parse(b),e=d.nodes(),f=new Array(e.length);e.forEach(function(a,b){var c=f[b]=d._nodes[e[b]];c.id=b,c.name=a});var g=d.edges(),h=[];g.forEach(function(a){var b=d._edges[a];h.push({source:d._nodes[b.u].id,target:d._nodes[b.v].id,sourcename:b.u,targetname:b.v})});var i={nodes:f,links:h};c(null,i)})},e.node_name=function(a){if(26>a)return String.fromCharCode(97+a);if(52>a)return String.fromCharCode(65+a-26);if(2704>a)return e.node_name(Math.floor(a/52))+e.node_name(a%52);throw new Error("no, that's too large")},e.node_object=function(a,b){return b=b||{},_.extend({id:a,name:e.node_name(a)},b)},e.edge_object=function(a,b,c,d){return d=d||{},_.extend({source:b,target:c,sourcename:a(b),targetname:a(c)},d)},e.generate=function(a,b,c){var d,f,g,h,i=function(a){return d[a].name};switch(a){case"clique":case"cliquestf":for(d=new Array(b),f=[],g=0;b>g;++g)for(d[g]=e.node_object(g,{circle:"A"}),h=0;g>h;++h)f.push(e.edge_object(i,g,h,{notLayout:!0,undirected:!0}));if("cliquestf"===a)for(g=0;b>g;++g)d[g+b]=e.node_object(g+b),d[g+2*b]=e.node_object(g+2*b),f.push(e.edge_object(i,g,g+b,{undirected:!0})),f.push(e.edge_object(i,g,g+2*b,{undirected:!0}));break;case"wheel":for(d=new Array(b),g=0;b>g;++g)d[g]=e.node_object(g);f=e.wheel_edges(i,_.range(b),15*b);break;default:throw new Error("unknown generation type "+a)}var j={nodes:d,links:f};c(null,j)},e.wheel_edges=function(a,b,c){for(var d=b.length,f=[],g=Math.floor(d/2),h=2*c*Math.sin(Math.PI/d),i=2*c*Math.sin(g*Math.PI/d),j=0;d>j;++j)f.push(e.edge_object(a,b[j],b[(j+1)%d],{distance:h}));for(j=0;d/2>j;++j)f.push(e.edge_object(a,b[j],b[(j+g)%d],{distance:i})),d%2&&j!=Math.floor(d/2)&&f.push(e.edge_object(a,b[j],b[(j+d-g)%d],{distance:i}));return f},e.d3=a,e.crossfilter=b,e.dc=c,e}if("function"==typeof define&&define.amd)define(["d3","crossfilter","dc"],a);else if("object"==typeof module&&module.exports){var b=require("d3"),c=require("crossfilter");"function"!=typeof c&&(c=c.crossfilter);var d=require("dc");module.exports=a(b,c,d)}else this.dc_graph=a(d3,crossfilter,dc)}();
//# sourceMappingURL=dc.graph.min.js.map