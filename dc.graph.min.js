/*!
 *  dc.graph 0.1.1
 *  http://dc-js.github.io/dc.graph.js/
 *  Copyright 2015-2016 AT&T Intellectual Property & the dc.graph.js Developers
 *  https://github.com/dc-js/dc.graph.js/blob/master/AUTHORS
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 */

!function(){function a(a,b,c){"use strict";function d(a,b){return function(){return a(b.apply(null,arguments))}}function e(a){return a.orig}function f(a){return B.functor_wrap(a,e)}function g(a,b,c){for(var d=["M",a[0].x,",",a[0].y],e=b,f=!1,g=1;g<a.length;++g)(isNaN(a[g].x)||isNaN(a[g].y))&&(f=!0),d.push(e===b?E[b]:" ",a[g].x,",",a[g].y),0===--e&&(e=b);return e!=b&&console.log("warning: pts.length didn't match bezian degree",a,b),c&&d.push("Z"),d.join("")}function h(a,b,c,d){function e(b){var e=c(b);a[e]||(a[e]={});var g=a[e];return d(g,b),f[e]=!0,g}var f={},g=b.map(e);for(var h in a)f[h]||delete a[h];return g}function i(a,b,c,d){var e=Math.tan(Math.atan2(d,c));e*=e;var f={x:a*b/Math.sqrt(b*b+a*a*e),y:a*b/Math.sqrt(a*a+b*b/e)};return 0>c&&(f.x=-f.x),0>d&&(f.y=-f.y),f}function j(a,b,c){return b>=a-F&&c+F>=b}function k(a,b,c,d,e,f,g,h){var i=((a*d-b*c)*(e-g)-(a-c)*(e*h-f*g))/((a-c)*(f-h)-(b-d)*(e-g)),k=((a*d-b*c)*(f-h)-(b-d)*(e*h-f*g))/((a-c)*(f-h)-(b-d)*(e-g));if(isNaN(i)||isNaN(k))return!1;if(a>=c){if(!j(c,i,a))return!1}else if(!j(a,i,c))return!1;if(b>=d){if(!j(d,k,b))return!1}else if(!j(b,k,d))return!1;if(e>=g){if(!j(g,i,e))return!1}else if(!j(e,i,g))return!1;if(f>=h){if(!j(h,k,f))return!1}else if(!j(f,k,h))return!1;return{x:i,y:k}}function l(a,b,c,d,e){for(var f=0;f<a.length;++f){var g=f===a.length-1?0:f+1,h=k(a[f].x,a[f].y,a[g].x,a[g].y,b,c,d,e);if(h)return h}return null}function m(a,b,c,d){switch(b.dcg_shape.shape){case"ellipse":return i(b.dcg_rx,b.dcg_ry,c,d);case"polygon":return l(b.dcg_points,0,0,c,d)}}function n(a){var b=a.shape;if("random"===a.shape){var c=Object.keys(G);b=a._shape=c[Math.floor(Math.random()*c.length)]}return(G[b]||function(){throw new Error("unknown shape "+a.shape)})(a)}function o(a){return function(b){var c=f(a.nodeShape())(b);b.dcg_shape=n(c),b.dcg_shape["abstract"]=c}}function p(a){return function(b){var c=f(a.nodeShape())(b),d=b.dcg_shape["abstract"];return c.shape!==d.shape?!0:"polygon"===c.shape?c.shape.sides!==d.sides||c.shape.skew!==d.skew||c.shape.distortion!==d.distortion||c.shape.rotation!==d.rotation:!1}}function q(){return function(a){var b,c=a.dcg_shape.shape;switch(c){case"ellipse":b="ellipse";break;case"polygon":b="path";break;default:throw new Error("unknown shape "+c)}return document.createElementNS("http://www.w3.org/2000/svg",b)}}function r(a){return function(b){var c,d=f(a.nodeRadius())(b),e=2*d+a.nodePadding();f(a.nodeFitLabel())(b)&&(c=this.getBBox());var g=0;if(c&&c.width&&c.height){var h=c.height/2/d,i=c.width/2/Math.sqrt(1-h*h);g=2*i+a.nodePadding(),b.dcg_rx=Math.max(i,d),b.dcg_ry=d,"polygon"===b.dcg_shape.shape&&(b.dcg_rx/=Math.cos(Math.PI/(b.dcg_shape.sides||4)))}else b.dcg_rx=b.dcg_ry=d;b.cola.width=Math.max(g,e),b.cola.height=e}}function s(){return{rx:function(a){return a.dcg_rx},ry:function(a){return a.dcg_ry}}}function t(){return{d:function(a){var b=a.dcg_shape,c=b.sides||4,d=b.skew||0,e=b.distortion||0,f=b.rotation||0,h=c%2?0:.5,i=[];f=f/360+.25;for(var j=0;c>j;++j){var k=-((j+h)/c+f)*Math.PI*2,l=a.dcg_rx*Math.cos(k),m=a.dcg_ry*Math.sin(k);l*=1+e*((a.dcg_ry-m)/a.dcg_ry-1),l-=d*m/2,i.push({x:l,y:m})}return a.dcg_points=i,g(i,1,!0)}}}function u(b){return function(c){var d=a.select(this);switch(c.dcg_shape.shape){case"ellipse":d.attr(s(b,c));break;case"polygon":d.attr(t(b,c));break;default:throw new Error("unknown shape "+c.dcg_shape.shape)}}}function v(a,b,c){var d=100;if(a(b).val>=0)throw new Error("f(a) must be less than 0");if(a(c).val<=0)throw new Error("f(b) must be greater than 0");for(;;){if(!--d)throw new Error("patience ran out");var e=(b+c)/2,f=a(e),g=f.val;if(Math.abs(g)<.5)return f;g>0?c=e:b=e}}function w(a,b,c,d,e,f,g,h,i,j,k,l){var n,o,p,q,r,s;if(h){var t=function(b,c){return m(a,b,1e3*Math.cos(c),1e3*Math.sin(c))},u=function(a,b,c){return function(d){var e=t(a,d);return e?{port:e,val:Math.hypot(e.x-b.x,e.y-b.y)-c,ang:d}:{port:{x:0,y:0},val:0,ang:d}}},w=Math.atan2(h.sourcePort.y,h.sourcePort.x),x=Math.atan2(h.targetPort.y,h.targetPort.x),y=v(u(b,h.sourcePort,j),w,w+2*i*j/k),z=v(u(c,h.targetPort,j),x,x-2*i*j/k);p=y.port,q=z.port;var A=Math.hypot(p.x,p.y),B=Math.hypot(q.x,q.y),C=A+k/2,D=B+l/2,E=d+C*Math.cos(y.ang),F=e+C*Math.sin(y.ang),G=f+D*Math.cos(z.ang),H=g+D*Math.sin(z.ang);r=[{x:d+p.x,y:e+p.y},{x:E,y:F},{x:G,y:H},{x:f+q.x,y:g+q.y}],s=3}else n=f-d,o=g-e,p=m(a,b,n,o),q=m(a,c,-n,-o),p||(p={x:0,y:0}),q||(q={x:0,y:0}),r=[{x:d+p.x,y:e+p.y},{x:f+q.x,y:g+q.y}],s=1;return{sourcePort:p,targetPort:q,points:r,bezDegree:s}}function x(a,b){for(var c=[],d=1;d<a.length;d++){var e=a[d-1],f=a[d];c.push({x:e.x+(f.x-e.x)*b,y:e.y+(f.y-e.y)*b})}return c}function y(a,b){for(var c=[a],d=1;d<a.length;d++)c.push(x(c[c.length-1],b));return c}function z(a,b){var c=y(a,b);return c[c.length-1][0]}function A(a){var b=function(){return{type:"alignment",axis:a}};return b.listname="offsets",b.wrap=function(a){return{node:a,offset:0}},b}var B={version:"0.1.1"},C=function(a){var b=a,c=null,d=function(a){return arguments.length?(c&&c(a),b=a,this):b};return d.react=function(a){return arguments.length?(c=a,this):c},d},D=function(a){return a};B.functor_wrap=function(a,b){return"function"==typeof a?b?function(c){return a(b(c))}:a:function(){return a}};var E={1:"L",2:"Q",3:"C"};Math.hypot=Math.hypot||function(){for(var a=0,b=arguments.length,c=0;b>c;c++){if(arguments[c]===1/0||arguments[c]===-(1/0))return 1/0;a+=arguments[c]*arguments[c]}return Math.sqrt(a)};var F=1e-7,G={ellipse:function(){return{shape:"ellipse"}},egg:function(){return{shape:"polygon",sides:100,distortion:-.25}},triangle:function(){return{shape:"polygon",sides:3}},diamond:function(){return{shape:"polygon",sides:4,rotation:45}},trapezium:function(){return{shape:"polygon",sides:4,distortion:-.5}},parallelogram:function(){return{shape:"polygon",sides:4,skew:.5}},pentagon:function(){return{shape:"polygon",sides:5}},hexagon:function(){return{shape:"polygon",sides:6}},septagon:function(){return{shape:"polygon",sides:7}},octagon:function(){return{shape:"polygon",sides:8}},invtriangle:function(){return{shape:"polygon",sides:3,rotation:180}},invtrapezium:function(){return{shape:"polygon",sides:4,distortion:.5}},square:function(){return{shape:"polygon",sides:4}},polygon:function(a){return{shape:"polygon",sides:a.sides,skew:a.skew,distortion:a.distortion,rotation:a.rotation}}};return B.diagram=function(i,j){function k(){T||(T=new Worker("js/dc.graph-worker.js")),T.postMessage({command:"init",args:{width:N.width(),height:N.height(),handleDisconnected:N.handleDisconnected(),lengthStrategy:N.lengthStrategy(),baseLength:N.baseLength(),flowLayout:N.flowLayout()}})}function l(a){return"edge-"+f(N.edgeKey())(a).replace(/[^\w-_]/g,"-")}function m(a){return"textpath-"+l(a)}function n(a){return!!a.source&&!!a.target}function s(a){U.end(a),$=!1,_&&(_=!1,window.setTimeout(function(){N.startLayout()},0))}function t(a,b,c,d,e,g){if(!a.ports[b]){var h=a.source.dcg_ry+f(N.nodeStrokeWidth())(a.source)/2,i=a.target.dcg_ry+f(N.nodeStrokeWidth())(a.target)/2;a.ports[b]=new Array(a.ports.n);for(var j=0;j<a.ports.n;++j){var k=!!(j%2)==e>c?-1:1,l=Math.floor((j+1)/2),m=l?a.ports[b][j>2?j-2:0]:null;a.ports[b][j]=w(N,a.source,a.target,c,d,e,g,m,k,N.parallelEdgeOffset(),h,i)}}return a.ports[b][a.parallel]}function v(a){t(a,"old",a.source.prevX||a.source.cola.x,a.source.prevY||a.source.cola.y,a.target.prevX||a.target.cola.x,a.target.prevY||a.target.cola.y)}function x(b){var c=t(b,"new",b.source.cola.x,b.source.cola.y,b.target.cola.x,b.target.cola.y),d=c.points[0],e=c.points[c.points.length-1];f(N.edgeArrowhead())(b)&&a.select("#"+F(b,"head")).attr("orient",function(){var a=z(c.points,.75);return Math.atan2(e.y-a.y,e.x-a.x)+"rad"}),b.length=Math.hypot(e.x-d.x,e.y-d.y)}function y(a){return function(b){var c=b.ports[a][b.parallel];return g(c.points,c.bezDegree)}}function A(a,b){a.every(function(a){return 0===a.size()})&&b();var c=0;a.forEach(function(a){a.each(function(){++c}).each("end.all",function(){--c||b()})})}function E(b,c,d,e,h){console.assert($),console.assert(d.data().every(n)),c.attr("transform",function(a){return"translate("+a.cola.x+","+a.cola.y+")"});var i=b.transition().duration(N.transitionDuration()).attr("opacity","1").attr("transform",function(a){return"translate("+a.cola.x+","+a.cola.y+")"});i.each("end.record",function(a){a.prevX=a.cola.x,a.prevY=a.cola.y}),d.each(function(a){a.ports["new"]=null,a.ports.old=null}),e.each(v).attr("d",y("old"));var j=d.each(x).transition().duration(N.transitionDuration()).attr("opacity",f(N.edgeOpacity())).attr("d",y("new"));d.each(function(b){var c=m(b),d=b.ports["new"][b.parallel],e=b.target.cola.x<b.source.cola.x?d.points.slice(0).reverse():d.points;a.select("#"+c).attr("d",function(){return g(e,d.bezDegree)})}),N.showLayoutSteps()||A([i,j],function(){s(!0)}),h.attr("d",y("new"))}function F(a,b){return"arrow-"+b+"-"+l(a)}function G(a,b,c){var d=b?[0]:[],e=P.selectAll("#"+a).data(d),f=e.enter().append(c).attr("id",a);return e.exit().remove(),f}function H(a,b,c){var d=F(a,b),e=G(d,!!c,"svg:marker");return c&&e.attr("viewBox","0 -5 10 10").attr("refX",Z[c].refX).attr("refY",Z[c].refY).attr("markerUnits","userSpaceOnUse").attr("markerWidth",Z[c].width).attr("markerHeight",Z[c].height).attr("stroke",f(N.edgeStroke())(a)).attr("fill",f(N.edgeStroke())(a)).call(Z[c].drawFunction),c?d:null}function I(){Q.attr("transform","translate("+a.event.translate+") scale("+a.event.scale+")")}function J(){O&&O.attr("width",N.width()).attr("height",N.height())}function K(){return O=N.root().append("svg"),J(),P=O.append("svg:defs"),N.mouseZoomable()&&O.call(a.behavior.zoom().on("zoom",I)),O}var L,M,N={},O=null,P=null,Q=null,R=null,S=null,T=null,U=a.dispatch("end","start","drawn"),V={},W={},X={},Y={},Z={},$=!1;N.width=C(200).react(J),N.height=C(200).react(J),N.root=C(null).react(function(a){a.empty()&&console.log("Warning: parent selector "+i+" doesn't seem to exist")}),N.mouseZoomable=C(!0),N.nodeDimension=C(),N.nodeGroup=C(),N.edgeDimension=C(),N.edgeGroup=C(),N.nodeKey=N.nodeKeyAccessor=C(function(a){return a.key}),N.edgeKey=N.edgeKeyAccessor=C(function(a){return a.key}),N.edgeSource=N.sourceAccessor=C(function(a){return a.value.sourcename}),N.edgeTarget=N.targetAccessor=C(function(a){return a.value.targetname}),N.nodeRadius=N.nodeRadiusAccessor=C(25),N.nodeStrokeWidth=N.nodeStrokeWidthAccessor=C(1),N.nodeStroke=N.nodeStrokeAccessor=C("black"),N.nodeFillScale=C(null),N.nodeFill=N.nodeFillAccessor=C("white"),N.nodePadding=C(6),N.nodeLabel=N.nodeLabelAccessor=C(function(a){return a.value.label||a.value.name}),N.nodeLabelFill=N.nodeLabelFillAccessor=C(null),N.nodeFitLabel=N.nodeFitLabelAccessor=C(!0),N.nodeShape=C({shape:"ellipse"}),N.nodeTitle=N.nodeTitleAccessor=C(function(a){return N.nodeKeyAccessor()(a)}),N.nodeOrdering=C(null),N.nodeFixed=N.nodeFixedAccessor=C(null),N.edgeStroke=N.edgeStrokeAccessor=C("black"),N.edgeStrokeWidth=N.edgeStrokeWidthAccessor=C(1),N.edgeHighlightStroke=N.edgeStrokeAccessor=C("orange"),N.edgeHighlightStrokeWidth=N.edgeStrokeWidthAccessor=C(3),N.edgeOpacity=N.edgeOpacityAccessor=C(1),N.edgeLabel=N.edgeLabelAccessor=C(function(a){return N.edgeKey()(a)}),N.edgeArrowhead=N.edgeArrowheadAccessor=C("vee"),N.edgeArrowtail=N.edgeArrowtailAccessor=C(null),N.edgeIsLayout=N.edgeIsLayoutAccessor=C(function(a){return!a.value.notLayout}),N.lengthStrategy=C("symmetric"),N.edgeLength=N.edgeDistanceAccessor=C(function(a){return a.value.distance}),N.flowLayout=C(null),N.baseLength=C(30),N.highlightNeighbors=C(!1),N.transitionDuration=C(500),N.timeLimit=C(0),N.constrain=C(function(){return[]}),N.parallelEdgeOffset=C(10),N.edgeOrdering=C(null),N.initLayoutOnRedraw=C(!1),N.layoutUnchanged=C(!1),N.relayout=function(){return L=M=null,this},N.induceNodes=C(!1),N.showLayoutSteps=C(!1),N.legend=C(null).react(function(a){a.parent(N)}),N.child=function(a,b){return Y[a]&&Y[a].parent(null),Y[a]=b,b.parent(N),N},N.handleDisconnected=C(!0),N._buildNode=function(a,b){N.nodeTitle()&&b.append("title"),b.each(o(N));var c=a.filter(p(N));c.select(".node-shape").remove(),c.each(o(N)),c.insert(q(N),":first-child").attr("class","node-shape"),b.append(q(N)).attr("class","node-shape"),b.append("text").attr("class","node-label").attr("dy","0.3em").attr("fill",f(N.nodeLabelFill())),a.select("title").text(f(N.nodeTitle())),a.select("text.node-label").text(f(N.nodeLabel())).each(r(N)),a.select(".node-shape").each(u(N)).attr({stroke:f(N.nodeStroke()),"stroke-width":f(N.nodeStrokeWidth()),fill:d(N.nodeFillScale()||D,f(N.nodeFill()))})},N.isRunning=function(){return $};var _=!1;return N.redraw=function(){return $?(_=!0,this):N.startLayout()},N.startLayout=function(){function c(a,b){a.forEach(function(a){var b=V[a.dcg_nodeKey];b.cola.x=a.x,b.cola.y=a.y}),b.forEach(function(a){W[a.dcg_edgeKey]})}var d=N.nodeGroup().all(),g=N.edgeGroup().all();if($)throw new Error("dc_graph.diagram.redraw already running!");$=!0,T&&T.postMessage({command:"stop"}),N.initLayoutOnRedraw()&&k(),N.nodeOrdering()&&(d=b.quicksort.by(N.nodeOrdering())(d.slice(0),0,d.length)),N.edgeOrdering()&&(g=b.quicksort.by(N.edgeOrdering())(g.slice(0),0,g.length));var i=h(V,d,function(a){return N.nodeKey()(a)},function(a,b){a.orig=b,a.cola=a.cola||{},a.cola.dcg_nodeKey=f(N.nodeKey())(a),N.nodeFixed()&&(a.cola.dcg_nodeFixed=f(N.nodeFixed())(a))}),j=h(W,g,function(a){return N.edgeKey()(a)},function(a,b){a.orig=b,a.cola=a.cola||{},a.cola.dcg_edgeKey=f(N.edgeKey())(a),a.cola.dcg_edgeSource=f(N.edgeSource())(a),a.cola.dcg_edgeTarget=f(N.edgeTarget())(a),a.source=V[a.cola.dcg_edgeSource],a.target=V[a.cola.dcg_edgeTarget],a.cola.dcg_edgeLength=f(N.edgeLength())(a)});if(j=j.filter(n),j=j.filter(function(a){return a.source!==a.target}),N.induceNodes()){var o={};j.forEach(function(a){o[a.cola.dcg_edgeSource]=!0,o[a.cola.dcg_edgeTarget]=!0}),i=i.filter(function(a){return o[a.cola.dcg_nodeKey]})}i.forEach(function(a,b){a.index=b}),X={nnodes:i.length,nedges:j.length};var p=!1;if(!N.layoutUnchanged()){var q=JSON.stringify(i.map(e)),r=JSON.stringify(j.map(e));q===L&&r===M&&(p=!0),L=q,M=r}if(N.parallelEdgeOffset()){for(var t=new Array(i.length),u=0;u<t.length;++u){t[u]=new Array(t.length);for(var v=0;v<t.length;++v)t[u][v]={n:0,ports:{}}}for(j.forEach(function(a){var b=Math.min(a.source.index,a.target.index),c=Math.max(a.source.index,a.target.index);a.parallel=t[b][c].n++,a.ports=t[b][c].ports}),u=0;u<t.length;++u)for(v=0;v<t.length;++v)t[u][v].n&&(t[u][v].ports.n=t[u][v].n)}var w=S.selectAll(".edge").data(j,f(N.edgeKey())),x=w.enter().append("svg:path").attr({"class":"edge",id:l,opacity:0});w.attr("stroke",f(N.edgeStroke())).attr("stroke-width",f(N.edgeStrokeWidth())).attr("marker-end",function(a){var b=f(N.edgeArrowhead())(a),c=H(a,"head",b);return c?"url(#"+c+")":null}).attr("marker-start",function(a){var b=f(N.edgeArrowtail())(a),c=H(a,"tail",b);return b?"url(#"+c+")":null}),w.exit().transition().duration(N.transitionDuration()).attr("opacity",0).each(function(a){H(a,"head",null),H(a,"head",null)}).remove();var y=S.selectAll(".edge-hover").data(j,f(N.edgeKey())),z=y.enter().append("svg:path").attr("class","edge-hover").attr("opacity",0).attr("stroke","green").attr("stroke-width",10).on("mouseover",function(b){a.select("#"+l(b)+"-label").attr("visibility","visible")}).on("mouseout",function(b){a.select("#"+l(b)+"-label").attr("visibility","hidden")});y.exit().remove();var A=S.selectAll(".edge-label").data(j,f(N.edgeKey())),C=A.enter().append("text").attr("id",function(a){return l(a)+"-label"}).attr("visibility","hidden").attr({"class":"edge-label","text-anchor":"middle",dy:-2}).append("textPath").attr("startOffset","50%").attr("xlink:href",function(a){var b=m(a);return G(b,!0,"svg:path"),"#"+b});A.each(function(a){a.dcg_bbox=null}).selectAll("textPath").text(function(a){return f(N.edgeLabel())(a)}),A.exit().transition().duration(N.transitionDuration()).attr("opacity",0).remove();var D=R.selectAll(".node").data(i,f(N.nodeKey())),F=D.enter().append("g").attr("class","node").attr("opacity","0");D.on("mouseover.highlight-neighbors",N.highlightNeighbors()?function(a){w.attr("stroke-width",function(b){return f(b.source===a||b.target===a?N.edgeHighlightStrokeWidth():N.edgeStrokeWidth())(b)}).attr("stroke",function(b){return f(b.source===a||b.target===a?N.edgeHighlightStroke():N.edgeStroke())(b)})}:null).on("mouseout.highlight-neighbors",N.highlightNeighbors()?function(){w.attr("stroke-width",f(N.edgeStrokeWidth())).attr("stroke",f(N.edgeStroke()))}:null),N._buildNode(D,F),D.exit().transition().duration(N.transitionDuration()).attr("opacity",0).remove(),U.drawn(D,w);var I=N.constrain()(i,j);I.forEach(function(a){if(a.type)switch(a.type){case"alignment":a.offsets.forEach(function(a){a.node=V[a.node].index});break;case"circle":a.nodes.forEach(function(a){a.node=V[a.node].index})}else a.axis&&(a.left=V[a.left].index,a.right=V[a.right].index)});var J=j.filter(f(N.edgeIsLayout())),K=(j.filter(function(a){return!f(N.edgeIsLayout())(a)}),I.filter(function(a){return"circle"===a.type}));I=I.filter(function(a){return"circle"!==a.type}),K.forEach(function(a){var b=(a.distance||4*N.baseLength())/(2*Math.sin(Math.PI/a.nodes.length)),c=a.nodes.map(function(a){return a.node}),d=function(a){return f(N.nodeKey())(i[a])},e=B.wheel_edges(d,c,b).map(function(a){var b={internal:a};return b.source=V[a.sourcename],b.target=V[a.targetname],b});J=J.concat(e)});var O=I.filter(function(a){return"ordering"===a.type});if(I=I.filter(function(a){return"ordering"!==a.type}),O.forEach(function(a){var c=a.nodes.map(function(a){return V[a]});if(a.ordering){var d=b.quicksort.by(f(a.ordering));c=d(c,0,c.length)}var e;c.forEach(function(b,c){0===c?e=b:I.push({left:e.index,right:(e=b).index,axis:a.axis,gap:a.gap})})}),N.legend()&&N.legend().redraw(),p)return $=!1,U.end(!1),this;var P=Date.now();return T.onmessage=function(a){var b=a.data.args;switch(a.data.response){case"tick":var d=Date.now()-P;c(b.nodes,b.edges),N.showLayoutSteps()&&E(D,F,w,x,y,z,A,C),(_||N.timeLimit()&&d>N.timeLimit())&&(console.log("cancelled"),T.postMessage({command:"stop"}));break;case"end":N.showLayoutSteps()?s(!0):E(D,F,w,x,y,z,A,C);break;case"start":console.log("COLA START"),U.start()}},U.start(),T.postMessage({command:"data",args:{nodes:i.map(function(a){return a.cola}),edges:J.map(function(a){return a.cola}),constraints:I}}),T.postMessage({command:"start",args:{initialUnconstrainedIterations:10,initialUserConstraintIterations:20,initialAllConstraintsIterations:20}}),this},N.render=function(){return N.initLayoutOnRedraw()||k(),N.resetSvg(),Q=O.append("g").attr("class","dc-graph"),S=Q.append("g"),R=Q.append("g"),N.legend()&&N.legend().render(),N.redraw()},N.on=function(a,b){return U.on(a,b),this},N.getStats=function(){return X},N.select=function(a){return N.root().select(a)},N.selectAll=function(a){return N.root()?N.root().selectAll(a):null},N.svg=function(a){return arguments.length?(O=a,N):O},N.resetSvg=function(){return N.select("svg").remove(),K()},N.redrawGroup=function(){c.redrawAll(j)},N.renderGroup=function(){c.renderAll(j)},N.defineArrow=function(a,b,c,d,e,f){return Z[a]={name:a,width:b,height:c,refX:d,refY:e,drawFunction:f},N},N.defineArrow("vee",12,12,10,0,function(a){a.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),N.defineArrow("dot",7,7,0,0,function(a){a.append("svg:circle").attr("r",5).attr("cx",5).attr("cy",0).attr("stroke-width","0px")}),N.root(a.select(i)),c.registerChart(N,j),N},B.legend=function(){var a,b={};return b.x=C(0),b.y=C(0),b.gap=C(5),b.nodeWidth=C(40),b.nodeHeight=C(40),b.exemplars=C({}),b.parent=C(null),b.redraw=function(){var c=b.parent().svg().selectAll("g.dc-graph-legend").data([0]);c.enter().append("g").attr("class","dc-graph-legend").attr("transform","translate("+b.x()+","+b.y()+")");var d=c.selectAll(".node").data(a,function(a){return a.name}),e=d.enter().append("g").attr("class","node");e.append("text").attr("dy","0.3em").attr("class","legend-label"),d.attr("transform",function(a,c){return"translate("+b.nodeWidth()/2+","+(b.nodeHeight()+b.gap())*(c+.5)+")"}),d.select("text.legend-label").attr("transform","translate("+(b.nodeWidth()/2+b.gap())+",0)").text(function(a){return a.name}),b.parent()._buildNode(d,e)},b.render=function(){var c=b.exemplars();if(c instanceof Array)a=c.map(function(a){return{name:a.name,orig:{key:a.key,value:a.value},cola:{}}});else{a=[];for(var d in c)a.push({name:d,orig:{key:d,value:c[d]},cola:{}})}b.redraw()},b},B.constraint_pattern=function(a,b){var c={},d=[];return b.nodes.forEach(function(a){var b=a.id,d=c[b]||(c[b]={});if(a.partition){var e=a.partition,f=a.value||a.id;a.all||a.typename?(d.match=function(a){return a.value[e]},d.typename=a.typename||function(a){return e+"="+a.value[e]}):d.match=function(a){return a.value[e]===f}}else{if(!a.match)throw new Error("couldn't determine matcher for type "+JSON.stringify(a));d.match=a.match}}),b.edges.forEach(function(a){if(!a.disable){var b={source:a.source,target:a.target};b.produce="function"==typeof a.produce?a.produce:function(){return Object.create(a.produce)},["listname","wrap","reverse"].forEach(function(c){void 0!==a[c]&&(b[c]=a[c])}),d.push(b)}}),function(b,e,g){var h={};b.forEach(function(b){var d=f(a.nodeKey())(b);for(var e in c){var g=c[e],i=g.match(b.orig);if(i){var j=g.typename?g.typename(e,i):e;h[j]||(h[j]={nodes:[],whether:{}}),h[j].nodes.push(d),h[j].whether[d]=!0}}});var i=d.filter(function(a){return a.source!==a.target}),j=d.filter(function(a){return a.source===a.target});return e.forEach(function(c){var d=f(a.edgeSource())(c),j=f(a.edgeTarget())(c);i.forEach(function(a){if(h[a.source]&&h[a.source].whether[d]&&h[a.target]&&h[a.target].whether[j]){var c=a.produce(h,b,e);a.reverse?(c.left=j,c.right=d):(c.left=d,c.right=j),g.push(c)}})}),j.forEach(function(a){if(h[a.source]){var b=a.produce(),c=a.listname||a.produce.listname||"nodes",d=a.wrap||a.produce.wrap||function(a){return a};b[c]=h[a.source].nodes.map(d),g.push(b)}}),g}},B.gap_y=function(a,b){return{axis:"y",gap:a,equality:!!b}},B.gap_x=function(a,b){return{axis:"x",gap:a,equality:!!b}},B.align_y=function(){return A("y")},B.align_x=function(){return A("x")},B.order_x=function(a,b){return{type:"ordering",axis:"x",gap:60,ordering:b}},B.order_y=function(a,b){return{type:"ordering",axis:"y",gap:60,ordering:b}},B.tip=function(){function b(b){d||(d=a.tip().attr("class","d3-tip").html(function(a){return"<span>"+a+"</span>"}),c.parent().svg().call(d)),b.on("mouseover.tip",function(b){var e=a.event.target;c.content()(b,function(a){d.show(a,e)})}).on("mouseout.foo",function(){d.hide()})}var c={},d=null;return c.parent=C(null).react(function(a){a?a.on("drawn.tip",function(a){b(a)}):c.parent()&&c.parent().on("drawn.tip",null)}),c.content=C(function(a,b){b(c.parent()?f(c.parent().nodeTitle())(a):"")}),c},B.load_graph=function(b,c){var d=b.replace(/\?.*/,"");/\.json$/.test(d)?a.json(b,c):/\.gv|\.dot$/.test(d)&&a.text(b,function(a,b){if(a)return void c(a,null);var d=graphlibDot.parse(b),e=d.nodes(),f=new Array(e.length);e.forEach(function(a,b){var c=f[b]=d._nodes[e[b]];c.id=b,c.name=a});var g=d.edges(),h=[];g.forEach(function(a){var b=d._edges[a];h.push({source:d._nodes[b.u].id,target:d._nodes[b.v].id,sourcename:b.u,targetname:b.v})});var i={nodes:f,links:h};c(null,i)})},B.node_name=function(a){if(26>a)return String.fromCharCode(97+a);if(52>a)return String.fromCharCode(65+a-26);if(2704>a)return B.node_name(Math.floor(a/52))+B.node_name(a%52);throw new Error("no, that's too large")},B.node_object=function(a,b){return b=b||{},_.extend({id:a,name:B.node_name(a)},b)},B.edge_object=function(a,b,c,d){return d=d||{},_.extend({source:b,target:c,sourcename:a(b),targetname:a(c)},d)},B.generate=function(a,b,c,d){var e,f,g,h,i=c.nodePrefix||"",j=function(a){return e[a].name},k=b[0],l=c.linkLength||30;switch(a){case"clique":case"cliquestf":for(e=new Array(k),f=[],g=0;k>g;++g)for(e[g]=B.node_object(g,{circle:"A",name:i+B.node_name(g)}),h=0;g>h;++h)f.push(B.edge_object(j,g,h,{notLayout:!0,undirected:!0}));if("cliquestf"===a)for(g=0;k>g;++g)e[g+k]=B.node_object(g+k),e[g+2*k]=B.node_object(g+2*k),f.push(B.edge_object(j,g,g+k,{undirected:!0})),f.push(B.edge_object(j,g,g+2*k,{undirected:!0}));break;case"wheel":for(e=new Array(k),g=0;k>g;++g)e[g]=B.node_object(g,{name:i+B.node_name(g)});f=B.wheel_edges(j,_.range(k),k*l/2);var m=f[0].distance;for(g=0;g<b[1];++g)for(h=0;k>h;++h)f.push(B.edge_object(j,h,(h+1)%k,{distance:m,par:g+2}));break;default:throw new Error("unknown generation type "+a)}var n={nodes:e,links:f};d(null,n)},B.wheel_edges=function(a,b,c){for(var d=b.length,e=[],f=Math.floor(d/2),g=2*c*Math.sin(Math.PI/d),h=2*c*Math.sin(f*Math.PI/d),i=0;d>i;++i)e.push(B.edge_object(a,b[i],b[(i+1)%d],{distance:g}));for(i=0;d/2>i;++i)e.push(B.edge_object(a,b[i],b[(i+f)%d],{distance:h})),d%2&&i!=Math.floor(d/2)&&e.push(B.edge_object(a,b[i],b[(i+d-f)%d],{distance:h}));return e},B.build_type_graph=function(a,b,c,d,e,f){var g={},h={},i={};return a.forEach(function(a){g[c(a)]=a;var b=d(a);h[b]||(h[b]={type:b})}),b.forEach(function(a){var b,c,h=e(a),j=f(a);if(!(b=g[h]))throw new Error("source key "+h+" not found!");if(!(c=g[j]))throw new Error("target key "+j+" not found!");var k=d(b)+"/"+d(c);i[k]||(i[k]={type:k,source:d(b),target:d(c)})}),{nodes:Object.keys(h).map(function(a){return h[a]}),edges:Object.keys(i).map(function(a){return i[a]})}},B.d3=a,B.crossfilter=b,B.dc=c,B}if("function"==typeof define&&define.amd)define(["d3","crossfilter","dc"],a);else if("object"==typeof module&&module.exports){var b=require("d3"),c=require("crossfilter");"function"!=typeof c&&(c=c.crossfilter);var d=require("dc");module.exports=a(b,c,d)}else this.dc_graph=a(d3,crossfilter,dc)}();
//# sourceMappingURL=dc.graph.min.js.map