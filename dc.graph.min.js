/*!
 *  dc.graph 0.1.0
 *  http://dc-js.github.io/dc.graph.js/
 *  Copyright 2015 Gordon Woodhull
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

!function(){function a(a,b,c){"use strict";function d(a,b){return function(){return a(b.apply(null,arguments))}}function e(a,b,c,d){var e=Math.tan(Math.atan2(d,c));e*=e;var f={x:a*b/Math.sqrt(b*b+a*a*e),y:a*b/Math.sqrt(a*a+b*b/e)};return 0>c&&(f.x=-f.x),0>d&&(f.y=-f.y),f}function f(a,b,c){return b>=a-m&&c+m>=b}function g(a,b,c,d,e,g,h,i){var j=((a*d-b*c)*(e-h)-(a-c)*(e*i-g*h))/((a-c)*(g-i)-(b-d)*(e-h)),k=((a*d-b*c)*(g-i)-(b-d)*(e*i-g*h))/((a-c)*(g-i)-(b-d)*(e-h));if(isNaN(j)||isNaN(k))return!1;if(a>=c){if(!f(c,j,a))return!1}else if(!f(a,j,c))return!1;if(b>=d){if(!f(d,k,b))return!1}else if(!f(b,k,d))return!1;if(e>=h){if(!f(h,j,e))return!1}else if(!f(e,j,h))return!1;if(g>=i){if(!f(i,k,g))return!1}else if(!f(g,k,i))return!1;return{x:j,y:k}}function h(a,b,c,d,e){for(var f=0;f<a.length;f+=2){var h=f===a.length-2?0:f+2,i=g(a[f],a[f+1],a[h],a[h+1],b,c,d,e);if(i)return i}return null}function i(a,b,c){for(var d=["M",a[0],",",a[1]],e=b,f=!1,g=2;g<a.length;g+=2)(isNaN(a[g])||isNaN(a[g+1]))&&(f=!0),d.push(e===b?n[b]:" ",a[g],",",a[g+1]),0===--e&&(e=b);return e!=b&&console.log("warning: pts.length didn't match bezness",a,b),c&&d.push("Z"),d.join("")}var j={version:"0.1.0"},k=function(a){var b=a,c=null,d=function(a){return arguments.length?(b=a,c&&c(a),this):b};return d.react=function(a){return arguments.length?(c=a,this):c},d},l=function(a){return a};j.functor_wrap=function(a,b){return"function"==typeof a?b?function(c){return a(b(c))}:a:function(){return a}};var m=1e-7,n={1:"L",2:"Q",3:"C"};return j.diagram=function(f,g){function m(a){return j.functor_wrap(a,function(a){return a.orig})}function n(){switch(G=cola.d3adaptor().avoidOverlaps(!0).size([B.width(),B.height()]),B.lengthStrategy()){case"symmetric":G.symmetricDiffLinkLengths(B.baseLength());break;case"jaccard":G.jaccardLinkLengths(B.baseLength());break;case"individual":G.linkDistance(function(a){var b=a.orig?m(B.edgeDistanceAccessor())(a):a.internal&&a.internal.distance;return b||B.baseLength()});break;case"none":}B.modLayout()&&B.modLayout()(G)}function o(a){return"edge-"+m(B.edgeKeyAccessor())(a).replace(/[^\w-_]/g,"-")}function p(a){return!!a.source&&!!a.target}function q(){H.end(),J=!1,M&&(M=!1,window.setTimeout(function(){B.startLayout()},0))}function r(a,b,c,d,f){var g,j,k,l,n,o,p=d-b,q=f-c,r=a.source.dcg_ry+m(B.nodeStrokeWidthAccessor())(a.source)/2,s=a.target.dcg_ry+m(B.nodeStrokeWidthAccessor())(a.target)/2;if(a.parallel){var t=!!(a.parallel%2)==d>b?-1:1,u=Math.floor((a.parallel+1)/2)*t,v=Math.atan2(q,p),w=v+u*B.parallelEdgeOffset()/r,x=v-Math.PI-u*B.parallelEdgeOffset()/s,y=Math.cos(w),z=Math.sin(w),A=Math.cos(x),C=Math.sin(x),D=Math.hypot(d-b,f-c);n=e(a.source.dcg_rx,a.source.dcg_ry,y,z),o=e(a.target.dcg_rx,a.target.dcg_ry,A,C);var E=Math.hypot(n.x,n.y),F=Math.hypot(o.x,o.y),G=Math.max(E+r/4,Math.min(2*E,D/2)),H=Math.min(F+s/4,Math.min(2*F,D/2));g=b+n.x,j=c+n.y;var I=b+G*y,J=c+G*z,K=d+H*A,L=f+H*C;return k=d+o.x,l=f+o.y,a.length=Math.hypot(k-g,l-j),i([g,j,I,J,K,L,k,l],3)}switch(m(B.nodeShape())(a).shape){case"ellipse":n=e(a.source.dcg_rx,a.source.dcg_ry,p,q),o=e(a.target.dcg_rx,a.target.dcg_ry,-p,-q);break;case"polygon":n=h(a.source.dcg_points,0,0,p,q),o=h(a.target.dcg_points,0,0,-p,-q),console.assert(n),console.assert(o)}return g=b+n.x,j=c+n.y,k=d+o.x,l=f+o.y,a.length=Math.hypot(k-g,l-j),i([g,j,k,l],1)}function s(a){return r(a,a.source.prevX||a.source.x,a.source.prevY||a.source.y,a.target.prevX||a.target.x,a.target.prevY||a.target.y)}function t(a){return r(a,a.source.x,a.source.y,a.target.x,a.target.y)}function u(a,b){a.every(function(a){return 0===a.size()})&&b();var c=0;a.forEach(function(a){a.each(function(){++c}).each("end.all",function(){--c||b.apply(this,arguments)})})}function v(a,b,c,d,e,f,g){console.assert(J),console.assert(c.data().every(p)),b.attr("transform",function(a){return"translate("+a.x+","+a.y+")"});var h=a.transition().duration(B.transitionDuration()).attr("opacity","1").attr("transform",function(a){return"translate("+a.x+","+a.y+")"});h.each("end.record",function(a){a.prevX=a.x,a.prevY=a.y}),d.attr("d",s);var i=c.transition().duration(B.transitionDuration()).attr("opacity",m(B.edgeOpacityAccessor())).attr("d",t);B.showLayoutSteps()||u([h,i],q),e.attr("d",t),g.transition().duration(B.transitionDuration()).attr("transform",function(a){if(a.target.x<a.source.x){var b=this.getBBox(),c=b.x+b.width/2,d=b.y+b.height/2;return"rotate(180 "+c+" "+d+")"}return"rotate(0)"}).attr("dy",function(a){return a.target.x<a.source.x?11:-2})}function w(){D.attr("transform","translate("+a.event.translate+") scale("+a.event.scale+")")}function x(){C&&C.attr("width",B.width()).attr("height",B.height())}function y(){return C=B.root().append("svg"),x(),B.defineArrow("vee",12,12,10,0,function(a){a.append("svg:path").attr("d","M0,-5 L10,0 L0,5 L3,0").attr("stroke-width","0px")}),B.defineArrow("dot",7,7,0,0,function(a){a.append("svg:circle").attr("r",5).attr("cx",5).attr("cy",0).attr("stroke-width","0px")}),B.mouseZoomable()&&C.call(a.behavior.zoom().on("zoom",w)),C}var z,A,B={},C=null,D=null,E=null,F=null,G=null,H=a.dispatch("end","start"),I={},J=!1;B.width=k(200).react(x),B.height=k(200).react(x),B.root=k(null).react(function(a){a.empty()&&console.log("Warning: parent selector "+f+" doesn't seem to exist")}),B.mouseZoomable=k(!0),B.nodeDimension=k(),B.nodeGroup=k(),B.edgeDimension=k(),B.edgeGroup=k(),B.nodeKeyAccessor=k(function(a){return a.key}),B.edgeKeyAccessor=k(function(a){return a.key}),B.sourceAccessor=k(function(a){return a.value.sourcename}),B.targetAccessor=k(function(a){return a.value.targetname}),B.nodeRadiusAccessor=k(function(){return 25}),B.nodeStrokeWidthAccessor=k(function(){return"1"}),B.nodeStrokeAccessor=k(function(){return"black"}),B.nodeFillScale=k(l),B.nodeFillAccessor=k(function(){return"white"}),B.nodePadding=k(6),B.nodeLabelAccessor=k(function(a){return a.value.label||a.value.name}),B.nodeLabelFillAccessor=k(null),B.nodeFitLabelAccessor=k(!0),B.nodeShape=k({shape:"ellipse"}),B.nodeTitleAccessor=k(function(a){return B.nodeKeyAccessor()(a)}),B.nodeOrdering=k(null),B.nodeFixedAccessor=k(null),B.edgeStrokeAccessor=k(function(){return"black"}),B.edgeStrokeWidthAccessor=k(function(){return"1"}),B.edgeOpacityAccessor=k(function(){return"1"}),B.edgeLabelAccessor=k(function(a){return B.edgeKeyAccessor()(a)}),B.edgeArrowheadAccessor=k(function(){return"vee"}),B.edgeArrowtailAccessor=k(function(){return null}),B.edgeIsLayoutAccessor=k(function(a){return!a.value.notLayout}),B.lengthStrategy=k("symmetric"),B.edgeDistanceAccessor=k(function(a){return a.value.distance}),B.baseLength=k(30),B.highlightNeighbors=k(!1),B.transitionDuration=k(500),B.timeLimit=k(0),B.constrain=k(function(){return[]}),B.parallelEdgeOffset=k(5),B.edgeOrdering=k(null),B.initLayoutOnRedraw=k(!1),B.layoutUnchanged=k(!1),B.relayout=function(){return z=A=null,this},B.induceNodes=k(!1),B.modLayout=k(function(){}),B.showLayoutSteps=k(!1),B.legend=k(null).react(function(a){a.parent(B)});var K={},L={};B._buildNode=function(a,b){B.nodeTitleAccessor()&&b.append("title"),b.append(function(a){var b,c=m(B.nodeShape())(a).shape;switch(c){case"ellipse":b="ellipse";break;case"polygon":b="path";break;default:throw new Error("unknown shape "+c)}return document.createElementNS("http://www.w3.org/2000/svg",b)}).attr("class","node-shape"),b.append("text").attr("class","node-label").attr("fill",m(B.nodeLabelFillAccessor())),a.select("title").text(m(B.nodeTitleAccessor())),a.select("text.node-label").text(m(B.nodeLabelAccessor())).each(function(a){var b,c=m(B.nodeRadiusAccessor())(a),d=2*c+B.nodePadding();m(B.nodeFitLabelAccessor())(a)&&(b=this.getBBox());var e=0;if(b&&b.width&&b.height&&"ellipse"===m(B.nodeShape())(a).shape){var f=b.height/2/c,g=b.width/2/Math.sqrt(1-f*f);e=2*g+B.nodePadding(),a.dcg_rx=Math.max(g,c),a.dcg_ry=c}else a.dcg_rx=a.dcg_ry=c;a.width=Math.max(e,d),a.height=d}),a.select("ellipse.node-shape").attr("rx",function(a){return a.dcg_rx}).attr("ry",function(a){return a.dcg_ry}),a.select("path.node-shape").attr("d",function(a){for(var b=m(B.nodeRadiusAccessor())(a),c=m(B.nodeShape())(a).sides||4,d=c%2?0:.5,e=[],f=0;c>f;++f){var g=-((f+d)/c+.25)*Math.PI*2;e.push(b*Math.cos(g),b*Math.sin(g))}return a.dcg_points=e,i(e,1,!0)}),a.select(".node-shape").attr("stroke",m(B.nodeStrokeAccessor())).attr("stroke-width",m(B.nodeStrokeWidthAccessor())).attr("fill",d(B.nodeFillScale(),m(B.nodeFillAccessor())))},B.isRunning=function(){return J};var M=!1;return B.redraw=function(){return J?(M=!0,this):B.startLayout()},B.startLayout=function(){function c(a){var b=B.nodeKeyAccessor()(a);K[b]||(K[b]={});var c=K[b];c.orig=a;var d;return B.nodeFixedAccessor()&&(d=B.nodeFixedAccessor()(a)),d?(c.x=a.x,c.y=a.y,c.fixed=!0):c.fixed=!1,h[b]=!0,c}function d(a){var b=B.edgeKeyAccessor()(a);L[b]||(L[b]={});var c=L[b];return c.orig=a,c.source=K[B.sourceAccessor()(a)],c.target=K[B.targetAccessor()(a)],i[b]=!0,c}function e(a){return a.orig}var f=B.nodeGroup().all(),g=B.edgeGroup().all();if(J)throw new Error("dc_graph.diagram.redraw already running!");J=!0,G&&G.stop(),B.initLayoutOnRedraw()&&n(),B.nodeOrdering()&&(f=b.quicksort.by(B.nodeOrdering())(f.slice(0),0,f.length)),B.edgeOrdering()&&(g=b.quicksort.by(B.edgeOrdering())(g.slice(0),0,g.length));var h={},i={},k=f.map(c);for(var l in K)h[l]||delete K[l];var r=g.map(d);for(var s in L)i[s]||delete L[s];if(r=r.filter(p),r=r.filter(function(a){return a.source!==a.target}),B.induceNodes()){var t={};r.forEach(function(a){t[m(B.sourceAccessor())(a)]=!0,t[m(B.targetAccessor())(a)]=!0}),k=k.filter(function(a){return t[m(B.nodeKeyAccessor())(a)]})}k.forEach(function(a,b){a.index=b}),I={nnodes:k.length,nedges:r.length};var u=!1;if(!B.layoutUnchanged()){var w=JSON.stringify(k.map(e)),x=JSON.stringify(r.map(e));w===z&&x===A&&(u=!0),z=w,A=x}if(B.parallelEdgeOffset()){for(var y=new Array(k.length),C=0;C<y.length;++C){y[C]=new Array(y.length);for(var D=0;D<y.length;++D)y[C][D]=0}r.forEach(function(a){var b=Math.min(a.source.index,a.target.index),c=Math.max(a.source.index,a.target.index);a.parallel=y[b][c]++})}var N=F.selectAll(".edge").data(r,m(B.edgeKeyAccessor())),O=N.enter().append("svg:path").attr({"class":"edge",id:o,opacity:0});N.attr("stroke",m(B.edgeStrokeAccessor())).attr("stroke-width",m(B.edgeStrokeWidthAccessor())).attr("marker-end",function(a){var b=m(B.edgeArrowheadAccessor())(a);return b?"url(#"+b+")":null}).attr("marker-start",function(a){var b=m(B.edgeArrowtailAccessor())(a);return b?"url(#"+b+")":null}),N.exit().transition().duration(B.transitionDuration()).attr("opacity",0).remove();var P=F.selectAll(".edge-hover").data(r,m(B.edgeKeyAccessor())),Q=P.enter().append("svg:path").attr("class","edge-hover").attr("opacity",0).attr("stroke","green").attr("stroke-width",10).on("mouseover",function(b){a.select("#"+o(b)+"-label").attr("visibility","visible")}).on("mouseout",function(b){a.select("#"+o(b)+"-label").attr("visibility","hidden")});P.exit().remove();var R=F.selectAll(".edge-label").data(r,m(B.edgeKeyAccessor())),S=R.enter().append("text").attr("id",function(a){return o(a)+"-label"}).attr("visibility","hidden").attr({"class":"edge-label","text-anchor":"middle",dy:-2}).append("textPath").attr("startOffset","50%").attr("xlink:href",function(a){return"#"+o(a)}).text(function(a){return m(B.edgeLabelAccessor())(a)});R.exit().transition().duration(B.transitionDuration()).attr("opacity",0).remove();var T=E.selectAll(".node").data(k,m(B.nodeKeyAccessor())),U=T.enter().append("g").attr("class","node").attr("opacity","0").call(G.drag);B.highlightNeighbors()&&U.on("mouseover",function(a){N.attr("stroke-width",function(b){return(b.source===a||b.target===a?2:1)*m(B.edgeStrokeWidthAccessor())(b)})}).on("mouseout",function(){N.attr("stroke-width",m(B.edgeStrokeWidthAccessor()))}),B._buildNode(T,U),T.exit().transition().duration(B.transitionDuration()).attr("opacity",0).remove();var V=B.constrain()(k,r);V.forEach(function(a){if(a.type)switch(a.type){case"alignment":a.offsets.forEach(function(a){a.node=K[a.node].index});break;case"circle":a.nodes.forEach(function(a){a.node=K[a.node].index})}else a.axis&&(a.left=K[a.left].index,a.right=K[a.right].index)}),G.on("tick",function(){var a=Date.now()-Z;B.showLayoutSteps()&&v(T,U,N,O,P,Q,R,S),(M||B.timeLimit()&&a>B.timeLimit())&&(console.log("cancelled"),G.stop())});var W=r.filter(m(B.edgeIsLayoutAccessor())),X=(r.filter(function(a){return!m(B.edgeIsLayoutAccessor())(a)}),V.filter(function(a){return"circle"===a.type}));V=V.filter(function(a){return"circle"!==a.type}),X.forEach(function(a){var b=(a.distance||4*B.baseLength())/(2*Math.sin(Math.PI/a.nodes.length)),c=a.nodes.map(function(a){return a.node}),d=function(a){return m(B.nodeKeyAccessor())(k[a])},e=j.wheel_edges(d,c,b).map(function(a){var b={internal:a};return b.source=K[a.sourcename],b.target=K[a.targetname],b});W=W.concat(e)});var Y=V.filter(function(a){return"ordering"===a.type});if(V=V.filter(function(a){return"ordering"!==a.type}),Y.forEach(function(a){var c,d=b.quicksort.by(m(a.ordering))(a.nodes.map(function(a){return K[a]}),0,a.nodes.length);d.forEach(function(b,d){0===d?c=b:V.push({left:c.index,right:(c=b).index,axis:a.axis,gap:a.gap})})}),u)return J=!1,H.end(),this;var Z=Date.now();return G.nodes(k).links(W).constraints(V),H.start(),window.setTimeout(function(){G.start(10,20,20).on("end",function(){B.showLayoutSteps()?q():v(T,U,N,O,P,Q,R,S)}).on("start",function(){console.log("COLA START"),H.start()})}),this},B.render=function(){return B.initLayoutOnRedraw()||n(),B.resetSvg(),D=C.append("g").attr("class","dc-graph"),F=D.append("g"),E=D.append("g"),B.legend()&&B.legend().render(),B.redraw()},B.on=function(a,b){return H.on(a,b),this},B.getStats=function(){return I},B.select=function(a){return B.root().select(a)},B.selectAll=function(a){return B.root()?B.root().selectAll(a):null},B.svg=function(a){return arguments.length?(C=a,B):C},B.resetSvg=function(){return B.select("svg").remove(),y()},B.redrawGroup=function(){c.redrawAll(g)},B.renderGroup=function(){c.renderAll(g)},B.defineArrow=function(a,b,c,d,e,f){C.append("svg:defs").append("svg:marker").attr("id",a).attr("viewBox","0 -5 10 10").attr("refX",d).attr("refY",e).attr("markerUnits","userSpaceOnUse").attr("markerWidth",b).attr("markerHeight",c).attr("orient","auto").call(f)},B.root(a.select(f)),c.registerChart(B,g),B},j.legend=function(){var a={},b=null;return a.x=k(0),a.y=k(0),a.gap=k(5),a.nodeWidth=k(40),a.nodeHeight=k(40),a.exemplars=k({}),a.parent=k(null),a.render=function(){var c=a.parent().svg().selectAll("g.dc-graph-legend").data([0]).enter();b=c.append("g").attr("class","dc-graph-legend").attr("transform","translate("+a.x()+","+a.y()+")");var d,e=a.exemplars();if(e instanceof Array)d=e.map(function(a){return{name:a.name,orig:{key:a.key,value:a.value}}});else{d=[];for(var f in e)d.push({name:f,orig:{key:f,value:e[f]}})}var g=b.selectAll(".node").data(d,function(a){return a.name}),h=g.enter().append("g").attr("class","node").attr("transform",function(b,c){return"translate("+a.nodeWidth()/2+","+(a.nodeHeight()+a.gap())*(c+.5)+")"});h.append("text").attr("class","legend-label").attr("transform","translate("+(a.nodeWidth()/2+a.gap())+",0)").text(function(a){return a.name}),a.parent()._buildNode(g,h)},a},j.load_graph=function(b,c){var d=b.replace(/\?.*/,"");/\.json$/.test(d)?a.json(b,c):/\.gv|\.dot$/.test(d)&&a.text(b,function(a,b){if(a)return void c(a,null);var d=graphlibDot.parse(b),e=d.nodes(),f=new Array(e.length);e.forEach(function(a,b){var c=f[b]=d._nodes[e[b]];c.id=b,c.name=a});var g=d.edges(),h=[];g.forEach(function(a){var b=d._edges[a];h.push({source:d._nodes[b.u].id,target:d._nodes[b.v].id,sourcename:b.u,targetname:b.v})});var i={nodes:f,links:h};c(null,i)})},j.node_name=function(a){if(26>a)return String.fromCharCode(97+a);if(52>a)return String.fromCharCode(65+a-26);if(2704>a)return j.node_name(Math.floor(a/52))+j.node_name(a%52);throw new Error("no, that's too large")},j.node_object=function(a,b){return b=b||{},_.extend({id:a,name:j.node_name(a)},b)},j.edge_object=function(a,b,c,d){return d=d||{},_.extend({source:b,target:c,sourcename:a(b),targetname:a(c)},d)},j.generate=function(a,b,c,d){var e,f,g,h,i=c.nodePrefix||"",k=function(a){return e[a].name},l=b[0],m=c.linkLength||30;switch(a){case"clique":case"cliquestf":for(e=new Array(l),f=[],g=0;l>g;++g)for(e[g]=j.node_object(g,{circle:"A",name:i+j.node_name(g)}),h=0;g>h;++h)f.push(j.edge_object(k,g,h,{notLayout:!0,undirected:!0}));if("cliquestf"===a)for(g=0;l>g;++g)e[g+l]=j.node_object(g+l),e[g+2*l]=j.node_object(g+2*l),f.push(j.edge_object(k,g,g+l,{undirected:!0})),f.push(j.edge_object(k,g,g+2*l,{undirected:!0}));break;case"wheel":for(e=new Array(l),g=0;l>g;++g)e[g]=j.node_object(g,{name:i+j.node_name(g)});f=j.wheel_edges(k,_.range(l),l*m/2);var n=f[0].distance;for(g=0;g<b[1];++g)for(h=0;l>h;++h)f.push(j.edge_object(k,h,(h+1)%l,{distance:n,par:g+2}));break;default:throw new Error("unknown generation type "+a)}var o={nodes:e,links:f};d(null,o)},j.wheel_edges=function(a,b,c){for(var d=b.length,e=[],f=Math.floor(d/2),g=2*c*Math.sin(Math.PI/d),h=2*c*Math.sin(f*Math.PI/d),i=0;d>i;++i)e.push(j.edge_object(a,b[i],b[(i+1)%d],{distance:g}));for(i=0;d/2>i;++i)e.push(j.edge_object(a,b[i],b[(i+f)%d],{distance:h})),d%2&&i!=Math.floor(d/2)&&e.push(j.edge_object(a,b[i],b[(i+d-f)%d],{distance:h}));return e},j.d3=a,j.crossfilter=b,j.dc=c,j}if("function"==typeof define&&define.amd)define(["d3","crossfilter","dc"],a);else if("object"==typeof module&&module.exports){var b=require("d3"),c=require("crossfilter");"function"!=typeof c&&(c=c.crossfilter);var d=require("dc");module.exports=a(b,c,d)}else this.dc_graph=a(d3,crossfilter,dc)}();
//# sourceMappingURL=dc.graph.min.js.map