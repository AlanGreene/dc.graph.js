/*!
 *  dc.graph 0.7.1
 *  http://dc-js.github.io/dc.graph.js/
 *  Copyright 2015-2016 AT&T Intellectual Property & the dc.graph.js Developers
 *  https://github.com/dc-js/dc.graph.js/blob/master/AUTHORS
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 */

!function(){function e(e,t,n){"use strict";function r(e){return e.orig}function o(e){return e}function a(){var e={},t=function(t,n){return 1===arguments.length?e[t]:e[t]===n?this:(e[t]&&e[t].parent(null),e[t]=n,n&&n.parent(this),this)};return t.enum=function(){return Object.keys(e)},t.nameOf=function(t){var n=Object.entries(e).find(function(e){return e[1]==t});return n?n[0]:null},t}function i(e,t){var n=J(t),r=function(){return arguments.length?(console.warn(e),n.apply(J,arguments),this):n()};return["cascade","_eval","eval","react"].forEach(function(e){r[e]=n[e]}),r}function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function c(e){try{return e.getBBox()}catch(e){return{x:0,y:0,width:0,height:0}}}function l(e,t){return function(n,r){return e(n)?t(n):r()}}function s(t,n){return function(r,o){return e.interpolate(o(r),n(r))(t(r))}}function d(e,t,n){var r={};for(var o in t)r[o]=n(e,p(t[o]));return r}function f(e,t){return d(e,t,l)}function g(e,t,n){var r={},o={},a=[];for(var i in n)/^node/.test(i)?r[i]=n[i]:/^edge/.test(i)?o[i]=n[i]:a.push(i);a.length&&console.error('only know how to deal with properties that start with "node" or "edge"',a);var u=e?f(e,r):{};return t&&Object.assign(u,f(t,o)),u}function h(e){return function(t,n,r){for(var o in r){if(!e[o])throw new Error("unknown attribute "+o);e[o].cascade(t,n?r[o]:null)}return e}}function p(e){return $.functor_wrap(e,r)}function y(e,t,n){for(var r=["M",e[0].x,",",e[0].y],o=t,a=1;a<e.length;++a)(isNaN(e[a].x)||isNaN(e[a].y))&&!0,r.push(o===t?Q[t]:" ",e[a].x,",",e[a].y),0==--o&&(o=t);return o!=t&&console.log("warning: pts.length didn't match bezian degree",e,t),n&&r.push("Z"),r.join("")}function v(e){return Promise.resolve(e)}function m(t,n){return!!e.select(t).classed(n)||t.parentElement&&m(t.parentElement,n)}function x(e,t,n,r,o,a,i){a||(a=function(e,t){}),i||(i=function(e){});var u={},c=t.map(function(t){var n=r(t);e[n]||a(n,e[n]={},t);var i=e[n];return o(i,t),u[n]=!0,i});n&&n.forEach(function(t){e[t]||(a(t,e[t]={},null),o(e[t],null)),u[t]||(c.push(e[t]),u[t]=!0)});for(var l in e)u[l]||(i(l,e[l]),delete e[l]);return c}function b(e,t,n){return e-ne<=t&&t<=n+ne}function w(e,t,n,r,o,a,i,u){var c=((e*r-t*n)*(o-i)-(e-n)*(o*u-a*i))/((e-n)*(a-u)-(t-r)*(o-i)),l=((e*r-t*n)*(a-u)-(t-r)*(o*u-a*i))/((e-n)*(a-u)-(t-r)*(o-i));if(isNaN(c)||isNaN(l))return!1;if(e>=n){if(!b(n,c,e))return!1}else if(!b(e,c,n))return!1;if(t>=r){if(!b(r,l,t))return!1}else if(!b(t,l,r))return!1;if(o>=i){if(!b(i,c,o))return!1}else if(!b(o,c,i))return!1;if(a>=u){if(!b(u,l,a))return!1}else if(!b(a,l,u))return!1;return{x:c,y:l}}function k(e,t,n,r,o){for(var a=0;a<e.length;++a){var i=a===e.length-1?0:a+1,u=w(e[a].x,e[a].y,e[i].x,e[i].y,t,n,r,o);if(u)return u}return null}function E(e,t){var n=e.nodeShape.eval(t);return n?"string"==typeof n?{shape:n}:n:re}function S(e){return function(t){var n=E(e,t);t.dcg_shape=function(e,t){var n=t.shape,r=Object.assign({},t);if(delete r.shape,"random"===n){var o=$.available_shapes();n=o[Math.floor(Math.random()*o.length)]}else if(-1!==e.shape.enum().indexOf(n))return e.shape(n).elaborate({shape:n},r);if(!$.shape_presets[n])return console.warn("unknown shape ",n),re;var a=$.shape_presets[n].preset(r);return a.shape=$.shape_presets[n].generator,e.shape(a.shape).elaborate(a,r)}(e,n),t.dcg_shape.abstract=n}}function K(e,t){var n=e.nodeLabelPadding.eval(t);return"number"==typeof n||"string"==typeof n?{x:+n,y:+n}:n}function A(e,t,n){var r=100;if(e(t).val>=0)throw new Error("f(a) must be less than 0");if(e(n).val<=0)throw new Error("f(b) must be greater than 0");for(;;){if(!--r)throw new Error("patience ran out");var o=(t+n)/2,a=e(o),i=a.val;if(Math.abs(i)<.5)return a;i>0?n=o:t=o}}function T(e,t,n,r,o,a,i,u,c,l,s){var d,f,g,h;if(i){var p,y,v=function(t,n,r){return function(o){var a=function(t,n){return e.shape(t.dcg_shape.shape).intersect_vec(t,1e3*Math.cos(n),1e3*Math.sin(n))}(t,o);return a?{port:a,val:Math.hypot(a.x-n.x,a.y-n.y)-r,ang:o}:{port:{x:0,y:0},val:0,ang:o}}},m=Math.atan2(i.sourcePort.y,i.sourcePort.x),x=Math.atan2(i.targetPort.y,i.targetPort.x);try{p=A(v(t.source,i.sourcePort,c),m,m+2*u*c/l)}catch(e){p={ang:m,port:i.sourcePort}}try{y=A(v(t.target,i.targetPort,c),x,x-2*u*c/l)}catch(e){y={ang:x,port:i.targetPort}}d=p.port,f=y.port;var _=Math.hypot(d.x,d.y)+l/2,b=Math.hypot(f.x,f.y)+s/2,w=n+_*Math.cos(p.ang),k=r+_*Math.sin(p.ang),E=o+b*Math.cos(y.ang),S=a+b*Math.sin(y.ang);g=[{x:n+d.x,y:r+d.y},{x:w,y:k},{x:E,y:S},{x:o+f.x,y:a+f.y}],h=3}else d=t.sourcePort.pos,f=t.targetPort.pos,d||(d={x:0,y:0}),f||(f={x:0,y:0}),g=[{x:n+d.x,y:r+d.y},{x:o+f.x,y:a+f.y}],h=1;return{sourcePort:d,targetPort:f,points:g,bezDegree:h}}function P(e){return 1===e.bezDegree&&2===e.points.length||3===e.bezDegree&&4===e.points.length}function N(e){var t=e.points;if(3===e.bezDegree)return t;if(1===e.bezDegree)return[{x:t[0].x,y:t[0].y},{x:t[0].x+(t[1].x-t[0].x)/3,y:t[0].y+(t[1].y-t[0].y)/3},{x:t[0].x+2*(t[1].x-t[0].x)/3,y:t[0].y+2*(t[1].y-t[0].y)/3},{x:t[1].x,y:t[1].y}];throw new Error("unknown bezDegree "+e.bezDegree)}function O(e,t){for(var n=[],r=1;r<e.length;r++){var o=e[r-1],a=e[r];n.push({x:o.x+(a.x-o.x)*t,y:o.y+(a.y-o.y)*t})}return n}function M(e,t){var n=function(e,t){for(var n=[e],r=1;r<e.length;r++)n.push(O(n[n.length-1],t));return n}(e,t);return n[n.length-1][0]}function L(e,t){var n=e[0].x,r=e[0].y,o=e[1].x,a=e[1].y,i=e[2].x,u=e[2].y,c=e[3].x,l=e[3].y,s=(o-n)*t+n,d=(a-r)*t+r,f=(i-o)*t+o,g=(u-a)*t+a,h=(c-i)*t+i,p=(l-u)*t+u,y=(f-s)*t+s,v=(g-d)*t+d,m=(h-f)*t+f,x=(p-g)*t+g,_=(m-y)*t+y,b=(x-v)*t+v;return[[{x:n,y:r},{x:s,y:d},{x:y,y:v},{x:_,y:b}],[{x:_,y:b},{x:m,y:x},{x:h,y:p},{x:c,y:l}]]}function j(e,t){for(var n=[];t>1;){var r=L(e,1/t);n.push(r[0][0],r[0][1],r[0][2]),e=r[1],--t}return n.push.apply(n,e),n}function D(e,t){var n,r=e[0],o=e[e.length-1],a="head"===t?o:r,i=.5;do{n=M(e,i=("head"===t?1+i:i)/2)}while(Math.hypot(a.x-n.x,a.y-n.y)>25);return Math.atan2(a.y-n.y,a.x-n.x)+"rad"}function C(e){return function(t){return{x:t.x+e,y:t.y}}}function R(e,t,n,r){return e[t](n,r)}function I(e,t){for(var n=[];t&&t.length;){var r=/^o?(?:l|r)?/.exec(t),o=!1,a=null;if(r[0])switch(r=r[0],t=t.slice(r.length),o="o"===r[0],r[r.length-1]){case"l":a="left";break;case"r":a="right"}var i=!1;for(var u in e)if(t.substring(0,u.length)===u){i=!0,n.push(R(e,u,o,a)),t=t.slice(u.length);break}if(!i){console.warn("couldn't find arrow name in "+t);break}}return n}function z(e,t){return[e[0]+t[0],e[1]+t[1]]}function F(e,t){return e.map(function(e){return e*t})}function W(e){return function(t){return t||e}}function B(e,t){var n=null;return e.map(function(r,o){var a=ae(r.frontRef).slice(),i=ie(r.backRef).slice();if(r.kernstems){var u=r.kernstems;if("function"==typeof u&&(u=u(t)),0!==o&&u[1]){var c=e[o-1];c.stems&&c.stems[0]&&(a[0]-=u[1])}if(u[0]){var l=!1;if(o===e.length-1)l=!0;else{var s=e[o+1];s.stems&&s.stems[1]&&(l=!0)}l&&(i[0]+=u[0])}}if(0===o)return a,n=i,{backRef:n,offset:[0,0]};var d=function(e,t){return[e[0]-t[0],e[1]-t[1]]}(n,a);return n=z(i,d),{backRef:n,offset:d}})}function q(e,t){var n=null,r=B(e,t);return e.forEach(function(e,t){var o=oe(e.viewBox),a=r[t].offset;n=n?function(e,t){var n=Math.min(e[0],t[0]),r=Math.min(e[1],t[1]);return[n,r,Math.max(e[0]+e[2],t[0]+t[2])-n,Math.max(e[1]+e[3],t[1]+t[3])-r]}(n,[o[0]+a[0],o[1]+a[1],o[2],o[3]]):o.slice()}),{offsets:r,viewBox:n}}function G(e,t){if(!e.length)return 0;var n=B(e,t);return ae(e[0].frontRef)[0]-n[e.length-1].backRef[0]}function H(e,t,n,r,o){var a=e.arrowId(n,r),i=e.nodeStrokeWidth.eval("tail"===r?n.source:n.target)/2;if(n[r+"ArrowLast"]===o+"-"+i)return a;var u=I(t,o),c=e.addOrRemoveDef(a,!!u.length,"svg:marker");if(u.length){var l=e.edgeArrowSize.eval(n),s=e.edgeStrokeWidth.eval(n)/l,d=q(u,s),f=ae(u[0].frontRef);d.viewBox[0]-=i/l,d.viewBox[3]+=i/l,c.attr("viewBox",d.viewBox.join(" ")).attr("refX",f[0]).attr("refY",f[1]).attr("markerUnits","userSpaceOnUse").attr("markerWidth",d.viewBox[2]*l).attr("markerHeight",d.viewBox[3]*l).attr("stroke",e.edgeStroke.eval(n)).attr("fill",e.edgeStroke.eval(n)),c.html(null),u.forEach(function(e,t){c.call(e.drawFunction,z([-i/l,0],d.offsets[t].offset),s)})}return n[r+"ArrowLast"]=o,o?a:null}function Y(e,t,n){return e||t?(e&&(e=e.replace(/\//g,"%2F")),t&&(t=t.replace(/\//g,"%2F")),(e?"node/"+e:"edge/"+t)+"/"+n):null}function U(e,t,n){if(!n.vec)throw console.assert(!n.edges.length),new Error("port has not been placed, maybe install place_ports? "+n.name);n.pos=e.shape(t.dcg_shape.shape).intersect_vec(t,1e3*n.vec[0],1e3*n.vec[1])}function X(e){var t=function(){return{type:"alignment",axis:e}};return t.listname="offsets",t.wrap=function(e){return{node:e,offset:0}},t}function V(t,n,r){if(n)t(n,null);else{var o=Object.keys(r[0]),a=o[0],i=o[1],u=e.set(r.map(function(e){return e[a]}));r.forEach(function(e){u.add(e[i])}),t(null,{nodes:u=u.values().map(function(e){return{name:e}}),links:r.map(function(e,t){return{key:t,sourcename:e[a],targetname:e[i]}})})}}function Z(e){return(e.nodes||e.vertices)&&(e.edges||e.links)}var $={version:"0.7.1",constants:{CHART_CLASS:"dc-graph"}},J=function(e,t){void 0===t?t=r:!1===t&&(t=o);var n=e,a=null,i=[],u=function(e){return arguments.length?(a&&a(e),n=e,this):n};return u.cascade=function(e,t){for(var n=0;n<i.length;++n){if(i[n].n===e)return t?i[n].f=t:i.splice(n,1),u;if(i[n].n>e)return i.splice(n,0,{n:e,f:t}),u}return i.push({n:e,f:t}),u},u._eval=function(e,n){if(0!==n&&i.length){return i[n-1].f(e,function(){return u._eval(e,n-1)})}return $.functor_wrap(u(),t)(e)},u.eval=function(e){return u._eval(e,i.length)},u.react=function(e){return arguments.length?(a=e,this):a},u};"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a])}return n},writable:!0,configurable:!0}),$.functor_wrap=function(e,t){return"function"==typeof e?t?function(n){return e(t(n))}:e:function(){return e}};var Q={1:"L",2:"Q",3:"C"};Math.hypot=Math.hypot||function(){for(var e=0,t=arguments.length,n=0;n<t;n++){if(arguments[n]===1/0||arguments[n]===-1/0)return 1/0;e+=arguments[n]*arguments[n]}return Math.sqrt(e)},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],o=0;o<n;){var a=t[o];if(e.call(r,a,o,t))return a;o++}}});var ee=function(){var e;return function(){if(void 0===e){e=null;var t=document.getElementsByTagName("script");if(t&&t.length>0)for(var n in t)if(t[n].src&&t[n].src.match(new RegExp("dc.graph.js$"))){e=t[n].src.replace(new RegExp("(.*)dc.graph.js$"),"$1");break}}return e}}();$.event_coords=function(t){var n=t.root().node().getBoundingClientRect();return t.invertCoord([e.event.clientX-n.left,e.event.clientY-n.top])};var te=-1!==navigator.platform.toUpperCase().indexOf("MAC");void 0===SVGElement.prototype.contains&&(SVGElement.prototype.contains=HTMLDivElement.prototype.contains),$.depth_first_traversal=function(e){return function(t,n){function r(t,n){var o=e.nodeid(t);l[o]?e.skip&&e.skip(t,a[o]):(c[n]||(c[n]=[]),e.place&&e.place(t,n,c[n]),c[n].push(t),l[o]=!0,i[o]&&i[o].forEach(function(t,a){var c=u[e.targetid(t)];a&&e.sib&&e.sib(!1,u[e.targetid(i[o][a-1])],c),e.push&&e.push(),r(c,n+1)}),e.pop&&e.pop(t))}e.init&&e.init(),e.tree&&(n=n.filter(function(t){return e.tree(t)}));var o,a={},i=n.reduce(function(t,n){var r=e.sourceid(n),o=e.targetid(n);return t[r]||(t[r]=[]),t[r].push(n),a[o]=(a[o]||0)+1,t},{}),u=t.reduce(function(t,n){return t[e.nodeid(n)]=n,t},{}),c=[],l={};e.root?o=t.filter(function(t){return e.root(t)}):(o=t.filter(function(t){return!a[e.nodeid(t)]}),t.length&&!o.length&&(o=[t[0]])),o.forEach(function(t,n){n&&e.sib&&e.sib(!0,o[n-1],t),e.push&&e.push(),r(t,e.row&&e.row(t)||0)}),e.finish(c)}},$.undirected_dfs=function(e){return function(t,n){function r(t){var n=e.nodeid(t);e.node(u,t),i[n]=!0,o[n]&&o[n].forEach(function(e){i[e]||r(a[e])})}var o=n.reduce(function(t,n){var r=e.sourceid(n),o=e.targetid(n);return t[r]||(t[r]=[]),t[o]||(t[o]=[]),t[r].push(o),t[o].push(r),t},{}),a=t.reduce(function(t,n){return t[e.nodeid(n)]=n,t},{}),i={},u=0;t.forEach(function(t){i[e.nodeid(t)]||(e.comp&&e.comp(u),r(t),++u)})}};var ne=1e-7;$.shape_presets={egg:{generator:"polygon",preset:function(){return{sides:100,distortion:-.25}}},triangle:{generator:"polygon",preset:function(){return{sides:3}}},rectangle:{generator:"polygon",preset:function(){return{sides:4}}},diamond:{generator:"polygon",preset:function(){return{sides:4,rotation:45}}},trapezium:{generator:"polygon",preset:function(){return{sides:4,distortion:-.5}}},parallelogram:{generator:"polygon",preset:function(){return{sides:4,skew:.5}}},pentagon:{generator:"polygon",preset:function(){return{sides:5}}},hexagon:{generator:"polygon",preset:function(){return{sides:6}}},septagon:{generator:"polygon",preset:function(){return{sides:7}}},octagon:{generator:"polygon",preset:function(){return{sides:8}}},invtriangle:{generator:"polygon",preset:function(){return{sides:3,rotation:180}}},invtrapezium:{generator:"polygon",preset:function(){return{sides:4,distortion:.5}}},square:{generator:"polygon",preset:function(){return{sides:4,regular:!0}}},plain:{generator:"rounded-rect",preset:function(){return{noshape:!0}}},house:{generator:"elaborated-rect",preset:function(){return{get_points:function(e,t){return[{x:e,y:2*t/3},{x:e,y:-t/2},{x:0,y:-t},{x:-e,y:-t/2},{x:-e,y:2*t/3}]},minrx:30}}},invhouse:{generator:"elaborated-rect",preset:function(){return{get_points:function(e,t){return[{x:e,y:t/2},{x:e,y:2*-t/3},{x:-e,y:2*-t/3},{x:-e,y:t/2},{x:0,y:t}]},minrx:30}}},rarrow:{generator:"elaborated-rect",preset:function(){return{get_points:function(e,t){return[{x:e,y:t},{x:e,y:1.5*t},{x:e+1.5*t,y:0},{x:e,y:1.5*-t},{x:e,y:-t},{x:-e,y:-t},{x:-e,y:t}]},minrx:30}}},larrow:{generator:"elaborated-rect",preset:function(){return{get_points:function(e,t){return[{x:-e,y:t},{x:-e,y:1.5*t},{x:-e-1.5*t,y:0},{x:-e,y:1.5*-t},{x:-e,y:-t},{x:e,y:-t},{x:e,y:t}]},minrx:30}}},rpromoter:{generator:"elaborated-rect",preset:function(){return{get_points:function(e,t){return[{x:e,y:t},{x:e,y:1.5*t},{x:e+1.5*t,y:0},{x:e,y:1.5*-t},{x:e,y:-t},{x:-e,y:-t},{x:-e,y:1.5*t},{x:0,y:1.5*t},{x:0,y:t}]},minrx:30}}},lpromoter:{generator:"elaborated-rect",preset:function(){return{get_points:function(e,t){return[{x:-e,y:t},{x:-e,y:1.5*t},{x:-e-1.5*t,y:0},{x:-e,y:1.5*-t},{x:-e,y:-t},{x:e,y:-t},{x:e,y:1.5*t},{x:0,y:1.5*t},{x:0,y:t}]},minrx:30}}},cds:{generator:"elaborated-rect",preset:function(){return{get_points:function(e,t){return[{x:e,y:t},{x:e+t,y:0},{x:e,y:-t},{x:-e,y:-t},{x:-e,y:t}]},minrx:30}}}},$.shape_presets.box=$.shape_presets.rect=$.shape_presets.rectangle,$.available_shapes=function(){var e=Object.keys($.shape_presets);return e.slice(0,e.length-1)};var re={shape:"ellipse"};$.no_shape=function(){return{parent:J(null),elaborate:function(e,t){return Object.assign(e,t)},useTextSize:function(){return!1},useRadius:function(){return!1},usePaddingAndStroke:function(){return!1},intersect_vec:function(e,t,n){return{x:0,y:0}},calc_radii:function(e,t,n){return{rx:0,ry:0}},create:function(e){},replace:function(e){},update:function(e){}}},$.ellipse_shape=function(){var e={parent:J(null),elaborate:function(e,t){return Object.assign(e,t)},intersect_vec:function(e,t,n){return function(e,t,n,r){var o=Math.tan(Math.atan2(r,n));o*=o;var a={x:e*t/Math.sqrt(t*t+e*e*o),y:e*t/Math.sqrt(e*e+t*t/o)};return n<0&&(a.x=-a.x),r<0&&(a.y=-a.y),a}(e.dcg_rx,e.dcg_ry,t,n)},calc_radii:function(e,t,n){t=Math.max(t,n.height/2+5);var r=n.width/2,o=n.height/2/t;return r/=Math.sqrt(1-o*o),r=Math.max(r,t),{rx:r,ry:t}},create:function(e){e.insert("ellipse",":first-child").attr("class","node-shape")},update:function(t){t.select("ellipse.node-shape").attr((e.parent(),{rx:function(e){return e.dcg_rx},ry:function(e){return e.dcg_ry}}))}};return e},$.polygon_shape=function(){var t={parent:J(null),elaborate:function(e,t){return Object.assign(e,t)},intersect_vec:function(e,t,n){return k(e.dcg_points,0,0,t,n)},calc_radii:function(e,t,n){t=Math.max(t,n.height/2+5);var r=n.width/2;return r=r*Math.sqrt(2)/Math.cos(Math.PI/(e.dcg_shape.sides||4)),{rx:r,ry:t}},create:function(e){e.insert("path",":first-child").attr("class","node-shape")},update:function(n){n.select("path.node-shape").attr((t.parent(),{d:function(t){var n=t.dcg_rx,r=t.dcg_ry,o=t.dcg_shape,a=o.sides||4,i=o.skew||0,u=o.distortion||0,c=o.rotation||0,l=a%2?0:.5,s=[];c=c/360+.25;for(var d=0;d<a;++d){var f=-((d+l)/a+c)*Math.PI*2;s.push({x:Math.cos(f),y:Math.sin(f)})}var g=e.extent(s,function(e){return e.y});return o.regular?n=r=Math.max(n,r):n<r&&!o.squeeze?n=r:r/=Math.min(-g[0],g[1]),t.dcg_points=s.map(function(e){var t=n*e.x,o=r*e.y;return t*=1+u*((r-o)/r-1),t-=i*o/2,{x:t,y:o}}),y(t.dcg_points,1,!0)}}))}};return t},$.rounded_rectangle_shape=function(){return{parent:J(null),elaborate:function(e,t){return e=Object.assign({rx:10,ry:10},e),Object.assign(e,t)},intersect_vec:function(e,t,n){return k([{x:e.dcg_rx,y:e.dcg_ry},{x:e.dcg_rx,y:-e.dcg_ry},{x:-e.dcg_rx,y:-e.dcg_ry},{x:-e.dcg_rx,y:e.dcg_ry}],0,0,t,n)},useRadius:function(e){return!e.noshape},calc_radii:function(e,t,n){var r=n.height/2;return e.dcg_shape.noshape||(r+=5),{rx:n.width/2,ry:Math.max(t,r)}},create:function(e){e.filter(function(e){return!e.dcg_shape.noshape}).insert("rect",":first-child").attr("class","node-shape")},update:function(e){e.select("rect.node-shape").attr({x:function(e){return-e.dcg_rx},y:function(e){return-e.dcg_ry},width:function(e){return 2*e.dcg_rx},height:function(e){return 2*e.dcg_ry},rx:function(e){return e.dcg_shape.rx+"px"},ry:function(e){return e.dcg_shape.ry+"px"}})}}},$.elaborated_rectangle_shape=function(){var e=$.rounded_rectangle_shape();e.intersect_vec=function(e,t,n){return k(e.dcg_shape.get_points(e.dcg_rx,e.dcg_ry),0,0,t,n)},delete e.useRadius;var t=e.calc_radii;return e.calc_radii=function(e,n,r){var o=t(e,n,r);return{rx:Math.max(o.rx,e.dcg_shape.minrx),ry:o.ry}},e.create=function(e){e.insert("path",":first-child").attr("class","node-shape")},e.update=function(e){e.select("path.node-shape").attr("d",function(e){return y(e.dcg_shape.get_points(e.dcg_rx,e.dcg_ry),1,!0)})},e},$.builtin_arrows={box:function(e,t){return e?{frontRef:[8,0],drawFunction:function(e,n,r){e.append("rect").attr({x:n[0]+.5,y:"right"===t?0:-3.5,width:7,height:t?3.5:7,"stroke-width":1,fill:"none"}),t&&e.append("svg:path").attr({d:["M",n[0],0,"h",8].join(" "),"stroke-width":r,fill:"none"})}}:{frontRef:[8,0],drawFunction:function(e,n,r){e.append("rect").attr({x:n[0],y:"right"===t?-r/2:-4,width:8,height:t?4+r/2:8,"stroke-width":0})}}},curve:function(e,t){return{stems:[!0,!1],kernstems:[0,.25],frontRef:[8,0],drawFunction:function(e,n,r){var o=[];o.push("M",("left"===t?7.5:4)+n[0],"left"===t?r/2:3.5),"left"===t&&o.push("v",-r/2),o.push("A",3.5,3.5,0,0,0,("right"===t?7.5:4)+n[0],"right"===t?0:-3.5),"right"===t&&o.push("v",-r/2),e.append("svg:path").attr({d:o.join(" "),"stroke-width":1,fill:"none"}),e.append("svg:path").attr({d:["M",7+n[0],0,"h  -7"].join(" "),"stroke-width":r,fill:"none"})}}},icurve:function(e,t){return{stems:[!1,!0],kernstems:[.25,0],frontRef:[8,0],drawFunction:function(e,n,r){var o=[];o.push("M",("left"===t?.5:4)+n[0],"left"===t?r/2:3.5),"left"===t&&o.push("v",-r/2),o.push("A",3.5,3.5,0,0,1,("right"===t?.5:4)+n[0],"right"===t?0:-3.5),"right"===t&&o.push("v",-r/2),e.append("svg:path").attr({d:o.join(" "),"stroke-width":1,fill:"none"}),e.append("svg:path").attr({d:["M",1+n[0],0,"h 7"].join(" "),"stroke-width":r,fill:"none"})}}},diamond:function(e,t){return e?{frontRef:[t?11.25:12,0],backRef:[t?.75:0,0],viewBox:[0,-4,12,8],stems:[!!t,!!t],kernstems:function(e){return[t?0:.75*e,t?0:.75*e]},drawFunction:function(e,n,r){var o=[{x:.9,y:0}];"left"!==t?o.push({x:6,y:3.4}):o.push({x:6,y:-3.4}),o.push({x:11.1,y:0}),t||o.push({x:6,y:-3.4});var a=o.map(C(n[0]));e.append("svg:path").attr({d:y(a,1,!t),"stroke-width":1,fill:"none"}),t&&e.append("svg:path").attr({d:["M",.75+n[0],0,"h 10.5"].join(" "),"stroke-width":r,fill:"none"})}}:{frontRef:[t?11.25:12,0],backRef:[t?.75:0,0],viewBox:[0,-4,12,8],stems:[!!t,!!t],kernstems:function(e){return[t?0:.75*e,t?0:.75*e]},drawFunction:function(e,n,r){var o=[{x:0,y:0}];"left"!==t?o.push({x:6,y:4}):o.push({x:6,y:-4}),o.push({x:12,y:0}),t||o.push({x:6,y:-4});var a=o.map(C(n[0]));e.append("svg:path").attr({d:y(a,1,!0),"stroke-width":0}),t&&e.append("svg:path").attr({d:["M",.75+n[0],0,"h 10.5"].join(" "),"stroke-width":r,fill:"none"})}}},dot:function(e,t){return e?{frontRef:[8,0],stems:[!!t,!!t],drawFunction:function(e,n,r){t?(e.append("svg:path").attr({d:["M",.5+n[0],0,"A",3.5,3.5,0,0,"left"===t?1:0,7.5+n[0],0].join(" "),"stroke-width":1,fill:"none"}),e.append("svg:path").attr({d:["M",n[0],0,"h 8"].join(" "),"stroke-width":r,fill:"none"})):e.append("svg:circle").attr("r",3.5).attr("cx",4+n[0]).attr("cy",0).attr("fill","none").attr("stroke-width","1px")}}:{frontRef:[8,0],stems:[!!t,!!t],drawFunction:function(e,n,r){t?(e.append("svg:path").attr({d:["M",n[0],0,"A",4,4,0,0,"left"===t?1:0,8+n[0],0].join(" "),"stroke-width":0}),e.append("svg:path").attr({d:["M",n[0],0,"h 8"].join(" "),"stroke-width":r,fill:"none"})):e.append("svg:circle").attr("r",4).attr("cx",4+n[0]).attr("cy",0).attr("stroke-width","0px")}}},normal:function(e,t){return e?{frontRef:[t?8-4/3:8,0],viewBox:[0,-3,8,6],kernstems:function(e){return[0,4*e/3]},drawFunction:function(e,n,r){var o=(t?[{x:.5,y:0},{x:.5,y:"left"===t?-2.28:2.28},{x:8-4/3,y:0}]:[{x:.5,y:2.28},{x:6.57,y:0},{x:.5,y:-2.28}]).map(C(n[0]));e.append("svg:path").attr({d:y(o,1,!t),"stroke-width":1,fill:"none"}),t&&e.append("svg:path").attr({d:["M",n[0],0,"h",8-4/3].join(" "),"stroke-width":r,fill:"none"})}}:{frontRef:[t?8-4/3:8,0],viewBox:[0,-3,8,6],kernstems:function(e){return[0,4*e/3]},drawFunction:function(e,n,r){var o=[];switch("left"===t?o.push({x:0,y:0}):o.push({x:0,y:3}),t){case"left":o.push({x:8-4*r/3,y:-r/2});break;case"right":o.push({x:8-4*r/3,y:r/2});break;default:o.push({x:8,y:0})}"right"===t?o.push({x:0,y:0}):o.push({x:0,y:-3});var a=o.map(C(n[0]));e.append("svg:path").attr("d",y(a,1,!0)).attr("stroke-width","0px"),t&&e.append("svg:path").attr({d:["M",n[0],0,"h",8-4*r/3].join(" "),"stroke-width":r,fill:"none"})}}},inv:function(e,t){return e?{frontRef:[8,0],backRef:[t?4/3:0,0],viewBox:[0,-3,8,6],kernstems:function(e){return[4*e/3,0]},drawFunction:function(e,n,r){var o=(t?[{x:7.5,y:0},{x:7.5,y:"left"===t?-2.28:2.28},{x:1.43,y:0}]:[{x:7.5,y:2.28},{x:1.43,y:0},{x:7.5,y:-2.28}]).map(C(n[0]));e.append("svg:path").attr({d:y(o,1,!t),"stroke-width":1,fill:"none"}),t&&e.append("svg:path").attr({d:["M",4*r/3+n[0],0,"h",8-4/3].join(" "),"stroke-width":r,fill:"none"})}}:{frontRef:[8,0],backRef:[t?4/3:0,0],viewBox:[0,-3,8,6],kernstems:function(e){return[4*e/3,0]},drawFunction:function(e,n,r){var o=[];switch("left"===t?o.push({x:8,y:0}):o.push({x:8,y:3}),t){case"left":o.push({x:4*r/3,y:-r/2});break;case"right":o.push({x:4*r/3,y:r/2});break;default:o.push({x:0,y:0})}"right"===t?o.push({x:8,y:0}):o.push({x:8,y:-3});var a=o.map(C(n[0]));e.append("svg:path").attr("d",y(a,1,!0)).attr("stroke-width","0px"),t&&e.append("svg:path").attr({d:["M",4*r/3+n[0],0,"h",8-4*r/3].join(" "),"stroke-width":r,fill:"none"})}}},tee:function(e,t){return{frontRef:[5,0],viewBox:[0,-5,5,10],stems:[!0,!1],drawFunction:function(e,n,r){var o="right"===t?0:-5,a="left"===t?0:5,i=[{x:2,y:a},{x:5,y:a},{x:5,y:o},{x:2,y:o}].map(C(n[0]));e.append("svg:path").attr("d",y(i,1,!0)).attr("stroke-width","0px"),e.append("svg:path").attr("d",["M",n[0],0,"h",5].join(" ")).attr("stroke-width",r).attr("fill","none")}}},vee:function(e,t){return{stems:[!0,!1],kernstems:function(e){return[0,e]},drawFunction:function(e,n,r){var o=[{x:0,y:-5},{x:10,y:0},{x:0,y:5},{x:5,y:0}];"right"===t?o.splice(0,1,{x:5,y:-r/2},{x:10,y:-r/2}):"left"===t&&o.splice(2,1,{x:10,y:r/2},{x:5,y:r/2});var a=o.map(C(n[0]));e.append("svg:path").attr("d",y(a,1,!0)).attr("stroke-width","0px"),e.append("svg:path").attr("d",["M",n[0]+5,0,"h",-5].join(" ")).attr("stroke-width",r)}}},crow:function(e,t){return{stems:[!1,!0],kernstems:function(e){return[e,0]},drawFunction:function(e,n,r){var o=[{x:10,y:-5},{x:0,y:0},{x:10,y:5},{x:5,y:0}];"right"===t?o.splice(0,1,{x:5,y:-r/2},{x:0,y:-r/2}):"left"===t&&o.splice(2,1,{x:0,y:r/2},{x:5,y:r/2});var a=o.map(C(n[0]));e.append("svg:path").attr("d",y(a,1,!0)).attr("stroke-width","0px"),e.append("svg:path").attr("d",["M",n[0]+5,0,"h",5].join(" ")).attr("stroke-width",r)}}}};var oe=W([0,-5,10,10]),ae=W([10,0]),ie=W([0,0]);$.text_contents=function(){var e={parent:J(null),update:function(t){var n=t.selectAll("text.node-label").data(function(e){return[e]});n.enter().append("text").attr("class","node-label");var r=n.selectAll("tspan").data(function(t){var n=e.parent().nodeLabel.eval(t);if(!n)return[];"string"==typeof n&&(n=[n]);var r=e.parent().nodeLineHeight(),o=1-((n.length-1)*r+1)/2;return n.map(function(e,n){return{node:t,line:e,yofs:(0==n?o:r)+"em"}})});r.enter().append("tspan"),r.attr({"text-anchor":"start","text-decoration":function(t){return e.parent().nodeLabelDecoration.eval(t.node)},x:0}).text(function(e){return e.line}),n.each(function(e){e.xofs=0}).filter(function(t){return"center"!==e.parent().nodeLabelAlignment.eval(t)}).each(function(t){var n=c(this);switch(t.bbox={x:n.x,y:n.y,width:n.width,height:n.height},e.parent().nodeLabelAlignment.eval(t)){case"left":t.xofs=-t.bbox.width/2;break;case"right":t.xofs=t.bbox.width/2}}).selectAll("tspan"),r.attr({"text-anchor":function(t){switch(e.parent().nodeLabelAlignment.eval(t.node)){case"left":return"start";case"center":return"middle";case"right":return"end"}return null},x:function(e){return e.node.xofs},dy:function(e){return e.yofs}}),r.exit().remove(),n.attr("fill",e.parent().nodeLabelFill.eval)},textbox:function(e){var t=c(this.selectContent(e).node());return{x:t.x,y:t.y,width:t.width,height:t.height}},selectContent:function(e){return e.select("text.node-label")},selectText:function(e){return this.selectContent(e)}};return e},$.with_icon_contents=function(t,n,r){var o={parent:J(null).react(function(e){t.parent(e)}),padding:function(e){var t=K(o.parent(),e);return{x:3*t.x,y:3*t.y}},update:function(a){var i=a.selectAll("g.with-icon").data(function(e){return[e]});i.enter().append("g").attr("class","with-icon").append("image").attr({class:"icon",width:n+"px",height:r+"px"}),i.call(t.update),t.selectContent(i).attr("transform","translate("+n/2+")"),i.selectAll("image.icon").attr({href:o.parent().nodeIcon.eval,x:function(r){return-(n+t.textbox(e.select(this.parentNode)).width)/2-K(o.parent(),r).x},y:-r/2})},textbox:function(e){var r=t.textbox(e);return r.x+=n/2,r},selectContent:function(e){return e.select("g.with-icon")},selectText:function(e){return this.selectContent(e).select("text.node-label")}};return o},$.diagram=function(u,l){function s(e){return function(t){ce.layoutEngine()||ce.layoutAlgorithm("cola",!0);var n=ce.layoutEngine();if(n.getEngine&&(n=n.getEngine()),n[e]){if(console.warn("property is deprecated, call on layout engine instead: dc_graph.diagram.%c"+e,"font-weight: bold"),!arguments.length)return n[e]();n[e](t)}else if(console.warn("property is deprecated, and is not supported for Warning: dc_graph.diagram.<b>"+e+'</b> is deprecated, and it is not supported for the "'+n.layoutAlgorithm()+'" layout algorithm: ignored.'),!arguments.length)return null;return this}}function d(e){ce.layoutEngine()||ce.layoutAlgorithm("cola",!0),(e||ce.layoutEngine()).init({width:ce.width(),height:ce.height()})}function f(e){return!!e.source&&!!e.target}function g(){var e=me,t=xe,n=ce.width(),r=ce.height();if(e!==n||t!==r){var o=fe.scale(),a=fe.translate();fe.scale(1).translate([0,0]);var i=ce.x().domain(),u=ce.y().domain();ce.x().domain([i[0],i[0]+(i[1]-i[0])*n/e]).range([0,n]),ce.y().domain([u[0],u[0]+(u[1]-u[0])*r/t]).range([0,r]),fe.x(ce.x()).y(ce.y()).translate(a).scale(o)}}function v(e,t){var n,r=!0;switch(ce.autoZoom()){case"always-skipanimonce":r=!1,ce.autoZoom("always");case"always":n=!0;break;case"once-noanim":r=!1;case"once":n=!0,ce.autoZoom(null);break;default:n=!1}!function(e,t){(ce.fitStrategy()||ce.restrictPan())&&e.size()&&(Fe=e.data().map(C).reduce(R),Fe=t.data().map(F).reduce(R,Fe))}(e,t),n&&W(r)}function m(e,t){var n=t.target.cola.y-t.source.cola.y,r=t.target.cola.x-t.source.cola.x;return t.source!==e&&(n=-n,r=-r),t.parallel&&t.parallel.edges.length>1&&t.source.index>t.target.index&&(n=-n,r=-r),function(e){var t=Math.hypot(e[0],e[1]);return[e[0]/t,e[1]/t]}([r,n])}function _(t,n){le={},n.forEach(function(e){var t=ce.nodeKey.eval(e.node);(le[t]=le[t]||[]).push(e)});for(var r in le){var o=t[r];le[r].forEach(function(t){if(ce.portElastic.eval(t)&&t.edges.length){var n=t.edges.map(m.bind(null,o));t.vec=[e.sum(n,function(e){return e[0]})/n.length,e.sum(n,function(e){return e[1]})/n.length]}else t.vec=t.vec||void 0;t.pos=null})}}function b(e,t,n){for(var r in le){var o=e[r];le[r].forEach(function(e){e.pos||U(ce,o,e)})}t.forEach(function(e){var t=ce.edgeSourcePortName.eval(e);e.sourcePort.pos=t?n[Y(ce.nodeKey.eval(e.source),null,t)].pos:n[Y(null,ce.edgeKey.eval(e),"source")].pos,t=ce.edgeTargetPortName.eval(e),e.targetPort.pos=t?n[Y(ce.nodeKey.eval(e.target),null,t)].pos:n[Y(null,ce.edgeKey.eval(e),"target")].pos,console.assert(e.sourcePort.pos&&e.targetPort.pos)})}function w(e,t){ce._updateEdge(t),ce._updateNode(e),X(e)}function k(e){Se.end(e),Oe=!1,ze&&(ze=!1,window.setTimeout(function(){ce.isRunning()||ce.redraw()},0))}function A(e,t,n){var r=e.points,o=r[0],a=r[r.length-1];switch(ce.enforceEdgeDirection()){case"LR":if(t.x>=n.x){var i=o.x-a.x;return{points:[o,{x:o.x+i,y:o.y-i/2},{x:a.x-i,y:a.y-i/2},a],bezDegree:3,sourcePort:e.sourcePort,targetPort:e.targetPort}}break;case"TB":if(t.y>=n.y){var u=o.y-a.y;return{points:[o,{x:o.x+u/2,y:o.y+u},{x:a.x+u/2,y:a.y-u},a],bezDegree:3,sourcePort:e.sourcePort,targetPort:e.targetPort}}}return e}function O(e,t,n,r,o,a){var i=e.parallel,u=e.source,c=e.target;if(i.edges.length>1&&e.source.index>e.target.index){var l;l=c,c=u,u=l,l=o,o=n,n=l,l=a,a=r,r=l}for(var s=u.dcg_ry+ce.nodeStrokeWidth.eval(u)/2,d=c.dcg_ry+ce.nodeStrokeWidth.eval(c)/2,f=0;f<i.edges.length;++f){var g=!!(f%2)==n<o?-1:1,h=Math.floor((f+1)/2)>0?i.edges[f>2?f-2:0].pos[t].path:null,p=T(ce,e,n,r,o,a,h,g,ce.parallelEdgeOffset(),s,d);i.edges.length>1&&i.rev[f]&&p.points.reverse(),ce.enforceEdgeDirection()&&(p=A(p,u.cola,c.cola)),i.edges[f].pos[t]={path:p,orienthead:D(p.points,"head"),orienttail:D(p.points,"tail")}}}function M(e){return function(t){var n=t.pos[e].path;return y(n.points,n.bezDegree)}}function L(e){return function(t){var n=t.pos[e].path;return y(n.points[n.points.length-1].x<n.points[0].x?n.points.slice(0).reverse():n.points,n.bezDegree)}}function C(e){return{left:e.cola.x-e.dcg_rx,top:e.cola.y-e.dcg_ry,right:e.cola.x+e.dcg_rx,bottom:e.cola.y+e.dcg_ry}}function R(e,t){return{left:Math.min(e.left,t.left),top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom)}}function z(e){return{left:e.x,top:e.y,right:e.x,bottom:e.y}}function F(e){return e.pos.new.path.points.map(z).reduce(R)}function W(e){if(ce.fitStrategy()){if(!Fe)return;var t=Fe.right-Fe.left,n=Fe.bottom-Fe.top,r=ce.width()-ce.margins().left-ce.margins().right,o=ce.height()-ce.margins().top-ce.margins().bottom;ce.DEBUG_BOUNDS&&function(e){var t=we.selectAll("rect.bounds").data([0]);t.enter().insert("rect",":first-child").attr({class:"bounds",fill:"rgba(128,255,128,0.1)",stroke:"#000"}),t.attr({x:e.left,y:e.top,width:e.right-e.left,height:e.bottom-e.top})}(Fe);var a=ce.fitStrategy(),i=[0,0],u=1;if(["default","vertical","horizontal"].indexOf(a)>=0){u=("default"===a?!(n/t<o/r):"vertical"===a)?o/n:r/t,u=Math.max(ce.zoomExtent()[0],Math.min(ce.zoomExtent()[1],u)),i=[ce.margins().left-Fe.left*u+(r-t*u)/2,ce.margins().top-Fe.top*u+(o-n*u)/2]}else if("string"==typeof a&&a.match(/^align_/)){var c=a.split("_")[1].toLowerCase().split("");if(c.length>2)throw new Error("align_ expecting 0-2 sides, not "+c.length);var l=Z();i=fe.translate(),u=fe.scale();var s=!1,d=!1;c.forEach(function(e){switch(e){case"l":i[0]=Q(i,l.left),d=!0;break;case"t":i[1]=ee(i,l.top),s=!0;break;case"r":i[0]=te(i,l.right),d=!0;break;case"b":i[1]=ne(i,l.bottom),s=!0;break;case"c":break;default:throw new Error("align_ expecting l t r b or c, not '"+e+"'")}}),c.includes("c")&&(d||(i[0]=function(e,t){return(Q(e,t.left)+te(e,t.right))/2}(i,l)),s||(i[1]=function(e,t){return(ee(e,t.top)+ne(e,t.bottom))/2}(i,l)))}else{if("zoom"!==a)throw new Error("unknown fitStrategy type "+typeof a);u=fe.scale(),i=oe(fe.translate())}ge=e,fe.translate(i).scale(u).event(_e),ge=!1}}function B(e,t){var n=+e.slice(0,-3),r=+t.slice(0,-3);return Math.abs(n-r)>Math.PI&&(r>n?n+=2*Math.PI:n-=2*Math.PI),n+"rad"}function q(t,n,r,o,a,i,u,c,l,s,d){console.assert(r.data().every(f));var g={};n.each(function(e){g[ce.nodeKey.eval(e)]=!0}).attr("transform",function(e){return"translate("+e.cola.x+","+e.cola.y+")"});var h=t.transition().duration(ce.stagedDuration()).delay(function(e){return ce.stagedDelay(g[ce.nodeKey.eval(e)])}).attr("opacity",ce.nodeOpacity.eval);d&&h.attr("transform",function(e){return"translate("+e.cola.x+","+e.cola.y+")"}).each("end.record",function(e){e.prevX=e.cola.x,e.prevY=e.cola.y}),r.each(function(e){e.pos.new=null}),r.each(function(e){e.cola.points?e.pos.new={path:{points:e.cola.points,bezDegree:3},orienthead:D(e.cola.points,"head"),orienttail:D(e.cola.points,"tail")}:(e.pos.old||O(e,"old",e.source.prevX||e.source.cola.x,e.source.prevY||e.source.cola.y,e.target.prevX||e.target.cola.x,e.target.prevY||e.target.cola.y),e.pos.new||O(e,"new",e.source.cola.x,e.source.cola.y,e.target.cola.x,e.target.cola.y)),e.pos.old?e.pos.old.path.bezDegree===e.pos.new.path.bezDegree&&e.pos.old.path.points.length===e.pos.new.path.points.length||(P(e.pos.old.path)?(e.pos.new.path.points=N(e.pos.new.path),e.pos.old.path.points=j(N(e.pos.old.path),(e.pos.new.path.points.length-1)/3),e.pos.old.path.bezDegree=e.pos.new.bezDegree=3):P(e.pos.new.path)?(e.pos.old.path.points=N(e.pos.old.path),e.pos.new.path.points=j(N(e.pos.new.path),(e.pos.old.path.points.length-1)/3),e.pos.old.path.bezDegree=e.pos.new.bezDegree=3):console.warn("don't know how to interpolate two multi-segments")):e.pos.old=e.pos.new});var p={};o.each(function(e){p[ce.edgeKey.eval(e)]=!0}).each(function(t){var n="modins"===ce.stageTransitions()?"new":"old";ce.edgeArrowhead.eval(t)&&e.select("#"+ce.arrowId(t,"head")).attr("orient",function(){return t.pos[n].orienthead}),ce.edgeArrowtail.eval(t)&&e.select("#"+ce.arrowId(t,"tail")).attr("orient",function(){return t.pos[n].orienttail})}).attr("d",M("modins"===ce.stageTransitions()?"new":"old")),r.each(V);var y=r.each(function(t){ce.edgeArrowhead.eval(t)&&e.select("#"+ce.arrowId(t,"head")).attr("orient",B(t.pos.old.orienthead,t.pos.new.orienthead)).transition().duration(ce.stagedDuration()).delay(ce.stagedDelay(!1)).attr("orient",function(){return t.pos.new.orienthead}),ce.edgeArrowtail.eval(t)&&e.select("#"+ce.arrowId(t,"tail")).attr("orient",B(t.pos.old.orienttail,t.pos.new.orienttail)).transition().duration(ce.stagedDuration()).delay(ce.stagedDelay(!1)).attr("orient",function(){return t.pos.new.orienttail})}).transition().duration(ce.stagedDuration()).delay(function(e){return ce.stagedDelay(p[ce.edgeKey.eval(e)])}).attr("opacity",ce.edgeOpacity.eval);d&&y.attr("d",function(e){return M("insmod"===ce.stageTransitions()&&p[ce.edgeKey.eval(e)]?"old":"new")(e)});var v=u.selectAll("text").data(function(e){var t=ce.edgeLabel.eval(e);return t?"string"==typeof t?[t]:t:[]});v.enter().append("text").attr({class:"edge-label","text-anchor":"middle",dy:function(e,t){return t*ce.edgeLabelSpacing.eval(this.parentNode)-2}}).append("textPath").attr("startOffset","50%").attr("xlink:href",function(t){var n=ce.textpathId(e.select(this.parentNode.parentNode).datum());return window.location.href.split("#")[0]+"#"+n}),v.select("textPath").text(function(e){return e}).attr("opacity",function(){ce.edgeOpacity.eval(e.select(this.parentNode.parentNode).datum())}),s.attr("d",L("modins"===ce.stageTransitions()?"new":"old"));var m=l.transition().duration(ce.stagedDuration()).delay(function(e){return ce.stagedDelay(p[ce.edgeKey.eval(e)])});d&&m.attr("d",function(e){return L("insmod"===ce.stageTransitions()&&p[ce.edgeKey.eval(e)]?"old":"new")(e)}),"insmod"===ce.stageTransitions()&&d&&(ce.stagedDuration()>=50?(y=y.transition().duration(ce.stagedDuration()).attr("d",M("new")),m=m.transition().duration(ce.stagedDuration()).attr("d",L("new"))):(y.attr("d",M("new")),m.attr("d",M("new")))),je=!0,ce.showLayoutSteps()||function(e,t){e.every(function(e){return 0===e.size()})&&t();var n=0;e.forEach(function(e){e.each(function(){++n}).each("end.all",function(){--n||t()})})}([h,y,m],function(){r.each(V),je=!1,k(!0)}),d&&a.attr("d",M("new")),r.each(function(e){e.pos.old=e.pos.new})}function X(e){le&&ce.portStyle.enum().forEach(function(t){var n={};for(var r in le)n[r]=le[r].filter(function(e){return ce.portStyleName.eval(e)===t});var o=ce.selectNodePortsOfStyle(e,t);ce.portStyle(t).drawPorts(o,n,e)})}function V(t){var n=this.getTotalLength(),r=ce.edgeArrowSize.eval(t),o=ce.edgeStrokeWidth.eval(t)/r,a=r*G(I(Ne,ce.edgeArrowhead.eval(t)),o),i=r*G(I(Ne,ce.edgeArrowtail.eval(t)),o),u=ce.nodeStrokeWidth.eval(t.source),c=ce.nodeStrokeWidth.eval(t.target),l=Math.max(0,n-a-i-(u+c)/2);e.select(this).attr("stroke-dasharray",l+" "+2*n).attr("stroke-dashoffset",-(i+u/2))}function Z(){var e=Fe||{left:0,top:0,right:0,bottom:0},t=fe?fe.scale():1;return{left:e.left-ce.margins().left/t,top:e.top-ce.margins().top/t,right:e.right+ce.margins().right/t,bottom:e.bottom+ce.margins().bottom/t}}function Q(e,t){return e[0]-ce.x()(t)+ce.x().range()[0]}function ee(e,t){return e[1]-ce.y()(t)+ce.y().range()[0]}function te(e,t){return e[0]-ce.x()(t)+ce.x().range()[1]}function ne(e,t){return e[1]-ce.y()(t)+ce.y().range()[1]}function oe(e){var t,n=ce.x().domain(),r=ce.y().domain(),o=Z(),a=o.left<n[0],i=o.right<n[1],u=o.right-o.left<n[1]-n[0];switch(a&&i?t=u?"left":"right":a||i||(t=u?"right":"left"),t){case"left":e[0]=Q(e,o.left);break;case"right":e[0]=te(e,o.right);break;default:0}switch(a=o.top<r[0],i=o.bottom<r[1],u=o.bottom-o.top<r[1]-r[0],a&&i?t=u?"top":"bottom":a||i||(t=u?"bottom":"top"),t){case"top":e[1]=ee(e,o.top);break;case"bottom":e[1]=ne(e,o.bottom);break;default:0}return e}function ae(){"auto"!==ye&&"auto"!==ve||g();var t,n=e.event.scale;ce.restrictPan()?fe.translate(t=oe(e.event.translate)):t=e.event.translate,function(e,t,n){Me=e,Le=t;var r=we;n&&(r=we.transition().duration(ce.zoomDuration())),r.attr("transform","translate("+e+") scale("+t+")")}(t,n,ge),Se.zoomed(t,n,ce.x().domain(),ce.y().domain())}function ie(){_e.call(fe),_e.on("dblclick.zoom",null)}function ue(){_e.on(".zoom",null)}var ce=n.marginMixin({});ce.__dcFlag__=n.utils.uniqueId(),ce.margins({left:10,top:10,right:10,bottom:10});var le,se,de,fe,ge,he,pe,ye,ve,me,xe,_e=null,be=null,we=null,ke=null,Ee=null,Se=e.dispatch("preDraw","data","end","start","render","drawn","receivedLayout","transitionsStarted","zoomed","reset"),Ke={},Ae={},Te={},Pe={},Ne={},Oe=!1,Me=[0,0],Le=1,je=!1,De=200,Ce=function(e){var t=e&&e.getBoundingClientRect&&e.getBoundingClientRect().width;return t&&t>De?t:De},Re=200,Ie=function(e){var t=e&&e.getBoundingClientRect&&e.getBoundingClientRect().height;return t&&t>Re?t:Re};ce.height=function(e){if(!arguments.length){if(!n.utils.isNumber(ve)){if(xe=Ie(ce.root().node()),"auto"===ve)return xe;ve=xe}return ve}if(n.utils.isNumber(e)||!e||"auto"===e)ve=e;else{if("function"!=typeof e)throw new Error("don't know what to do with height type "+typeof e+" value "+e);Ie=e,ve=void 0}return ce},ce.minHeight=function(e){return arguments.length?(Re=e,ce):Re},ce.width=function(e){if(!arguments.length){if(!n.utils.isNumber(ye)){if(me=Ce(ce.root().node()),"auto"===ye)return me;ye=me}return ye}if(n.utils.isNumber(e)||!e||"auto"===e)ye=e;else{if("function"!=typeof e)throw new Error("don't know what to do with width type "+typeof e+" value "+e);Ce=e,ye=void 0}return ce},ce.minWidth=function(e){return arguments.length?(De=e,ce):De},ce.root=J(null).react(function(e){e.empty()&&console.log("Warning: parent selector "+u+" doesn't seem to exist")}),ce.mouseZoomable=J(!0),ce.zoomExtent=J([.1,2]),ce.modKeyZoom=ce.altKeyZoom=J(!1),ce.fitStrategy=J("default"),ce.restrictPan=J(!1),ce.autoZoom=J(null),ce.zoomToFit=function(e){if(ke&&Ee){var t=ce.selectAllNodes();ce.selectAllEdges();W(t)}},ce.zoomDuration=J(500),ce.nodeDimension=J(),ce.nodeGroup=J(),ce.edgeDimension=J(),ce.edgeGroup=J(),ce.edgesInFront=J(!1),ce.nodeKey=ce.nodeKeyAccessor=J(function(e){return e.key}),ce.edgeKey=ce.edgeKeyAccessor=J(function(e){return e.key}),ce.edgeSource=ce.sourceAccessor=J(function(e){return e.value.sourcename}),ce.edgeTarget=ce.targetAccessor=J(function(e){return e.value.targetname}),ce.portDimension=J(null),ce.portGroup=J(null),ce.portNodeKey=J(null),ce.portEdgeKey=J(null),ce.portName=J(null),ce.portStyleName=J(null),ce.portElastic=J(!0),ce.portStyle=a(),ce.portBounds=J(null),ce.edgeSourcePortName=J(null),ce.edgeTargetPortName=J(null),ce.nodeRadius=ce.nodeRadiusAccessor=J(25),ce.nodeStrokeWidth=ce.nodeStrokeWidthAccessor=J(1),ce.nodeStroke=ce.nodeStrokeAccessor=J("black"),ce.nodeStrokeDashArray=J(null),ce.nodeFillScale=J(null),ce.nodeFill=ce.nodeFillAccessor=J("white"),ce.nodeOpacity=J(1),ce.nodePadding=J(6),ce.nodeLabelPadding=J(0),ce.nodeLineHeight=J(1),ce.nodeLabel=ce.nodeLabelAccessor=J(function(e){return e.value.label||e.value.name}),ce.nodeLabelAlignment=J("center"),ce.nodeLabelDecoration=J(null),ce.nodeLabelFill=ce.nodeLabelFillAccessor=J(null),ce.nodeFitLabel=ce.nodeFitLabelAccessor=J(!0),ce.nodeShape=J(re),ce.shape=a(),ce.shape("nothing",$.no_shape()),ce.shape("ellipse",$.ellipse_shape()),ce.shape("polygon",$.polygon_shape()),ce.shape("rounded-rect",$.rounded_rectangle_shape()),ce.shape("elaborated-rect",$.elaborated_rectangle_shape()),ce.nodeContent=J("text"),ce.content=a(),ce.content("text",$.text_contents()),ce.nodeIcon=J(null),ce.nodeTitle=ce.nodeTitleAccessor=J(function(e){return ce.nodeKey()(e)}),ce.nodeOrdering=J(null),ce.nodeFixed=ce.nodeFixedAccessor=J(null),ce.edgeStroke=ce.edgeStrokeAccessor=J("black"),ce.edgeStrokeWidth=ce.edgeStrokeWidthAccessor=J(1),ce.edgeStrokeDashArray=J(null),ce.edgeOpacity=ce.edgeOpacityAccessor=J(1),ce.edgeLabel=ce.edgeLabelAccessor=J(function(e){return ce.edgeKey()(e)}),ce.edgeLabelSpacing=J(12),ce.edgeArrowhead=ce.edgeArrowheadAccessor=J("vee"),ce.edgeArrowtail=ce.edgeArrowtailAccessor=J(null),ce.edgeArrowSize=J(1),ce.edgeIsLayout=ce.edgeIsLayoutAccessor=J(function(e){return!e.value.notLayout}),ce.edgeIsShown=J(!0),ce.lengthStrategy=s("lengthStrategy"),ce.edgeLength=ce.edgeDistanceAccessor=J(function(e){return e.value.distance}),ce.flowLayout=s("flowLayout"),ce.rankdir=s("rankdir"),ce.baseLength=s("baseLength"),ce.transitionDuration=J(500),ce.stageTransitions=J("none"),ce.deleteDelay=J(0),ce.groupConnected=s("groupConnected"),ce.timeLimit=J(0),ce.constrain=J(function(e,t){return[]}),ce.parallelEdgeOffset=J(10),ce.edgeOrdering=J(null),ce.edgeSort=J(null),ce.cascade=h(ce),ce.initLayoutOnRedraw=J(!1),ce.layoutUnchanged=J(!1),ce.relayout=function(){return se=de=null,this},ce.initialLayout=i("initialLayout is deprecated - use layout algorithms instead",null),ce.initialOnly=i("initialOnly is deprecated - see the initialLayout deprecation notice in the documentation",!1),ce.induceNodes=J(!1),ce.showLayoutSteps=J(!1),ce.mode=ce.child=a(),ce.legend=function(e){return arguments.length?(ce.child("node-legend",e),ce):ce.child("node-legend")},ce.layoutAlgorithm=function(e,t){if(!arguments.length)return ce.layoutEngine()?ce.layoutEngine().layoutAlgorithm():"cola";t||console.warn("dc.graph.diagram.layoutAlgorithm is depecrated - pass the layout engine object to dc_graph.diagram.layoutEngine instead");var n;switch(e){case"cola":n=$.cola_layout();break;case"dagre":n=$.dagre_layout()}return n=$.webworker_layout(n),ce.layoutEngine(n),this},ce.layoutEngine=J(null).react(function(e){e&&e.parent&&e.parent(ce),we&&(Object.keys(Ae).forEach(function(e){Ae[e].cola.points=null}),d(e))}),ce.enforceEdgeDirection=J(null),ce.tickSize=s("tickSize"),ce.uniqueId=function(){return ce.anchorName().replace(/[ .#=\[\]"]/g,"-")},ce.edgeId=function(e){return"edge-"+ce.edgeKey.eval(e).replace(/[^\w-_]/g,"-")},ce.arrowId=function(e,t){return"arrow-"+t+"-"+ce.uniqueId()+"-"+ce.edgeId(e)},ce.textpathId=function(e){return"textpath-"+ce.uniqueId()+"-"+ce.edgeId(e)},ce.getNode=function(e){return Ke[e]?Ke[e].orig:null},ce.getWholeNode=function(e){return Ke[e]?Ke[e]:null},ce.getEdge=function(e){return Ae[e]?Ae[e].orig:null},ce.getWholeEdge=function(e){return Ae[e]?Ae[e]:null},ce.getPort=function(e,t,n){return Te[Y(e,t,n)]},ce.nodePorts=function(){return le},ce.handleDisconnected=s("handleDisconnected"),ce.forEachChild=function(e,t,n,r){t.enum().forEach(function(o){r(t(o),e.filter(function(e){return n(e)===o}))})},ce.forEachShape=function(e,t){ce.forEachChild(e,ce.shape,function(e){return e.dcg_shape.shape},t)},ce.forEachContent=function(e,t){ce.forEachChild(e,ce.content,ce.nodeContent.eval,t)},ce.renderNode=ce._enterNode=function(e){return ce.nodeTitle()&&e.append("title"),e.each(S(ce)),ce.forEachShape(e,function(e,t){t.call(e.create)}),ce},ce.redrawNode=ce._updateNode=function(e){var t=e.filter(function(e){return function(t){var n=E(e,t),r=t.dcg_shape.abstract;return n.shape!==r.shape||"polygon"===n.shape&&(n.shape.sides!==r.sides||n.shape.skew!==r.skew||n.shape.distortion!==r.distortion||n.shape.rotation!==r.rotation)}}(ce));return t.selectAll(".node-shape").remove(),t.each(S(ce)),ce.forEachShape(t,function(e,t){t.call(e.create)}),e.select("title").text(ce.nodeTitle.eval),ce.forEachContent(e,function(e,t){t.call(e.update),ce.forEachShape(e.selectContent(t),function(e,t){t.call(function(e,t){return function(n){n.each(function(n){var r=null;if((!e.useTextSize||e.useTextSize(n.dcg_shape))&&t.nodeFitLabel.eval(n)){r={x:(r=c(this)).x,y:r.y,width:r.width,height:r.height};var o,a=t.nodeContent.eval(n);if(a&&t.content(a).padding)o=t.content(a).padding(n);else{var i=K(t,n);o={x:2*i.x,y:2*i.y}}r.width+=o.x,r.height+=o.y,n.bbox=r}var u,l=0;e.useRadius&&!e.useRadius(n.dcg_shape)||(l=t.nodeRadius.eval(n)),u=r&&r.width&&r.height||e.useTextSize&&!e.useTextSize(n.dcg_shape)?e.calc_radii(n,l,r):{rx:l,ry:l},n.dcg_rx=u.rx,n.dcg_ry=u.ry;var s=2*u.rx,d=2*u.ry;if(s<d&&(s=d),!e.usePaddingAndStroke||e.usePaddingAndStroke(n.dcg_shape)){var f=t.nodePadding.eval(n)+t.nodeStrokeWidth.eval(n);s+=f,d+=f}n.cola.width=s,n.cola.height=d})}}(e,ce))})}),ce.forEachShape(e,function(e,t){t.call(e.update)}),e.select(".node-shape").attr({stroke:ce.nodeStroke.eval,"stroke-width":ce.nodeStrokeWidth.eval,"stroke-dasharray":ce.nodeStrokeDashArray.eval,fill:function(e,t){return function(){return e(t.apply(null,arguments))}}(ce.nodeFillScale()||o,ce.nodeFill.eval)}),ce},ce.redrawEdge=ce._updateEdge=function(t){t.attr("stroke",ce.edgeStroke.eval).attr("stroke-width",ce.edgeStrokeWidth.eval).attr("stroke-dasharray",ce.edgeStrokeDashArray.eval).attr("marker-end",function(e){var t=ce.edgeArrowhead.eval(e),n=H(ce,Ne,e,"head",t);return n?"url(#"+n+")":null}).attr("marker-start",function(e){var t=ce.edgeArrowtail.eval(e),n=H(ce,Ne,e,"tail",t);return t?"url(#"+n+")":null}).each(function(t){ce.edgeStroke.eval(t);e.selectAll("#"+ce.arrowId(t,"head")).attr("fill",ce.edgeStroke.eval(t)),e.selectAll("#"+ce.arrowId(t,"tail")).attr("fill",ce.edgeStroke.eval(t))})},ce.stagedDuration=function(){return"none"!==ce.stageTransitions()?ce.transitionDuration()/2:ce.transitionDuration()},ce.stagedDelay=function(e){return"none"===ce.stageTransitions()||"modins"===ce.stageTransitions()==!e?0:ce.transitionDuration()/2},ce.selectAllNodes=function(t){return t=t||".node",ke&&ke.selectAll(t).filter(function(e){return!e.deleted})||e.selectAll(".foo-this-does-not-exist")},ce.selectAllEdges=function(t){return t=t||".edge",Ee&&Ee.selectAll(t).filter(function(e){return!e.deleted})||e.selectAll(".foo-this-does-not-exist")},ce.selectAllDefs=function(t){return be&&be.selectAll(t).filter(function(e){return!e.deleted})||e.selectAll(".foo-this-does-not-exist")},ce.isRunning=function(){return Oe};var ze=!1;ce.redraw=function(){return Oe?(ze=!0,this):ce.startLayout()},ce.startLayout=function(){function n(e,t){e.forEach(function(e){var t=Ke[e.dcg_nodeKey];t?(t.cola.x=e.x,t.cola.y=e.y):console.warn('received node "'+e.dcg_nodeKey+'" that we did not send')}),t.forEach(function(e){var t=Ae[e.dcg_edgeKey];t?e.points&&(t.cola.points=e.points):console.warn('received edge "'+e.dcg_edgeKey+'" that we did not send')})}var o=ce.nodeGroup().all(),a=ce.edgeGroup().all(),i=ce.portGroup()?ce.portGroup().all():[];if(Oe)throw new Error("dc_graph.diagram.redraw already running!");Oe=!0,"auto"===ye||"auto"===ve?g():ce.resizeSvg(),ce.initLayoutOnRedraw()&&d(),ce.layoutEngine().stop(),Se.preDraw(),ce.nodeOrdering()&&(o=t.quicksort.by(ce.nodeOrdering())(o.slice(0),0,o.length)),ce.edgeOrdering()&&(a=t.quicksort.by(ce.edgeOrdering())(a.slice(0),0,a.length));var u=x(Ke,o,null,function(e){return ce.nodeKey()(e)},function(e,t){e.orig=t,e.cola=e.cola||{},e.cola.dcg_nodeKey=ce.nodeKey.eval(e),ce.layoutEngine().populateLayoutNode(e.cola,e)}),c=x(Ae,a,null,function(e){return ce.edgeKey()(e)},function(e,t){e.orig=t,e.cola=e.cola||{},e.cola.dcg_edgeKey=ce.edgeKey.eval(e),e.cola.dcg_edgeSource=ce.edgeSource.eval(e),e.cola.dcg_edgeTarget=ce.edgeTarget.eval(e),e.source=Ke[e.cola.dcg_edgeSource],e.target=Ke[e.cola.dcg_edgeTarget],e.cola.dcg_edgeLength=ce.edgeLength.eval(e),e.sourcePort=e.sourcePort||{},e.targetPort=e.targetPort||{},ce.layoutEngine().populateLayoutEdge(e.cola,e)}),l=(c=(c=(c=c.filter(f)).filter(function(e){return e.source!==e.target})).filter(ce.edgeIsShown.eval)).map(function(e){return ce.edgeSourcePortName.eval(e)?Y(ce.edgeSource.eval(e),null,ce.edgeSourcePortName.eval(e)):Y(null,ce.edgeKey.eval(e),"source")});l=l.concat(c.map(function(e){return ce.edgeTargetPortName.eval(e)?Y(ce.edgeTarget.eval(e),null,ce.edgeTargetPortName.eval(e)):Y(null,ce.edgeKey.eval(e),"target")})),i=i.filter(function(e){return ce.portNodeKey()&&ce.portNodeKey()(e)||ce.portEdgeKey()&&ce.portEdgeKey()(e)});var s=x(Te,i,l,function(e){return Y(ce.portNodeKey()&&ce.portNodeKey()(e),ce.portEdgeKey()&&ce.portEdgeKey()(e),ce.portName()(e))},function(e,t){e.orig=t,e.named&&(e.edges=[])},function(e,t){console.assert(e,"should have screened out invalid ports");var n=function(e){var t=e.split("/");return console.assert(3===t.length),"node"===(t=t.map(function(e){return e.replace(/%2F/g,"/")}))[0]?{nodeKey:t[1],name:t[2]}:{edgeKey:t[1],name:t[2]}}(e);if(n.nodeKey)t.node=Ke[n.nodeKey],t.named=!0;else{var r=Ae[n.edgeKey];t.node=r[n.name],t.edges=[r],t.named=!1}t.name=n.name});if(s=s.filter(function(e){return e.node}),c.forEach(function(e){var t=ce.edgeSourcePortName.eval(e);t&&Te[Y(ce.nodeKey.eval(e.source),null,t)].edges.push(e),(t=ce.edgeTargetPortName.eval(e))&&Te[Y(ce.nodeKey.eval(e.target),null,t)].edges.push(e)}),ce.induceNodes()){var h={};c.forEach(function(e){h[e.cola.dcg_edgeSource]=!0,h[e.cola.dcg_edgeTarget]=!0}),u=u.filter(function(e){return h[e.cola.dcg_nodeKey]});for(var y in Ke)h[y]||delete Ke[y]}if(u.forEach(function(e,t){e.index=t}),Se.data(ce,Ke,u,Ae,c,Te,s),Pe={nnodes:u.length,nedges:c.length},u.forEach(function(e){ce.nodeFixed()&&(e.cola.dcg_nodeFixed=ce.nodeFixed.eval(e))}),ce.parallelEdgeOffset()){for(var m=new Array(u.length),E=0;E<u.length;++E)m[E]=new Array(E);c.forEach(function(e){e.pos=e.pos||{};var t,n,r,o;e.source.index<e.target.index?(t=e.source.index,n=e.target.index,r="edgeSourcePortName",o="edgeTargetPortName"):(n=e.source.index,t=e.target.index,o="edgeSourcePortName",r="edgeTargetPortName");var a=ce[r].eval(e)||"no port",i=ce[o].eval(e)||"no port";m[n][t]=m[n][t]||{},m[n][t][i]=m[n][t][i]||{},e.parallel=m[n][t][i][a]=m[n][t][i][a]||{rev:[],edges:[]},e.parallel.edges.push(e),e.parallel.rev.push(t!==e.source.index)})}var S=Ee.selectAll(".edge").data(c,ce.edgeKey.eval),K=S.enter().append("svg:path").attr({class:"edge",id:ce.edgeId,opacity:0}).each(function(e){e.deleted=!1});S.exit().each(function(e){e.deleted=!0}).transition().duration(ce.stagedDuration()).delay(ce.deleteDelay()).attr("opacity",0).each(function(e){H(ce,Ne,e,"head",null),H(ce,Ne,e,"tail",null)}).remove(),ce.edgeSort()&&S.sort(function(e,t){var n=ce.edgeSort.eval(e),r=ce.edgeSort.eval(t);return n<r?-1:r<n?1:0});var A=Ee.selectAll(".edge-hover").data(c,ce.edgeKey.eval);A.enter().append("svg:path").attr("class","edge-hover").attr("opacity",0).attr("fill","none").attr("stroke","green").attr("stroke-width",10).on("mouseover",function(t){e.select("#"+ce.edgeId(t)+"-label").attr("visibility","visible")}).on("mouseout",function(t){e.select("#"+ce.edgeId(t)+"-label").attr("visibility","hidden")});A.exit().remove();var T=Ee.selectAll("g.edge-label-wrapper").data(c,ce.edgeKey.eval),P=(T.enter().append("g").attr("class","edge-label-wrapper").attr("visibility","hidden").attr("id",function(e){return ce.edgeId(e)+"-label"}),be.selectAll("path.edge-label-path").data(c,ce.textpathId)),N=P.enter().append("svg:path").attr({class:"edge-label-path",id:ce.textpathId});T.exit().transition().duration(ce.stagedDuration()).delay(ce.deleteDelay()).attr("opacity",0).remove();var O=ke.selectAll(".node").data(u,ce.nodeKey.eval),M=O.enter().append("g").attr("class","node").attr("opacity","0").each(function(e){e.deleted=!1});ce._enterNode(M),O.exit().each(function(e){e.deleted=!0}).transition().duration(ce.stagedDuration()).delay(ce.deleteDelay()).attr("opacity",0).remove(),Se.drawn(O,S,A),w(O,S),ce.initialLayout()&&ce.initialLayout()(ce,u,c);var L=!1;if(!ce.layoutUnchanged()){var j=JSON.stringify(u.map(function(e){return{orig:r(e),cola:{dcg_nodeFixed:e.cola.dcg_nodeFixed}}})),D=JSON.stringify(c.map(function(e){return{orig:r(e),cola:e.cola}}));j===se&&D===de&&(L=!0),se=j,de=D}var C=ce.constrain()(ce,u,c);C.forEach(function(e){if(e.type)switch(e.type){case"alignment":e.offsets.forEach(function(e){e.node=Ke[e.node].index});break;case"circle":e.nodes.forEach(function(e){e.node=Ke[e.node].index})}else e.axis&&(e.left=Ke[e.left].index,e.right=Ke[e.right].index)});var R=c.filter(ce.edgeIsLayout.eval),I=(c.filter(function(e){return!ce.edgeIsLayout.eval(e)}),C.filter(function(e){return"circle"===e.type}));C=C.filter(function(e){return"circle"!==e.type}),I.forEach(function(e){var t=(e.distance||4*ce.baseLength())/(2*Math.sin(Math.PI/e.nodes.length)),n=e.nodes.map(function(e){return e.node}),r=$.wheel_edges(function(e){return ce.nodeKey.eval(u[e])},n,t).map(function(e){var t={internal:e};return t.source=Ke[e.sourcename],t.target=Ke[e.targetname],t});R=R.concat(r)});var z=C.filter(function(e){return"ordering"===e.type});if(C=C.filter(function(e){return"ordering"!==e.type}),z.forEach(function(e){var n=e.nodes.map(function(e){return Ke[e]});if(e.ordering){n=t.quicksort.by(p(e.ordering))(n,0,n.length)}var r;n.forEach(function(t,n){0===n?r=t:C.push({left:r.index,right:(r=t).index,axis:e.axis,gap:e.gap})})}),L)return Oe=!1,q(O,M,S,K,A,0,T,0,P,N,!0),X(O),Se.transitionsStarted(O,S,A),v(O,S),this;var F=Date.now();return ce.layoutEngine().on("tick",function(e,t){var r=Date.now()-F;ce.initialOnly()||n(e,t),ce.showLayoutSteps()&&(_(Ke,s),Se.receivedLayout(ce,Ke,u,Ae,c,Te,s),b(Ke,c,Te),q(O,M,S,K,A,0,T,0,P,N,!0),X(O),Se.transitionsStarted(O,S,A)),(ze||ce.timeLimit()&&r>ce.timeLimit())&&(console.log("cancelled"),ce.layoutEngine().stop())}).on("end",function(e,t){ce.showLayoutSteps()?k(!0):(ce.initialOnly()||n(e,t),_(Ke,s),Se.receivedLayout(ce,Ke,u,Ae,c,Te,s),b(Ke,c,Te),q(O,M,S,K,A,0,T,0,P,N,!0),X(O),Se.transitionsStarted(O,S,A)),v(O,S)}).on("start",function(){console.log("algo "+ce.layoutEngine().layoutAlgorithm()+" started."),Se.start()}),ce.initialOnly()?ce.layoutEngine().dispatch().end(u,c):(Se.start(),ce.layoutEngine().data({width:ce.width(),height:ce.height()},u.map(function(e){return Object.assign({},e.cola,e.dcg_shape)}),R.map(function(e){return e.cola}),C),ce.layoutEngine().start()),this},ce.refresh=function(t,n,r,o,a){if(je)return this;w(t=t||ce.selectAllNodes(),n=n||ce.selectAllEdges()),r=r||ce.selectAllEdges(".edge-hover"),o=o||ce.selectAllEdges(".edge-label-wrapper"),a=a||ce.selectAllDefs("path.edge-label-path");var i=e.select(null);return q(t,i,n,i,r,0,o,0,a,i,!1),this},ce.requestRefresh=function(e){window.requestAnimationFrame(function(){var t;void 0!==e&&(t=ce.transitionDuration(),ce.transitionDuration(e)),ce.refresh(),void 0!==e&&ce.transitionDuration(t)})},ce.reposition=function(t,n){return t.attr("transform",function(e){return"translate("+e.cola.x+","+e.cola.y+")"}),n.each(function(t){t.pos.new=null,t.pos.old=null,O(t,"new",t.source.cola.x,t.source.cola.y,t.target.cola.x,t.target.cola.y),ce.edgeArrowhead.eval(t)&&e.select("#"+ce.arrowId(t,"head")).attr("orient",function(){return t.pos.new.orienthead}),ce.edgeArrowtail.eval(t)&&e.select("#"+ce.arrowId(t,"tail")).attr("orient",function(){return t.pos.new.orienttail})}).attr("d",M("new")),this};var Fe;return ce.animating=function(){return je},ce.selectNodePortsOfStyle=function(e,t){return e.selectAll("g.port").filter(function(e){return ce.portStyleName.eval(e)===t})},ce.render=function(){_e&&Se.reset(),ce.initLayoutOnRedraw()||d(),ce.resetSvg(),we=_e.append("g").attr("class","draw");var e=["edge-layer","node-layer"];return ce.edgesInFront()&&e.reverse(),we.selectAll("g").data(e).enter().append("g").attr("class",function(e){return e}),Ee=we.selectAll("g.edge-layer"),ke=we.selectAll("g.node-layer"),Se.render(),ce.redraw(),this},ce.on=function(e,t){return 1===arguments.length?Se.on(e):(Se.on(e,t),this)},ce.getStats=function(){return Pe},ce.select=function(e){return ce.root().select(e)},ce.selectAll=function(e){return ce.root()?ce.root().selectAll(e):null},ce.x=J(null),ce.y=J(null),ce.zoom=function(e){return arguments.length?(fe=e,ce):fe},ce.svg=function(e){return arguments.length?(_e=e,ce):_e},ce.g=function(e){return arguments.length?(we=e,ce):we},ce.translate=function(){return Me},ce.scale=function(){return Le},ce.resetSvg=function(){return(_e||ce.select("svg")).remove(),_e=null,function(){if(_e=ce.root().append("svg"),ce.resizeSvg(),be=_e.append("svg:defs"),ce.x()||ce.x(e.scale.linear().domain([0,ce.width()]).range([0,ce.width()])),ce.y()||ce.y(e.scale.linear().domain([0,ce.height()]).range([0,ce.height()])),fe=e.behavior.zoom().on("zoom",ae).x(ce.x()).y(ce.y()).scaleExtent(ce.zoomExtent()),ce.mouseZoomable()){var t,n,r=ce.child("brush");if(t=ce.modKeyZoom()){n=Array.isArray(t)?t.slice():"string"==typeof t?[t]:["Alt"];var o=!1,a=!1,i=!1;_e.on("mousedown.modkey-zoom",function(){o=!0}).on("mouseup.modkey-zoom",function(){(o=!1)||a||!i||(i=!1,ue(),r&&r.activate())}),e.select(document).on("keydown.modkey-zoom",function(){n.indexOf(e.event.key)>-1&&(a=!0,o||(i=!0,ie(),r&&r.deactivate()))}).on("keyup.modkey-zoom",function(){n.indexOf(e.event.key)>-1&&(a=!1,o||(i=!1,ue(),r&&r.activate()))})}else ie()}return _e}()},ce.redrawGroup=function(){n.redrawAll(pe)},ce.renderGroup=function(){n.renderAll(pe)},ce.defineArrow=function(e,t){if("function"!=typeof t)throw new Error("sorry, defineArrow no longer takes specific shape parameters, and the parameters have changed too much to convert them. it takes a name and a function returning a definition - please look at arrows.js for new format");return Ne[e]=t,ce},ce.arrows=function(){return Ne},ce.addOrRemoveDef=function(e,t,n,r){var o=t?[0]:[],a=be.selectAll("#"+e).data(o),i=a.enter().append(n).attr("id",e);return i.size()&&r&&i.call(r),a.exit().remove(),a},Object.keys($.builtin_arrows).forEach(function(e){var t=$.builtin_arrows[e];ce.defineArrow(e,t)}),ce.resizeSvg=function(e,t){return _e&&_e.attr("width",e||("auto"===ye?"100%":ce.width())).attr("height",t||("auto"===ve?"100%":ce.height())),ce},ce.invertCoord=function(e){return[ce.x().invert(e[0]),ce.y().invert(e[1])]},ce.anchor=function(t,r){if(!arguments.length)return he;if(!t)throw new n.errors.BadArgumentException("parent must be defined");return he=t.select&&t.classed?t.node():t,ce.root(e.select(he)),ce.root().classed($.constants.CHART_CLASS,!0),n.registerChart(ce,r),pe=r,ce},ce.chartID=function(){return ce.__dcFlag__},ce.anchorName=function(){var e=ce.anchor();return e&&e.id?e.id:e&&e.replace?e.replace("#",""):"dc-graph"+ce.chartID()},ce.anchor(u,l)},$.spawn_engine=function(e,t,n){t=t||{},n=n&&!!window.Worker;var r=$.engines.instantiate(e,t,n);return r||(console.warn("layout engine "+e+" not found; using default "+$._default_engine),r=$.engines.instantiate($._default_engine,t,n)),r},$._engines=[{name:"dagre",params:["rankdir"],instantiate:function(){return $.dagre_layout()}},{name:"d3force",instantiate:function(){return $.d3_force_layout()}},{name:"d3v4force",instantiate:function(){return $.d3v4_force_layout()}},{name:"tree",instantiate:function(){return $.tree_layout()}},{names:["circo","dot","neato","osage","twopi","fdp"],instantiate:function(e,t){return $.graphviz_layout(null,e,t.server)}},{name:"cola",params:["lengthStrategy"],instantiate:function(){return $.cola_layout()}}],$._default_engine="cola",$.engines={entry_pred:function(e){return function(t){return t.name&&t.name===e||t.names&&t.names.includes(e)}},get:function(e){return $._engines.find(this.entry_pred(e))},instantiate:function(e,t,n){var r=this.get(e);if(!r)return null;var o=r.instantiate(e,t);return(r.params||[]).forEach(function(e){t[e]&&o[e](t[e])}),o.supportsWebworker&&o.supportsWebworker()&&n&&(o=$.webworker_layout(o)),o},available:function(){return $._engines.reduce(function(e,t){return e.concat(t.name?[t.name]:t.names)},[])},unregister:function(e){var t=$._engines.findIndex(this.entry_pred(e)),n=!1;if(t<0)return!1;var r=$._engines[t];if(r.name===e)n=!0;else{var o=r.names.indexOf(e);o>=0?r.names.splice(o,1):console.warn("search for engine failed",e),0===r.names.length&&(n=!0)}return n&&$._engines.splice(t,1),!0},register:function(e){var t=this;if(!e.instantiate)return console.error("engine definition needs instantiate: function(layout, args) { ... }"),this;if(e.name)this.unregister(e.name);else{if(!e.names)return console.error("engine definition needs name or names[]"),this;e.names.forEach(function(e){t.unregister(e)})}return $._engines.push(e),this}};var ue={};$.webworker_layout=function(t){var n=e.dispatch("init","start","tick","end"),r=function(e){if(!ue[e]){var t=ue[e]={worker:new Worker(ee()+"dc.graph."+e+".worker.js"),layouts:{}};t.worker.onmessage=function(e){var n=e.data.layoutId;if(!t.layouts[n])throw new Error('layoutId "'+n+'" unknown!');t.layouts[n].dispatch()[e.data.response].apply(null,e.data.args)}}return ue[e]}(t.layoutAlgorithm()),o={};r.layouts[t.layoutId()]=o,o.parent=function(e){t.parent&&t.parent(e)},o.init=function(e){return e=t.optionNames().reduce(function(e,n){return e[n]=t[n](),e},e),r.worker.postMessage({command:"init",args:{layoutId:t.layoutId(),options:e}}),this},o.data=function(e,n,o,a){r.worker.postMessage({command:"data",args:{layoutId:t.layoutId(),graph:e,nodes:n,edges:o,constraints:a}})},o.start=function(){r.worker.postMessage({command:"start",args:{layoutId:t.layoutId()}})},o.stop=function(){return r.worker.postMessage({command:"stop",args:{layoutId:t.layoutId()}}),this},o.getEngine=function(){return t};return["layoutAlgorithm","needsStage","populateLayoutNode","populateLayoutEdge","rankdir","ranksep"].concat(t.optionNames()).forEach(function(e){o[e]=function(){var n=t[e].apply(t,arguments);return arguments.length?this:n}}),o.on=function(e,t){return 1===arguments.length?n.on(e):(n.on(e,t),this)},o.dispatch=function(){return n},o},$.graphviz_attrs=function(){return{rankdir:J("TB"),nodesep:J(40),ranksep:J(40)}},$.cola_layout=function(t){var n,r=t||u(),o=null,a=e.dispatch("tick","start","end"),i={},c={},l=$.graphviz_attrs(),s=Object.keys(l);l.rankdir(null);var d=Object.assign(l,{layoutAlgorithm:function(){return"cola"},layoutId:function(){return r},supportsWebworker:function(){return!0},needsStage:function(e){return"ports"===e||"edgepos"===e},parent:J(null),on:function(e,t){return 1===arguments.length?a.on(e):(a.on(e,t),this)},init:function(e){return this.optionNames().forEach(function(t){e[t]=e[t]||this[t]()}.bind(this)),function(e){switch((o=cola.d3adaptor().avoidOverlaps(!0).size([e.width,e.height]).handleDisconnected(e.handleDisconnected)).tickSize&&o.tickSize(e.tickSize),e.lengthStrategy){case"symmetric":o.symmetricDiffLinkLengths(e.baseLength);break;case"jaccard":o.jaccardLinkLengths(e.baseLength);break;case"individual":o.linkDistance(function(t){return t.dcg_edgeLength||e.baseLength})}e.flowLayout&&o.flowLayout(e.flowLayout.axis,e.flowLayout.minSeparation)}(e),this},data:function(e,t,n,r){!function(e,t,n){function r(e){a[e](u,l.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}var u=x(i,e,null,function(e){return e.dcg_nodeKey},function(e,t){e.dcg_nodeKey=t.dcg_nodeKey,e.width=t.width,e.height=t.height,e.fixed=!!t.dcg_nodeFixed,e.fixed&&"object"==typeof t.dcg_nodeFixed?(e.x=t.dcg_nodeFixed.x,e.y=t.dcg_nodeFixed.y):(void 0!==t.x&&(e.x=t.x),void 0!==t.y&&(e.y=t.y))}),l=x(c,t,null,function(e){return e.dcg_edgeKey},function(e,t){e.dcg_edgeKey=t.dcg_edgeKey,e.source=i[t.dcg_edgeSource],e.target=i[t.dcg_edgeTarget],e.dcg_edgeLength=t.dcg_edgeLength});u.forEach(function(e,t){e.index=t});var s=null;d.groupConnected()&&(s=cola.separateGraphs(u,l).map(function(e){return{leaves:e.array.map(function(e){return e.index})}}));o.on("tick",function(){r("tick")}).on("start",function(){a.start()}).on("end",function(){r("end")}),o.nodes(u).links(l).constraints(n).groups(s)}(t,n,r)},start:function(){o.start(d.unconstrainedIterations(),d.userConstraintIterations(),d.allConstraintsIterations(),d.gridSnapIterations())},stop:function(){o&&o.stop()},optionNames:function(){return["handleDisconnected","lengthStrategy","baseLength","flowLayout","tickSize","groupConnected"].concat(s)},populateLayoutNode:function(){},populateLayoutEdge:function(){},handleDisconnected:J(!0),lengthStrategy:J("symmetric"),baseLength:J(30),flowLayout:function(e){if(!arguments.length){if(n)return n;switch(d.rankdir()){case"LR":return{axis:"x",minSeparation:d.ranksep()+2*d.parent().nodeRadius()};case"TB":return{axis:"y",minSeparation:d.ranksep()+2*d.parent().nodeRadius()};default:return null}}return n=e,this},unconstrainedIterations:J(10),userConstraintIterations:J(20),allConstraintsIterations:J(20),gridSnapIterations:J(0),tickSize:J(1),groupConnected:J(!1)});return d},$.cola_layout.scripts=["d3.js","cola.js"],$.dagre_layout=function(t){var n,r=t||u(),o=null,a=e.dispatch("tick","start","end"),i={},c={},l=$.graphviz_attrs(),s=Object.keys(l);return Object.assign(l,{layoutAlgorithm:function(){return"dagre"},layoutId:function(){return r},supportsWebworker:function(){return!0},needsStage:function(e){return"ports"===e||"edgepos"===e},on:function(e,t){return 1===arguments.length?a.on(e):(a.on(e,t),this)},init:function(e){return this.optionNames().forEach(function(t){e[t]=e[t]||this[t]()}.bind(this)),function(e){(o=new dagre.graphlib.Graph({multigraph:!0})).setGraph({rankdir:e.rankdir,nodesep:e.nodesep,ranksep:e.ranksep}),o.setDefaultEdgeLabel(function(){return{}})}(e),this},data:function(e,t,r){!function(e,t){function r(e){a[e](u,l.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}var u=x(i,e,null,function(e){return e.dcg_nodeKey},function(e,t){e.dcg_nodeKey=t.dcg_nodeKey,e.width=t.width,e.height=t.height},function(e,t){o.setNode(e,t)},function(e){o.removeNode(e)}),l=x(c,t,null,function(e){return e.dcg_edgeKey},function(e,t){e.dcg_edgeKey=t.dcg_edgeKey,e.dcg_edgeSource=t.dcg_edgeSource,e.dcg_edgeTarget=t.dcg_edgeTarget},function(e,t,n){o.setEdge(n.dcg_edgeSource,n.dcg_edgeTarget,t)},function(e,t){o.removeEdge(t.dcg_edgeSource,t.dcg_edgeTarget,t.dcg_edgeKey)});(function(){r("tick")}),n=function(){r("end")}}(t,r)},start:function(){a.start(),dagre.layout(o),n()},stop:function(){},optionNames:function(){return s},populateLayoutNode:function(){},populateLayoutEdge:function(){}})},$.dagre_layout.scripts=["d3.js","dagre.js"],$.tree_layout=function(t){var n,r,o,a=t||u(),i=e.dispatch("tick","start","end");return{layoutAlgorithm:function(){return"tree"},layoutId:function(){return a},supportsWebworker:function(){return!1},on:function(e,t){return 1===arguments.length?i.on(e):(i.on(e,t),this)},init:function(t){return this.optionNames().forEach(function(e){t[e]=t[e]||this[e]()}.bind(this)),function(t){function r(e,t){return(a(e)+a(t))/2}var o,a=e.functor(t.nodeWidth);n=$.depth_first_traversal({nodeid:function(e){return e.dcg_nodeKey},sourceid:function(e){return e.dcg_edgeSource},targetid:function(e){return e.dcg_edgeTarget},init:function(){o=t.offsetX},row:function(e){return e.dcg_rank},place:function(e,n,r){if(r.length){var i=r[r.length-1],u=(a(i)+a(e))/2;o=Math.max(o,i.left_x+u)}e.left_x=o,e.hit_ins=1,e.y=n*t.gapY+t.offsetY},sib:function(e,t,n){var a=r(t,n);e&&(a*=1.5),o+=a},pop:function(e){e.x=(e.left_x+o)/2},skip:function(e,t){e.x=(e.hit_ins*e.x+o)/++e.hit_ins,e.hit_ins===t&&delete e.hit_ins},finish:function(e){e.forEach(function(e){for(var t,n=e.sort(function(e,t){return e.x-t.x}),o=null,a=null,i=0;i<n.length-1;++i){var u=n[i],c=n[i+1];if(o){if(t+=r(u,c),i<n.length-2&&c.x<a+t)continue;o>0&&--o;var l,s;if(i<n.length-2){var d=c.x-(a+t);l=n[o].x+d/2,s=i+1}else l=Math.max(n[o].x,a-r(n[o],n[o+1])-(t-c.x+a)/2),s=n.length;for(var f=o+1;f<s;++f)l+=r(n[f-1],n[f]),n[f].x=l;o=a=t=null}else c.x-u.x<r(u,c)&&(o=i,a=u.x,t=r(u,c))}})}})}(t),this},data:function(e,t,n){!function(e,t){r=e,o=t}(t,n)},start:function(){n(r,o),i.end(r,o)},stop:function(){},optionNames:function(){return["nodeWidth","offsetX","offsetY","rowFunction","gapY"]},populateLayoutNode:function(e,t){this.rowFunction()&&(e.dcg_rank=this.rowFunction.eval(t))},populateLayoutEdge:function(){},nodeWidth:J(function(e){return e.width}),offsetX:J(30),offsetY:J(30),rowFunction:J(null),gapY:J(100)}},$.tree_layout.scripts=[],$.graphviz_layout=function(t,n,r){function o(e){return e.replace(/^%/,"&#37;")}function a(e){return e.replace(/^&#37;/,"%")}function i(e,t){return[e,'"'+t+'"'].join("=")}function c(e){return"["+e.join(", ")+"]"}function l(e,t){h.start();var n=t.bb.split(",").map(function(e){return+e}),r=(t.objects||[]).filter(function(e){return e.pos}).map(function(e){var t=e.pos.split(",");return{dcg_nodeKey:a(e.name),x:+t[0],y:n[3]-t[1]}});(f=(t.objects||[]).filter(function(e){return/^cluster/.test(e.name)})).forEach(function(e){e.bbflip=e.bb.split(",").map(function(e){return+e});var t=n[3]-e.bbflip[1];e.bbflip[1]=n[3]-e.bbflip[3],e.bbflip[3]=t});var o=(t.edges||[]).map(function(e){var t={dcg_edgeKey:a(e.id||"n"+e._gvid)};if(e._draw_){var r=e._draw_.find(function(e){return e.op&&e.points});t.points=r.points.map(function(e){return{x:e[0],y:n[3]-e[1]}})}return t});h.end(r,o)}var s,d,f,g=t||u(),h=e.dispatch("tick","start","end"),p=$.graphviz_attrs(),y=Object.keys(p);return Object.assign(p,{layoutAlgorithm:function(){return n},layoutId:function(){return g},supportsWebworker:function(){return!1},on:function(e,t){return 1===arguments.length?h.on(e):(h.on(e,t),this)},init:function(e){return this.optionNames().forEach(function(t){e[t]=e[t]||this[t]()}.bind(this)),this},data:function(e,t,r){!function(e,t){if(s)d=s;else{var r=[],a="neato"!==n;r.push((a?"digraph":"graph")+" g {"),r.push("graph "+c([i("nodesep",p.nodesep()/72),i("ranksep",p.ranksep()/72),i("rankdir",p.rankdir())])),(r=(r=r.concat(e.map(function(e){var t=[i("width",e.width/72),i("height",e.height/72),i("fixedsize","shape"),i("shape",e.abstract.shape)];return e.dcg_nodeFixed&&t.push(i("pos",[e.dcg_nodeFixed.x,1e3-e.dcg_nodeFixed.y].join(","))),'  "'+o(e.dcg_nodeKey)+'" '+c(t)}))).concat(t.map(function(e){return'  "'+o(e.dcg_edgeSource)+(a?'" -> "':'" -- "')+o(e.dcg_edgeTarget)+'" '+c([i("id",o(e.dcg_edgeKey)),i("arrowhead","none"),i("arrowtail","none")])}))).push("}"),r.push(""),d=r.join("\n")}}(t,r)},dotInput:function(e){return s=e,this},clusters:function(){return f},start:function(){!function(){if(r)e.json(r).header("Content-type","application/x-www-form-urlencoded").post("layouttool="+n+"&"+encodeURIComponent(d),l);else{var t=Viz(d,{format:"json",engine:n,totalMemory:1<<25});l(0,t=JSON.parse(t))}}()},stop:function(){},optionNames:function(){return y},populateLayoutNode:function(){},populateLayoutEdge:function(){}})},$.d3_force_layout=function(t){function n(e){i[e](s,d.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}function r(){!function(){if(null===g)a.gravity(f.gravityStrength).charge(f.initialCharge);else{if(f.fixOffPathNodes){var t=e.set();g.forEach(function(e){e.forEach(function(e){t.add(e)})}),Object.keys(c).forEach(function(e){t.has(e)?c[e].fixed=!1:c[e].fixed=!0})}a.charge(f.chargeForce)}}(),function(e){if(!e)return void n("end");a.start();for(var t=0;t<300;++t)a.tick(),g&&function(){function e(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function t(t,n){var r=function(e,t){return e.x*t.x+e.y*t.y}(t,n)/(e(t)*e(n));return r=Math.min(r,1),r=Math.max(r,-1),Math.acos(r)}function n(t){var n=-t.y/t.x,r=e({x:n,y:1});return{x:n/r,y:1/r}}function r(e,t,n,r){e.x+=n.x*(Math.PI-t)*r,e.y+=n.y*(Math.PI-t)*r}g.forEach(function(e){if(!(e.length<3))for(var o=1;o<e.length-1;++o){var a=c[e[o]],i=c[e[o-1]],u=c[e[o+1]],l={x:i.x-a.x,y:i.y-a.y},s={x:u.x-a.x,y:u.y-a.y},d=t(l,s),g=n(l),h=n(s),p={x:(i.x+u.x)/2,y:(i.y+u.y)/2},y={x:p.x-i.x,y:p.y-i.y},v={x:p.x-u.x,y:p.y-u.y};g=t(y,g)>=Math.PI/2?g:{x:-g.x,y:-g.y},h=t(v,h)>=Math.PI/2?h:{x:-h.x,y:-h.y},r(i,d,g,f.angleForce),r(u,d,h,f.angleForce)}})}();a.stop()}(f.iterations)}var o=t||u(),a=null,i=e.dispatch("tick","start","end"),c={},l={},s=[],d=[],f=null,g=null,h=$.graphviz_attrs(),p=Object.keys(h);return Object.assign(h,{layoutAlgorithm:function(){return"d3-force"},layoutId:function(){return o},supportsWebworker:function(){return!0},parent:J(null),on:function(e,t){return 1===arguments.length?i.on(e):(i.on(e,t),this)},init:function(t){return this.optionNames().forEach(function(e){t[e]=t[e]||this[e]()}.bind(this)),function(t){f=t,(a=e.layout.force().size([t.width,t.height])).on("tick",function(){n("tick")}).on("start",function(){i.start()}).on("end",function(){n("end")})}(t),this},data:function(e,t,n,r){!function(e,t,n){var r={};e.forEach(function(e,t){r[e.dcg_nodeKey]=t}),s=x(c,e,null,function(e){return e.dcg_nodeKey},function(e,t){e.dcg_nodeKey=t.dcg_nodeKey,e.width=t.width,e.height=t.height,e.id=t.dcg_nodeKey,t.dcg_nodeFixed?(e.fixed=!0,e.x=t.dcg_nodeFixed.x,e.y=t.dcg_nodeFixed.y):e.fixed=!1}),d=x(l,t,null,function(e){return e.dcg_edgeKey},function(e,t){e.dcg_edgeKey=t.dcg_edgeKey,e.source=c[t.dcg_edgeSource],e.source.id=r[e.source.dcg_nodeKey],e.target=c[t.dcg_edgeTarget],e.target.id=r[e.target.dcg_nodeKey],e.dcg_edgeLength=t.dcg_edgeLength}),a.nodes(s),a.links(d)}(t,n)},start:function(){r()},stop:function(){a&&a.stop()},paths:function(e){g=e},savePositions:function(){var e={};return Object.keys(c).forEach(function(t){e[t]={x:c[t].x,y:c[t].y}}),e},restorePositions:function(e){Object.keys(e).forEach(function(t){c[t]&&(c[t].fixed=!1,c[t].x=e[t].x,c[t].y=e[t].y)})},optionNames:function(){return["iterations","angleForce","chargeForce","gravityStrength","initialCharge","fixOffPathNodes"].concat(p)},iterations:J(300),angleForce:J(.02),chargeForce:J(-500),gravityStrength:J(1),initialCharge:J(-400),fixOffPathNodes:J(!1),populateLayoutNode:function(){},populateLayoutEdge:function(){}})},$.d3_force_layout.scripts=["d3.js"],$.d3v4_force_layout=function(t){function n(e){i[e](s,d.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}function r(){i.start(),function(t){t&&(t=t.filter(function(e){return e.nodes.every(function(e){return c[e]})}));if(null!==t&&t.length){var n;f.fixOffPathNodes&&(n=e.set(),t.forEach(function(e){e.nodes.forEach(function(e){n.add(e)})})),Object.keys(c).forEach(function(e){f.fixOffPathNodes&&!n.has(e)?(c[e].fx=c[e].x,c[e].fy=c[e].y):(c[e].fx=null,c[e].fy=null)}),a.force("charge").strength(f.chargeForce),a.force("straighten",d3v4.forceStraightenPaths().id(function(e){return e.dcg_nodeKey}).angleForce(f.angleForce).pathNodes(function(e){return e.nodes}).pathStrength(function(e){return e.strength}).paths(t))}else a.force("charge").strength(f.initialCharge)}(g),function(e){a.alpha(1);for(var t=0;t<e;++t)a.tick(),n("tick");n("end")}(f.iterations)}var o=t||u(),a=null,i=e.dispatch("tick","start","end"),c={},l={},s=[],d=[],f=null,g=null,h=$.graphviz_attrs(),p=Object.keys(h),y=Object.assign(h,{layoutAlgorithm:function(){return"d3v4-force"},layoutId:function(){return o},supportsWebworker:function(){return!0},parent:J(null),on:function(e,t){return 1===arguments.length?i.on(e):(i.on(e,t),this)},init:function(e){return this.optionNames().forEach(function(t){e[t]=e[t]||this[t]()}.bind(this)),function(e){f=e,a=d3v4.forceSimulation().force("link",d3v4.forceLink()).force("center",d3v4.forceCenter(e.width/2,e.height/2)).force("gravityX",d3v4.forceX(e.width/2).strength(f.gravityStrength)).force("gravityY",d3v4.forceY(e.height/2).strength(f.gravityStrength)).force("collision",d3v4.forceCollide(f.collisionRadius)).force("charge",d3v4.forceManyBody()).stop()}(e),this},data:function(e,t,n,r){!function(e,t,n){var r={};e.forEach(function(e,t){r[e.dcg_nodeKey]=t}),s=x(c,e,null,function(e){return e.dcg_nodeKey},function(e,t){e.dcg_nodeKey=t.dcg_nodeKey,e.width=t.width,e.height=t.height,e.id=t.dcg_nodeKey,t.dcg_nodeFixed?(e.fx=t.dcg_nodeFixed.x,e.fy=t.dcg_nodeFixed.y):e.fx=e.fy=null}),d=x(l,t,null,function(e){return e.dcg_edgeKey},function(e,t){e.dcg_edgeKey=t.dcg_edgeKey,e.source=r[c[t.dcg_edgeSource].dcg_nodeKey],e.target=r[c[t.dcg_edgeTarget].dcg_nodeKey],e.dcg_edgeLength=t.dcg_edgeLength}),a.force("straighten",null),a.nodes(s),a.force("link").links(d)}(t,n)},start:function(){r()},stop:function(){},paths:function(e){g=e},savePositions:function(){var e={};return Object.keys(c).forEach(function(t){e[t]={x:c[t].x,y:c[t].y}}),e},restorePositions:function(e){Object.keys(e).forEach(function(t){c[t]&&(c[t].fx=e[t].x,c[t].fy=e[t].y)})},optionNames:function(){return["iterations","angleForce","chargeForce","gravityStrength","collisionRadius","initialCharge","fixOffPathNodes"].concat(p)},iterations:J(300),angleForce:J(.01),chargeForce:J(-600),gravityStrength:J(.3),collisionRadius:J(8),initialCharge:J(-100),fixOffPathNodes:J(!1),populateLayoutNode:function(){},populateLayoutEdge:function(){}});return y.pathStraightenForce=y.angleForce,y},$.d3v4_force_layout.scripts=["d3.js","d3v4-force.js"],$.flexbox_layout=function(t){function n(e,t,r,o){if(o.address=e.slice(),o.children=o.children||{},t.length){var a=o.children[t[0]]=o.children[t[0]]||{};e.push(t.shift()),n(e,t,r,a)}else o.node=r}function r(e){var t=y.addressToKey()(e.address);return Array.prototype.concat.apply([t],Object.keys(e.children).map(function(t){return r(e.children[t])}))}function o(e,t){var n={name:y.addressToKey()(t.address),style:{}},r=Object.assign({},e),a=Object.keys(t.children).length;t.node&&Object.assign(e,t.node);for(var i in e)if(!(g.includes(i)||a&&h.includes(i))){var u=e[i];"function"==typeof u&&(u=u(t.node)),n.style[i]=u}return a&&(n.children=Object.values(t.children).sort(e.sort).map(function(e){return e.address[e.address.length-1]}).map(function(e){return o(Object.assign({},r),t.children[e])})),t.flexnode=n,n}function a(e,t){y.logStuff()&&console.log(t.node.dcg_nodeKey+": "+JSON.stringify(t.flexnode.layout)),t.node.x=e.x+t.flexnode.layout.left+t.flexnode.layout.width/2,t.node.y=e.y+t.flexnode.layout.top+t.flexnode.layout.height/2,Object.keys(t.children).map(function(e){return t.children[e]}).forEach(function(n){a({x:e.x+t.flexnode.layout.left,y:e.y+t.flexnode.layout.top},n)})}function i(){var t=o({sort:function(t,n){return e.ascending(t.node.dcg_nodeKey,n.node.dcg_nodeKey)}},l);t.style.width=c.width,t.style.height=c.height,y.logStuff()&&console.log(JSON.stringify(t,null,2)),computeLayout(t),a({x:0,y:0},l),function(e,t,n){f[n](e,t.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}(s,[],"end")}var c,l,s,d=t||u(),f=e.dispatch("tick","start","end"),g=["sort","dcg_nodeKey","x","y"],h=["width","height"],p=["width","height","minWidth","minHeight","maxWidth","maxHeight","left","right","top","bottom","margin","marginLeft","marginRight","marginTop","marginBottom","padding","paddingLeft","paddingRight","paddingTop","paddingBottom","borderWidth","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth","flexDirection","justifyContent","alignItems","alignSelf","flex","flexWrap","position"],y={layoutAlgorithm:function(){return"cola"},layoutId:function(){return d},supportsWebworker:function(){return!0},needsStage:function(e){return"ports"===e||"edgepos"===e},parent:J(null),on:function(e,t){return 1===arguments.length?f.on(e):(f.on(e,t),this)},init:function(e){return this.optionNames().forEach(function(t){e[t]=e[t]||this[t]()}.bind(this)),this},data:function(e,t){!function(e,t){c=e,l={},t.forEach(function(e){n([],y.keyToAddress()(e.dcg_nodeKey),e,l)}),r(l),s=t}(e,t)},start:function(){i()},stop:function(){},optionNames:function(){return[]},populateLayoutNode:function(e,t){["sort","order"].concat(p).forEach(function(n){t.orig.value[n]&&(e[n]=t.orig.value[n])})},populateLayoutEdge:function(){},addressToKey:J(function(e){return e.join(",")}),keyToAddress:J(function(e){return e.split(",")}),logStuff:J(!1)};return y},$.flexbox_layout.scripts=["css-layout.js"],$.manual_layout=function(t){function n(){!function(e,t,n){a[n](e,t.map(function(e){return{dcg_edgeKey:e.dcg_edgeKey}}))}(r,[],"end")}var r,o=t||u(),a=e.dispatch("tick","start","end");return{layoutAlgorithm:function(){return"manual"},layoutId:function(){return o},supportsWebworker:function(){return!0},needsStage:function(e){return"ports"===e||"edgepos"===e},parent:J(null),on:function(e,t){return 1===arguments.length?a.on(e):(a.on(e,t),this)},init:function(e){return this.optionNames().forEach(function(t){e[t]=e[t]||this[t]()}.bind(this)),this},data:function(e,t,n){!function(e){r=e}(t)},start:function(){n()},stop:function(){},optionNames:function(){return[]},populateLayoutNode:function(e,t){["x","y"].forEach(function(n){void 0!==t.orig.value[n]&&(e[n]=t.orig.value[n])})},populateLayoutEdge:function(){},addressToKey:J(function(e){return e.join(",")}),keyToAddress:J(function(e){return e.split(",")})}},$.manual_layout.scripts=["css-layout.js"],$.place_ports=function(){function t(t,r,o,a,i,u,c){function l(e,t){return e[0]*t[1]-e[1]*t[0]>0}function s(e,t){return l(t[0],e)&&l(e,t[1])}function d(e,t){return l(e,t[0])?t[0]:l(t[1],e)?t[1]:e}function f(e){return[Math.cos(e),Math.sin(e)]}function g(e){return Math.atan2(e[1],e[0])}function h(e,t){return Math.hypot(t.pos.x-e.pos.x,t.pos.y-e.pos.y)}function p(e,t){return h(e,t)>n.minDistance()}function y(e,t){return e+Math.random()*(t-e)}var v=t.nodePorts();for(var m in v){var x=r[m],_=v[m];_.forEach(function(e){var n=e.orig&&t.portBounds.eval(e)||[0,2*Math.PI];Array.isArray(n[0])?(e.vbounds=n,e.abounds=n.map(g)):(e.vbounds=n.map(f),e.abounds=n),e.abounds[0]>e.abounds[1]&&(e.abounds[1]+=2*Math.PI),console.assert(e.orig||e.vec,"unplaced unspecified port")});var b=[],w=[],k=[];_.forEach(function(e){e.vec?e.vbounds&&!s(e.vec,e.vbounds)?w.push(e):b.push(e):k.push(e)}),w.forEach(function(e){e.vec=d(e.vec,e.vbounds),b.push(e)});var E={},S={};k.forEach(function(e){var t=e.abounds.map(function(e){return e.toFixed(3)}).join(",");E[t]=e.abounds,S[t]=S[t]||[],S[t].push(e)});for(var K in S){var A=E[K],T=S[K];if(1===T.length)T[0].vec=f((A[0]+A[1])/2);else{var P=(A[1]-A[0])/(S[K].length-1);S[K].forEach(function(e,t){e.vec=f(A[0]+t*P)})}}b=b.concat(k),k=[],b.forEach(function(e){U(t,x,e)});for(var N=0;N<b.length;++N){var O=b[N];if(!k.includes(O))for(var M=N+1;M<b.length;++M){var L=b[M];if(!k.includes(L)&&!p(O,L)){if(!O.edges.length){k.push(O);continue}k.push(L)}}}b=b.filter(function(e){return!k.includes(e)});for(var j,D=n.patience(),C=0;k.length;){var R=k[0];R.vec=f(y(R.abounds[0],R.abounds[1])),U(t,x,R);var I=e.min(b,function(e){return h(R,e)});I>C&&(C=I,j=R.vec),(!D--||I>n.minDistance())&&(D<0&&(console.warn("ran out of patience placing a port"),R.vec=j,U(t,x,R)),b.push(R),k.shift(),D=n.patience(),C=0)}}}var n={parent:J(null).react(function(e){e?e.on("receivedLayout.place-ports",t):n.parent()&&n.parent().on("receivedLayout.place-ports",null)}),minDistance:J(20),patience:J(20)};return n},$.grid=function(){function t(t){(i=t.g().selectAll("g.grid-layer").data([0])).enter().append("g").attr("class","grid-layer");var n=u.wholeOnLines()?0:.5,c=r>=u.threshold()?e.range(Math.floor(o[0]),Math.ceil(o[1])+1):[],l=i.selectAll("line.grid-line.vertical").data(c,function(e){return e-n});l.exit().remove(),l.enter().append("line").attr({class:"grid-line vertical",x1:function(e){return e-n},x2:function(e){return e-n}}),l.attr({"stroke-width":1/r,y1:a[0],y2:a[1]});var s=r>=u.threshold()?e.range(Math.floor(a[0]),Math.ceil(a[1])+1):[],d=i.selectAll("line.grid-line.horizontal").data(s,function(e){return e-n});d.exit().remove(),d.enter().append("line").attr({class:"grid-line horizontal",y1:function(e){return e-n},y2:function(e){return e-n}}),d.attr({"stroke-width":1/r,x1:o[0],x2:o[1]})}function n(e,n,i,c){e,r=n,o=i,a=c,t(u.parent())}var r,o,a,i=null,u=$.behavior("highlight-paths",{add_behavior:function(e,t,n,r){},remove_behavior:function(e,t,n,r){i&&i.remove()},parent:function(e){e&&(e.on("zoomed.grid",n),function(e){e.translate(),r=e.scale(),o=e.x().domain(),a=e.y().domain(),t(e)}(e))}});return u.threshold=J(4),u.wholeOnLines=J(!0),u},$.troubleshoot=function(){function e(e,t,r,o){function h(e){return{x:e.cola.x,y:e.cola.y}}d||(d=e.g().append("g").attr({class:"troubleshoot","pointer-events":"none"}));var p=t.data().map(function(e){return{x:e.cola.x,y:e.cola.y}}),y=d.selectAll("path.nodecenter").data(p);y.exit().remove(),y.enter().append("path").attr("class","nodecenter"),y.attr({d:function(e){return"M"+(e.x-g.xhairWidth()/2)+","+e.y+" h"+g.xhairWidth()+" M"+e.x+","+(e.y-g.xhairHeight()/2)+" v"+g.xhairHeight()},opacity:null!==g.xhairOpacity()?g.xhairOpacity():g.opacity(),stroke:g.xhairColor(),"stroke-width":1/f});var v=t.data().map(function(e){return n(h(e),e.cola.width,e.cola.height)});a(d.selectAll("path.colaboundary").data(v),"colaboundary",g.boundsColor());var m=t.data().map(function(e){return e.bbox&&(e.bbox.width||e.bbox.height)?n(h(e),e.bbox.width,e.bbox.height):null}).filter(function(e){return!!e});a(d.selectAll("path.textboundary").data(m),"textboundary",g.boundsColor());var x=t.data().map(function(e){return"number"!=typeof e.dcg_rx?null:n(h(e),2*e.dcg_rx,2*e.dcg_ry)}).filter(function(e){return!!e});a(d.selectAll("path.radiiboundary").data(x),"radiiboundary",g.boundsColor()),e.addOrRemoveDef("debug-orient-marker-head",!0,"svg:marker",c.bind(null,g.arrowHeadColor())),e.addOrRemoveDef("debug-orient-marker-tail",!0,"svg:marker",c.bind(null,g.arrowTailColor()));var _=g.arrowLength()?r.data().map(function(e){return{pos:e.pos.new.path.points[e.pos.new.path.points.length-1],orient:e.pos.new.orienthead}}):[];u(d.selectAll("line.heads").data(_),"heads",g.arrowHeadColor(),"#debug-orient-marker-head");var b=g.arrowLength()?r.data().map(function(e){return{pos:e.pos.new.path.points[0],orient:e.pos.new.orienttail}}):[];u(d.selectAll("line.tails").data(b),"tails",g.arrowTailColor(),"#debug-orient-marker-tail");var w=Array.prototype.concat.apply([],r.data().map(function(t){var n=e.edgeArrowSize.eval(t);return l(e.arrows(),e.edgeArrowhead.eval(t),n,e.edgeStrokeWidth.eval(t)/n,i(t.pos.new.orienthead),t.pos.new.path.points[t.pos.new.path.points.length-1],e.nodeStrokeWidth.eval(t.target))}));s(d.selectAll("path.head-point").data(w),"head-point",g.arrowHeadColor());var k=Array.prototype.concat.apply([],r.data().map(function(t){var n=e.edgeArrowSize.eval(t);return l(e.arrows(),e.edgeArrowtail.eval(t),n,e.edgeStrokeWidth.eval(t)/n,i(t.pos.new.orienttail),t.pos.new.path.points[0],e.nodeStrokeWidth.eval(t.source))}));s(d.selectAll("path.tail-point").data(k),"tail-point",g.arrowTailColor());var E=d.selectAll("rect.domain").data([0]);E.enter().append("rect");var S=g.parent().x().domain(),K=g.parent().y().domain();E.attr({class:"domain",fill:"none",opacity:g.domainOpacity(),stroke:g.domainColor(),"stroke-width":g.domainStrokeWidth()/f,x:S[0],y:K[0],width:S[1]-S[0],height:K[1]-K[0]})}function t(t,n,r,o){t,f=n,r,o,e(g.parent(),g.parent().selectAllNodes(),g.parent().selectAllEdges())}function n(e,t,n){return{left:e.x-t/2,top:e.y-n/2,right:e.x+t/2,bottom:e.y+n/2}}function r(e,t,n,r){return"M"+e+","+(t+r)+" v"+-r+" h"+n}function o(e){return[r(e.left,e.top,g.boundsWidth(),g.boundsHeight()),r(e.right,e.top,-g.boundsWidth(),g.boundsHeight()),r(e.right,e.bottom,-g.boundsWidth(),-g.boundsHeight()),r(e.left,e.bottom,g.boundsWidth(),-g.boundsHeight())].join(" ")}function a(e,t,n){e.exit().remove(),e.enter().append("path").attr("class",t),e.attr({d:o,opacity:null!==g.boundsOpacity()?g.boundsOpacity():g.opacity(),stroke:n,"stroke-width":1/f,fill:"none"})}function i(e){return+e.replace("rad","")}function u(e,t,n,r){e.exit().remove(),e.enter().append("line").attr("class",t),e.attr({x1:function(e){return e.pos.x},y1:function(e){return e.pos.y},x2:function(e){return e.pos.x-Math.cos(i(e.orient))*g.arrowLength()},y2:function(e){return e.pos.y-Math.sin(i(e.orient))*g.arrowLength()},stroke:n,"stroke-width":g.arrowStrokeWidth()/f,opacity:null!==g.arrowOpacity()?g.arrowOpacity():g.opacity(),"marker-end":"url("+r+")"})}function c(e,t){t.attr({viewBox:"0 -3 3 6",refX:3,refY:0,orient:"auto"}),t.append("path").attr("stroke",e).attr("fill","none").attr("d","M0,3 L3,0 L0,-3")}function l(e,t,n,r,o,a,i){var u=I(e,t),c=B(u,r),l=[Math.cos(o),Math.sin(o)];if(a=[a.x,a.y],!u.length)return[[a[0]-l[0]*i/2,a[1]-l[1]*i/2]];var s=z([-i/n/2,0],F(ae(u[0].frontRef),-1)),d=c.map(function(e,t){return F([s,ae(u[t].frontRef),e.offset].reduce(z),n)});return d.push(F([s,ie(u[u.length-1].backRef),c[u.length-1].offset].reduce(z),n)),d.map(function(e){return z(a,[e[0]*l[0]-e[1]*l[1],e[0]*l[1]+e[1]*l[0]])})}function s(e,t,n){var r=g.xWidth()/2,o=g.xHeight()/2;e.exit().remove(),e.enter().append("path").attr("class",t),e.attr({d:function(e){return[[[-r,-o],[r,o]],[[r,-o],[-r,o]]].map(function(t){return"M"+t.map(function(t){return e[0]+t[0]+","+(e[1]+t[1])}).join(" L")}).join(" ")},"stroke-width":2/f,stroke:n,opacity:g.xOpacity()})}var d=null,f=1,g=$.behavior("highlight-paths",{laterDraw:!0,add_behavior:e,remove_behavior:function(e,t,n,r){d&&d.remove()},parent:function(e){e?(e.translate(),f=e.scale(),e.on("zoomed.troubleshoot",t)):g.parent()&&g.parent().on("zoomed.troubleshoot",null)}});return g.opacity=J(.75),g.xhairOpacity=J(null),g.xhairWidth=J(10),g.xhairHeight=J(10),g.xhairColor=J("blue"),g.boundsOpacity=J(null),g.boundsWidth=J(10),g.boundsHeight=J(10),g.boundsColor=J("green"),g.arrowOpacity=J(null),g.arrowStrokeWidth=J(3),g.arrowColor=g.arrowHeadColor=J("darkorange"),g.arrowTailColor=J("red"),g.arrowLength=J(100),g.xWidth=J(1),g.xHeight=J(1),g.xOpacity=J(.8),g.domainOpacity=J(.6),g.domainColor=J("darkorange"),g.domainStrokeWidth=J(4),g},$.validate=function(t){function n(e,t,n,r){var o=e.filter(function(e){return!t(e)});return o.length?[n+" is empty for "+o.length+" of "+e.length+" "+r,o]:null}function r(e,t){return e.reduce(function(e,n){return e[t(n)]=n,e},{})}function o(e,t,n,r,o,a){var i=t.filter(function(t){return!e[n(t)]}).map(function(e){return{key:n(e),value:e}});return i.length?[r+" was not found in "+o,Object.keys(e),"for "+i.length+" of "+t.length+" "+a,i]:null}function a(){function a(e){e&&f.push(e)}function u(){return l.length+" nodes, "+s.length+" edges, "+d.length+" ports"}var c=i.parent(),l=c.nodeGroup().all(),s=c.edgeGroup().all(),d=c.portGroup()?c.portGroup().all():[],f=[];a(n(l,c.nodeKey(),"nodeKey","nodes")),a(n(s,c.edgeSource(),"edgeSource","edges")),a(n(s,c.edgeTarget(),"edgeTarget","edges"));var g=e.set(c.content.enum()),h=$.functor_wrap(c.nodeContent()),p=l.filter(function(e){return!g.has(h(e))});p.length&&f.push(["there are "+p.length+" nodes with nodeContent not matching any content",p]);var y=r(l,c.nodeKey()),v=r(s,c.edgeKey());a(o(y,s,c.edgeSource(),"edgeSource","nodes","edges")),a(o(y,s,c.edgeTarget(),"edgeTarget","nodes","edges")),a(n(d,function(e){return c.portNodeKey()&&c.portNodeKey()(e)||c.portEdgeKey()&&c.portEdgeKey()(e)},"portNodeKey||portEdgeKey","ports"));var m=!c.portNodeKey()&&[]||d.filter(function(e){return c.portNodeKey()(e)}),x=!c.portEdgeKey()&&[]||d.filter(function(e){return c.portEdgeKey()(e)});if(a(o(y,m,c.portNodeKey(),"portNodeKey","nodes","ports")),a(o(v,x,c.portEdgeKey(),"portEdgeKey","edges","ports")),c.portName()){var _=r(m,function(e){return c.portNodeKey()(e)+" - "+c.portName()(e)});c.edgeSourcePortName()&&a(o(_,s,function(t){return c.edgeSource()(t)+" - "+e.functor(c.edgeSourcePortName())(t)},"edgeSourcePortName","ports","edges")),c.edgeTargetPortName()&&a(o(_,s,function(t){return c.edgeTarget()(t)+" - "+e.functor(c.edgeTargetPortName())(t)},"edgeTargetPortName","ports","edges"))}f.length?(console.warn("validation of "+t+" failed with "+u()+":"),f.forEach(function(e){console.warn.apply(null,e)})):console.log("validation of "+t+" succeeded with "+u()+".")}var i={parent:J(null).react(function(e){e?e.on("data.validate",a):i.parent().on("data.validate",null)})};return i},$.legend=function(t){function n(){g.dimension()&&(g.dimension().filterFunction(function(e){return!d.length||d.includes(e)}),g.parent().redraw())}function o(e,t,n,o,a,i,u){g.counter()&&(s=g.counter()(n.map(r),a.map(r),u.map(r)))}function a(){var r=g.parent().svg().selectAll("g.dc-graph-legend."+t).data([0]);r.enter().append("g").attr("class","dc-graph-legend "+t).attr("transform","translate("+g.x()+","+g.y()+")");var o=g.omitEmpty()&&s?u.filter(function(e){return d.length&&!d.includes(e.orig.key)||s[e.orig.key]}):u,a=r.selectAll(g.type().itemSelector()).data(o,function(e){return e.name});a.exit().remove();var i=g.type().create(g.parent(),a.enter(),g.itemWidth(),g.itemHeight());if(i.append("text").attr("dy","0.3em").attr("class","legend-label"),a.attr("transform",function(e,t){return"translate("+g.itemWidth()/2+","+(g.itemHeight()+g.gap())*(t+.5)+")"}),a.select("text.legend-label").attr("transform","translate("+(g.itemWidth()/2+g.gap())+",0)").attr("pointer-events",g.dimension()?"auto":"none").text(function(e){return e.name+(g.counter()&&s?" ("+(s[e.orig.key]||0)+(s[e.orig.key]!==l[e.orig.key]?"/"+(l[e.orig.key]||0):"")+")":"")}),g.type().draw(g.parent(),i,a),g.noLabel()&&a.selectAll(g.type().labelSelector()).remove(),g.dropdown()){var h=a.selectAll("text.dropdown-caret").data(function(e){return[e]});h.enter().append("text").attr("dy","0.3em").attr("font-size","75%").attr("fill","blue").attr("class","dropdown-caret").style("visibility","hidden").html("&emsp;&#x25BC;"),h.attr("dx",function(t){return g.itemWidth()/2+g.gap()+c(e.select(this.parentNode).select("text.legend-label").node()).width}).on("mouseenter",function(e){var t=this.getBoundingClientRect(),n=g.parent().nodeKey.eval(e);g.dropdown().show(n,t.x,t.y)}),a.on("mouseenter",function(t){s&&s[t.orig.key]&&e.select(this).selectAll(".dropdown-caret").style("visibility","visible")}).on("mouseleave",function(t){e.select(this).selectAll(".dropdown-caret").style("visibility","hidden")})}g.dimension()?a.attr("cursor","pointer").on("click.legend",function(e){var t=g.parent().nodeKey.eval(e);d.length||(d=u.map(g.parent().nodeKey.eval)),d.includes(t)?d=d.filter(function(e){return e!==t}):d.push(t),n(),f.filtered(g,t)}):a.attr("cursor","auto").on("click.legend",null),a.transition().duration(1e3).attr("opacity",function(e){return!d.length||d.includes(g.parent().nodeKey.eval(e))?1:.25})}function i(){var e=g.exemplars();if(g.countBaseline(),e instanceof Array)u=e.map(function(e){return{name:e.name,orig:{key:e.key,value:e.value},cola:{}}});else{u=[];for(var t in e)u.push({name:t,orig:{key:t,value:e[t]},cola:{}})}a()}t=t||"node-legend";var u,l,s,d=[],f=e.dispatch("filtered"),g=$.behavior(t,{add_behavior:a,remove_behavior:function(){},parent:function(e){e?e.on("render."+t,i).on("data."+t,o):g.parent().on("render."+t,null).on("data."+t,null)}});return g.type=J($.legend.node_legend()),g.x=J(0),g.y=J(0),g.gap=J(5),g.itemWidth=g.nodeWidth=J(40),g.itemHeight=g.nodeHeight=J(40),g.omitEmpty=J(!1),g.noLabel=J(!0),g.counter=J(null),g.replaceFilter=function(e){return d=e&&1===e.length?e[0]:[],g},g.filters=function(){return d},g.on=function(e,t){return f.on(e,t),g},g.exemplars=J({}),g.countBaseline=function(){g.counter&&(l=g.counter()(g.parent().nodeGroup().all(),g.parent().edgeGroup().all(),g.parent().portGroup()&&g.parent().portGroup().all()))},g.dropdown=J(null).react(function(e){!!e!=!!g.dropdown()&&g.parent()&&g.parent().svg()&&window.setTimeout(g.redraw,0)}),g.dimension=J(null).react(function(e){e||(d=[],n())}),g},$.legend.node_legend=function(){return{itemSelector:function(){return".node"},labelSelector:function(){return".node-label"},create:function(e,t){return t.append("g").attr("class","node")},draw:function(e,t,n){e._enterNode(t)._updateNode(n)}}},$.legend.edge_legend=function(){var e={itemSelector:function(){return".edge-container"},labelSelector:function(){return".edge-label"},create:function(t,n,r,o){var a=n.append("g").attr("class","edge-container").attr("opacity",0);a.append("rect").attr({x:-r/2,y:-o/2,width:r,height:o,fill:"green",opacity:0}),a.selectAll("circle").data([-1,1]).enter().append("circle").attr({r:e.fakeNodeRadius(),fill:"none",stroke:"black","stroke-dasharray":"4,4",opacity:.15,transform:function(t){return"translate("+[t*e.length()/2,0].join(",")+")"}});var i=e.length()/2-e.fakeNodeRadius();return a.append("svg:path").attr({class:"edge",id:function(e){return e.name},d:"M"+-i+",0 L"+i+",0",opacity:t.edgeOpacity.eval}),a},fakeNodeRadius:J(10),length:J(50),draw:function(e,t,n){e._updateEdge(t.select("path.edge"))}};return e},$.constraint_pattern=function(e){var t={},n=[];return e.nodes.forEach(function(e){var n=e.id,r=t[n]||(t[n]={});if(e.partition){var o=e.partition,a=e.value||e.id;e.all||e.typename?(r.match=e.extract?function(t){return e.extract(t.value[o])}:function(e){return e.value[o]},r.typename=e.typename||function(e){return o+"="+e.value[o]}):r.match=function(e){return e.value[o]===a}}else{if(!e.match)throw new Error("couldn't determine matcher for type "+JSON.stringify(e));r.match=e.match}}),e.edges.forEach(function(e){if(!e.disable){var t={source:e.source,target:e.target};t.produce="function"==typeof e.produce?e.produce:function(){return function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(e.produce)},["listname","wrap","reverse"].forEach(function(n){void 0!==e[n]&&(t[n]=e[n])}),n.push(t)}}),function(e,r,o){var a=[],i={};r.forEach(function(n){var r=e.nodeKey.eval(n);for(var o in t){var a=t[o],u=a.match(n.orig);if(u){var c=a.typename?a.typename(o,u):o;i[c]||(i[c]={nodes:[],whether:{}}),i[c].nodes.push(r),i[c].whether[r]=!0}}});var u=n.filter(function(e){return e.source!==e.target}),c=n.filter(function(e){return e.source===e.target});return o.forEach(function(t){var n=e.edgeSource.eval(t),c=e.edgeTarget.eval(t);u.forEach(function(e){if(i[e.source]&&i[e.source].whether[n]&&i[e.target]&&i[e.target].whether[c]){var t=e.produce(i,r,o);e.reverse?(t.left=c,t.right=n):(t.left=n,t.right=c),a.push(t)}})}),c.forEach(function(e){if(i[e.source]){var t=e.produce(),n=e.listname||e.produce.listname||"nodes",r=e.wrap||e.produce.wrap||function(e){return e};t[n]=i[e.source].nodes.map(r),a.push(t)}}),a}},$.gap_y=function(e,t){return{axis:"y",gap:e,equality:!!t}},$.gap_x=function(e,t){return{axis:"x",gap:e,equality:!!t}},$.align_y=function(){return X("y")},$.align_x=function(){return X("x")},$.order_x=function(e,t){return{type:"ordering",axis:"x",gap:60,ordering:t}},$.order_y=function(e,t){return{type:"ordering",axis:"y",gap:60,ordering:t}},$.tree_positions=function(t,n,r,o,a,i,u){function c(e,t){return(i(e)+i(t))/2}console.warn("dc_graph.tree_positions is deprecated; use the layout engine tree_layout instead"),(t||r)&&console.warn("dc_graph.tree_positions: rootf and treef are ignored");var l;i=e.functor(i);var s=$.depth_first_traversal({nodeid:function(e){return e.cola.dcg_nodeKey},sourceid:function(e){return e.cola.dcg_edgeSource},targetid:function(e){return e.cola.dcg_edgeTarget},init:function(){l=o},row:function(e){return n(e.orig)},place:function(e,t,n){if(n.length){var r=n[n.length-1],o=(i(r)+i(e))/2;l=Math.max(l,r.left_x+o)}e.left_x=l,e.hit_ins=1,e.cola.y=t*u+a},sib:function(e,t,n){var r=c(t,n);e&&(r*=1.5),l+=r},pop:function(e){e.cola.x=(e.left_x+l)/2},skip:function(e,t){e.cola.x=(e.hit_ins*e.cola.x+l)/++e.hit_ins,e.hit_ins===t&&delete e.hit_ins},finish:function(e){e.forEach(function(e){for(var t,n=e.sort(function(e,t){return e.cola.x-t.cola.x}),r=null,o=null,a=0;a<n.length-1;++a){var i=n[a],u=n[a+1];if(r){if(t+=c(i,u),a<n.length-2&&u.cola.x<o+t)continue;r>0&&--r;var l,s;if(a<n.length-2){var d=u.cola.x-(o+t);l=n[r].cola.x+d/2,s=a+1}else l=Math.max(n[r].cola.x,o-c(n[r],n[r+1])-(t-u.cola.x+o)/2),s=n.length;for(var f=r+1;f<s;++f)l+=c(n[f-1],n[f]),n[f].cola.x=l;r=o=t=null}else u.cola.x-i.cola.x<c(i,u)&&(r=a,o=i.cola.x,t=c(i,u))}})}});return function(e,t,n){return s(t,n)}},$.tree_constraints=function(e,t,n,r){return console.warn("dc_graph.tree_constraints is deprecated - it never worked right and may not be a good idea"),function(r,o,a){var i=[],u=0;return $.depth_first_traversal({root:e,tree:t,place:function(e,t,n){if(n.length){var o=n[n.length-1];i.push({left:r.nodeKey.eval(o),right:r.nodeKey.eval(e),axis:"x",gap:u-o.foo_x,equality:!0})}e.foo_x=u},sib:function(){u+=n}})(r,o,a),i}},$.behavior=function(e,t){var n={},r=t.laterDraw?"transitionsStarted":"drawn";return n.parent=J(null).react(function(o){var a;if(o){var i=!0;a=o,o.on(r+"."+e,function(e,n,r){t.add_behavior(a,e,n,r),i&&t.first?(t.first(a,e,n,r),i=!1):t.rest&&t.rest(a,e,n,r)}),o.on("reset."+e,function(){t.remove_behavior(a,a.selectAllNodes(),a.selectAllEdges(),a.selectAllEdges(".edge-hover"))})}else n.parent()&&(a=n.parent()).on(r+"."+e,function(n,o,i){t.remove_behavior(a,n,o,i),a.on(r+"."+e,null)});t.parent&&t.parent(o)}),n},$.tip=function(t){function n(t){if(f.disabled()||f.selection().exclude&&f.selection().exclude(e.event.target))a.call(this);else{var n=this,r=function(){f.content()(t,function(r){s.show.call(n,r,n),e.select("div.d3-tip").selectAll("a.tip-link").on("click",function(){e.event.preventDefault(),f.linkCallback()&&f.linkCallback()(this.id)}),d.tipped(t)})};c&&window.clearTimeout(c),f.delay()?(window.clearTimeout(u),u=window.setTimeout(r,f.delay())):r()}}function r(){return!(!(!e.event.relatedTarget||f.selection().exclude&&f.selection().exclude(e.event.target))&&(this&&this.contains(e.event.relatedTarget)||f.clickable()&&e.event.relatedTarget.classList.contains("d3-tip")))}function o(){u&&(window.clearTimeout(u),u=null)}function a(){r.apply(this)&&(o(),s.hide())}function i(){r.apply(this)&&(o(),f.hideDelay()?c=window.setTimeout(function(){s.hide()},f.hideDelay()):s.hide())}var u,c,l=(t=t||{}).namespace||"tip",s=null,d=e.dispatch("tipped"),f=$.behavior(l,{add_behavior:function(r,o,a,u){!function(n){s||(s=e.tip().attr("class",t.class||"d3-tip").html(function(e){return"<span>"+e+"</span>"}).direction(f.direction()),f.offset()&&s.offset(f.offset()),n.svg().call(s))}(r),f.programmatic()||f.selection().select(r,o,a,u).on("mouseover."+l,n).on("mouseout."+l,i),f.clickable()&&e.select("div.d3-tip").on("mouseover."+l,function(){c&&window.clearTimeout(c)}).on("mouseout."+l,i)},remove_behavior:function(e,t,n,r){f.programmatic()||f.selection().select(e,t,n,r).on("mouseover."+l,null).on("mouseout."+l,null)},laterDraw:!0});return f.direction=J("n"),f.content=J(function(e,t){t(f.parent()?f.parent().nodeTitle.eval(e):"")}),f.on=function(e,t){return d.on(e,t)},f.disabled=J(!1),f.programmatic=J(!1),f.displayTip=function(t,r,o){if("function"!=typeof t){var a=t;t=function(e){return e===a}}var u=f.selection().select(f.parent(),f.parent().selectAllNodes(),f.parent().selectAllEdges(),null).filter(t);if(u.size()>0){var c=n,l=u.reduce(function(e,t){return e.concat(t)},[]),s=(r||0)%l.length;c.call(l[s],e.select(l[s]).datum()),a=e.select(l[s]).datum(),o&&o(a),f.programmatic()&&u.on("mouseout",i)}return f},f.hideTip=function(e){return s&&(e?i():a()),f},f.selection=J($.tip.select_node_and_edge()),f.showDelay=f.delay=J(0),f.hideDelay=J(200),f.offset=J(null),f.clickable=J(!1),f.linkCallback=J(null),f},$.tip.table=function(){var t=function(n,r){n=t.fetch()(n);var o=Object.keys(n).filter(e.functor(t.filter())).filter(function(e){return n[e]}),a=e.select(document.createElement("table")),i=a.selectAll("tr").data(o).enter().append("tr");i.append("td").text(function(e){return e}),i.append("td").text(function(e){return n[e]}),r(a.node().outerHTML)};return t.filter=J(!0),t.fetch=J(function(e){return e.orig.value}),t},$.tip.select_node_and_edge=function(){return{select:function(e,t,n,r){var o=e.selectAll(".foo-this-does-not-exist");return o[0]=t[0].concat(r?r[0]:[]),o},exclude:function(e){return m(e,"port")}}},$.tip.select_node=function(){return{select:function(e,t,n,r){return t},exclude:function(e){return m(e,"port")}}},$.tip.select_edge=function(){return{select:function(e,t,n,r){return n}}},$.tip.select_port=function(){return{select:function(e,t,n,r){return t.selectAll("g.port")}}},$.dropdown=function(){$.dropdown.unique_id=($.dropdown.unique_id||16)+1;var e={id:"id"+$.dropdown.unique_id,parent:J(null),show:function(t,n,r){var o=e.parent().root().selectAll("div.dropdown."+e.id).data([0]),a=o.enter().append("div").attr("class","dropdown "+e.id);o.style("visibility","visible").style("left",n+"px").style("top",r+"px");var i,u=e.hideOn().split("|"),c=e.selectOn().split("|");if(u.includes("leave"))o.on("mouseleave",function(){o.style("visibility","hidden")});else if(u.includes("clickout")){var l=e.parent();i=l.svg().append("rect").attr("x",0).attr("y",0).attr("width",l.width()).attr("height",l.height()).attr("opacity",0).on("click",function(){i.remove(),o.style("visibility","hidden")})}var s=o;if(e.scrollHeight()){var d=e.scrollHeight();"number"==typeof d&&(d+="px"),o.style("max-height",d).property("scrollTop",0),a.style("overflow-y","auto").append("div").attr("class","scroller"),s=o.selectAll("div.scroller")}e.fetchValues()(t,function(t){var n=s.selectAll("div.dropdown-item").data(t);n.enter().append("div").attr("class","dropdown-item"),n.exit().remove();var r=null;c.includes("click")?r="click":c.includes("hover")&&(r="mouseenter"),n.text(function(t){return e.itemText()(t)}),r&&n.on(r+".select",function(t){e.itemSelected()(t)}),u.includes("clickitem")&&n.on("click.hide",function(e){i.remove(),o.style("visibility","hidden")})})},hideOn:J("clickout|clickitem"),selectOn:J("click"),height:J(10),itemText:J(function(e){return e}),itemSelected:J(function(){}),fetchValues:J(function(e,t){t([])}),scrollHeight:J("12em")};return e},$.keyboard=function(){function t(){o.keydown()}function n(){o.keyup()}var r,o=e.dispatch("keydown","keyup"),a=$.behavior("brush",{add_behavior:function(e){(r=e.svg().selectAll("a#dcgraph-keyboard").data([1])).enter().insert("a",":first-child").attr({id:"dcgraph-keyboard",href:"#"}),r.on("keydown.keyboard",t),r.on("keyup.keyboard",n),e.svg().on("mouseup.keyboard",function(){a.focus()})},remove_behavior:function(e){r.remove()}});return a.on=function(e,t){return 1===arguments.length?o.on(e):(o.on(e,t),this)},a.focus=function(){a.disableFocus()||r.node().focus()},a.disableFocus=J(!1),a},$.edit_text=function(t,n){function r(){var e;switch(n.align){case"left":e=[n.box.x,n.box.y];break;default:case"center":e=[n.box.x+(n.box.width-u.node().offsetWidth)/2,n.box.y+(n.box.height-u.node().offsetHeight)/2]}i.attr("transform","translate("+e.join(" ")+")")}function o(){e.event.stopPropagation()}function a(){n.cancel&&n.cancel(),u.on("blur.edittext",null),i.remove(),n.finally&&n.finally()}var i=t.append("foreignObject").attr({height:"100%",width:"100%"}),u=i.append("xhtml:div"),c=n.text||"type on me";u.text(c).attr({contenteditable:!0,width:"auto"}).style({display:"inline-block","background-color":"white",padding:"2px"}),i.on("mousedown",o).on("mousemove",o).on("mouseup",o).on("dblclick",o),u.on("keydown.edittext",function(){13===e.event.keyCode&&e.event.preventDefault()}).on("keyup.edittext",function(){13===e.event.keyCode?(n.accept&&n.accept(u.text()),u.on("blur.edittext",null),i.remove(),n.finally&&n.finally()):27===e.event.keyCode&&a(),r()}).on("blur.edittext",a),r(),u.node().focus();var l=document.createRange();n.selectText?l.selectNodeContents(u.node()):(l.setStart(u.node(),1),l.setEnd(u.node(),1));var s=window.getSelection();s.removeAllRanges(),s.addRange(l)},$.brush=function(){function t(){u.brushstart()}function n(){var e=i.extent();u.brushmove(e)}function r(){u.brushend(),a.call(i.clear())}function o(){a&&(a.remove(),a=null)}var a,i=null,u=e.dispatch("brushstart","brushmove","brushend"),c=$.behavior("brush",{add_behavior:function(){},remove_behavior:o});return c.on=function(e,t){return 1===arguments.length?u.on(e):(u.on(e,t),this)},c.activate=function(){return function(o){i||(i=e.svg.brush().x(o.x()).y(o.y()).on("brushstart",t).on("brush",n).on("brushend",r)),a||(a=o.svg().insert("g",":first-child").attr("class","brush").call(i))}(c.parent()),this},c.deactivate=function(){return o(),this},c.isActive=function(){return!!a},c},$.select_things=function(t,n,r){function o(e,t){return!!g.find(p(t))}function a(e){return e.shiftKey}function i(e){return te?e.metaKey:e.ctrlKey}function u(e,t){return o(0,t)?e:e.concat([t])}function c(e,t){return o(0,t)?e.filter(function(e){return e!=t}):e.concat([t])}function l(r,o){y!==o&&(r.svg().on("click."+n,o?function(n){e.event.target===this&&t.set_changed([])}:null),y=o)}function s(){a(e.event.sourceEvent)||i(e.event.sourceEvent)?f=g.slice():(f=[],t.set_changed([]))}function d(n){if(r.intersectRect){var o,l=r.intersectRect(n);o=a(e.event.sourceEvent)?l.reduce(u,f):i(e.event.sourceEvent)?l.reduce(c,f):l,t.set_changed(o)}}var f,g=[],h=null,p=r.keysEqual?function(e){return function(t){return r.keysEqual(e,t)}}:function(e){return function(t){return e===t}},y=!1,v=$.behavior(n,{add_behavior:function(s,d,f){var p=v.noneIsAll()?function(e){return!g.length||o(0,r.key(e))}:function(e){return o(0,r.key(e))};r.applyStyles(p),r.clickables(s,d,f).on("mousedown."+n,function(e){h=e}),r.clickables(s,d,f).on("mouseup."+n,function(n){if(!(r.excludeClick&&r.excludeClick(e.event.target)||h!==n)){var o,l=r.key(n);v.multipleSelect()&&(a(e.event)?o=u(g,l):i(e.event)&&(o=c(g,l))),o||(o=[l]),t.set_changed(o)}}),v.multipleSelect()?s.child("brush").activate():l(s,v.clickBackgroundClears());if(v.autoCropSelection()){r.clickables(s,d,f).data().map(r.key);var y=g.filter(function(e){return o(0,e)});g.length!==y.length&&t.set_changed(y,!1)}},remove_behavior:function(e,t,o){r.clickables(e,t,o).on("click."+n,null),e.svg().on("click."+n,null),r.removeStyles()},parent:function(e){if(t.on("set_changed."+n,e?function(e){return function(t,n){void 0===n&&(n=!0),g=t,n&&e.refresh()}}(e):null),e&&v.multipleSelect()){var r=e.child("brush");r||(r=$.brush(),e.child("brush",r)),r.on("brushstart."+n,s).on("brushmove."+n,d)}},laterDraw:r.laterDraw||!1});return v.multipleSelect=J(!0),v.clickBackgroundClears=J(!0,!1).react(function(e){!v.multipleSelect()&&v.parent()&&l(v.parent(),e)}),v.noneIsAll=J(!1),v.autoCropSelection=J(!0),v.thinginess=function(){return r},v},$.select_things_group=function(t,n){return window.chart_registry.create_type(n,function(){return e.dispatch("set_changed")}),window.chart_registry.create_group(n,t)},$.select_nodes=function(e,t){t=t||{};var n=$.select_things_group(t.select_nodes_group||"select-nodes-group","select-nodes"),r={intersectRect:function(e){return o.parent().selectAllNodes().data().filter(function(t){return t&&e[0][0]<t.cola.x&&t.cola.x<e[1][0]&&e[0][1]<t.cola.y&&t.cola.y<e[1][1]}).map(this.key)},clickables:function(e,t,n){return t},excludeClick:function(e){return m(e,"port")},key:function(e){return o.parent().nodeKey.eval(e)},applyStyles:function(t){o.parent().cascade(50,!0,g(t,null,e))},removeStyles:function(){o.parent().cascade(50,!1,e)}},o=$.select_things(n,"select-nodes",r);return o},$.select_edges=function(e,t){t=t||{};var n=$.select_things_group(t.select_edges_group||"select-edges-group","select-edges"),r={intersectRect:function(e){return this.clickables().data().filter(function(t){return[{x:t.source.cola.x+t.sourcePort.pos.x,y:t.source.cola.y+t.sourcePort.pos.y},{x:t.target.cola.x+t.targetPort.pos.x,y:t.target.cola.y+t.targetPort.pos.y}].some(function(t){return e[0][0]<t.x&&t.x<e[1][0]&&e[0][1]<t.y&&t.y<e[1][1]})}).map(this.key)},clickables:function(){return o.parent().selectAllEdges(".edge-hover")},key:function(e){return o.parent().edgeKey.eval(e)},applyStyles:function(t){o.parent().cascade(50,!0,g(null,t,e))},removeStyles:function(){o.parent().cascade(50,!1,e)}},o=$.select_things(n,"select-edges",r);return o},$.select_ports=function(e,t){var n=(t=t||{}).portStyle||"symbols",r=$.select_things_group(t.select_ports_group||"select-ports-group","select-ports"),o={laterDraw:!0,intersectRect:null,clickables:function(){return a.parent().selectAllNodes("g.port")},key:function(e){return e.named?{node:a.parent().nodeKey.eval(e.node),name:e.name}:{edge:a.parent().edgeKey.eval(e.edges[0]),name:e.name}},applyStyles:function(t){a.parent().portStyle(n).cascade(50,!0,f(t,e))},removeStyles:function(){a.parent().portStyle(n).cascade(50,!1,e)},keysEqual:function(e,t){return e.name===t.name&&(e.node?e.node===t.node:e.edge===t.edge)}},a=$.select_things(r,"select-ports",o);return a},$.move_nodes=function(t){function n(e,t){(t=t||l).forEach(function(t){var n=f.parent().getWholeNode(t);e(n,t)})}t=t||{};var r,o,a,i,u=$.select_things_group(t.select_nodes_group||"select-nodes-group","select-nodes"),c=$.fix_nodes_group("fix-nodes-group"),l=[],s=null,d=null,f=$.behavior("move-nodes",{add_behavior:function(t,g,h){function p(){if(s){if(!(1&e.event.buttons))return void y();d&&u.set_changed([d]);var a=$.event_coords(t),i=a[0]-s[0],c=a[1]-s[1];!o&&Math.hypot(i,c)>f.dragSize()&&(o=!0,r&&r.style("pointer-events","none")),o&&(n(function(e){e.cola.x=e.original_position[0]+i,e.cola.y=e.original_position[1]+c}),t.reposition(g,h))}}function y(){if(s){if(o){o=!1,r&&(r.style("pointer-events",null),r=null);var e=[];n(function(t,n){e.push({id:n,pos:{x:t.cola.x,y:t.cola.y}})}),c.request_fixes(e)}a&&a.activate(),s=null}}g.on("mousedown.move-nodes",function(o){if(!(i&&i.usePorts()&&i.usePorts().eventPort())){s=$.event_coords(t),r=e.select(this);var u=t.nodeKey.eval(o),c=l;l.indexOf(u)<0?(c=[u],d=u):d=null,n(function(e){e.original_position=[e.cola.x,e.cola.y]},c),a&&a.deactivate()}}),g.on("mousemove.move-nodes",p).on("mouseup.move-nodes",y),t.svg().on("mousemove.move-nodes",p).on("mouseup.move-nodes",y)},remove_behavior:function(e,t,n){t.on("mousedown.move-nodes",null),t.on("mousemove.move-nodes",null),t.on("mouseup.move-nodes",null)},parent:function(e){u.on("set_changed.move-nodes",e?function(e,t){void 0===t&&(t=!0),l=e}:null),a=e.child("brush"),i=e.child("draw-graphs"),e.child("select-nodes")}});return f.dragSize=J(5),f},$.fix_nodes=function(e){function t(e){p.strategy().request_fixes(h,e),i(o()).then(function(){p.parent().redraw()})}function n(e,t,n){p.strategy().new_node(h,e,t,n)}function r(e,t,n){var r=l[t],o=l[n];p.strategy().new_edge(h,e,r,o)}function o(){var e=[];return s.forEach(function(t){var n=p.parent().nodeKey.eval(t),r=g[n],o=t.orig.value[f],a=!1;o?r&&r.x===o.x&&r.y===o.y||(a=!0):a=r,a&&e.push({n:t,fixed:r?{x:r.x,y:r.y}:null})}),e}function a(e,t){t?h.fix_node(e.orig.value,t):h.unfix_node(e.orig.value)}function i(e){var t=p.fixNode()||function(e,t){return Promise.resolve(t)},n=e.map(function(e){var n=p.parent().nodeKey.eval(e.n);return t(n,e.fixed).then(function(t){a(e.n,t)})});return Promise.all(n)}function u(e){e.forEach(function(e){a(e.n,e.fixed)})}function c(e,t,n,r,a,i,c){if(l=t,s=n,r,a,p.strategy().on_data){p.strategy().on_data(h,t,n,r,a,i,c);var d=o();u(d),p.reportOverridesAsynchronously()&&function(e){var t=p.fixNode()||function(e,t){return Promise.resolve(t)},n=e.map(function(e){var n=p.parent().nodeKey.eval(e.n);return t(n,e.fixed)});Promise.all(n)}(d)}}e=e||{};var l,s,d=$.fix_nodes_group("fix-nodes-group"),f=e.fixedPosTag||"fixedPos",g=[],h={nodeid:function(e){return p.parent().nodeKey.eval(e)},sourceid:function(e){return p.parent().edgeSource.eval(e)},targetid:function(e){return p.parent().edgeTarget.eval(e)},get_fix:function(e){return p.parent().nodeFixed.eval(e)},fix_node:function(e,t){e[f]=t},unfix_node:function(e){e[f]=null},clear_fixes:function(){g={}},register_fix:function(e,t){g[e]=t}},p={parent:J(null).react(function(e){d.on("request_fixes.fix-nodes",e?t:null).on("new_node.fix_nodes",e?n:null).on("new_edge.fix_nodes",e?r:null),e?e.on("data.fix-nodes",c):p.parent()&&p.parent().on("data.fix-nodes",null)}),fixNode:J(null),fixAllNodes:function(e){void 0===e&&(e=!0);var t=s.map(function(e){return{n:e,fixed:{x:e.cola.x,y:e.cola.y}}});return e?i(t):(u(t),Promise.resolve(void 0))},clearFixes:function(){p.strategy().clear_all_fixes&&p.strategy().clear_all_fixes(),h.clear_fixes()},strategy:J($.fix_nodes.strategy.fix_last()),reportOverridesAsynchronously:J(!0)};return p},$.fix_nodes.strategy={},$.fix_nodes.strategy.fix_last=function(){return{request_fixes:function(e,t){e.clear_fixes(),t.forEach(function(t){e.register_fix(t.id,t.pos)})},new_node:function(e,t,n,r){e.fix_node(n,r)},new_edge:function(e,t,n,r){e.unfix_node(n.orig.value),e.unfix_node(r.orig.value)}}},$.fix_nodes.strategy.last_N_per_component=function(e){e=e||1;var t=0,n={};return{clear_all_fixes:function(){n={}},request_fixes:function(e,r){++t,r.forEach(function(e){n[e.id]={id:e.id,age:t,pos:e.pos}})},new_node:function(e,r,o,a){++t,n[r]={id:r,age:t,pos:a},e.fix_node(o,a)},new_edge:function(){},on_data:function(r,o,a,i,u,c,l){++t,a.forEach(function(e){var o=r.nodeid(e),a=r.get_fix(e);a&&!n[o]&&(n[o]={id:o,age:t,pos:a})});var s=[];$.undirected_dfs({nodeid:r.nodeid,sourceid:r.sourceid,targetid:r.targetid,comp:function(){s.push([])},node:function(e,t){s[e].push(t)}})(a,u),r.clear_fixes(),s.forEach(function(t,o){var a=t.reduce(function(e,t){if(t.last_component){var o=e[t.last_component]=e[t.last_component]||{total:0,fixed:0};o.total++,n[r.nodeid(t)]&&o.fixed++}return e},{}),i=Object.keys(a).reduce(function(e,t){return a[t].fixed&&e.push({compid:+t,total:a[t].total,fixed:a[t].fixed}),e},[]).sort(function(e,t){return t.total-e.total}),u=i.length&&i[0].compid,c=t.filter(function(e){return!e.last_component||e.last_component===u}).map(function(e){return n[r.nodeid(e)]}).filter(function(e){return e});c.length>e&&(c.sort(function(e,t){return t.age-e.age}),c=c.slice(0,e)),c.forEach(function(e){r.register_fix(e.id,e.pos)});var l=c.reduce(function(e,t){return e[t.id]=!0,e},{});t.forEach(function(e){var t=r.nodeid(e);l[t]||(n[t]=null),e.last_component=o+1})})}}},$.fix_nodes_group=function(t){return window.chart_registry.create_type("fix-nodes",function(){return e.dispatch("request_fixes","new_node","new_edge")}),window.chart_registry.create_group("fix-nodes",t)},$.filter_selection=function(t,n){n=n||"select-nodes";var r=$.select_things_group(t||"select-nodes-group",n),o={parent:J(null).react(function(t){r.on("set_changed.filter-selection-"+n,t?function(t){return function(n){if(n.length){var r=e.set(n);o.dimensionAccessor()(t).filterFunction(function(e){return r.has(e)})}else o.dimensionAccessor()(t).filter(null);t.redrawGroup()}}(t):null)})};return o.dimensionAccessor=J(function(e){return e.nodeDimension()}),o},$.delete_things=function(t,n,r){function o(e){l=e}function a(e){return e[r]}function i(e){if(!s.crossfilterAccessor())throw new Error("need crossfilterAccessor");if(!s.dimensionAccessor())throw new Error("need dimensionAccessor");if(0===(e=e||l).length)return Promise.resolve([]);var t=s.preDelete()?s.preDelete()(e):Promise.resolve(e);return s.onDelete()&&(t=t.then(s.onDelete())),t.then(function(e){if(e&&e.length){var t=s.crossfilterAccessor()(s.parent()),n=s.dimensionAccessor()(s.parent()),r=t.all().slice();r.length;n.filter(null),t.remove();var o=r.filter(function(t){return-1===e.indexOf(a(t))});r.length!==o.length+e.length&&console.warn("size after deletion is not previous size minus selection size",o.map(a),r.map(a),e),t.add(o),s.parent().redrawGroup()}return!0})}r=r||"id";var u,c=te?"Backspace":"Delete",l=[],s=$.behavior(n,{add_behavior:function(t){u.on("keyup."+n,function(){e.event.code===c&&i()})},remove_behavior:function(e){},parent:function(e){t.on("set_changed."+n,o),e&&((u=e.child("keyboard"))||e.child("keyboard",u=$.keyboard()))}});return s.preDelete=J(null),s.onDelete=J(null),s.crossfilterAccessor=J(null),s.dimensionAccessor=J(null),s.deleteSelection=i,s},$.delete_nodes=function(e,t){t=t||{};var n=$.select_things_group(t.select_nodes_group||"select-nodes-group","select-nodes"),r=$.select_things_group(t.select_edges_group||"select-edges-group","select-edges"),o=$.delete_things(n,"delete-nodes",e);return o.preDelete(function(e){var t=o.parent(),n=t.child("delete-edges");return n?Promise.resolve(void 0).then(function(){var o=t.edgeGroup().all().filter(function(n){return-1!==e.indexOf(t.edgeSource()(n))||-1!==e.indexOf(t.edgeTarget()(n))}).map(t.edgeKey());return r.set_changed(o),n.deleteSelection().then(function(){return e})}):null}),o},$.label_things=function(t){function n(e){return function(n,r){var a=t.thing_box(n);t.hide_thing_label(n,!0),$.edit_text(e.g(),{text:r.text||t.thing_label(n)||t.default_label,align:t.align,box:a,selectText:r.selectText,accept:function(e){return t.accept(n,e)},finally:function(){t.hide_thing_label(n,!1),o.focus()}})}}function r(e,n,r){var o=t.find_thing(c[0],e,n);o.empty()?console.error("couldn't find thing '"+c[0]+"'!"):o.size()>1?console.error("found too many things for '"+c[0]+"' ("+o.size()+")!"):u.edit_label(o,r)}t=t||{};var o,a,i=$.select_things_group(t.select_group,t.select_type),u=$.label_things_group(t.label_group,t.label_type),c=[],l=$.behavior(t.label_type,{add_behavior:function(n,i,u){o.on("keyup."+t.label_type,function(){if(c.length){if(1!==e.event.key.length)return;r(i,u,{text:e.event.key,selectText:!1})}}),a&&a.thinginess().clickables(n,i,u).on("dblclick."+t.label_type,function(){r(i,u,{selectText:!0})})},remove_behavior:function(e,t,n){},parent:function(e){i.on("set_changed."+t.label_type,e?function(e){c=e}:null),u.on("edit_label."+t.label_type,e?n(e):null),e&&((o=e.child("keyboard"))||e.child("keyboard",o=$.keyboard()),a=e.child(t.select_type))}});return l.editSelection=function(e){r(l.parent().selectAllNodes(),l.parent().selectAllEdges(),e)},l},$.label_things_group=function(t,n){return window.chart_registry.create_type(n,function(){return e.dispatch("edit_label")}),window.chart_registry.create_group(n,t)},$.label_nodes=function(e){var t=(e=e||{}).labelTag||"label";e.select_group=e.select_group||"select-nodes-group",e.select_type=e.select_type||"select-nodes",e.label_group=e.label_group||"label-nodes-group",e.label_type=e.label_type||"label-nodes",e.default_label="node name",e.find_thing=function(e,t,r){return t.filter(function(t){return n.parent().nodeKey.eval(t)===e})},e.hide_thing_label=function(e,t){n.parent().content(n.parent().nodeContent.eval(e.datum())).selectText(e).attr("visibility",t?"hidden":"visible")},e.thing_box=function(e,t){var r=n.parent().content(n.parent().nodeContent.eval(e.datum())).textbox(e);return r.x+=e.datum().cola.x,r.y+=e.datum().cola.y,r},e.thing_label=function(e){return n.parent().nodeLabel.eval(e.datum())},e.accept=function(e,r){return(n.changeNodeLabel()?n.changeNodeLabel()(n.parent().nodeKey.eval(e.datum()),r):Promise.resolve(r)).then(function(r){e.datum().orig.value[t]=r,n.parent().redrawGroup()})};var n=$.label_things(e);return n.changeNodeLabel=J(null),n},$.label_edges=function(e){var t=(e=e||{}).labelTag||"label";e.select_group=e.select_group||"select-edges-group",e.select_type=e.select_type||"select-edges",e.label_group=e.label_group||"label-edges-group",e.label_type=e.label_type||"label-edges",e.default_label="edge name",e.find_thing=function(e,t,r){return r.filter(function(t){return n.parent().edgeKey.eval(t)===e})},e.hide_thing_label=function(e,t){n.parent().selectAll("#"+n.parent().edgeId(e.datum())+"-label textPath").attr("visibility",t?"hidden":"visible")},e.thing_box=function(e,t){var n=e.datum().pos.new.path.points;return{x:(n[0].x+n[1].x)/2,y:(n[0].y+n[1].y)/2-10,width:0,height:20}},e.thing_label=function(e){return n.parent().edgeLabel.eval(e.datum())},e.accept=function(e,r){return(n.changeEdgeLabel()?n.changeEdgeLabel()(n.parent().edgeKey.eval(e.datum()),r):Promise.resolve(r)).then(function(r){e.datum().orig.value[t]=r,n.parent().redrawGroup()})};var n=$.label_things(e);return n.changeEdgeLabel=J(null),n},$.register_highlight_things_group=function(t){return window.chart_registry.create_type("highlight-things",function(){return e.dispatch("highlight")}),window.chart_registry.create_group("highlight-things",t)},$.highlight_things=function(e,t,n,r,o){function a(e,t){i=e||t,c=e||{},l=t||{},s.parent().requestRefresh(s.durationOverride())}var i,u=$.register_highlight_things_group(r||"highlight-things-group"),c={},l={};o=o||150;var s=$.behavior(n,{add_behavior:function(n){n.cascade(o,!0,g(function(e){return c[s.parent().nodeKey.eval(e)]},function(e){return l[s.parent().edgeKey.eval(e)]},e)),n.cascade(o+10,!0,g(function(e){return i&&!c[s.parent().nodeKey.eval(e)]},function(e){return i&&!l[s.parent().edgeKey.eval(e)]},t))},remove_behavior:function(n){n.cascade(o,!1,e),n.cascade(o+10,!1,t)},parent:function(e){u.on("highlight."+n,e?a:null)}});return s.durationOverride=J(void 0),s},$.register_highlight_neighbors_group=function(t){return window.chart_registry.create_type("highlight-neighbors",function(){return e.dispatch("highlight_node")}),window.chart_registry.create_group("highlight-neighbors",t)},$.highlight_neighbors=function(e,t,n,r){function o(e){var t=u.parent(),n={},r={};e?(n[e]=!0,u.parent().selectAllEdges().each(function(o){t.nodeKey.eval(o.source)===e&&(r[t.edgeKey.eval(o)]=!0,n[t.nodeKey.eval(o.target)]=!0),t.nodeKey.eval(o.target)===e&&(r[t.edgeKey.eval(o)]=!0,n[t.nodeKey.eval(o.source)]=!0)}),i.highlight(n,r)):i.highlight(null,null)}var a=$.register_highlight_neighbors_group(n||"highlight-neighbors-group"),i=$.register_highlight_things_group(r||"highlight-things-group"),u=$.behavior("highlight-neighbors",{add_behavior:function(e,t,n){t.on("mouseover.highlight-neighbors",function(e){a.highlight_node(u.parent().nodeKey.eval(e))}).on("mouseout.highlight-neighbors",function(e){a.highlight_node(null)})},remove_behavior:function(e,t,n){!function(e,t,n){t.on("mouseover.highlight-neighbors",null).on("mouseout.highlight-neighbors",null),a.highlight_node(null)}(0,t)},parent:function(n){a.on("highlight_node.highlight",n?o:null),n.child("highlight-things")||n.child("highlight-things",$.highlight_things(e,t).durationOverride(u.durationOverride()))}});return u.durationOverride=J(void 0),u},$.highlight_radius=function(e){function t(e,n,r,o){r[e.key()]=!0,n&&(e.outs().filter(function(e){return!o[e.key()]}).forEach(function(e){o[e.key()]=!0,t(e.target(),n-1,r,o)}),e.ins().filter(function(e){return!o[e.key()]}).forEach(function(e){o[e.key()]=!0,t(e.source(),n-1,r,o)}))}function n(e){u=e,console.assert(o);var n={},r={};e.forEach(function(e){t(o.node(e),c.radius(),n,r)}),Object.keys(n).length||Object.keys(r).length||(n=r=null),i.highlight(n,r)}function r(e,t,n,r,i,c,l){o=metagraph.graph(n,i,{nodeKey:e.nodeKey.eval,edgeKey:e.edgeKey.eval,edgeSource:e.edgeSource.eval,edgeTarget:e.edgeTarget.eval});var s=u.filter(function(e){return!!o.node(e)});s.length<u.length&&window.setTimeout(function(){a.set_changed(s)},0)}e=e||{};var o,a=$.select_things_group(e.select_nodes_group||"select-nodes-group","select-nodes"),i=$.register_highlight_things_group(e.highlight_things_group||"highlight-things-group"),u=[],c={parent:function(e){e?e.on("data.fix-nodes",r):c.parent()&&c.parent().on("data.fix-nodes",null),a.on("set_changed",n)}};return c.radius=J(1),c},$.register_highlight_paths_group=function(t){return window.chart_registry.create_type("highlight-paths",function(){return e.dispatch("paths_changed","hover_changed","select_changed")}),window.chart_registry.create_group("highlight-paths",t)},$.highlight_paths=function(e,t,n,r){function o(){_.doRedraw()?_.parent().relayout().redraw():_.parent().refresh()}function a(e,t){m=x=null,0===Object.keys(y).length&&0===Object.keys(e).length&&0===Object.keys(v).length&&0===Object.keys(t).length||(y=e,v=t,o())}function i(e){e!==x&&(x=e,o())}function u(e){e!==m&&(m=e,o())}function c(e){return function(t){return e.indexOf(t)>=0}}function l(e){var t=c(e);return function(e){return!t(e)}}function s(e,t){return!(!e||!t)&&e.some(c(t))}function d(e,t){return e?t?t.every(c(e))?e.filter(l(t)):e.concat(t.filter(l(e))):e:t}function f(r,o,a,i){o.on("mouseover.highlight-paths",null).on("mouseout.highlight-paths",null).on("click.highlight-paths",null),i.on("mouseover.highlight-paths",null).on("mouseout.highlight-paths",null).on("click.highlight-paths",null),y={},v={},r.cascade(200,!1,e).cascade(300,!1,n).cascade(400,!1,t)}var h=$.register_highlight_paths_group(r||"highlight-paths-group");e=e||{},t=t||{},n=n||{};var p,y={},v={},m=null,x=null,_=$.behavior("highlight-paths",{add_behavior:function(r,o,a,i){r.cascade(200,!0,g(function(e){return!!y[r.nodeKey.eval(e)]},function(e){return!!v[r.edgeKey.eval(e)]},e)).cascade(300,!0,g(function(e){return s(y[r.nodeKey.eval(e)],m)},function(e){return s(v[r.edgeKey.eval(e)],m)},n)).cascade(400,!0,g(function(e){return s(y[r.nodeKey.eval(e)],x)},function(e){return s(v[r.edgeKey.eval(e)],x)},t)),o.on("mouseover.highlight-paths",function(e){h.hover_changed(y[r.nodeKey.eval(e)]||null)}).on("mouseout.highlight-paths",function(e){h.hover_changed(null)}).on("click.highlight-paths",function(e){h.select_changed(d(m,y[r.nodeKey.eval(e)]))}),i.on("mouseover.highlight-paths",function(e){h.hover_changed(v[r.edgeKey.eval(e)]||null)}).on("mouseout.highlight-paths",function(e){h.hover_changed(null)}).on("click.highlight-paths",function(e){h.select_changed(d(m,v[r.nodeKey.eval(e)]))})},remove_behavior:function(e,t,n,r){return f(e,t,0,r),this},parent:function(e){e&&(p=e.anchorName()),h.on("paths_changed.highlight"+p,e?a:null),h.on("hover_changed.highlight"+p,e?i:null),h.on("select_changed.highlight"+p,e?u:null)}});return _.doRedraw=J(!1),_},$.draw_spline_paths=function(t,n,r,o,a){function i(e,n,r){h=r;var o=w.parent().layoutEngine(),a=r.filter(l);if(a.length){var i=a.map(function(e){var n=t.pathStrength.eval(e);return"number"!=typeof n&&(n=1),y&&-1!==y.indexOf(e)&&(n*=w.selectedStrength()),{nodes:c(e),strength:n}});o.paths(i)}else o.paths(null),m&&o.restorePositions(m);y&&(y=y.filter(function(e){return-1!==a.indexOf(e)})),w.parent().redraw()}function u(e){e!==y&&(y=e,i(0,0,h))}function c(e,n){n=!1!==n;var r=t.elementList.eval(e).filter(function(e){return"node"===t.elementType.eval(e)}).map(function(e){return t.nodeKey.eval(e)});return n?function(e){var t=[];return e.forEach(function(n,r){0!==r&&n===e[r-1]||t.push(n)}),t}(r):r}function l(e){return t.elementList.eval(e).every(function(e){return"node"!==t.elementType.eval(e)||w.parent().getWholeNode(t.nodeKey.eval(e))})}function s(e,t,n,r,o){var a=function(e,t){return c(e,!1).map(function(e){var n=w.parent().getWholeNode(e);return{x:t&&void 0!==n.prevX?n.prevX:n.cola.x,y:t&&void 0!==n.prevY?n.prevY:n.cola.y}})}(e,t);if(a.length<2)return"";var i="";return i+=function(e,t,n,r){var o=t||0;n=!1!==n,r=r||.02;for(var a=[e[0]],i=1;i<e.length;i++)b(e[i],a[a.length-1])>1e-6&&a.push(e[i]);(e=(e=[a[0]]).concat(a)).push(a[a.length-1]);var u=[];for(i=1;i<e.length-2;i++){var c=(1-o)*(e[i+1].x-e[i-1].x)/2,l=(1-o)*(e[i+1].y-e[i-1].y)/2,s=(1-o)*(e[i+2].x-e[i].x)/2,d=(1-o)*(e[i+2].y-e[i].y)/2,f=e[i],g=e[i+1],h=f;1!==i&&(h={x:f.x+c/3,y:f.y+l/3});var p=g;if(i!==e.length-3&&(p={x:g.x-s/3,y:g.y-d/3}),n){var y={x:e[i-1].x-e[i].x,y:e[i-1].y-e[i].y},v={x:e[i+1].x-e[i].x,y:e[i+1].y-e[i].y},m=x(y,v)/(_(y)*_(v));if(m=Math.max(-1,Math.min(1,m)),Math.acos(m)<=r){var w=(1-o)*(e[i].x-e[i-1].x)/2,k=(1-o)*(e[i].y-e[i-1].y)/2,E={x:f.x+-k/3*2,y:f.y+w/3*2},S={x:f.x- -k/3*2,y:f.y-w/3*2},K={x:E.x-S.x,y:E.y-S.y},A={x:e[i-2].x-e[i+2].x,y:e[i-2].y-e[i+2].y};x(K,A)>0?(h=E,u[u.length-1][1]=S):(h=S,u[u.length-1][1]=E)}}u.push([h,p,g])}var T="M"+e[0].x+","+e[0].y;for(i=0;i<u.length;i++){var P=u[i];T+="C"+P[0].x+","+P[0].y,T+=","+P[1].x+","+P[1].y,T+=","+P[2].x+","+P[2].y}return T}(a,n,r,o),i+=function(e,t,n,r){for(var o=0,a=1,i=[];o<e.length-1&&a<e.length;)if(b(e[o],e[a])<1e-6){for(var u=e[a];a<e.length&&b(e[a],u)<1e-6;)a++;i.push({start:Math.max(0,o-1),end:Math.min(e.length-1,a)}),a=(o=a)+1}else o++,a++;for(var c="",l=0;l<i.length;l++){var s=i[l],d=s.end-s.start-2,f=e[s.start+1],g={x:e[s.end].x-e[s.start].x,y:e[s.end].y-e[s.start].y};0==_(g)&&(g={x:-(e[s.end].y-f.y),y:e[s.end].x-f.x});for(var h,p=g.x/_(g),y=g.y/_(g),v=-g.y/_(g),m=g.x/_(g),w=0;w<d;w++){var k,E,S,K,A=15+2*w;k={x:f.x+A*p,y:f.y+A*y},K={x:f.x-A*p,y:f.y-A*y};var T=25+5*w,P={x:f.x+v*T,y:f.y+m*T},N={x:f.x-v*T,y:f.y-m*T},O={x:e[s.end].x-f.x,y:e[s.end].y-f.y},M={x:P.x-f.x,y:P.y-f.y};h=P,x(M,O)>0&&(h=N),E={x:h.x+A*p,y:h.y+A*y},S={x:h.x-A*p,y:h.y-A*y};var L="M"+f.x+","+f.y;L+="C"+k.x+","+k.y+","+E.x+","+E.y+","+h.x+","+h.y,c+=L+="C"+S.x+","+S.y+","+K.x+","+K.y+","+f.x+","+f.y}}return c}(a)}function d(t){function a(e){return-1!==i.indexOf(e)?2:-1!==u.indexOf(e)?1:0}if(null!==t){t=t.filter(l);var i=p||[],u=y||[],d=v.selectAll(".spline-edge").data(t,function(e){return c(e).join(",")});d.exit().remove();d.enter().append("svg:path").attr("class","spline-edge").attr("id",function(e,t){return"spline-path-"+t}).attr("stroke-width",n.edgeStrokeWidth||1).attr("fill","none").attr("d",function(e){return s(e,!0,n.lineTension,w.avoidSharpTurns())});d.attr("stroke",function(e){return-1!==u.indexOf(e)&&o.edgeStroke||-1!==i.indexOf(e)&&r.edgeStroke||n.edgeStroke||"black"}).attr("opacity",function(e){return-1!==u.indexOf(e)&&o.edgeOpacity||-1!==i.indexOf(e)&&r.edgeOpacity||n.edgeOpacity||1}),d.sort(function(e,t){return a(e)-a(t)}),v.selectAll(".spline-edge-hover").each(function(){this.parentNode.appendChild(this)}),d.transition().duration(w.parent().transitionDuration()).attr("d",function(e){return s(e,!1,n.lineTension,w.avoidSharpTurns())});var g=v.selectAll(".spline-edge-hover").data(t,function(e){return c(e).join(",")});g.exit().remove();g.enter().append("svg:path").attr("class","spline-edge-hover").attr("d",function(e){return s(e,!0,n.lineTension,w.avoidSharpTurns())}).attr("opacity",0).attr("stroke","green").attr("stroke-width",(n.edgeStrokeWidth||1)+4).attr("fill","none").on("mouseover",function(e){f.hover_changed([e])}).on("mouseout",function(e){f.hover_changed(null)}).on("click",function(t){var n=y&&y.slice(0)||[],r=n.indexOf(t);-1!==r?n.splice(r,1):e.event.shiftKey?n.push(t):n=[t],f.select_changed(n)});g.transition().duration(w.parent().transitionDuration()).attr("d",function(e){return s(e,!1,n.lineTension,w.avoidSharpTurns())})}else m=w.parent().layoutEngine().savePositions()}var f=$.register_highlight_paths_group(a||"highlight-paths-group");n=n||{},r=r||{};var g,h=null,p=null,y=null,v=null,m=null,x=function(e,t){return e.x*t.x+e.y*t.y},_=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},b=function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},w=$.behavior("draw-spline-paths",{laterDraw:!0,add_behavior:function(e,t,n,r){(v=w.parent().select("g.draw").selectAll("g.spline-layer").data([0])).enter().append("g").attr("class","spline-layer"),d(h)},remove_behavior:function(e,t,n,r){return this},parent:function(e){e&&(g=e.anchorName()),f.on("paths_changed.draw-spline-paths-"+g,e?i:null).on("select_changed.draw-spline-paths-"+g,e?u:null).on("hover_changed.draw-spline-paths-"+g,e?function(e){p=e,d(h)}:null)}});return w.selectedStrength=J(1),w.avoidSharpTurns=J(!0),w},$.expand_collapse=function(t){function n(e,t,n,r,o){r&&y[o.dir][e.nodeKey.eval(r)]&&(o=null);var a=t.selectAll("g.spikes").data(function(e){return o&&r===e?[e]:[]});a.exit().remove(),a.enter().insert("g",":first-child").classed("spikes",!0);var i=a.selectAll("rect.spike").data(function(t){e.nodeKey.eval(t);for(var n=o.dir,r=o.n,a=function(e,t,n){if("both"===t)return function(e){return Math.PI*(2*e/n-.5)};var r,o=(n-1)*Math.PI/n;switch(e){case"LR":r=0;break;case"TB":r=Math.PI/2;break;case"RL":r=Math.PI;break;case"BT":r=-Math.PI/2}return"in"===t&&(r+=Math.PI),function(e){return r+o*((n>1?e/(n-1):0)-.5)}}(e.layoutEngine().rankdir(),n,r),i=Array(r),u=0;u<r;++u){var c=a(u);i[u]={a:180*c/Math.PI,x:Math.cos(c)*t.dcg_rx*.9,y:Math.sin(c)*t.dcg_ry*.9,edge:o.invisible?o.invisible[u]:null}}return i});i.enter().append("rect").classed("spike",!0).attr({width:25,height:3,fill:function(t){var n=t.edge?e.edgeStroke()(t.edge):"black";return function(e,t){_[e]||(_[e]=!0,t.addOrRemoveDef("spike-gradient-"+e,!0,"linearGradient",function(t){t.attr({x1:"0%",y1:"0%",x2:"100%",y2:"0%",spreadMethod:"pad"}),t.selectAll("stop").data([[0,e,1],[100,e,"0"]]).enter().append("stop").attr({offset:function(e){return e[0]+"%"},"stop-color":function(e){return e[1]},"stop-opacity":function(e){return e[2]}})}))}(n,e),"url(#spike-gradient-"+n+")"},rx:1,ry:1,x:0,y:0}),i.attr("transform",function(e){return"translate("+e.x+","+e.y+") rotate("+e.a+")"}),i.exit().remove()}function r(e,t,r){n(e,t,0,null,null)}function o(e,t,n,r){if(1===n.length)return n[0];var o=e.root().node().getBoundingClientRect(),a=e.invertCoord([t.clientX-o.left,t.clientY-o.top]),i=a[0],u=a[1];switch(e.layoutEngine().rankdir()){case"TB":return u>r.cola.y?"out":"in";case"BT":return u<r.cola.y?"out":"in";case"LR":return i>r.cola.x?"out":"in";case"RL":return i<r.cola.x?"out":"in"}throw new Error("unknown rankdir "+e.layoutEngine().rankdir())}function a(t){switch(t){case"Alt":return e.event.altKey;case"Meta":return e.event.metaKey;case"Shift":return e.event.shiftKey;case"Control":return e.event.ctrlKey}return!1}function u(e,t,n){var r=e.nodeKey.eval(t),o={},a={};o[r]=!0,n.each(function(t){e.edgeSource.eval(t)!==r&&e.edgeTarget.eval(t)!==r||(a[e.edgeKey.eval(t)]=!0)}),x.highlight(o,a)}function c(e,t){var n={};n[e.edgeKey.eval(t)]=!0,x.highlight({},n)}function l(e,r,o,a,i){var u=e.nodeKey.eval(r);(t.get_edges?Promise.resolve(t.get_edges(u,i)):Promise.resolve(t.get_degree(u,i))).then(function(c){var l,s;l="number"==typeof c?c:(s=c).length;var d={dir:i,visible:function(e,t,n,r){var o;switch(n){case"out":o=function(t){return e.edgeSource.eval(t)===r};break;case"in":o=function(t){return e.edgeTarget.eval(t)===r};break;case"both":o=function(t){return e.edgeSource.eval(t)===r||e.edgeTarget.eval(t)===r}}return t.filter(o).data()}(e,a,i,u)};if(d.n=Math.max(0,l-d.visible.length),s){var f=d.visible.reduce(function(t,n){return t[e.edgeKey.eval(n)]=!0,t},{});d.invisible=s.filter(function(t){return!f[e.edgeKey()(t)]})}n(e,o,0,r,d);var g={},h={};if(y[i][u]&&t.collapsibles){var p=t.collapsibles(u,i);g=p.nodes,h=p.edges}m.highlight(g,h)})}function s(e,n,r){"both"!==e||y.both?y[e][n]=r:t.dirs.forEach(function(e){y[e][n]=r});var o;o=y.both?y.both:Object.keys(y.in).filter(function(e){return y.in[e]&&y.out[e]}).reduce(function(e,t){return e[t]=!0,e},{}),v.highlight(o,{}),"both"!==e||y.both?r?t.expand(n,e):t.collapse(n,e):t.dirs.forEach(function(e,o){r?t.expand(n,e,o!==t.dirs.length-1):t.collapse(n,e,o!==t.dirs.length-1)})}"function"==typeof t&&(t={get_degree:arguments[0],expand:arguments[1],collapse:arguments[2],dirs:arguments[3]});var d,g,h,p,y={},v=$.register_highlight_things_group(t.expanded_highlight_group||"expanded-highlight-group"),m=$.register_highlight_things_group(t.collapse_highlight_group||"collapse-highlight-group"),x=$.register_highlight_things_group(t.hide_highlight_group||"hide-highlight-group");if(t.dirs=t.dirs||["both"],t.dirs.forEach(function(e){y[e]={}}),t.hideKey=t.hideKey||"Alt",t.linkKey=t.linkKey||(te?"Meta":"Control"),t.dirs.length>2)throw new Error("there are only two directions to expand in");var _={},b=$.behavior("expand-collapse",{add_behavior:function(n,i,v,_){function b(u){var c=n.nodeKey.eval(u);if(t.hideNode&&a(t.hideKey))t.hideNode(c);else if(a(t.linkKey))u.orig.value.value.URL&&window.open(u.orig.value.value.URL,"dcgraphlink");else{r(n,i);var l=o(n,e.event,t.dirs,u);s(l,c,!y[l][c])}}i.on("mouseenter.expand-collapse",function(r){var c=o(n,e.event,t.dirs,r);g=r,h=c,t.hideNode&&a(t.hideKey)?u(n,r,v):g.orig.value.value.URL&&a(t.linkKey)?(n.selectAllNodes().filter(function(e){return e===g}).attr("cursor","pointer"),n.requestRefresh(0)):l(n,r,i,v,c)}).on("mouseout.expand-collapse",function(e){n.selectAllNodes().filter(function(e){return e===g}).attr("cursor",null),g=null,r(n,i),m.highlight({},{}),x.highlight({},{})}).on("click",b).on("dblclick",b),_.on("mouseenter.expand-collapse",function(e){p=e,t.hideEdge&&a(t.hideKey)&&c(n,e)}).on("mouseout.expand-collapse",function(e){p=null,x.highlight({},{})}).on("click.expand-collapse",function(e){t.hideEdge&&a(t.hideKey)&&t.hideEdge(n.edgeKey.eval(e))}),d.on("keydown.expand-collapse",function(){e.event.key===t.hideKey&&(g&&t.hideNode||p&&t.hideEdge)?(g&&u(n,g,v),p&&c(n,p),r(n,i),m.highlight({},{})):e.event.key===t.linkKey&&g&&(g&&g.orig.value.value.URL&&n.selectAllNodes().filter(function(e){return e===g}).attr("cursor","pointer"),x.highlight({},{}),r(n,i),m.highlight({},{}))}).on("keyup.expand_collapse",function(){e.event.key!==t.hideKey&&e.event.key!==t.linkKey||!g&&!p||(x.highlight({},{}),g&&(l(n,g,i,v,h),g.orig.value.value.URL&&n.selectAllNodes().filter(function(e){return e===g}).attr("cursor",null)))}),n.cascade(97,!0,f(function(e){return e===g&&e.orig.value.value.URL},{nodeLabelDecoration:"underline"}))},remove_behavior:function(e,t,n){t.on("mouseover.expand-collapse",null).on("mouseout.expand-collapse",null),r(e,t)},parent:function(e){e&&((d=e.child("keyboard"))||e.child("keyboard",d=$.keyboard()))}});return b.expand=s,b.expandNodes=function(e){var n=e.reduce(function(e,t){return e[t]=!0,e},{});t.dirs.forEach(function(e){y[e]=Object.assign({},n)}),v.highlight(n,{}),t.expandedNodes(n)},b.clickableLinks=i("warning - clickableLinks doesn't belong in collapse_expand and will be moved",!1),b},$.expand_collapse.shown_hidden=function(e){function t(){s.filterFunction(function(e){return c[e]})}function r(e){return u.edgeGroup.all().filter(function(t){return u.edgeSource(t)===e||u.edgeTarget(t)===e})}function o(e){return u.edgeGroup.all().filter(function(t){return u.edgeSource(t)===e})}function a(e){return u.edgeGroup.all().filter(function(t){return u.edgeTarget(t)===e})}function i(e,t){return u.edgeGroup.all().every(function(n){var r;return u.edgeSource(n)===t?r=u.edgeTarget(n):u.edgeTarget(n)===t&&(r=u.edgeSource(n)),!r||r===e||!c[r]})}var u=Object.assign({nodeKey:function(e){return e.key},edgeKey:function(e){return e.key},edgeSource:function(e){return e.value.source},edgeTarget:function(e){return e.value.target}},e),c={},l={},s=u.nodeCrossfilter.dimension(u.nodeKey);t();var d={};return u.directional?Object.assign(d,{get_degree:function(e,t){switch(t){case"out":return o(e).length;case"in":return a(e).length;default:throw new Error("unknown direction "+t)}},expand:function(e,r,i){switch(c[e]=!0,r){case"out":o(e).forEach(function(e){l[u.edgeTarget(e)]||(c[u.edgeTarget(e)]=!0)});break;case"in":a(e).forEach(function(e){l[u.edgeSource(e)]||(c[u.edgeSource(e)]=!0)});break;default:throw new Error("unknown direction "+r)}i||(t(),n.redrawAll())},expandedNodes:function(e){if(!arguments.length)throw new Error("not supported");var r=this;return c={},Object.keys(e).forEach(function(e){r.expand(e,"out",!0),r.expand(e,"in",!0)}),t(),n.redrawAll(),this},collapsibles:function(e,t){var n={},c={};return("out"===t?o(e):a(e)).forEach(function(o){var a="out"===t?u.edgeTarget(o):u.edgeSource(o);i(e,a)&&(n[a]=!0,r(a).forEach(function(e){c[u.edgeKey(e)]=!0}))}),{nodes:n,edges:c}},collapse:function(e,r){Object.keys(this.collapsibles(e,r).nodes).forEach(function(e){c[e]=!1}),t(),n.redrawAll()},hideNode:function(e){l[e]=!0,c[e]=!1,t(),n.redrawAll()},dirs:["out","in"]}):Object.assign(d,{get_degree:function(e){return r(e).length},expand:function(e){c[e]=!0,function(e){return r(e).map(function(t){return u.edgeSource(t)===e?u.edgeTarget(t):u.edgeSource(t)})}(e).forEach(function(e){l[e]||(c[e]=!0)}),t(),n.redrawAll()},expandedNodes:function(e){if(!arguments.length)throw new Error("not supported");var t=this;return c={},Object.keys(e).forEach(function(e){t.expand(e)}),this},collapsibles:function(e,t){var n={},o={};return function(e){return r(e).map(function(t){return u.edgeSource(t)===e?[t,u.edgeTarget(t)]:[t,u.edgeSource(t)]})}(e).forEach(function(t){var r=t[0],a=t[1];i(e,a)&&(n[a]=!0,o[u.edgeKey(r)]=!0)}),{nodes:n,edges:o}},collapse:function(e,r){Object.keys(d.collapsibles(e,r).nodes).forEach(function(e){c[e]=!1}),t(),n.redrawAll()},hideNode:function(e){l[e]=!0,c[e]=!1,t(),n.redrawAll()}}),d},$.expand_collapse.expanded_hidden=function(e){function t(e){return Object.keys(e).reduce(function(e,t){return e[t]=!0,function(e){return o(e).map(function(t){return a.edgeSource(t)===e?a.edgeTarget(t):a.edgeSource(t)})}(t).forEach(function(t){u[t]||(e[t]=!0)}),e},{})}function r(){var e=t(i);l.filterFunction(function(t){return e[t]}),s&&s.filterFunction(function(e){return!c[e]})}function o(e){return a.edgeGroup.all().filter(function(t){return a.edgeSource(t)===e||a.edgeTarget(t)===e})}var a=Object.assign({nodeKey:function(e){return e.key},edgeKey:function(e){return e.key},edgeSource:function(e){return e.value.source},edgeTarget:function(e){return e.value.target}},e),i={},u={},c={},l=a.nodeCrossfilter.dimension(a.nodeKey),s=a.edgeCrossfilter&&a.edgeCrossfilter.dimension(a.edgeRawKey);r();return{get_degree:function(e){return o(e).length},get_edges:function(e){return o(e)},expand:function(e){i[e]=!0,r(),n.redrawAll()},expandedNodes:function(e){return arguments.length?(i=e,r(),n.redrawAll(),this):i},collapsibles:function(e,n){var r=Object.assign({},i);delete r[e];var o=t(i),u=t(r),c=Object.keys(o).filter(function(e){return!u[e]}).reduce(function(e,t){return e[t]=!0,e},{});return{nodes:c,edges:a.edgeGroup.all().filter(function(e){return c[a.edgeSource(e)]||c[a.edgeTarget(e)]}).reduce(function(e,t){return e[a.edgeKey(t)]=!0,e},{})}},collapse:function(e,t){delete i[e],r(),n.redrawAll()},hideNode:function(e){u[e]=!0,this.collapse(e)},hideEdge:function(e){a.edgeCrossfilter||console.warn("expanded_hidden needs edgeCrossfilter to hide edges"),c[e]=!0,r(),n.redrawAll()}}},$.draw_graphs=function(t){function n(){var e=E.filter(function(e){return e.source&&e.target}),t=k.selectAll("line.hint-edge").data(e);t.exit().remove(),t.enter().append("line").attr("class","hint-edge").style({fill:"none",stroke:"black","pointer-events":"none"}),t.attr({x1:function(e){return e.source.x},y1:function(e){return e.source.y},x2:function(e){return e.target.x},y2:function(e){return e.target.y}})}function r(e){var t=S.parent().portStyle(S.parent().portStyleName.eval(e)).portPosition(e);return t.x+=e.node.cola.x,t.y+=e.node.cola.y,t}function o(){var e;e=l?S.usePorts()?[r(l)]:[{x:l.node.cola.x,y:l.node.cola.y}]:[];var t=S.crossSize(),n=S.crossWidth(),o=k.selectAll("polygon.graph-draw-crossout").data(e);o.exit().remove(),o.enter().append("polygon").attr("class","graph-draw-crossout"),o.attr("points",function(e){var r=e.x,o=e.y;return[[r-t/2,o+t/2],[r-t/2+n,o+t/2],[r,o+n/2],[r+t/2-n,o+t/2],[r+t/2,o+t/2],[r+n/2,o],[r+t/2,o-t/2],[r+t/2-n,o-t/2],[r,o-n/2],[r-t/2+n,o-t/2],[r-t/2,o-t/2],[r-n/2,o]].map(function(e){return e.join(",")}).join(" ")})}function a(){E=[],w=!1,_=b=null,n()}function i(e,t,n){if(!S.nodeCrossfilter())throw new Error("need nodeCrossfilter");var r,o=S.addNode()||v;n?r=n:((r={})[g]=u(),r[m]=""),t&&f.new_node(r[g],r,{x:t[0],y:t[1]}),o(r).then(function(t){t&&(S.nodeCrossfilter().add([t]),e.redrawGroup(),s.set_changed([t[g]]))})}function c(n){var r;if(!(1&e.event.buttons))return l=null,S.conduct().cancelDragEdge&&S.conduct().cancelDragEdge(_),a(),o(),!0;if(!_.started&&Math.hypot(n[0]-E[0].source.x,n[1]-E[0].source.y)>S.dragSize()&&S.conduct().startDragEdge){if(!S.conduct().startDragEdge(_))return S.conduct().invalidSourceMessage&&(r=S.conduct().invalidSourceMessage(_),console.log(r),t.negativeTip&&t.negativeTip.content(function(e,t){t(r)}).displayTip(S.usePorts()?_.port:_.node)),a(),!0;_.started=!0}return!1}var l,s=$.select_things_group(t.select_nodes_group||"select-nodes-group","select-nodes"),d=$.select_things_group(t.select_edges_group||"select-edges-group","select-edges"),f=($.label_things_group("label-nodes-group","label-nodes"),$.label_things_group("label-edges-group","label-edges"),$.fix_nodes_group("fix-nodes-group")),g=t.idTag||"id",h=t.edgeIdTag||g,p=t.sourceTag||"source",y=t.targetTag||"target",m=t.labelTag||"label",x=t.edgeLabelTag||m,_=null,b=null,w=!1,k=null,E=[],S=$.behavior("highlight-paths",{add_behavior:function(g,m,K,A){var T=g.child("select-nodes");T&&S.clickCreatesNodes()&&T.clickBackgroundClears(!1),m.on("mousedown.draw-graphs",function(n){if(e.event.stopPropagation(),S.dragCreatesEdges())if(t.tipsDisable&&t.tipsDisable.forEach(function(e){e.hideTip().disabled(!0)}),S.usePorts()){var o;if(!(o="object"==typeof S.usePorts()&&S.usePorts().eventPort?S.usePorts().eventPort():g.getPort(g.nodeKey.eval(n),null,"out")||g.getPort(g.nodeKey.eval(n),null,"in")))return;_={node:n,port:o},E=[{source:r(o)}]}else E=[{source:{x:(_={node:n}).node.cola.x,y:_.node.cola.y}}]}).on("mousemove.draw-graphs",function(a){var i;if(e.event.stopPropagation(),_){var u=$.event_coords(g);if(c(u))return;var s=b;if(a===_.node)S.conduct().invalidTargetMessage&&console.log(S.conduct().invalidTargetMessage(_,_)),b=null,E[0].target=null;else if(S.usePorts()){var d;d="object"==typeof S.usePorts()&&S.usePorts().eventPort?S.usePorts().eventPort():g.getPort(g.nodeKey.eval(a),null,"in")||g.getPort(g.nodeKey.eval(a),null,"out"),b=d?{node:a,port:d}:null}else b&&a===b.node||(b={node:a});if(S.conduct().changeDragTarget){(S.usePorts()?(s&&s.port)!==(b&&b.port):(s&&s.node)!==(b&&b.node))&&(S.conduct().changeDragTarget(_,b)?(l=null,t.negativeTip&&t.negativeTip.hideTip(),i=S.conduct().validTargetMessage&&S.conduct().validTargetMessage()||"matches",t.positiveTip&&t.positiveTip.content(function(e,t){t(i)}).displayTip(S.usePorts()?b.port:b.node),w=!0):(l=S.usePorts()?b&&b.port:b&&b.node,b&&S.conduct().invalidTargetMessage&&(t.positiveTip&&t.positiveTip.hideTip(),i=S.conduct().invalidTargetMessage(_,b),console.log(i),t.negativeTip&&t.negativeTip.content(function(e,t){t(i)}).displayTip(S.usePorts()?b.port:b.node)),w=!1))}else w=!0;b?b.port?E[0].target=r(d):E[0].target={x:a.cola.x,y:a.cola.y}:E[0].target={x:u[0],y:u[1]},n(),o()}}).on("mouseup.draw-graphs",function(e){if(l=null,t.negativeTip&&t.negativeTip.hideTip(!0),t.positiveTip&&t.positiveTip.hideTip(!0),t.tipsDisable&&t.tipsDisable.forEach(function(e){e.disabled(!1)}),_&&w){var n;n=S.conduct().finishDragEdge?S.conduct().finishDragEdge(_,b):Promise.resolve(!0);var r=_,i=b;n.then(function(e){e&&function(e,t,n){if(!S.edgeCrossfilter())throw new Error("need edgeCrossfilter");var r={},o=S.addEdge()||v;if(r[h]=u(),r[x]="",S.conduct().detectReversedEdge&&S.conduct().detectReversedEdge(r,t.port,n.port)){r[p]=n.node.orig.key,r[y]=t.node.orig.key;var a;a=t,t=n,n=a}else r[p]=t.node.orig.key,r[y]=n.node.orig.key;o(r,t.port,n.port).then(function(t){t&&(f.new_edge(r[h],t[p],t[y]),S.edgeCrossfilter().add([t]),s.set_changed([],!1),d.set_changed([t[h]],!1),e.redrawGroup())})}(g,r,i)})}else _&&S.conduct().cancelDragEdge&&S.conduct().cancelDragEdge(_);a(),o()}),g.svg().on("mousedown.draw-graphs",function(){_=null}).on("mousemove.draw-graphs",function(){if(_){var e=$.event_coords(g);if(l=null,c(e))return;S.conduct().dragCanvas&&S.conduct().dragCanvas(_,e),S.conduct().changeDragTarget&&b&&S.conduct().changeDragTarget(_,null),b=null,E[0].target={x:e[0],y:e[1]},n(),o()}}).on("mouseup.draw-graphs",function(){l=null,t.negativeTip&&t.negativeTip.hideTip(!0),t.positiveTip&&t.positiveTip.hideTip(!0),t.tipsDisable&&t.tipsDisable.forEach(function(e){e.disabled(!1)}),_?(S.conduct().cancelDragEdge&&S.conduct().cancelDragEdge(_),a()):e.event.target===this&&S.clickCreatesNodes()&&i(g,$.event_coords(g)),o()}),k||(k=g.g().append("g").attr("class","draw-graphs"))},remove_behavior:function(e,t,n,r){t.on("mousedown.draw-graphs",null).on("mousemove.draw-graphs",null).on("mouseup.draw-graphs",null),e.svg().on("mousedown.draw-graphs",null).on("mousemove.draw-graphs",null).on("mouseup.draw-graphs",null)}});return S.nodeCrossfilter=J(t.nodeCrossfilter),S.edgeCrossfilter=J(t.edgeCrossfilter),S.usePorts=J(null),S.clickCreatesNodes=J(!0),S.dragCreatesEdges=J(!0),S.dragSize=J(5),S.crossSize=J(15),S.crossWidth=J(5),S.conduct=J({}),S.addNode=J(null),S.addEdge=J(null),S.createNode=function(e,t){i(S.parent(),e,t)},S},$.match_ports=function(e,t){function n(t,n){return t.map(function(t){return t.state=n,e.portNodeKey.eval(t)})}function r(r){var o=n(c,"small");r.port.state="small",o.push(e.portNodeKey.eval(r.port)),t.animateNodes(o)}function o(e,t){return u.some(function(n){return e.edges.indexOf(n)>=0&&t.edges.indexOf(n)>=0})}function a(e,t){return(l.allowParallel()||!o(e,t))&&l.isValid()(e,t)}var i,u,c;e.on("data.match-ports",function(e,t,n,r,o,a,c){a,i=c,u=o}),e.on("transitionsStarted",function(){t.enableHover(!0)});var l={isValid:J(function(e,t){return t!==e&&t.name===e.name}),whyInvalid:J(function(e,t){return t===e?"can't connect port to itself":t.name!==e.name&&"must connect ports of the same type"}),allowParallel:J(!1),hoverPort:function(e){if(e){if((c=i.filter(a.bind(null,e))).length)return n(c,"shimmer-medium")}else if(c)return n(c,"small");return null},startDragEdge:function(r){var o=n(c=i.filter(a.bind(null,r.port)),"shimmer");return c.length&&(t.enableHover(!1),r.port.state="large",o.push(e.portNodeKey.eval(r.port)),t.animateNodes(o)),console.log("valid targets",o),0!==c.length},invalidSourceMessage:function(e){return"no valid matches for this port"},changeDragTarget:function(e,r){var o,i,u=r&&a(e.port,r.port);return u?(o=n(c,"small"),r.port.state="large"):(o=n(c,"small"),i=t.animateNodes(o),o=n(c,"shimmer")),t.animateNodes(o,i),u},validTargetMessage:function(e,t){return"it's a match!"},invalidTargetMessage:function(e,t){return function(e,t){return!l.allowParallel()&&o(e,t)?"can't connect two edges between the same two ports":l.whyInvalid()(e,t)}(e.port,t.port)},finishDragEdge:function(e,n){return t.enableHover(!0),r(e),Promise.resolve(a(e.port,n.port))},cancelDragEdge:function(e){return t.enableHover(!0),r(e),!0}};return l},$.match_opposites=function(t,n,r){function o(e){return{x:e.node.cola.x+e.pos.x,y:e.node.cola.y+e.pos.y}}function a(e,t){return(f.allowParallel()||!c.some(function(n){return e.edges.indexOf(n)>=0&&t.edges.indexOf(n)>=0}))&&f.isValid()(e,t)}function i(e,t){t.forEach(function(e){e.edges.forEach(function(e){e.deleting=0})}),e&&e.port.edges.forEach(function(e){e.deleting=0})}r=Object.assign({multiplier:2,ease:e.ease("cubic")},r);var u,c,l;t.cascade(100,!0,d(function(e){return r.ease(e.deleting||0)},n,s)),t.on("data.match-opposites",function(e,t,n,r,o,a,i){a,u=i,c=o});var f={isValid:J(function(e,n){return"in"===t.portName.eval(e)^"in"===t.portName.eval(n)}),allowParallel:J(!1),hoverPort:function(e){},startDragEdge:function(e){return l=u.filter(a.bind(null,e.port)),console.log("valid targets",l.map(t.portNodeKey.eval)),0!==l.length},dragCanvas:function(e,n){var a=l.map(function(e){var t=o(e);return{distance:Math.hypot(n[0]-t.x,n[1]-t.y),port:e}}).sort(function(e,t){return e.distance-t.distance}),i=o(a[0].port),u=o(e.port);a.forEach(function(e){e.port.edges.forEach(function(t){t.deleting=1-r.multiplier*e.distance/Math.hypot(i.x-u.x,i.y-u.y)})}),e.port.edges.forEach(function(e){e.deleting=1-r.multiplier*a[0].distance/Math.hypot(i.x-u.x,i.y-u.y)}),t.requestRefresh(0)},changeDragTarget:function(e,n){var r=n&&a(e.port,n.port);return r&&(n.port.edges.forEach(function(e){e.deleting=1}),e.port.edges.forEach(function(e){e.deleting=1}),i(null,l.filter(function(e){return e!==n.port})),t.requestRefresh(0)),r},finishDragEdge:function(e,n){if(a(e.port,n.port)){if(i(null,l.filter(function(e){return e!==n.port})),r.delete_edges){var o=e.port.edges.map(t.edgeKey.eval).concat(n.port.edges.map(t.edgeKey.eval));return r.delete_edges.deleteSelection(o)}return Promise.resolve(!0)}return i(e,l),Promise.resolve(!1)},cancelDragEdge:function(e){return i(e,l),!0},detectReversedEdge:function(e,n,r){return"in"===t.portName.eval(n)}};return f},$.wildcard_ports=function(e){function t(e,t){if(!r)return[];var n=r.nodeKey.eval(e),o=i(t),a=(l(e)||[]).find(function(e){return e.includes(o)});return a?a.filter(function(e){return e!==o}).map(function(e){return r.getPort(n,null,e)}):[]}function n(e){return e.every(function(e){return 0===e.edges.length})}var r=e.diagram,o=e.get_type||function(e){return e.orig.value.type},a=e.set_type||function(e,t){e.orig.value.type=t.orig.value.type},i=e.get_name||function(e){return e.orig.value.name},u=e.is_wild||function(e){return e.orig.value.wild},c=e.update_ports||function(){},l=e.get_linked||function(){return[]};return{isValid:function(e,t){return null===o(e)^null===o(t)||null!==o(e)&&o(e)===o(t)},whyInvalid:function(e,t){return null===o(e)&&null===o(t)?"can't connect wildcard to wildcard":o(e)!==o(t)&&"the types of ports must match"},copyLinked:function(e,n){t(e,n).forEach(function(e){a(e,n)})},copyType:function(e,t,n){return null===o(t)?(a(t,n),this.copyLinked(t.node,t),c()):null===o(n)&&(a(n,t),this.copyLinked(n.node,n),c()),Promise.resolve(e)},resetTypes:function(e){var o=r;return 2===arguments.length&&(o=arguments[0],e=arguments[1]),e.forEach(function(e){var r=o.getWholeEdge(e),i=o.edgeSourcePortName.eval(r),l=o.edgeTargetPortName.eval(r),s=!1,d=o.getPort(o.nodeKey.eval(r.source),null,i),f=t(r.source,d);u(d)&&1===d.edges.length&&n(f)&&(a(d,null),f.forEach(function(e){a(e,null),s=!0})),d=o.getPort(o.nodeKey.eval(r.target),null,l),f=t(r.target,d),u(d)&&1===d.edges.length&&n(f)&&(a(d,null),f.forEach(function(e){a(e,null),s=!0})),s&&c()}),Promise.resolve(e)}}},$.symbol_port_style=function(){function t(e){return e.named?e.name:v.parent().edgeKey.eval(e.edges[0])}function n(e){var t=v.color.eval(e);return t?v.colorScale()?v.colorScale()(t):t:"none"}function r(e){var t=v.portPosition(e);return"translate("+t.x+","+t.y+")"}function a(t){v.symbolScale()||v.symbolScale(e.scale.ordinal().range(e.shuffle(v.content().enum())));var n=v.symbol.eval(t);return n&&(v.symbolScale()?v.symbolScale()(n):n)}function i(e){return e.vec[0]<0}function u(e){switch(e.state){case"large":return v.largeRadius.eval(e);case"medium":return v.mediumRadius.eval(e);case"small":default:return v.smallRadius.eval(e)}}function l(e){return/-medium$/.test(e.state)?v.mediumRadius.eval(e):v.largeRadius.eval(e)}function s(e){var t,n;return v.outlineFill.eval(e)?(t=v.outlineFillScale()||o,n=v.outlineFill.eval(e)):(t=v.parent().nodeFillScale()||o,n=v.parent().nodeFill.eval(e.node)),"none"===n?"none":t(n)}function d(e){return v.outlineStroke.eval(e)||v.parent().nodeStroke.eval(e.node)}function f(e){var t=v.outlineStrokeWidth.eval(e);return"number"==typeof t?t:v.parent().nodeStrokeWidth.eval(e.node)}var g,p,y,v={};return v.symbolScale=J(null),v.colorScale=J(e.scale.ordinal().range(e.shuffle(["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]))),v.symbol=v.portSymbol=J(t,!1),v.color=v.portColor=J(t,!1),v.outline=J($.symbol_port_style.outline.circle()),v.content=J($.symbol_port_style.content.d3symbol()),v.smallRadius=v.portRadius=J(7),v.mediumRadius=v.portHoverNodeRadius=J(10),v.largeRadius=v.portHoverPortRadius=J(14),v.displacement=v.portDisplacement=J(2),v.outlineFillScale=v.portBackgroundScale=J(null),v.outlineFill=v.portBackgroundFill=J(null),v.outlineStroke=v.portBackgroundStroke=J(null),v.outlineStrokeWidth=v.portBackgroundStrokeWidth=J(null),v.padding=v.portPadding=J(2),v.label=v.portLabel=v.portText=J(function(e){return e.name}),v.portLabelPadding=J({x:5,y:5}),v.cascade=h(v),v.portPosition=function(e){var t=Math.hypot(e.pos.x,e.pos.y),n=e.pos.x/t,r=e.pos.y/t,o=v.displacement.eval(e);return{x:e.pos.x+o*n,y:e.pos.y+o*r}},v.animateNodes=function(t,n){function r(){var e=d.transition().duration(1e3).ease("bounce");e.selectAll(".port-outline").call(v.outline().draw(function(e){return l(e)+v.portPadding.eval(e)})),e.selectAll(".port-symbol").call(v.content().draw(a,l));var t=e.transition().duration(1e3).ease("sin");t.selectAll(".port-outline").call(v.outline().draw(function(e){return v.smallRadius.eval(e)+v.portPadding.eval(e)})),t.selectAll(".port-symbol").call(v.content().draw(a,v.smallRadius.eval)),t.each("end",r)}function o(e){return"large"===e.state||"medium"===e.state}var i=e.set(t),c=p.filter(function(e){return i.has(v.parent().nodeKey.eval(e))}),s=v.parent().selectNodePortsOfStyle(c,v.parent().portStyle.nameOf(this)),d=s.filter(function(e){return/^shimmer/.test(e.state)}),f=s.filter(function(e){return!/^shimmer/.test(e.state)});d.size()&&(n?n.each("end",r):r());var h=f.transition().duration(250);return h.selectAll(".port-outline").call(v.outline().draw(function(e){return u(e)+v.portPadding.eval(e)})),h.selectAll(".port-symbol").call(v.content().draw(a,u)),h.selectAll("text.port-label").attr({opacity:function(e){return o(e)?1:0},"pointer-events":function(e){return o(e)?"auto":"none"}}),h.selectAll("rect.port-label-background").attr("opacity",function(e){return o(e)?1:0}),p.filter(function(e){var t=g[v.parent().nodeKey.eval(e)];return t&&t.some(o)}).each(function(){this.parentNode.appendChild(this)}),s.filter(function(e){return"small"!==e.state}).each(function(){this.parentNode.appendChild(this)}),h},v.eventPort=function(){var t=e.select(e.event.target.parentNode);return"g"===e.event.target.parentNode.tagName&&t.classed("port")?t.datum():null},v.drawPorts=function(e,o,u){g=o,p=u;var l=e.data(function(e){return o[v.parent().nodeKey.eval(e)]||[]},t);l.exit().remove();var h=l.enter().append("g").attr({class:"port",transform:r});l.transition("port-position").duration(v.parent().stagedDuration()).delay(v.parent().stagedDelay(!1)).attr({transform:r});var y=l.selectAll(".port-outline").data(function(e){return"none"!==s(e)?[e]:[]});y.exit().remove();var m=y.enter().append(v.outline().tag()).attr({class:"port-outline",fill:s,"stroke-width":f,stroke:d});v.outline().init&&m.call(v.outline().init),m.call(v.outline().draw(function(e){return v.smallRadius.eval(e)+v.portPadding.eval(e)})),y.attr({fill:s,"stroke-width":f,stroke:d}),y.transition().duration(v.parent().stagedDuration()).delay(v.parent().stagedDelay(!1)).call(v.outline().draw(function(e){return v.smallRadius.eval(e)+v.portPadding.eval(e)}));h.append(v.content().tag()).attr("class","port-symbol").call(v.content().draw(a,v.smallRadius.eval));var x=l.select(".port-symbol");x.attr("fill",n),x.transition().duration(v.parent().stagedDuration()).delay(v.parent().stagedDelay(!1)).call(v.content().draw(a,v.smallRadius.eval));var _=l.selectAll("text.port-label").data(function(e){return v.portLabel.eval(e)?[e]:[]});_.exit().remove();var b=_.enter();return b.append("rect").attr({class:"port-label-background","pointer-events":"none"}),b.append("text").attr({class:"port-label","dominant-baseline":"middle","pointer-events":"none",cursor:"default",opacity:0}),_.each(function(e){e.offset=(i(e)?-1:1)*(v.largeRadius.eval(e)+v.portPadding.eval(e))}).attr({"text-anchor":function(e){return i(e)?"end":"start"},transform:function(e){return"translate("+e.offset+",0)"}}).text(v.portLabel.eval).each(function(e){e.bbox=c(this)}),l.selectAll("rect.port-label-background").attr({x:function(e){return(e.offset<0?e.offset-e.bbox.width:e.offset)-v.portLabelPadding.eval(e).x},y:function(e){return-e.bbox.height/2-v.portLabelPadding.eval(e).y},width:function(e){return e.bbox.width+2*v.portLabelPadding.eval(e).x},height:function(e){return e.bbox.height+2*v.portLabelPadding.eval(e).y},fill:"white",opacity:0}),v},v.enableHover=function(e){if(!y&&v.parent()){var t=v.parent().child("draw-graphs");t&&(y=t.conduct())}var n="grow-ports-"+v.parent().portStyle.nameOf(this);return e?(p.on("mouseover."+n,function(e){var t=v.parent().nodeKey.eval(e),n=v.eventPort();g[t]&&g[t].forEach(function(e){e.state=e===n?"large":n?"small":"medium"});var r=y&&y.hoverPort(n)||[];r.push(t),v.animateNodes(r)}),p.on("mouseout."+n,function(e){var t=v.parent().nodeKey.eval(e);g[t]&&g[t].forEach(function(e){e.state="small"});var n=y&&y.hoverPort(null)||[];n.push(t),v.animateNodes(n)})):(p.on("mouseover."+n,null),p.on("mouseout."+n,null)),v},v.parent=J(null),v},$.symbol_port_style.outline={},$.symbol_port_style.outline.circle=function(){return{tag:function(){return"circle"},draw:function(e){return function(t){t.attr("r",function(t){return e(t)})}}}},$.symbol_port_style.outline.square=function(){return{tag:function(){return"rect"},init:function(e){},draw:function(e){return function(t){t.attr({x:function(t){return-e(t)},y:function(t){return-e(t)},width:function(t){return 2*e(t)},height:function(t){return 2*e(t)}})}}}},$.symbol_port_style.outline.arrow=function(){var e=.75-Math.PI/8,t={tag:function(){return"path"},init:function(e){},draw:function(n){return function(r){r.attr("d",function(r){var o=n(r);return!t.outie()||t.outie()(r.orig)?"M"+-e*o+","+-o+" h"+o+" l"+o+","+o+" l"+-o+","+o+" h"+-o+" a"+o+","+o+" 0 1,1 0,"+-2*o:"M"+-(2-e)*o+","+-o+" h"+2*o+" a"+o+","+o+" 0 1,1 0,"+2*o+" h"+-2*o+" l"+o+","+-o+" l"+-o+","+-o})}},outie:J(null)};return t},$.symbol_port_style.content={},$.symbol_port_style.content.d3symbol=function(){return{tag:function(){return"path"},enum:function(){return e.svg.symbolTypes},draw:function(t,n){return function(r){r.attr("d",function(r){var o=t(r),a=n(r);return o?e.svg.symbol().type(o).size(a*a)():""}),r.attr("transform",function(e){switch(t(e)){case"triangle-up":return"translate(0, -1)";case"triangle-down":return"translate(0, 1)";default:return null}})}}}},$.symbol_port_style.content.letter=function(){return{tag:function(){return"text"},enum:function(){return e.range(65,91).map(String.fromCharCode)},draw:function(e,t){return function(n){n.text(e).attr({"dominant-baseline":"middle","text-anchor":"middle"}),n.each(function(e){e.symbol_size||(e.symbol_size=c(this))}),n.attr("transform",function(e){return"scale("+2*t(e)/e.symbol_size.height+") translate("+[0,2].join(",")+")"})}}}},$.load_graph=function(){function t(e){return e?e.replace(/\?.*/,""):null}var n,r,o;if(n=arguments[0],3===arguments.length)r=arguments[1],o=arguments[2];else{if(2!==arguments.length)throw new Error("need two or three arguments");o=arguments[1]}r?queue().defer(e.json,n).defer(e.json,r).await(function(e,t,n){e?o(e,null):o(null,{nodes:t.results,edges:n.results})}):/\.json$/.test(t(n))?e.json(n,o):/\.gv|\.dot$/.test(t(n))?e.text(n,function(e,t,n){if(t)e(t,null);else{var r,o;if(graphlibDot.parse){var a=graphlibDot.parse(n),i=a.nodes();r=new Array(i.length),i.forEach(function(e,t){var n=r[t]=a._nodes[i[t]];n.id=t,n.name=e});var u=a.edges();o=[],u.forEach(function(e){var t=a._edges[e];o.push(Object.assign({},t.value,{source:a._nodes[t.u].id,target:a._nodes[t.v].id,sourcename:t.u,targetname:t.v}))})}else a=graphlibDot.read(n),i=a.nodes(),r=new Array(i.length),i.forEach(function(e,t){var n=r[t]=a._nodes[i[t]];n.id=t,n.name=e}),o=[],a.edges().forEach(function(e){o.push(Object.assign({},e.value,{source:a._nodes[e.v].id,target:a._nodes[e.w].id,sourcename:e.v,targetname:e.w}))});e(null,{nodes:r,links:o})}}.bind(null,o)):/\.psv$/.test(t(n))?e.dsv("|","text/plain")(n,V.bind(null,o)):/\.csv$/.test(t(n))&&e.csv(n,V.bind(null,o))},$.munge_graph=function(e,t,n,r){function o(e,t){return t.filter(function(t){return!!e[t]})}var a,i,u=t||"name",c=n||"sourcename",l=r||"targetname";if(!Z(e)){var s=["database","response"],d=s.findIndex(function(t){return e[t]&&Z(e[t])});if(d<0)throw new Error("couldn't find the data!");e=e[s[d]]}i=e.edges||e.links,a=e.nodes||e.vertices;var f=i[0];if(void 0===f[c]){var g=n?[n]:["source_ecomp_uid","node1","source","tail"],h=r?[r]:["target_ecomp_uid","node2","target","head"],p=["edge"];if(f.node0&&f.node1)c="node0",l="node1";else{var y=o(f,g);if(!y.length){if((d=p.findIndex(function(e){return f[e]&&o(f[e],g).length}))<0)throw n?new Error("sourceattr "+c+" didn't work"):new Error("didn't find any source attr");i=i.map(function(e){return e[p[d]]}),y=o(f=i[0],g)}if(y.length>1&&console.warn("found more than one possible source attr",y),c=y[0],!(y=o(f,h)).length)throw r&&!f[r]?new Error("targetattr "+l+" didn't work"):new Error("didn't find any target attr");y.length>1&&console.warn("found more than one possible target attr",y),l=y[0]}}var v=a[0];if(void 0===v[u]){var m=t?[t]:["ecomp_uid","id","_id"],x=["vertex"];if(!(y=o(v,m)).length){if((d=x.findIndex(function(e){return v[e]&&o(v[e],m).length}))<0)throw t?new Error("nodekeyattr "+u+" didn't work"):new Error("couldn't find the node data");a=a.map(function(e){return e[x[d]]}),y=o(v=a[0],m)}y.length>1&&console.warn("found more than one possible node key attr",y),u=y[0]}return{nodes:a,edges:i,nodekeyattr:u,sourceattr:c,targetattr:l}},$.flat_group=function(){function e(e,t){var r=e.dimension(t);return{crossfilter:e,dimension:r,group:function(e){return{all:function(){return e.all().filter(function(e){return null!==e.value})}}}(r.group().reduce(n.add,n.remove,n.init))}}var n={add:function(e,t){return t},remove:function(){return null},init:function(){return null}};return{make:function(n,r){return e(t(n),r)},another:function(t,n){return e(t,n)}}}();var ce=function(e,t,r,o,a,i){if(a=a||0,t.length>(r.valuesByAttr?1:0)){var c=t.shift(),l=[],s=[],d=e.map(function(e){var n=e[r.nestKey],d=r.nestKeysUnique?n:u();if(d){var f;if(r.ancestorKeys?(i=i||{},c&&(i[c]=n),f=Object.assign({},i)):f={},f[r.nodeKey]=d,r.label&&r.labelFun&&(f[r.label]=r.labelFun(n,c,e)),r.level&&(f[r.level]=a+1),l.push(f),o){var g={};g[r.edgeSource]=o,g[r.edgeTarget]=d,s.push(g)}}var h=r.valuesByAttr?e[t[0]]:e.values;return ce(h,t.slice(0),r,d,a+1,Object.assign({},i))});return{nodes:Array.prototype.concat.apply(l,d.map(n.pluck("nodes"))),edges:Array.prototype.concat.apply(s,d.map(n.pluck("edges")))}}return{nodes:e.map(function(e){return e=Object.assign({},e),r.level&&(e[r.level]=a+1),e}),edges:e.map(function(e){var t={};return t[r.edgeSource]=o,t[r.edgeTarget]=e[r.nodeKey],t})}};$.convert_tree=function(e,t,n){return n=Object.assign({nodeKey:"key",edgeKey:"key",edgeSource:"sourcename",edgeTarget:"targetname",nestKey:"key"},n),Array.isArray(e)?ce(e,t,n,n.root,0,n.inherit):(t=[""].concat(t),ce([e],t,n,n.root,0,n.inherit))},$.convert_nest=function(e,t,n,r,o,a,i){return $.convert_tree(e,t,{nodeKey:n,edgeSource:r,edgeTarget:o,root:a,inherit:i,ancestorKeys:!0,label:"name",labelFun:function(e,t,n){return t+":"+e},level:"_level"})},$.convert_adjacency_list=function(e,t,n){return{nodes:e,edges:Array.prototype.concat.apply([],e.map(function(e){return e[t.adjacencies].map(function(r){var o={};return n.edgeKey&&(o[n.edgeKey]=u()),o[n.edgeSource]=e[t.nodeKey],o[n.edgeTarget]=t.targetKey?r[t.targetKey]:r,n.adjacency&&(o[n.adjacency]=r),o})}))}},$.deparallelize=function(e,t,n){return{all:function(){var r={};e.all().forEach(function(e){var o=e.value[t],a=e.value[n],i=o<a,u=i?o:a,c=i?a:o;r[u]=r[u]||{};var l=r[u][c]=r[u][c]||{in:0,out:0,original:e};i?++l.in:++l.out});var o=[];return Object.keys(r).forEach(function(e){Object.keys(r[e]).forEach(function(a){var i=r[e][a];i[t]=e,i[n]=a,o.push({key:i.original.key,value:i})})}),o}}},$.path_reader=function(e){function t(e,t,n){u.elementList.eval(e).forEach(function(r){var o,a;switch(u.elementType.eval(r)){case"node":o=u.nodeKey.eval(r),a=t[o]=t[o]||[];break;case"edge":o=u.edgeSource.eval(r)+"-"+u.edgeTarget.eval(r),a=n[o]=n[o]||[]}a.push(e)})}var n,r,a,i=$.register_highlight_paths_group(e||"highlight-paths-group"),u={pathList:J(o,!1),timeRange:J(null,!1),pathStrength:J(null,!1),elementList:J(o,!1),elementType:J(null,!1),nodeKey:J(null,!1),edgeSource:J(null,!1),edgeTarget:J(null,!1),clear:function(){i.paths_changed({},{},[])},data:function(e){var o,c={},l={},s=[];u.pathList.eval(e).forEach(function(e){if(e._range=u.timeRange.eval(e)){if(!1===o)throw new Error("can't have a mix of ranged and non-ranged paths");o=!0}else{if(!0===o)throw new Error("can't have a mix of ranged and non-ranged paths");o=!1,t(e,c,l)}s.push(e)}),o?(n=s.map(function(e){var t=[e._range[0].getTime(),e._range[1].getTime()];return t.path=e,t}),r=lysenkoIntervalTree(n),a&&this.setTime(a)):(n=null,r=null,i.paths_changed(c,l,s))},getIntervals:function(){return n},setTime:function(e){if(e&&r){var n=[],o={},u={};r.queryPoint(e.getTime(),function(e){n.push(e.path),t(e.path,o,u)}),i.paths_changed(o,u,n)}a=e}};return u},$.path_selector=function(t,r,o,a){function i(e){return function(t){return!!e&&e.indexOf(t)>=0}}function u(e){var t=i(e);return function(e){return!t(e)}}function c(t,n){if(0!==n.length){f.attr("height",20*(n.length+1)).attr("width",30+46*(n.length/2+1)+20),f.selectAll(".path-selector").remove();var r=f.selectAll("g.path-selector").data(n);r.enter().append("g").attr("class","path-selector").attr("transform",function(e,t){return"translate(0, "+20*t+")"}).each(function(n,r){var o=n.element_list.filter(function(e){return"node"===e.element_type});e.select(this).append("line").attr("x1",60).attr("y1",9).attr("x2",30+30*o.length).attr("y2",9).attr("opacity",.4).attr("stroke-width",5).attr("stroke","#bdbdbd");e.select(this).selectAll("circle").data(o).enter().append("circle").attr("cx",function(e,t){return 30+30*(t+1)}).attr("cy",9).attr("r",8).attr("opacity",.4).attr("fill",function(e){var n={key:e.property_map.ecomp_uid,value:e.property_map};return t.nodeStroke()(n)});e.select(this).append("text").text("Path "+r).attr("class","path_label").attr("x",0).attr("y",13.6).on("mouseover",function(){d.hover_changed([n])}).on("mouseout",function(){d.hover_changed(null)}).on("click",function(){d.select_changed(function(e,t){return e?t?t.every(i(e))?e.filter(u(t)):e.concat(t.filter(u(e))):e:t}(p,[n]))})}),r.exit().transition(1e3).attr("opacity",0).remove()}}function l(){var t=i(h);f.selectAll("g.path-selector").each(function(n,r){var o=t(n)?"#e41a1c":"black",a=t(n)?"black":"#bdbdbd",i=t(n)?"1":"0.4";e.select(this).select(".path_label").attr("fill",o),e.select(this).selectAll("line").attr("stroke",a).attr("opacity",i),e.select(this).selectAll("circle").attr("opacity",i)})}function s(){var t=i(p);f.selectAll("g.path-selector").each(function(n,r){var o=t(n)?"bold":"normal",a=t(n)?"black":"#bdbdbd",i=t(n)?"1":"0.4";e.select(this).select(".path_label").attr("font-weight",o),e.select(this).selectAll("line").attr("stroke",a).attr("opacity",i),e.select(this).selectAll("circle").attr("opacity",i)})}var d=$.register_highlight_paths_group(o||"highlight-paths-group"),f=e.select(t).append("svg"),g=[],h=null,p=null;d.on("paths_changed.selector",function(e,t,n){h=p=null,g=n,y.redraw()}).on("hover_changed.selector",function(e){h=e,l()}).on("select_changed.selector",function(e){p=e,s()});var y={default_text:J("Nothing here"),zero_text:J("No paths"),error_text:J(null),queried:J(!1),redraw:function(){c(diagram,g),l(),s()},render:function(){return this.redraw(),this}};return n.registerChart(y,a),y},$.node_name=function(e){if(e<26)return String.fromCharCode(97+e);if(e<52)return String.fromCharCode(65+e-26);if(e<2704)return $.node_name(Math.floor(e/52))+$.node_name(e%52);throw new Error("no, that's too large")},$.node_object=function(e,t){return t=t||{},_.extend({id:e,name:$.node_name(e)},t)},$.edge_object=function(e,t,n,r){return r=r||{},_.extend({source:t,target:n,sourcename:e(t),targetname:e(n)},r)},$.generate=function(e,t,n,r){var o,a,i,u,c=n.nodePrefix||"",l=function(e){return o[e].name},s=t[0],d=n.linkLength||30;switch(e){case"clique":case"cliquestf":for(o=new Array(s),a=[],i=0;i<s;++i)for(o[i]=$.node_object(i,{circle:"A",name:c+$.node_name(i)}),u=0;u<i;++u)a.push($.edge_object(l,i,u,{notLayout:!0,undirected:!0}));if("cliquestf"===e)for(i=0;i<s;++i)o[i+s]=$.node_object(i+s),o[i+2*s]=$.node_object(i+2*s),a.push($.edge_object(l,i,i+s,{undirected:!0})),a.push($.edge_object(l,i,i+2*s,{undirected:!0}));break;case"wheel":for(o=new Array(s),i=0;i<s;++i)o[i]=$.node_object(i,{name:c+$.node_name(i)});var f=(a=$.wheel_edges(l,_.range(s),s*d/2))[0].distance;for(i=0;i<t[1];++i)for(u=0;u<s;++u){var g,h=u,p=(u+1)%s;i%2==1&&(g=h,h=p,p=g),a.push($.edge_object(l,h,p,{distance:f,par:i+2}))}break;default:throw new Error("unknown generation type "+e)}r(null,{nodes:o,links:a})},$.wheel_edges=function(e,t,n){for(var r=t.length,o=[],a=Math.floor(r/2),i=2*n*Math.sin(Math.PI/r),u=2*n*Math.sin(a*Math.PI/r),c=0;c<r;++c)o.push($.edge_object(e,t[c],t[(c+1)%r],{distance:i}));for(c=0;c<r/2;++c)o.push($.edge_object(e,t[c],t[(c+a)%r],{distance:u})),r%2&&c!=Math.floor(r/2)&&o.push($.edge_object(e,t[c],t[(c+r-a)%r],{distance:u}));return o},$.random_graph=function(e){function t(){var t={};return t[e.nodeKey]=e.nodeKeyGen(r.length),t[e.colorTag]=Math.floor(Math.random()*e.ncolors),r.push(t),t}function n(){return r[Math.floor(Math.random()*r.length)]}e=Object.assign({ncolors:5,ndashes:4,nodeKey:"key",edgeKey:"key",sourceKey:"sourcename",targetKey:"targetname",colorTag:"color",dashTag:"dash",nodeKeyGen:function(e){return"n"+e},edgeKeyGen:function(e){return"e"+e},newComponentProb:.1,newNodeProb:.9,removeEdgeProb:.75,log:!1},e),isNaN(e.newNodeProb)&&(e.newNodeProb=.9),e.newNodProb<=0&&(e.newNodeProb=.1);var r=[],o=[];return{nodes:function(){return r},edges:function(){return o},generate:function(a){for(;a-- >0;){var i,u,c=Math.random();if(i=!r.length||c<e.newComponentProb?t():n(),u=c<e.newNodeProb?t():n(),i&&u){var l={};l[e.edgeKey]=e.edgeKeyGen(o.length),l[e.sourceKey]=i[e.nodeKey],l[e.targetKey]=u[e.nodeKey],l[e.dashTag]=Math.floor(Math.random()*e.ndashes),e.log&&console.log(i[e.nodeKey]+" -> "+u[e.nodeKey]),o.push(l)}}},remove:function(t){for(;t-- >0;){if(Math.random()<e.removeEdgeProb)o.splice(Math.floor(Math.random()*o.length),1);else{var n=r[Math.floor(Math.random()*r.length)],a=[];o.forEach(function(t,r){t[e.sourceKey]!==n[e.nodeKey]&&t[e.targetKey]!==n[e.nodeKey]||a.push(r)}),a.reverse().forEach(function(e){o.splice(e,1)})}}}}};var le=function(e){return function(){console.warn(e)}}("dc_graph.line_breaks now takes a string - d.key behavior is deprecated and will be removed in a later version");return $.line_breaks=function(e,t){var n=new RegExp(e,"g");return function(e){"object"==typeof e&&(le(),e=e.key);var r,o,a="",i=[],u=0;do{o=(r=n.exec(e))?e.slice(u,n.lastIndex):e.slice(u),a.length+o.length>t&&a.length>0&&(i.push(a),a=""),a+=o,u=n.lastIndex}while(null!==r);return i.push(a),i}},$.build_type_graph=function(e,t,n,r,o,a){var i={},u={},c={};return e.forEach(function(e){i[n(e)]=e;var t=r(e);u[t]||(u[t]={type:t})}),t.forEach(function(e){var t,n,u=o(e),l=a(e);if(!(t=i[u]))throw new Error("source key "+u+" not found!");if(!(n=i[l]))throw new Error("target key "+l+" not found!");var s=r(t)+"/"+r(n);c[s]||(c[s]={type:s,source:r(t),target:r(n)})}),{nodes:Object.keys(u).map(function(e){return u[e]}),edges:Object.keys(c).map(function(e){return c[e]})}},$.d3=e,$.crossfilter=t,$.dc=n,$}if("function"==typeof define&&define.amd)define(["d3","crossfilter","dc"],e);else if("object"==typeof module&&module.exports){var t=require("d3"),n=require("crossfilter");"function"!=typeof n&&(n=n.crossfilter);var r=require("dc");module.exports=e(t,n,r)}else this.dc_graph=e(d3,crossfilter,dc)}();
//# sourceMappingURL=dc.graph.min.js.map